Compiled from "UpgradeServletInputStream.java"
public class io.undertow.servlet.spec.UpgradeServletInputStream extends jakarta.servlet.ServletInputStream {
  private final org.xnio.channels.StreamSourceChannel channel;

  private final io.undertow.connector.ByteBufferPool bufferPool;

  private final java.util.concurrent.Executor ioExecutor;

  private volatile jakarta.servlet.ReadListener listener;

  private static final int FLAG_READY;

  private static final int FLAG_CLOSED;

  private static final int FLAG_FINISHED;

  private static final int FLAG_ON_DATA_READ_CALLED;

  private int state;

  private io.undertow.connector.PooledByteBuffer pooled;

  public io.undertow.servlet.spec.UpgradeServletInputStream(org.xnio.channels.StreamSourceChannel, io.undertow.connector.ByteBufferPool, java.util.concurrent.Executor);
    Code:
       0: aload_0
       1: invokespecial #1                  // Method jakarta/servlet/ServletInputStream."<init>":()V
       4: aload_0
       5: aload_1
       6: putfield      #2                  // Field channel:Lorg/xnio/channels/StreamSourceChannel;
       9: aload_0
      10: aload_2
      11: putfield      #3                  // Field bufferPool:Lio/undertow/connector/ByteBufferPool;
      14: aload_0
      15: aload_3
      16: putfield      #4                  // Field ioExecutor:Ljava/util/concurrent/Executor;
      19: return

  public boolean isFinished();
    Code:
       0: aload_0
       1: getfield      #5                  // Field state:I
       4: iconst_4
       5: invokestatic  #7                  // Method org/xnio/Bits.anyAreSet:(II)Z
       8: ireturn

  public boolean isReady();
    Code:
       0: aload_0
       1: getfield      #5                  // Field state:I
       4: iconst_1
       5: invokestatic  #7                  // Method org/xnio/Bits.anyAreSet:(II)Z
       8: ifeq          22
      11: aload_0
      12: invokevirtual #8                  // Method isFinished:()Z
      15: ifne          22
      18: iconst_1
      19: goto          23
      22: iconst_0
      23: ireturn

  public void setReadListener(jakarta.servlet.ReadListener);
    Code:
       0: aload_1
       1: ifnonnull     13
       4: getstatic     #9                  // Field io/undertow/servlet/UndertowServletMessages.MESSAGES:Lio/undertow/servlet/UndertowServletMessages;
       7: invokeinterface #10,  1           // InterfaceMethod io/undertow/servlet/UndertowServletMessages.listenerCannotBeNull:()Ljava/lang/NullPointerException;
      12: athrow
      13: aload_0
      14: getfield      #11                 // Field listener:Ljakarta/servlet/ReadListener;
      17: ifnull        29
      20: getstatic     #9                  // Field io/undertow/servlet/UndertowServletMessages.MESSAGES:Lio/undertow/servlet/UndertowServletMessages;
      23: invokeinterface #12,  1           // InterfaceMethod io/undertow/servlet/UndertowServletMessages.listenerAlreadySet:()Ljava/lang/IllegalStateException;
      28: athrow
      29: aload_0
      30: aload_1
      31: putfield      #11                 // Field listener:Ljakarta/servlet/ReadListener;
      34: aload_0
      35: getfield      #2                  // Field channel:Lorg/xnio/channels/StreamSourceChannel;
      38: invokeinterface #13,  1           // InterfaceMethod org/xnio/channels/StreamSourceChannel.getReadSetter:()Lorg/xnio/ChannelListener$Setter;
      43: new           #14                 // class io/undertow/servlet/spec/UpgradeServletInputStream$ServletInputStreamChannelListener
      46: dup
      47: aload_0
      48: invokespecial #15                 // Method io/undertow/servlet/spec/UpgradeServletInputStream$ServletInputStreamChannelListener."<init>":(Lio/undertow/servlet/spec/UpgradeServletInputStream;)V
      51: invokeinterface #16,  2           // InterfaceMethod org/xnio/ChannelListener$Setter.set:(Lorg/xnio/ChannelListener;)V
      56: aload_0
      57: getfield      #4                  // Field ioExecutor:Ljava/util/concurrent/Executor;
      60: new           #17                 // class io/undertow/servlet/spec/UpgradeServletInputStream$1
      63: dup
      64: aload_0
      65: invokespecial #18                 // Method io/undertow/servlet/spec/UpgradeServletInputStream$1."<init>":(Lio/undertow/servlet/spec/UpgradeServletInputStream;)V
      68: invokeinterface #19,  2           // InterfaceMethod java/util/concurrent/Executor.execute:(Ljava/lang/Runnable;)V
      73: return

  public int read() throws java.io.IOException;
    Code:
       0: iconst_1
       1: newarray       byte
       3: astore_1
       4: aload_0
       5: aload_1
       6: invokevirtual #20                 // Method read:([B)I
       9: istore_2
      10: iload_2
      11: iconst_m1
      12: if_icmpne     17
      15: iconst_m1
      16: ireturn
      17: aload_1
      18: iconst_0
      19: baload
      20: sipush        255
      23: iand
      24: ireturn

  public int read(byte[]) throws java.io.IOException;
    Code:
       0: aload_0
       1: aload_1
       2: iconst_0
       3: aload_1
       4: arraylength
       5: invokevirtual #21                 // Method read:([BII)I
       8: ireturn

  public int read(byte[], int, int) throws java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #5                  // Field state:I
       4: iconst_2
       5: invokestatic  #7                  // Method org/xnio/Bits.anyAreSet:(II)Z
       8: ifeq          20
      11: getstatic     #9                  // Field io/undertow/servlet/UndertowServletMessages.MESSAGES:Lio/undertow/servlet/UndertowServletMessages;
      14: invokeinterface #22,  1           // InterfaceMethod io/undertow/servlet/UndertowServletMessages.streamIsClosed:()Ljava/io/IOException;
      19: athrow
      20: aload_0
      21: getfield      #11                 // Field listener:Ljakarta/servlet/ReadListener;
      24: ifnull        47
      27: aload_0
      28: getfield      #5                  // Field state:I
      31: iconst_1
      32: invokestatic  #23                 // Method org/xnio/Bits.anyAreClear:(II)Z
      35: ifeq          51
      38: getstatic     #9                  // Field io/undertow/servlet/UndertowServletMessages.MESSAGES:Lio/undertow/servlet/UndertowServletMessages;
      41: invokeinterface #24,  1           // InterfaceMethod io/undertow/servlet/UndertowServletMessages.streamNotReady:()Ljava/lang/IllegalStateException;
      46: athrow
      47: aload_0
      48: invokevirtual #25                 // Method readIntoBuffer:()V
      51: aload_0
      52: getfield      #5                  // Field state:I
      55: iconst_4
      56: invokestatic  #7                  // Method org/xnio/Bits.anyAreSet:(II)Z
      59: ifeq          64
      62: iconst_m1
      63: ireturn
      64: iload_3
      65: ifne          70
      68: iconst_0
      69: ireturn
      70: aload_0
      71: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      74: invokeinterface #27,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.getBuffer:()Ljava/nio/ByteBuffer;
      79: astore        4
      81: aload         4
      83: invokevirtual #28                 // Method java/nio/ByteBuffer.remaining:()I
      86: iload_3
      87: invokestatic  #29                 // Method java/lang/Math.min:(II)I
      90: istore        5
      92: aload         4
      94: aload_1
      95: iload_2
      96: iload         5
      98: invokevirtual #30                 // Method java/nio/ByteBuffer.get:([BII)Ljava/nio/ByteBuffer;
     101: pop
     102: aload         4
     104: invokevirtual #31                 // Method java/nio/ByteBuffer.hasRemaining:()Z
     107: ifne          135
     110: aload_0
     111: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
     114: invokeinterface #32,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.close:()V
     119: aload_0
     120: aconst_null
     121: putfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
     124: aload_0
     125: getfield      #11                 // Field listener:Ljakarta/servlet/ReadListener;
     128: ifnull        135
     131: aload_0
     132: invokevirtual #33                 // Method readIntoBufferNonBlocking:()V
     135: iload         5
     137: ireturn

  private void readIntoBuffer() throws java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
       4: ifnonnull     90
       7: aload_0
       8: getfield      #5                  // Field state:I
      11: iconst_4
      12: invokestatic  #7                  // Method org/xnio/Bits.anyAreSet:(II)Z
      15: ifne          90
      18: aload_0
      19: aload_0
      20: getfield      #3                  // Field bufferPool:Lio/undertow/connector/ByteBufferPool;
      23: invokeinterface #34,  1           // InterfaceMethod io/undertow/connector/ByteBufferPool.allocate:()Lio/undertow/connector/PooledByteBuffer;
      28: putfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      31: aload_0
      32: getfield      #2                  // Field channel:Lorg/xnio/channels/StreamSourceChannel;
      35: aload_0
      36: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      39: invokeinterface #27,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.getBuffer:()Ljava/nio/ByteBuffer;
      44: invokestatic  #35                 // Method org/xnio/channels/Channels.readBlocking:(Ljava/nio/channels/ReadableByteChannel;Ljava/nio/ByteBuffer;)I
      47: istore_1
      48: aload_0
      49: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      52: invokeinterface #27,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.getBuffer:()Ljava/nio/ByteBuffer;
      57: invokevirtual #36                 // Method java/nio/ByteBuffer.flip:()Ljava/nio/ByteBuffer;
      60: pop
      61: iload_1
      62: iconst_m1
      63: if_icmpne     90
      66: aload_0
      67: dup
      68: getfield      #5                  // Field state:I
      71: iconst_4
      72: ior
      73: putfield      #5                  // Field state:I
      76: aload_0
      77: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      80: invokeinterface #32,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.close:()V
      85: aload_0
      86: aconst_null
      87: putfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      90: return

  private void readIntoBufferNonBlocking() throws java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
       4: ifnonnull     279
       7: aload_0
       8: getfield      #5                  // Field state:I
      11: bipush        6
      13: invokestatic  #7                  // Method org/xnio/Bits.anyAreSet:(II)Z
      16: ifne          279
      19: aload_0
      20: aload_0
      21: getfield      #3                  // Field bufferPool:Lio/undertow/connector/ByteBufferPool;
      24: invokeinterface #34,  1           // InterfaceMethod io/undertow/connector/ByteBufferPool.allocate:()Lio/undertow/connector/PooledByteBuffer;
      29: putfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      32: aload_0
      33: getfield      #11                 // Field listener:Ljakarta/servlet/ReadListener;
      36: ifnonnull     122
      39: aload_0
      40: getfield      #2                  // Field channel:Lorg/xnio/channels/StreamSourceChannel;
      43: aload_0
      44: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      47: invokeinterface #27,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.getBuffer:()Ljava/nio/ByteBuffer;
      52: invokeinterface #37,  2           // InterfaceMethod org/xnio/channels/StreamSourceChannel.read:(Ljava/nio/ByteBuffer;)I
      57: istore_1
      58: iload_1
      59: ifne          77
      62: aload_0
      63: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      66: invokeinterface #32,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.close:()V
      71: aload_0
      72: aconst_null
      73: putfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      76: return
      77: aload_0
      78: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      81: invokeinterface #27,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.getBuffer:()Ljava/nio/ByteBuffer;
      86: invokevirtual #36                 // Method java/nio/ByteBuffer.flip:()Ljava/nio/ByteBuffer;
      89: pop
      90: iload_1
      91: iconst_m1
      92: if_icmpne     119
      95: aload_0
      96: dup
      97: getfield      #5                  // Field state:I
     100: iconst_4
     101: ior
     102: putfield      #5                  // Field state:I
     105: aload_0
     106: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
     109: invokeinterface #32,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.close:()V
     114: aload_0
     115: aconst_null
     116: putfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
     119: goto          279
     122: aload_0
     123: getfield      #5                  // Field state:I
     126: iconst_1
     127: invokestatic  #23                 // Method org/xnio/Bits.anyAreClear:(II)Z
     130: ifeq          142
     133: getstatic     #9                  // Field io/undertow/servlet/UndertowServletMessages.MESSAGES:Lio/undertow/servlet/UndertowServletMessages;
     136: invokeinterface #24,  1           // InterfaceMethod io/undertow/servlet/UndertowServletMessages.streamNotReady:()Ljava/lang/IllegalStateException;
     141: athrow
     142: aload_0
     143: getfield      #2                  // Field channel:Lorg/xnio/channels/StreamSourceChannel;
     146: aload_0
     147: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
     150: invokeinterface #27,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.getBuffer:()Ljava/nio/ByteBuffer;
     155: invokeinterface #37,  2           // InterfaceMethod org/xnio/channels/StreamSourceChannel.read:(Ljava/nio/ByteBuffer;)I
     160: istore_1
     161: aload_0
     162: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
     165: invokeinterface #27,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.getBuffer:()Ljava/nio/ByteBuffer;
     170: invokevirtual #36                 // Method java/nio/ByteBuffer.flip:()Ljava/nio/ByteBuffer;
     173: pop
     174: iload_1
     175: iconst_m1
     176: if_icmpne     206
     179: aload_0
     180: dup
     181: getfield      #5                  // Field state:I
     184: iconst_4
     185: ior
     186: putfield      #5                  // Field state:I
     189: aload_0
     190: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
     193: invokeinterface #32,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.close:()V
     198: aload_0
     199: aconst_null
     200: putfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
     203: goto          279
     206: iload_1
     207: ifne          279
     210: aload_0
     211: dup
     212: getfield      #5                  // Field state:I
     215: bipush        -2
     217: iand
     218: putfield      #5                  // Field state:I
     221: aload_0
     222: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
     225: invokeinterface #32,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.close:()V
     230: aload_0
     231: aconst_null
     232: putfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
     235: invokestatic  #38                 // Method java/lang/Thread.currentThread:()Ljava/lang/Thread;
     238: aload_0
     239: getfield      #2                  // Field channel:Lorg/xnio/channels/StreamSourceChannel;
     242: invokeinterface #39,  1           // InterfaceMethod org/xnio/channels/StreamSourceChannel.getIoThread:()Lorg/xnio/XnioIoThread;
     247: if_acmpne     262
     250: aload_0
     251: getfield      #2                  // Field channel:Lorg/xnio/channels/StreamSourceChannel;
     254: invokeinterface #40,  1           // InterfaceMethod org/xnio/channels/StreamSourceChannel.resumeReads:()V
     259: goto          279
     262: aload_0
     263: getfield      #4                  // Field ioExecutor:Ljava/util/concurrent/Executor;
     266: new           #41                 // class io/undertow/servlet/spec/UpgradeServletInputStream$2
     269: dup
     270: aload_0
     271: invokespecial #42                 // Method io/undertow/servlet/spec/UpgradeServletInputStream$2."<init>":(Lio/undertow/servlet/spec/UpgradeServletInputStream;)V
     274: invokeinterface #19,  2           // InterfaceMethod java/util/concurrent/Executor.execute:(Ljava/lang/Runnable;)V
     279: return

  public int available() throws java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #5                  // Field state:I
       4: iconst_2
       5: invokestatic  #7                  // Method org/xnio/Bits.anyAreSet:(II)Z
       8: ifeq          20
      11: getstatic     #9                  // Field io/undertow/servlet/UndertowServletMessages.MESSAGES:Lio/undertow/servlet/UndertowServletMessages;
      14: invokeinterface #22,  1           // InterfaceMethod io/undertow/servlet/UndertowServletMessages.streamIsClosed:()Ljava/io/IOException;
      19: athrow
      20: aload_0
      21: invokevirtual #33                 // Method readIntoBufferNonBlocking:()V
      24: aload_0
      25: getfield      #5                  // Field state:I
      28: iconst_4
      29: invokestatic  #7                  // Method org/xnio/Bits.anyAreSet:(II)Z
      32: ifeq          37
      35: iconst_0
      36: ireturn
      37: aload_0
      38: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      41: ifnonnull     46
      44: iconst_0
      45: ireturn
      46: aload_0
      47: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      50: invokeinterface #27,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.getBuffer:()Ljava/nio/ByteBuffer;
      55: invokevirtual #28                 // Method java/nio/ByteBuffer.remaining:()I
      58: ireturn

  public void close() throws java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #5                  // Field state:I
       4: iconst_2
       5: invokestatic  #7                  // Method org/xnio/Bits.anyAreSet:(II)Z
       8: ifeq          12
      11: return
      12: aload_0
      13: dup
      14: getfield      #5                  // Field state:I
      17: bipush        6
      19: ior
      20: putfield      #5                  // Field state:I
      23: aload_0
      24: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      27: ifnull        44
      30: aload_0
      31: getfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      34: invokeinterface #32,  1           // InterfaceMethod io/undertow/connector/PooledByteBuffer.close:()V
      39: aload_0
      40: aconst_null
      41: putfield      #26                 // Field pooled:Lio/undertow/connector/PooledByteBuffer;
      44: aload_0
      45: getfield      #2                  // Field channel:Lorg/xnio/channels/StreamSourceChannel;
      48: invokeinterface #43,  1           // InterfaceMethod org/xnio/channels/StreamSourceChannel.suspendReads:()V
      53: aload_0
      54: getfield      #2                  // Field channel:Lorg/xnio/channels/StreamSourceChannel;
      57: invokeinterface #44,  1           // InterfaceMethod org/xnio/channels/StreamSourceChannel.shutdownReads:()V
      62: return
}
