Compiled from "ProxyPeerAddressHandler.java"
public class io.undertow.server.handlers.ProxyPeerAddressHandler implements io.undertow.server.HttpHandler {
  private static final java.util.regex.Pattern IP4_EXACT;

  private static final java.util.regex.Pattern IP6_EXACT;

  private final io.undertow.server.HttpHandler next;

  private static final boolean DEFAULT_CHANGE_LOCAL_ADDR_PORT;

  private static final java.lang.String CHANGE_LOCAL_ADDR_PORT;

  private final boolean isChangeLocalAddrPort;

  public io.undertow.server.handlers.ProxyPeerAddressHandler(io.undertow.server.HttpHandler);
    Code:
       0: aload_0
       1: aload_1
       2: getstatic     #1                  // Field DEFAULT_CHANGE_LOCAL_ADDR_PORT:Z
       5: invokespecial #2                  // Method "<init>":(Lio/undertow/server/HttpHandler;Z)V
       8: return

  public io.undertow.server.handlers.ProxyPeerAddressHandler(io.undertow.server.HttpHandler, boolean);
    Code:
       0: aload_0
       1: invokespecial #3                  // Method java/lang/Object."<init>":()V
       4: aload_0
       5: aload_1
       6: putfield      #4                  // Field next:Lio/undertow/server/HttpHandler;
       9: aload_0
      10: iload_2
      11: putfield      #5                  // Field isChangeLocalAddrPort:Z
      14: return

  public void handleRequest(io.undertow.server.HttpServerExchange) throws java.lang.Exception;
    Code:
       0: aload_1
       1: invokevirtual #6                  // Method io/undertow/server/HttpServerExchange.getRequestHeaders:()Lio/undertow/util/HeaderMap;
       4: getstatic     #7                  // Field io/undertow/util/Headers.X_FORWARDED_FOR:Lio/undertow/util/HttpString;
       7: invokevirtual #8                  // Method io/undertow/util/HeaderMap.getFirst:(Lio/undertow/util/HttpString;)Ljava/lang/String;
      10: astore_2
      11: aload_2
      12: ifnull        97
      15: aload_0
      16: aload_2
      17: invokevirtual #9                  // Method mostRecent:(Ljava/lang/String;)Ljava/lang/String;
      20: astore_3
      21: getstatic     #10                 // Field IP4_EXACT:Ljava/util/regex/Pattern;
      24: aload_3
      25: invokevirtual #11                 // Method java/util/regex/Pattern.matcher:(Ljava/lang/CharSequence;)Ljava/util/regex/Matcher;
      28: invokevirtual #12                 // Method java/util/regex/Matcher.matches:()Z
      31: ifeq          54
      34: aload_1
      35: new           #13                 // class java/net/InetSocketAddress
      38: dup
      39: aload_3
      40: invokestatic  #14                 // Method io/undertow/util/NetworkUtils.parseIpv4Address:(Ljava/lang/String;)Ljava/net/InetAddress;
      43: iconst_0
      44: invokespecial #15                 // Method java/net/InetSocketAddress."<init>":(Ljava/net/InetAddress;I)V
      47: invokevirtual #16                 // Method io/undertow/server/HttpServerExchange.setSourceAddress:(Ljava/net/InetSocketAddress;)Lio/undertow/server/HttpServerExchange;
      50: pop
      51: goto          97
      54: getstatic     #17                 // Field IP6_EXACT:Ljava/util/regex/Pattern;
      57: aload_3
      58: invokevirtual #11                 // Method java/util/regex/Pattern.matcher:(Ljava/lang/CharSequence;)Ljava/util/regex/Matcher;
      61: invokevirtual #12                 // Method java/util/regex/Matcher.matches:()Z
      64: ifeq          87
      67: aload_1
      68: new           #13                 // class java/net/InetSocketAddress
      71: dup
      72: aload_3
      73: invokestatic  #18                 // Method io/undertow/util/NetworkUtils.parseIpv6Address:(Ljava/lang/String;)Ljava/net/InetAddress;
      76: iconst_0
      77: invokespecial #15                 // Method java/net/InetSocketAddress."<init>":(Ljava/net/InetAddress;I)V
      80: invokevirtual #16                 // Method io/undertow/server/HttpServerExchange.setSourceAddress:(Ljava/net/InetSocketAddress;)Lio/undertow/server/HttpServerExchange;
      83: pop
      84: goto          97
      87: aload_1
      88: aload_3
      89: iconst_0
      90: invokestatic  #19                 // Method java/net/InetSocketAddress.createUnresolved:(Ljava/lang/String;I)Ljava/net/InetSocketAddress;
      93: invokevirtual #16                 // Method io/undertow/server/HttpServerExchange.setSourceAddress:(Ljava/net/InetSocketAddress;)Lio/undertow/server/HttpServerExchange;
      96: pop
      97: aload_1
      98: invokevirtual #6                  // Method io/undertow/server/HttpServerExchange.getRequestHeaders:()Lio/undertow/util/HeaderMap;
     101: getstatic     #20                 // Field io/undertow/util/Headers.X_FORWARDED_PROTO:Lio/undertow/util/HttpString;
     104: invokevirtual #8                  // Method io/undertow/util/HeaderMap.getFirst:(Lio/undertow/util/HttpString;)Ljava/lang/String;
     107: astore_3
     108: aload_3
     109: ifnull        122
     112: aload_1
     113: aload_0
     114: aload_3
     115: invokevirtual #9                  // Method mostRecent:(Ljava/lang/String;)Ljava/lang/String;
     118: invokevirtual #21                 // Method io/undertow/server/HttpServerExchange.setRequestScheme:(Ljava/lang/String;)Lio/undertow/server/HttpServerExchange;
     121: pop
     122: aload_1
     123: invokevirtual #6                  // Method io/undertow/server/HttpServerExchange.getRequestHeaders:()Lio/undertow/util/HeaderMap;
     126: getstatic     #22                 // Field io/undertow/util/Headers.X_FORWARDED_HOST:Lio/undertow/util/HttpString;
     129: invokevirtual #8                  // Method io/undertow/util/HeaderMap.getFirst:(Lio/undertow/util/HttpString;)Ljava/lang/String;
     132: astore        4
     134: aload_1
     135: invokevirtual #6                  // Method io/undertow/server/HttpServerExchange.getRequestHeaders:()Lio/undertow/util/HeaderMap;
     138: getstatic     #23                 // Field io/undertow/util/Headers.X_FORWARDED_PORT:Lio/undertow/util/HttpString;
     141: invokevirtual #8                  // Method io/undertow/util/HeaderMap.getFirst:(Lio/undertow/util/HttpString;)Ljava/lang/String;
     144: astore        5
     146: aload         4
     148: ifnull        386
     151: aload_0
     152: aload         4
     154: invokevirtual #9                  // Method mostRecent:(Ljava/lang/String;)Ljava/lang/String;
     157: astore        6
     159: aload         6
     161: ldc           #24                 // String [
     163: invokevirtual #25                 // Method java/lang/String.startsWith:(Ljava/lang/String;)Z
     166: ifeq          228
     169: aload         6
     171: ldc           #26                 // String ]
     173: invokevirtual #27                 // Method java/lang/String.lastIndexOf:(Ljava/lang/String;)I
     176: istore        7
     178: iload         7
     180: iconst_m1
     181: if_icmpne     187
     184: iconst_0
     185: istore        7
     187: aload         6
     189: ldc           #28                 // String :
     191: iload         7
     193: invokevirtual #29                 // Method java/lang/String.indexOf:(Ljava/lang/String;I)I
     196: istore        8
     198: iload         8
     200: iconst_m1
     201: if_icmpeq     225
     204: aload         6
     206: iload         8
     208: iconst_1
     209: iadd
     210: invokevirtual #30                 // Method java/lang/String.substring:(I)Ljava/lang/String;
     213: astore        5
     215: aload         6
     217: iconst_0
     218: iload         8
     220: invokevirtual #31                 // Method java/lang/String.substring:(II)Ljava/lang/String;
     223: astore        6
     225: goto          264
     228: aload         6
     230: ldc           #28                 // String :
     232: invokevirtual #27                 // Method java/lang/String.lastIndexOf:(Ljava/lang/String;)I
     235: istore        7
     237: iload         7
     239: iconst_m1
     240: if_icmpeq     264
     243: aload         6
     245: iload         7
     247: iconst_1
     248: iadd
     249: invokevirtual #30                 // Method java/lang/String.substring:(I)Ljava/lang/String;
     252: astore        5
     254: aload         6
     256: iconst_0
     257: iload         7
     259: invokevirtual #31                 // Method java/lang/String.substring:(II)Ljava/lang/String;
     262: astore        6
     264: iconst_0
     265: istore        7
     267: aload         6
     269: invokestatic  #32                 // Method io/undertow/util/NetworkUtils.formatPossibleIpv6Address:(Ljava/lang/String;)Ljava/lang/String;
     272: astore        8
     274: aload         5
     276: ifnull        354
     279: aload_0
     280: aload         5
     282: invokevirtual #9                  // Method mostRecent:(Ljava/lang/String;)Ljava/lang/String;
     285: invokestatic  #33                 // Method java/lang/Integer.parseInt:(Ljava/lang/String;)I
     288: istore        7
     290: iload         7
     292: ifle          325
     295: aload_1
     296: invokevirtual #34                 // Method io/undertow/server/HttpServerExchange.getRequestScheme:()Ljava/lang/String;
     299: astore        9
     301: iload         7
     303: aload         9
     305: invokestatic  #35                 // Method standardPort:(ILjava/lang/String;)Z
     308: ifne          322
     311: aload         8
     313: iload         7
     315: invokedynamic #36,  0             // InvokeDynamic #0:makeConcatWithConstants:(Ljava/lang/String;I)Ljava/lang/String;
     320: astore        8
     322: goto          337
     325: getstatic     #37                 // Field io/undertow/UndertowLogger.REQUEST_LOGGER:Lio/undertow/UndertowLogger;
     328: ldc           #38                 // String Ignoring negative port: %s
     330: aload         5
     332: invokeinterface #39,  3           // InterfaceMethod io/undertow/UndertowLogger.debugf:(Ljava/lang/String;Ljava/lang/Object;)V
     337: goto          354
     340: astore        9
     342: getstatic     #37                 // Field io/undertow/UndertowLogger.REQUEST_LOGGER:Lio/undertow/UndertowLogger;
     345: ldc           #41                 // String Cannot parse port: %s
     347: aload         5
     349: invokeinterface #39,  3           // InterfaceMethod io/undertow/UndertowLogger.debugf:(Ljava/lang/String;Ljava/lang/Object;)V
     354: aload_1
     355: invokevirtual #6                  // Method io/undertow/server/HttpServerExchange.getRequestHeaders:()Lio/undertow/util/HeaderMap;
     358: getstatic     #42                 // Field io/undertow/util/Headers.HOST:Lio/undertow/util/HttpString;
     361: aload         8
     363: invokevirtual #43                 // Method io/undertow/util/HeaderMap.put:(Lio/undertow/util/HttpString;Ljava/lang/String;)Lio/undertow/util/HeaderMap;
     366: pop
     367: aload_0
     368: getfield      #5                  // Field isChangeLocalAddrPort:Z
     371: ifeq          386
     374: aload_1
     375: aload         6
     377: iload         7
     379: invokestatic  #19                 // Method java/net/InetSocketAddress.createUnresolved:(Ljava/lang/String;I)Ljava/net/InetSocketAddress;
     382: invokevirtual #44                 // Method io/undertow/server/HttpServerExchange.setDestinationAddress:(Ljava/net/InetSocketAddress;)Lio/undertow/server/HttpServerExchange;
     385: pop
     386: aload_0
     387: getfield      #4                  // Field next:Lio/undertow/server/HttpHandler;
     390: aload_1
     391: invokeinterface #45,  2           // InterfaceMethod io/undertow/server/HttpHandler.handleRequest:(Lio/undertow/server/HttpServerExchange;)V
     396: return
    Exception table:
       from    to  target type
         279   337   340   Class java/lang/NumberFormatException

  private java.lang.String mostRecent(java.lang.String);
    Code:
       0: aload_1
       1: bipush        44
       3: invokevirtual #46                 // Method java/lang/String.indexOf:(I)I
       6: istore_2
       7: iload_2
       8: iconst_m1
       9: if_icmpne     14
      12: aload_1
      13: areturn
      14: aload_1
      15: iconst_0
      16: iload_2
      17: invokevirtual #31                 // Method java/lang/String.substring:(II)Ljava/lang/String;
      20: areturn

  private static boolean standardPort(int, java.lang.String);
    Code:
       0: iload_0
       1: bipush        80
       3: if_icmpne     15
       6: ldc           #47                 // String http
       8: aload_1
       9: invokevirtual #48                 // Method java/lang/String.equals:(Ljava/lang/Object;)Z
      12: ifne          31
      15: iload_0
      16: sipush        443
      19: if_icmpne     35
      22: ldc           #49                 // String https
      24: aload_1
      25: invokevirtual #48                 // Method java/lang/String.equals:(Ljava/lang/Object;)Z
      28: ifeq          35
      31: iconst_1
      32: goto          36
      35: iconst_0
      36: ireturn

  public java.lang.String toString();
    Code:
       0: ldc           #50                 // String proxy-peer-address()
       2: areturn

  static {};
    Code:
       0: ldc           #52                 // String (?:\\d{1,3}\\.){3}\\d{1,3}
       2: invokestatic  #53                 // Method java/util/regex/Pattern.compile:(Ljava/lang/String;)Ljava/util/regex/Pattern;
       5: putstatic     #10                 // Field IP4_EXACT:Ljava/util/regex/Pattern;
       8: ldc           #54                 // String ^(?:([0-9a-fA-F]{1,4}:){7,7}(?:[0-9a-fA-F]){1,4}|(?:([0-9a-fA-F]{1,4}:)){1,7}(?:(:))|(?:([0-9a-fA-F]{1,4}:)){1,6}(?:(:[0-9a-fA-F]){1,4})|(?:([0-9a-fA-F]{1,4}:)){1,5}(?:(:[0-9a-fA-F]{1,4})){1,2}|(?:([0-9a-fA-F]{1,4}:)){1,4}(?:(:[0-9a-fA-F]{1,4})){1,3}|(?:([0-9a-fA-F]{1,4}:)){1,3}(?:(:[0-9a-fA-F]{1,4})){1,4}|(?:([0-9a-fA-F]{1,4}:)){1,2}(?:(:[0-9a-fA-F]{1,4})){1,5}|(?:([0-9a-fA-F]{1,4}:))(?:(:[0-9a-fA-F]{1,4})){1,6}|(?:(:))(?:((:[0-9a-fA-F]{1,4}){1,7}|(?:(:)))))$
      10: invokestatic  #53                 // Method java/util/regex/Pattern.compile:(Ljava/lang/String;)Ljava/util/regex/Pattern;
      13: putstatic     #17                 // Field IP6_EXACT:Ljava/util/regex/Pattern;
      16: ldc           #55                 // String io.undertow.forwarded.change-local-addr-port
      18: invokestatic  #56                 // Method java/lang/Boolean.getBoolean:(Ljava/lang/String;)Z
      21: putstatic     #1                  // Field DEFAULT_CHANGE_LOCAL_ADDR_PORT:Z
      24: return
}
