Compiled from "TotalOrderStateTransferInterceptor.java"
public class org.infinispan.interceptors.totalorder.TotalOrderStateTransferInterceptor extends org.infinispan.interceptors.base.BaseStateTransferInterceptor {
  private static final org.infinispan.util.logging.Log log;

  private static final boolean trace;

  public org.infinispan.interceptors.totalorder.TotalOrderStateTransferInterceptor();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method org/infinispan/interceptors/base/BaseStateTransferInterceptor."<init>":()V
       4: return

  public java.lang.Object visitPrepareCommand(org.infinispan.context.impl.TxInvocationContext, org.infinispan.commands.tx.PrepareCommand) throws java.lang.Throwable;
    Code:
       0: aload_1
       1: invokeinterface #2,  1            // InterfaceMethod org/infinispan/context/impl/TxInvocationContext.isOriginLocal:()Z
       6: ifeq          16
       9: aload_0
      10: aload_1
      11: aload_2
      12: invokespecial #3                  // Method localPrepare:(Lorg/infinispan/context/impl/TxInvocationContext;Lorg/infinispan/commands/tx/PrepareCommand;)Ljava/lang/Object;
      15: areturn
      16: aload_0
      17: aload_1
      18: aload_2
      19: invokespecial #4                  // Method remotePrepare:(Lorg/infinispan/context/impl/TxInvocationContext;Lorg/infinispan/commands/tx/PrepareCommand;)Ljava/lang/Object;
      22: areturn

  protected org.infinispan.util.logging.Log getLog();
    Code:
       0: getstatic     #5                  // Field log:Lorg/infinispan/util/logging/Log;
       3: areturn

  private java.lang.Object remotePrepare(org.infinispan.context.impl.TxInvocationContext, org.infinispan.commands.tx.PrepareCommand) throws java.lang.Throwable;
    Code:
       0: aload_0
       1: invokevirtual #6                  // Method currentTopologyId:()I
       4: istore_3
       5: aload_1
       6: invokeinterface #7,  1            // InterfaceMethod org/infinispan/context/impl/TxInvocationContext.getCacheTransaction:()Lorg/infinispan/transaction/impl/AbstractCacheTransaction;
      11: checkcast     #8                  // class org/infinispan/transaction/impl/RemoteTransaction
      14: aload_2
      15: invokevirtual #9                  // Method org/infinispan/commands/tx/PrepareCommand.getTopologyId:()I
      18: invokevirtual #10                 // Method org/infinispan/transaction/impl/RemoteTransaction.setLookedUpEntriesTopology:(I)V
      21: getstatic     #11                 // Field trace:Z
      24: ifeq          57
      27: getstatic     #5                  // Field log:Lorg/infinispan/util/logging/Log;
      30: ldc           #12                 // String Remote transaction received %s. Tx topology id is %s and current topology is is %s
      32: aload_1
      33: invokeinterface #13,  1           // InterfaceMethod org/infinispan/context/impl/TxInvocationContext.getGlobalTransaction:()Lorg/infinispan/transaction/xa/GlobalTransaction;
      38: invokevirtual #14                 // Method org/infinispan/transaction/xa/GlobalTransaction.globalId:()Ljava/lang/String;
      41: aload_2
      42: invokevirtual #9                  // Method org/infinispan/commands/tx/PrepareCommand.getTopologyId:()I
      45: invokestatic  #15                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;
      48: iload_3
      49: invokestatic  #15                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;
      52: invokeinterface #16,  5           // InterfaceMethod org/infinispan/util/logging/Log.tracef:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;)V
      57: aload_2
      58: invokevirtual #9                  // Method org/infinispan/commands/tx/PrepareCommand.getTopologyId:()I
      61: iload_3
      62: if_icmpge     103
      65: getstatic     #5                  // Field log:Lorg/infinispan/util/logging/Log;
      68: invokeinterface #17,  1           // InterfaceMethod org/infinispan/util/logging/Log.isDebugEnabled:()Z
      73: ifeq          95
      76: getstatic     #5                  // Field log:Lorg/infinispan/util/logging/Log;
      79: ldc           #18                 // String Transaction %s delivered in new topology Id. Discard it because it should be retransmitted
      81: aload_1
      82: invokeinterface #13,  1           // InterfaceMethod org/infinispan/context/impl/TxInvocationContext.getGlobalTransaction:()Lorg/infinispan/transaction/xa/GlobalTransaction;
      87: invokevirtual #14                 // Method org/infinispan/transaction/xa/GlobalTransaction.globalId:()Ljava/lang/String;
      90: invokeinterface #19,  3           // InterfaceMethod org/infinispan/util/logging/Log.debugf:(Ljava/lang/String;Ljava/lang/Object;)V
      95: new           #20                 // class org/infinispan/interceptors/totalorder/RetryPrepareException
      98: dup
      99: invokespecial #21                 // Method org/infinispan/interceptors/totalorder/RetryPrepareException."<init>":()V
     102: athrow
     103: aload_2
     104: invokevirtual #9                  // Method org/infinispan/commands/tx/PrepareCommand.getTopologyId:()I
     107: iload_3
     108: if_icmple     121
     111: new           #22                 // class java/lang/IllegalStateException
     114: dup
     115: ldc           #23                 // String This should never happen
     117: invokespecial #24                 // Method java/lang/IllegalStateException."<init>":(Ljava/lang/String;)V
     120: athrow
     121: aload_0
     122: aload_1
     123: aload_2
     124: invokevirtual #25                 // Method invokeNextInterceptor:(Lorg/infinispan/context/InvocationContext;Lorg/infinispan/commands/VisitableCommand;)Ljava/lang/Object;
     127: areturn

  private java.lang.Object localPrepare(org.infinispan.context.impl.TxInvocationContext, org.infinispan.commands.tx.PrepareCommand) throws java.lang.Throwable;
    Code:
       0: iconst_1
       1: istore_3
       2: aconst_null
       3: astore        4
       5: iload_3
       6: ifeq          121
       9: aload_2
      10: aload_0
      11: invokevirtual #6                  // Method currentTopologyId:()I
      14: invokevirtual #26                 // Method org/infinispan/commands/tx/PrepareCommand.setTopologyId:(I)V
      17: getstatic     #11                 // Field trace:Z
      20: ifeq          47
      23: getstatic     #5                  // Field log:Lorg/infinispan/util/logging/Log;
      26: ldc           #27                 // String Local transaction received %s. setting topology Id to %s
      28: aload_2
      29: invokevirtual #28                 // Method org/infinispan/commands/tx/PrepareCommand.getGlobalTransaction:()Lorg/infinispan/transaction/xa/GlobalTransaction;
      32: invokevirtual #14                 // Method org/infinispan/transaction/xa/GlobalTransaction.globalId:()Ljava/lang/String;
      35: aload_2
      36: invokevirtual #9                  // Method org/infinispan/commands/tx/PrepareCommand.getTopologyId:()I
      39: invokestatic  #15                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;
      42: invokeinterface #29,  4           // InterfaceMethod org/infinispan/util/logging/Log.tracef:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
      47: aload_0
      48: aload_1
      49: aload_2
      50: invokevirtual #25                 // Method invokeNextInterceptor:(Lorg/infinispan/context/InvocationContext;Lorg/infinispan/commands/VisitableCommand;)Ljava/lang/Object;
      53: astore        4
      55: iconst_0
      56: istore_3
      57: goto          5
      60: astore        5
      62: aload_0
      63: aload         5
      65: invokespecial #31                 // Method needsToRePrepare:(Ljava/lang/Throwable;)Z
      68: istore_3
      69: getstatic     #5                  // Field log:Lorg/infinispan/util/logging/Log;
      72: invokeinterface #17,  1           // InterfaceMethod org/infinispan/util/logging/Log.isDebugEnabled:()Z
      77: ifeq          106
      80: getstatic     #5                  // Field log:Lorg/infinispan/util/logging/Log;
      83: ldc           #32                 // String Exception caught while preparing transaction %s (cause = %s). Needs to retransmit? %s
      85: aload_2
      86: invokevirtual #28                 // Method org/infinispan/commands/tx/PrepareCommand.getGlobalTransaction:()Lorg/infinispan/transaction/xa/GlobalTransaction;
      89: invokevirtual #14                 // Method org/infinispan/transaction/xa/GlobalTransaction.globalId:()Ljava/lang/String;
      92: aload         5
      94: invokevirtual #33                 // Method java/lang/Throwable.getCause:()Ljava/lang/Throwable;
      97: iload_3
      98: invokestatic  #34                 // Method java/lang/Boolean.valueOf:(Z)Ljava/lang/Boolean;
     101: invokeinterface #16,  5           // InterfaceMethod org/infinispan/util/logging/Log.tracef:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;)V
     106: iload_3
     107: ifne          113
     110: aload         5
     112: athrow
     113: aload_0
     114: aload_2
     115: invokevirtual #35                 // Method logRetry:(Lorg/infinispan/commands/VisitableCommand;)V
     118: goto          5
     121: aload         4
     123: areturn
    Exception table:
       from    to  target type
           9    57    60   Class java/lang/Throwable

  private boolean needsToRePrepare(java.lang.Throwable);
    Code:
       0: aload_1
       1: instanceof    #36                 // class org/infinispan/remoting/RemoteException
       4: ifeq          21
       7: aload_1
       8: invokevirtual #33                 // Method java/lang/Throwable.getCause:()Ljava/lang/Throwable;
      11: instanceof    #20                 // class org/infinispan/interceptors/totalorder/RetryPrepareException
      14: ifeq          21
      17: iconst_1
      18: goto          22
      21: iconst_0
      22: ireturn

  static {};
    Code:
       0: ldc           #37                 // class org/infinispan/interceptors/totalorder/TotalOrderStateTransferInterceptor
       2: invokestatic  #38                 // Method org/infinispan/util/logging/LogFactory.getLog:(Ljava/lang/Class;)Lorg/infinispan/util/logging/Log;
       5: putstatic     #5                  // Field log:Lorg/infinispan/util/logging/Log;
       8: getstatic     #5                  // Field log:Lorg/infinispan/util/logging/Log;
      11: invokeinterface #39,  1           // InterfaceMethod org/infinispan/util/logging/Log.isTraceEnabled:()Z
      16: putstatic     #11                 // Field trace:Z
      19: return
}
