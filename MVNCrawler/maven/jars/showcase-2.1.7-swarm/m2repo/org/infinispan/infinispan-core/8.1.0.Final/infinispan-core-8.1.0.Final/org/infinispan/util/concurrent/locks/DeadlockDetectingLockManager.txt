Compiled from "DeadlockDetectingLockManager.java"
public class org.infinispan.util.concurrent.locks.DeadlockDetectingLockManager extends org.infinispan.util.concurrent.locks.impl.DefaultLockManager implements org.infinispan.util.concurrent.locks.DeadlockChecker,java.lang.Runnable {
  private static final org.infinispan.util.logging.Log log;

  private static final boolean trace;

  private java.util.concurrent.ScheduledFuture<?> scheduledFuture;

  protected volatile boolean exposeJmxStats;

  private java.util.concurrent.atomic.AtomicLong localTxStopped;

  private java.util.concurrent.atomic.AtomicLong remoteTxStopped;

  private java.util.concurrent.atomic.AtomicLong cannotRunDld;

  public org.infinispan.util.concurrent.locks.DeadlockDetectingLockManager();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method org/infinispan/util/concurrent/locks/impl/DefaultLockManager."<init>":()V
       4: aload_0
       5: new           #2                  // class java/util/concurrent/atomic/AtomicLong
       8: dup
       9: lconst_0
      10: invokespecial #3                  // Method java/util/concurrent/atomic/AtomicLong."<init>":(J)V
      13: putfield      #4                  // Field localTxStopped:Ljava/util/concurrent/atomic/AtomicLong;
      16: aload_0
      17: new           #2                  // class java/util/concurrent/atomic/AtomicLong
      20: dup
      21: lconst_0
      22: invokespecial #3                  // Method java/util/concurrent/atomic/AtomicLong."<init>":(J)V
      25: putfield      #5                  // Field remoteTxStopped:Ljava/util/concurrent/atomic/AtomicLong;
      28: aload_0
      29: new           #2                  // class java/util/concurrent/atomic/AtomicLong
      32: dup
      33: lconst_0
      34: invokespecial #3                  // Method java/util/concurrent/atomic/AtomicLong."<init>":(J)V
      37: putfield      #6                  // Field cannotRunDld:Ljava/util/concurrent/atomic/AtomicLong;
      40: return

  public void init();
    Code:
       0: aload_0
       1: getfield      #7                  // Field configuration:Lorg/infinispan/configuration/cache/Configuration;
       4: invokevirtual #8                  // Method org/infinispan/configuration/cache/Configuration.deadlockDetection:()Lorg/infinispan/configuration/cache/DeadlockDetectionConfiguration;
       7: invokevirtual #9                  // Method org/infinispan/configuration/cache/DeadlockDetectionConfiguration.spinDuration:()J
      10: lstore_1
      11: aload_0
      12: aload_0
      13: getfield      #7                  // Field configuration:Lorg/infinispan/configuration/cache/Configuration;
      16: invokevirtual #10                 // Method org/infinispan/configuration/cache/Configuration.jmxStatistics:()Lorg/infinispan/configuration/cache/JMXStatisticsConfiguration;
      19: invokevirtual #11                 // Method org/infinispan/configuration/cache/JMXStatisticsConfiguration.enabled:()Z
      22: putfield      #12                 // Field exposeJmxStats:Z
      25: aload_0
      26: aload_0
      27: getfield      #13                 // Field scheduler:Ljava/util/concurrent/ScheduledExecutorService;
      30: aload_0
      31: lload_1
      32: lload_1
      33: getstatic     #14                 // Field java/util/concurrent/TimeUnit.MILLISECONDS:Ljava/util/concurrent/TimeUnit;
      36: invokeinterface #15,  7           // InterfaceMethod java/util/concurrent/ScheduledExecutorService.scheduleWithFixedDelay:(Ljava/lang/Runnable;JJLjava/util/concurrent/TimeUnit;)Ljava/util/concurrent/ScheduledFuture;
      41: putfield      #16                 // Field scheduledFuture:Ljava/util/concurrent/ScheduledFuture;
      44: return

  public void stopScheduler();
    Code:
       0: aload_0
       1: getfield      #16                 // Field scheduledFuture:Ljava/util/concurrent/ScheduledFuture;
       4: ifnull        23
       7: aload_0
       8: getfield      #16                 // Field scheduledFuture:Ljava/util/concurrent/ScheduledFuture;
      11: iconst_0
      12: invokeinterface #17,  2           // InterfaceMethod java/util/concurrent/ScheduledFuture.cancel:(Z)Z
      17: pop
      18: aload_0
      19: aconst_null
      20: putfield      #16                 // Field scheduledFuture:Ljava/util/concurrent/ScheduledFuture;
      23: return

  public org.infinispan.util.concurrent.locks.KeyAwareLockPromise lock(java.lang.Object, java.lang.Object, long, java.util.concurrent.TimeUnit);
    Code:
       0: aload_2
       1: instanceof    #18                 // class org/infinispan/transaction/xa/DldGlobalTransaction
       4: ifeq          28
       7: aload_2
       8: checkcast     #18                 // class org/infinispan/transaction/xa/DldGlobalTransaction
      11: aload_1
      12: invokestatic  #19                 // Method java/util/Collections.singleton:(Ljava/lang/Object;)Ljava/util/Set;
      15: invokevirtual #20                 // Method org/infinispan/transaction/xa/DldGlobalTransaction.setLockIntention:(Ljava/util/Collection;)V
      18: aload_0
      19: aload_1
      20: aload_2
      21: lload_3
      22: aload         5
      24: invokespecial #21                 // Method org/infinispan/util/concurrent/locks/impl/DefaultLockManager.lock:(Ljava/lang/Object;Ljava/lang/Object;JLjava/util/concurrent/TimeUnit;)Lorg/infinispan/util/concurrent/locks/KeyAwareLockPromise;
      27: areturn
      28: aload_0
      29: aload_1
      30: aload_2
      31: lload_3
      32: aload         5
      34: invokespecial #21                 // Method org/infinispan/util/concurrent/locks/impl/DefaultLockManager.lock:(Ljava/lang/Object;Ljava/lang/Object;JLjava/util/concurrent/TimeUnit;)Lorg/infinispan/util/concurrent/locks/KeyAwareLockPromise;
      37: areturn

  public org.infinispan.util.concurrent.locks.KeyAwareLockPromise lockAll(java.util.Collection<?>, java.lang.Object, long, java.util.concurrent.TimeUnit);
    Code:
       0: aload_2
       1: instanceof    #18                 // class org/infinispan/transaction/xa/DldGlobalTransaction
       4: ifeq          32
       7: aload_2
       8: checkcast     #18                 // class org/infinispan/transaction/xa/DldGlobalTransaction
      11: new           #22                 // class java/util/HashSet
      14: dup
      15: aload_1
      16: invokespecial #23                 // Method java/util/HashSet."<init>":(Ljava/util/Collection;)V
      19: invokevirtual #20                 // Method org/infinispan/transaction/xa/DldGlobalTransaction.setLockIntention:(Ljava/util/Collection;)V
      22: aload_0
      23: aload_1
      24: aload_2
      25: lload_3
      26: aload         5
      28: invokespecial #24                 // Method org/infinispan/util/concurrent/locks/impl/DefaultLockManager.lockAll:(Ljava/util/Collection;Ljava/lang/Object;JLjava/util/concurrent/TimeUnit;)Lorg/infinispan/util/concurrent/locks/KeyAwareLockPromise;
      31: areturn
      32: aload_0
      33: aload_1
      34: aload_2
      35: lload_3
      36: aload         5
      38: invokespecial #24                 // Method org/infinispan/util/concurrent/locks/impl/DefaultLockManager.lockAll:(Ljava/util/Collection;Ljava/lang/Object;JLjava/util/concurrent/TimeUnit;)Lorg/infinispan/util/concurrent/locks/KeyAwareLockPromise;
      41: areturn

  public void run();
    Code:
       0: aload_0
       1: getfield      #25                 // Field lockContainer:Lorg/infinispan/util/concurrent/locks/impl/LockContainer;
       4: aload_0
       5: invokeinterface #26,  2           // InterfaceMethod org/infinispan/util/concurrent/locks/impl/LockContainer.deadlockCheck:(Lorg/infinispan/util/concurrent/locks/DeadlockChecker;)V
      10: return

  private boolean isDeadlockAndIAmLoosing(org.infinispan.transaction.xa.DldGlobalTransaction, org.infinispan.transaction.xa.DldGlobalTransaction);
    Code:
       0: aload_2
       1: aload_1
       2: invokevirtual #27                 // Method org/infinispan/transaction/xa/DldGlobalTransaction.wouldLose:(Lorg/infinispan/transaction/xa/DldGlobalTransaction;)Z
       5: istore_3
       6: iload_3
       7: ifne          30
      10: getstatic     #28                 // Field trace:Z
      13: ifeq          28
      16: getstatic     #29                 // Field log:Lorg/infinispan/util/logging/Log;
      19: ldc           #30                 // String We (%s) win against the other (%s) transaction, so no point running rest of DLD
      21: aload_2
      22: aload_1
      23: invokeinterface #31,  4           // InterfaceMethod org/infinispan/util/logging/Log.tracef:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
      28: iconst_0
      29: ireturn
      30: aload_0
      31: aload_2
      32: aload_1
      33: invokespecial #32                 // Method ownsAnyLocalIntention:(Lorg/infinispan/transaction/xa/DldGlobalTransaction;Lorg/infinispan/transaction/xa/DldGlobalTransaction;)Z
      36: ifne          57
      39: aload_0
      40: aload_1
      41: aload_2
      42: invokespecial #33                 // Method ownsRemoteIntention:(Lorg/infinispan/transaction/xa/DldGlobalTransaction;Lorg/infinispan/transaction/xa/DldGlobalTransaction;)Z
      45: ifne          57
      48: aload_0
      49: aload_2
      50: aload_1
      51: invokespecial #34                 // Method isSameKeyDeadlock:(Lorg/infinispan/transaction/xa/DldGlobalTransaction;Lorg/infinispan/transaction/xa/DldGlobalTransaction;)Z
      54: ifeq          61
      57: iconst_1
      58: goto          62
      61: iconst_0
      62: ireturn

  private boolean isSameKeyDeadlock(org.infinispan.transaction.xa.DldGlobalTransaction, org.infinispan.transaction.xa.DldGlobalTransaction);
    Code:
       0: aload_1
       1: invokevirtual #35                 // Method org/infinispan/transaction/xa/DldGlobalTransaction.isRemote:()Z
       4: ifne          11
       7: iconst_1
       8: goto          12
      11: iconst_0
      12: istore_3
      13: aload_2
      14: invokevirtual #35                 // Method org/infinispan/transaction/xa/DldGlobalTransaction.isRemote:()Z
      17: istore        4
      19: iload_3
      20: ifeq          48
      23: iload         4
      25: ifeq          48
      28: getstatic     #28                 // Field trace:Z
      31: ifeq          46
      34: getstatic     #29                 // Field log:Lorg/infinispan/util/logging/Log;
      37: ldc           #36                 // String Same key deadlock between %s and %s.
      39: aload_1
      40: aload_2
      41: invokeinterface #31,  4           // InterfaceMethod org/infinispan/util/logging/Log.tracef:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
      46: iconst_1
      47: ireturn
      48: iconst_0
      49: ireturn

  private boolean ownsRemoteIntention(org.infinispan.transaction.xa.DldGlobalTransaction, org.infinispan.transaction.xa.DldGlobalTransaction);
    Code:
       0: aload_1
       1: invokevirtual #35                 // Method org/infinispan/transaction/xa/DldGlobalTransaction.isRemote:()Z
       4: ifne          11
       7: iconst_1
       8: goto          12
      11: iconst_0
      12: istore_3
      13: iload_3
      14: ifeq          43
      17: aload_2
      18: aload_1
      19: invokevirtual #37                 // Method org/infinispan/transaction/xa/DldGlobalTransaction.hasAnyLockAtOrigin:(Lorg/infinispan/transaction/xa/DldGlobalTransaction;)Z
      22: ifeq          60
      25: getstatic     #28                 // Field trace:Z
      28: ifeq          41
      31: getstatic     #29                 // Field log:Lorg/infinispan/util/logging/Log;
      34: ldc           #38                 // String Same key deadlock detected: lock owner tries to acquire a lock remotely but we have it!
      36: invokeinterface #39,  2           // InterfaceMethod org/infinispan/util/logging/Log.trace:(Ljava/lang/Object;)V
      41: iconst_1
      42: ireturn
      43: getstatic     #28                 // Field trace:Z
      46: ifeq          60
      49: getstatic     #29                 // Field log:Lorg/infinispan/util/logging/Log;
      52: ldc           #40                 // String Lock owner is remote: %s
      54: aload_1
      55: invokeinterface #41,  3           // InterfaceMethod org/infinispan/util/logging/Log.tracef:(Ljava/lang/String;Ljava/lang/Object;)V
      60: iconst_0
      61: ireturn

  private boolean ownsAnyLocalIntention(org.infinispan.transaction.xa.DldGlobalTransaction, org.infinispan.transaction.xa.DldGlobalTransaction);
    Code:
       0: aload_2
       1: invokevirtual #42                 // Method org/infinispan/transaction/xa/DldGlobalTransaction.getLockIntention:()Ljava/util/Collection;
       4: invokeinterface #43,  1           // InterfaceMethod java/util/Collection.iterator:()Ljava/util/Iterator;
       9: astore_3
      10: aload_3
      11: invokeinterface #44,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
      16: ifeq          61
      19: aload_3
      20: invokeinterface #45,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      25: astore        4
      27: aload_0
      28: aload         4
      30: aload_1
      31: invokevirtual #46                 // Method ownsLock:(Ljava/lang/Object;Ljava/lang/Object;)Z
      34: ifeq          58
      37: getstatic     #28                 // Field trace:Z
      40: ifeq          56
      43: getstatic     #29                 // Field log:Lorg/infinispan/util/logging/Log;
      46: ldc           #47                 // String Local intention is \'%s\' and we (%s) own the lock.
      48: aload         4
      50: aload_1
      51: invokeinterface #31,  4           // InterfaceMethod org/infinispan/util/logging/Log.tracef:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
      56: iconst_1
      57: ireturn
      58: goto          10
      61: iconst_0
      62: ireturn

  public boolean deadlockDetected(java.lang.Object, java.lang.Object);
    Code:
       0: aload_1
       1: instanceof    #18                 // class org/infinispan/transaction/xa/DldGlobalTransaction
       4: ifeq          14
       7: aload_2
       8: instanceof    #18                 // class org/infinispan/transaction/xa/DldGlobalTransaction
      11: ifne          42
      14: getstatic     #28                 // Field trace:Z
      17: ifeq          32
      20: getstatic     #29                 // Field log:Lorg/infinispan/util/logging/Log;
      23: ldc           #48                 // String Unable to run DLD with %s and %s. One of them are not a DldGlobalTransaction.
      25: aload_1
      26: aload_2
      27: invokeinterface #31,  4           // InterfaceMethod org/infinispan/util/logging/Log.tracef:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
      32: aload_0
      33: getfield      #6                  // Field cannotRunDld:Ljava/util/concurrent/atomic/AtomicLong;
      36: invokevirtual #49                 // Method java/util/concurrent/atomic/AtomicLong.incrementAndGet:()J
      39: pop2
      40: iconst_0
      41: ireturn
      42: getstatic     #28                 // Field trace:Z
      45: ifeq          66
      48: getstatic     #29                 // Field log:Lorg/infinispan/util/logging/Log;
      51: ldc           #50                 // String Could not acquire lock. It is locked by %s (%s)
      53: aload_2
      54: aload_2
      55: invokestatic  #51                 // Method java/lang/System.identityHashCode:(Ljava/lang/Object;)I
      58: invokestatic  #52                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;
      61: invokeinterface #31,  4           // InterfaceMethod org/infinispan/util/logging/Log.tracef:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
      66: aload_2
      67: checkcast     #18                 // class org/infinispan/transaction/xa/DldGlobalTransaction
      70: astore_3
      71: aload_1
      72: checkcast     #18                 // class org/infinispan/transaction/xa/DldGlobalTransaction
      75: astore        4
      77: aload_0
      78: aload_3
      79: aload         4
      81: invokespecial #53                 // Method isDeadlockAndIAmLoosing:(Lorg/infinispan/transaction/xa/DldGlobalTransaction;Lorg/infinispan/transaction/xa/DldGlobalTransaction;)Z
      84: ifeq          107
      87: aload_0
      88: aload         4
      90: invokespecial #54                 // Method updateStats:(Lorg/infinispan/transaction/xa/DldGlobalTransaction;)V
      93: getstatic     #29                 // Field log:Lorg/infinispan/util/logging/Log;
      96: ldc           #55                 // String Deadlock found and we (%s) shall not continue. Other tx is %s
      98: aload_1
      99: aload_2
     100: invokeinterface #31,  4           // InterfaceMethod org/infinispan/util/logging/Log.tracef:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
     105: iconst_1
     106: ireturn
     107: iconst_0
     108: ireturn

  public void setExposeJmxStats(boolean);
    Code:
       0: aload_0
       1: iload_1
       2: putfield      #12                 // Field exposeJmxStats:Z
       5: return

  public long getTotalNumberOfDetectedDeadlocks();
    Code:
       0: aload_0
       1: getfield      #4                  // Field localTxStopped:Ljava/util/concurrent/atomic/AtomicLong;
       4: invokevirtual #56                 // Method java/util/concurrent/atomic/AtomicLong.get:()J
       7: aload_0
       8: getfield      #5                  // Field remoteTxStopped:Ljava/util/concurrent/atomic/AtomicLong;
      11: invokevirtual #56                 // Method java/util/concurrent/atomic/AtomicLong.get:()J
      14: ladd
      15: lreturn

  public void resetStatistics();
    Code:
       0: aload_0
       1: getfield      #4                  // Field localTxStopped:Ljava/util/concurrent/atomic/AtomicLong;
       4: lconst_0
       5: invokevirtual #57                 // Method java/util/concurrent/atomic/AtomicLong.set:(J)V
       8: aload_0
       9: getfield      #5                  // Field remoteTxStopped:Ljava/util/concurrent/atomic/AtomicLong;
      12: lconst_0
      13: invokevirtual #57                 // Method java/util/concurrent/atomic/AtomicLong.set:(J)V
      16: aload_0
      17: getfield      #6                  // Field cannotRunDld:Ljava/util/concurrent/atomic/AtomicLong;
      20: lconst_0
      21: invokevirtual #57                 // Method java/util/concurrent/atomic/AtomicLong.set:(J)V
      24: return

  public long getDetectedRemoteDeadlocks();
    Code:
       0: aload_0
       1: getfield      #5                  // Field remoteTxStopped:Ljava/util/concurrent/atomic/AtomicLong;
       4: invokevirtual #56                 // Method java/util/concurrent/atomic/AtomicLong.get:()J
       7: lreturn

  public long getDetectedLocalDeadlocks();
    Code:
       0: aload_0
       1: getfield      #4                  // Field localTxStopped:Ljava/util/concurrent/atomic/AtomicLong;
       4: invokevirtual #56                 // Method java/util/concurrent/atomic/AtomicLong.get:()J
       7: lreturn

  public long getOverlapWithNotDeadlockAwareLockOwners();
    Code:
       0: aload_0
       1: getfield      #6                  // Field cannotRunDld:Ljava/util/concurrent/atomic/AtomicLong;
       4: invokevirtual #56                 // Method java/util/concurrent/atomic/AtomicLong.get:()J
       7: lreturn

  private void updateStats(org.infinispan.transaction.xa.DldGlobalTransaction);
    Code:
       0: aload_0
       1: getfield      #12                 // Field exposeJmxStats:Z
       4: ifeq          33
       7: aload_1
       8: invokevirtual #35                 // Method org/infinispan/transaction/xa/DldGlobalTransaction.isRemote:()Z
      11: ifeq          25
      14: aload_0
      15: getfield      #5                  // Field remoteTxStopped:Ljava/util/concurrent/atomic/AtomicLong;
      18: invokevirtual #49                 // Method java/util/concurrent/atomic/AtomicLong.incrementAndGet:()J
      21: pop2
      22: goto          33
      25: aload_0
      26: getfield      #4                  // Field localTxStopped:Ljava/util/concurrent/atomic/AtomicLong;
      29: invokevirtual #49                 // Method java/util/concurrent/atomic/AtomicLong.incrementAndGet:()J
      32: pop2
      33: return

  static {};
    Code:
       0: ldc           #58                 // class org/infinispan/util/concurrent/locks/DeadlockDetectingLockManager
       2: invokestatic  #59                 // Method org/infinispan/util/logging/LogFactory.getLog:(Ljava/lang/Class;)Lorg/infinispan/util/logging/Log;
       5: putstatic     #29                 // Field log:Lorg/infinispan/util/logging/Log;
       8: getstatic     #29                 // Field log:Lorg/infinispan/util/logging/Log;
      11: invokeinterface #60,  1           // InterfaceMethod org/infinispan/util/logging/Log.isTraceEnabled:()Z
      16: putstatic     #28                 // Field trace:Z
      19: return
}
