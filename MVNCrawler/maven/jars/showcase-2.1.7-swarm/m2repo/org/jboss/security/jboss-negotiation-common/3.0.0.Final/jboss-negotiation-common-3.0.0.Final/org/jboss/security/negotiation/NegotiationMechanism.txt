Compiled from "NegotiationMechanism.java"
public class org.jboss.security.negotiation.NegotiationMechanism implements io.undertow.security.api.AuthenticationMechanism {
  private static final org.jboss.logging.Logger log;

  private static final java.lang.String NEGOTIATION_PLAIN;

  private static final java.lang.String NEGOTIATE_PREFIX;

  public org.jboss.security.negotiation.NegotiationMechanism();
    Code:
       0: aload_0
       1: invokespecial #2                  // Method java/lang/Object."<init>":()V
       4: return

  public io.undertow.security.api.AuthenticationMechanism$AuthenticationMechanismOutcome authenticate(io.undertow.server.HttpServerExchange, io.undertow.security.api.SecurityContext);
    Code:
       0: getstatic     #3                  // Field log:Lorg/jboss/logging/Logger;
       3: ldc           #4                  // String Authenticating user
       5: invokevirtual #5                  // Method org/jboss/logging/Logger.trace:(Ljava/lang/Object;)V
       8: aload_1
       9: invokevirtual #6                  // Method io/undertow/server/HttpServerExchange.getRequestHeaders:()Lio/undertow/util/HeaderMap;
      12: getstatic     #7                  // Field io/undertow/util/Headers.AUTHORIZATION:Lio/undertow/util/HttpString;
      15: invokevirtual #8                  // Method io/undertow/util/HeaderMap.get:(Lio/undertow/util/HttpString;)Lio/undertow/util/HeaderValues;
      18: astore_3
      19: aload_3
      20: ifnull        423
      23: aload_3
      24: invokeinterface #9,  1            // InterfaceMethod java/util/List.iterator:()Ljava/util/Iterator;
      29: astore        4
      31: aload         4
      33: invokeinterface #10,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
      38: ifeq          423
      41: aload         4
      43: invokeinterface #11,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      48: checkcast     #12                 // class java/lang/String
      51: astore        5
      53: aload         5
      55: getstatic     #13                 // Field NEGOTIATE_PREFIX:Ljava/lang/String;
      58: invokevirtual #14                 // Method java/lang/String.startsWith:(Ljava/lang/String;)Z
      61: ifeq          420
      64: aload         5
      66: getstatic     #13                 // Field NEGOTIATE_PREFIX:Ljava/lang/String;
      69: invokevirtual #15                 // Method java/lang/String.length:()I
      72: invokevirtual #16                 // Method java/lang/String.substring:(I)Ljava/lang/String;
      75: astore        6
      77: aload         6
      79: invokestatic  #17                 // Method org/picketbox/commons/cipher/Base64.decode:(Ljava/lang/String;)[B
      82: astore        7
      84: new           #18                 // class java/io/ByteArrayInputStream
      87: dup
      88: aload         7
      90: invokespecial #19                 // Method java/io/ByteArrayInputStream."<init>":([B)V
      93: astore        8
      95: aload         6
      97: invokestatic  #20                 // Method org/jboss/security/negotiation/common/MessageTrace.logRequestBase64:(Ljava/lang/String;)V
     100: aload         7
     102: invokestatic  #21                 // Method org/jboss/security/negotiation/common/MessageTrace.logRequestHex:([B)V
     105: aload_1
     106: invokevirtual #22                 // Method io/undertow/server/HttpServerExchange.getConnection:()Lio/undertow/server/ServerConnection;
     109: astore        9
     111: aload         9
     113: getstatic     #23                 // Field org/jboss/security/negotiation/common/NegotiationContext.ATTACHMENT_KEY:Lio/undertow/util/AttachmentKey;
     116: invokevirtual #24                 // Method io/undertow/server/ServerConnection.getAttachment:(Lio/undertow/util/AttachmentKey;)Ljava/lang/Object;
     119: checkcast     #25                 // class org/jboss/security/negotiation/common/NegotiationContext
     122: astore        10
     124: aload         10
     126: ifnonnull     149
     129: new           #25                 // class org/jboss/security/negotiation/common/NegotiationContext
     132: dup
     133: invokespecial #26                 // Method org/jboss/security/negotiation/common/NegotiationContext."<init>":()V
     136: astore        10
     138: aload         9
     140: getstatic     #23                 // Field org/jboss/security/negotiation/common/NegotiationContext.ATTACHMENT_KEY:Lio/undertow/util/AttachmentKey;
     143: aload         10
     145: invokevirtual #27                 // Method io/undertow/server/ServerConnection.putAttachment:(Lio/undertow/util/AttachmentKey;Ljava/lang/Object;)Ljava/lang/Object;
     148: pop
     149: aload_1
     150: getstatic     #23                 // Field org/jboss/security/negotiation/common/NegotiationContext.ATTACHMENT_KEY:Lio/undertow/util/AttachmentKey;
     153: aload         10
     155: invokevirtual #28                 // Method io/undertow/server/HttpServerExchange.putAttachment:(Lio/undertow/util/AttachmentKey;Ljava/lang/Object;)Ljava/lang/Object;
     158: pop
     159: invokestatic  #29                 // Method org/jboss/security/negotiation/MessageFactory.newInstance:()Lorg/jboss/security/negotiation/MessageFactory;
     162: astore        11
     164: aload         11
     166: aload         8
     168: invokevirtual #30                 // Method org/jboss/security/negotiation/MessageFactory.accepts:(Ljava/io/InputStream;)Z
     171: ifne          184
     174: new           #31                 // class java/io/IOException
     177: dup
     178: ldc           #32                 // String Unsupported negotiation mechanism.
     180: invokespecial #33                 // Method java/io/IOException."<init>":(Ljava/lang/String;)V
     183: athrow
     184: aload         10
     186: aload         11
     188: aload         8
     190: invokevirtual #34                 // Method org/jboss/security/negotiation/MessageFactory.createMessage:(Ljava/io/InputStream;)Lorg/jboss/security/negotiation/NegotiationMessage;
     193: invokevirtual #35                 // Method org/jboss/security/negotiation/common/NegotiationContext.setRequestMessage:(Lorg/jboss/security/negotiation/NegotiationMessage;)V
     196: goto          213
     199: astore        11
     201: getstatic     #3                  // Field log:Lorg/jboss/logging/Logger;
     204: aload         11
     206: invokevirtual #37                 // Method org/jboss/logging/Logger.debug:(Ljava/lang/Object;)V
     209: getstatic     #38                 // Field io/undertow/security/api/AuthenticationMechanism$AuthenticationMechanismOutcome.NOT_AUTHENTICATED:Lio/undertow/security/api/AuthenticationMechanism$AuthenticationMechanismOutcome;
     212: areturn
     213: aload         10
     215: invokevirtual #39                 // Method org/jboss/security/negotiation/common/NegotiationContext.getUsername:()Ljava/lang/String;
     218: astore        11
     220: aload         11
     222: ifnull        233
     225: aload         11
     227: invokevirtual #15                 // Method java/lang/String.length:()I
     230: ifne          248
     233: invokestatic  #40                 // Method java/util/UUID.randomUUID:()Ljava/util/UUID;
     236: invokevirtual #41                 // Method java/util/UUID.toString:()Ljava/lang/String;
     239: astore        11
     241: aload         10
     243: aload         11
     245: invokevirtual #42                 // Method org/jboss/security/negotiation/common/NegotiationContext.setUsername:(Ljava/lang/String;)V
     248: aload_0
     249: aload_2
     250: invokespecial #43                 // Method getIdentityManager:(Lio/undertow/security/api/SecurityContext;)Lio/undertow/security/idm/IdentityManager;
     253: astore        12
     255: aload         10
     257: invokevirtual #44                 // Method org/jboss/security/negotiation/common/NegotiationContext.associate:()V
     260: aload         12
     262: aload         11
     264: aconst_null
     265: invokeinterface #45,  3           // InterfaceMethod io/undertow/security/idm/IdentityManager.verify:(Ljava/lang/String;Lio/undertow/security/idm/Credential;)Lio/undertow/security/idm/Account;
     270: astore        13
     272: aload         13
     274: ifnull        398
     277: aload_2
     278: aload         13
     280: ldc           #46                 // String SPNEGO
     282: iconst_1
     283: invokeinterface #47,  4           // InterfaceMethod io/undertow/security/api/SecurityContext.authenticationComplete:(Lio/undertow/security/idm/Account;Ljava/lang/String;Z)V
     288: aload         10
     290: invokevirtual #48                 // Method org/jboss/security/negotiation/common/NegotiationContext.getResponseMessage:()Lorg/jboss/security/negotiation/NegotiationMessage;
     293: astore        14
     295: aload         14
     297: ifnull        376
     300: new           #49                 // class java/io/ByteArrayOutputStream
     303: dup
     304: invokespecial #50                 // Method java/io/ByteArrayOutputStream."<init>":()V
     307: astore        15
     309: aload         14
     311: aload         15
     313: iconst_1
     314: invokevirtual #51                 // Method org/jboss/security/negotiation/NegotiationMessage.writeTo:(Ljava/io/OutputStream;Z)V
     317: goto          332
     320: astore        16
     322: new           #52                 // class java/lang/IllegalStateException
     325: dup
     326: aload         16
     328: invokespecial #53                 // Method java/lang/IllegalStateException."<init>":(Ljava/lang/Throwable;)V
     331: athrow
     332: aload         15
     334: invokevirtual #54                 // Method java/io/ByteArrayOutputStream.toString:()Ljava/lang/String;
     337: astore        16
     339: aload         16
     341: invokestatic  #55                 // Method org/jboss/security/negotiation/common/MessageTrace.logResponseBase64:(Ljava/lang/String;)V
     344: aload_1
     345: invokevirtual #56                 // Method io/undertow/server/HttpServerExchange.getResponseHeaders:()Lio/undertow/util/HeaderMap;
     348: getstatic     #57                 // Field io/undertow/util/Headers.WWW_AUTHENTICATE:Lio/undertow/util/HttpString;
     351: new           #58                 // class java/lang/StringBuilder
     354: dup
     355: invokespecial #59                 // Method java/lang/StringBuilder."<init>":()V
     358: getstatic     #13                 // Field NEGOTIATE_PREFIX:Ljava/lang/String;
     361: invokevirtual #60                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     364: aload         16
     366: invokevirtual #60                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     369: invokevirtual #61                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     372: invokevirtual #62                 // Method io/undertow/util/HeaderMap.put:(Lio/undertow/util/HttpString;Ljava/lang/String;)Lio/undertow/util/HeaderMap;
     375: pop
     376: aload         9
     378: getstatic     #23                 // Field org/jboss/security/negotiation/common/NegotiationContext.ATTACHMENT_KEY:Lio/undertow/util/AttachmentKey;
     381: invokevirtual #63                 // Method io/undertow/server/ServerConnection.removeAttachment:(Lio/undertow/util/AttachmentKey;)Ljava/lang/Object;
     384: pop
     385: getstatic     #64                 // Field io/undertow/security/api/AuthenticationMechanism$AuthenticationMechanismOutcome.AUTHENTICATED:Lio/undertow/security/api/AuthenticationMechanism$AuthenticationMechanismOutcome;
     388: astore        15
     390: aload         10
     392: invokevirtual #65                 // Method org/jboss/security/negotiation/common/NegotiationContext.clear:()V
     395: aload         15
     397: areturn
     398: aload         10
     400: invokevirtual #65                 // Method org/jboss/security/negotiation/common/NegotiationContext.clear:()V
     403: goto          416
     406: astore        17
     408: aload         10
     410: invokevirtual #65                 // Method org/jboss/security/negotiation/common/NegotiationContext.clear:()V
     413: aload         17
     415: athrow
     416: getstatic     #38                 // Field io/undertow/security/api/AuthenticationMechanism$AuthenticationMechanismOutcome.NOT_AUTHENTICATED:Lio/undertow/security/api/AuthenticationMechanism$AuthenticationMechanismOutcome;
     419: areturn
     420: goto          31
     423: getstatic     #66                 // Field io/undertow/security/api/AuthenticationMechanism$AuthenticationMechanismOutcome.NOT_ATTEMPTED:Lio/undertow/security/api/AuthenticationMechanism$AuthenticationMechanismOutcome;
     426: areturn
    Exception table:
       from    to  target type
         159   196   199   Class org/jboss/security/negotiation/NegotiationException
         159   196   199   Class java/io/IOException
         309   317   320   Class java/io/IOException
         255   390   406   any
         406   408   406   any

  private io.undertow.security.idm.IdentityManager getIdentityManager(io.undertow.security.api.SecurityContext);
    Code:
       0: aload_1
       1: invokeinterface #67,  1           // InterfaceMethod io/undertow/security/api/SecurityContext.getIdentityManager:()Lio/undertow/security/idm/IdentityManager;
       6: areturn

  public io.undertow.security.api.AuthenticationMechanism$ChallengeResult sendChallenge(io.undertow.server.HttpServerExchange, io.undertow.security.api.SecurityContext);
    Code:
       0: aload_1
       1: getstatic     #23                 // Field org/jboss/security/negotiation/common/NegotiationContext.ATTACHMENT_KEY:Lio/undertow/util/AttachmentKey;
       4: invokevirtual #68                 // Method io/undertow/server/HttpServerExchange.getAttachment:(Lio/undertow/util/AttachmentKey;)Ljava/lang/Object;
       7: checkcast     #25                 // class org/jboss/security/negotiation/common/NegotiationContext
      10: astore_3
      11: getstatic     #69                 // Field NEGOTIATION_PLAIN:Ljava/lang/String;
      14: astore        4
      16: aload_3
      17: ifnull        98
      20: aload_3
      21: invokevirtual #48                 // Method org/jboss/security/negotiation/common/NegotiationContext.getResponseMessage:()Lorg/jboss/security/negotiation/NegotiationMessage;
      24: astore        5
      26: aload         5
      28: ifnull        98
      31: new           #49                 // class java/io/ByteArrayOutputStream
      34: dup
      35: invokespecial #50                 // Method java/io/ByteArrayOutputStream."<init>":()V
      38: astore        6
      40: aload         5
      42: aload         6
      44: iconst_1
      45: invokevirtual #51                 // Method org/jboss/security/negotiation/NegotiationMessage.writeTo:(Ljava/io/OutputStream;Z)V
      48: goto          63
      51: astore        7
      53: new           #52                 // class java/lang/IllegalStateException
      56: dup
      57: aload         7
      59: invokespecial #53                 // Method java/lang/IllegalStateException."<init>":(Ljava/lang/Throwable;)V
      62: athrow
      63: aload         6
      65: invokevirtual #54                 // Method java/io/ByteArrayOutputStream.toString:()Ljava/lang/String;
      68: astore        7
      70: aload         7
      72: invokestatic  #55                 // Method org/jboss/security/negotiation/common/MessageTrace.logResponseBase64:(Ljava/lang/String;)V
      75: new           #58                 // class java/lang/StringBuilder
      78: dup
      79: invokespecial #59                 // Method java/lang/StringBuilder."<init>":()V
      82: getstatic     #13                 // Field NEGOTIATE_PREFIX:Ljava/lang/String;
      85: invokevirtual #60                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      88: aload         7
      90: invokevirtual #60                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      93: invokevirtual #61                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      96: astore        4
      98: aload_1
      99: invokevirtual #56                 // Method io/undertow/server/HttpServerExchange.getResponseHeaders:()Lio/undertow/util/HeaderMap;
     102: getstatic     #57                 // Field io/undertow/util/Headers.WWW_AUTHENTICATE:Lio/undertow/util/HttpString;
     105: aload         4
     107: invokevirtual #62                 // Method io/undertow/util/HeaderMap.put:(Lio/undertow/util/HttpString;Ljava/lang/String;)Lio/undertow/util/HeaderMap;
     110: pop
     111: aload_1
     112: sipush        401
     115: invokevirtual #70                 // Method io/undertow/server/HttpServerExchange.setStatusCode:(I)Lio/undertow/server/HttpServerExchange;
     118: pop
     119: new           #71                 // class io/undertow/security/api/AuthenticationMechanism$ChallengeResult
     122: dup
     123: iconst_1
     124: sipush        401
     127: invokestatic  #72                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;
     130: invokespecial #73                 // Method io/undertow/security/api/AuthenticationMechanism$ChallengeResult."<init>":(ZLjava/lang/Integer;)V
     133: areturn
    Exception table:
       from    to  target type
          40    48    51   Class java/io/IOException

  static {};
    Code:
       0: ldc           #74                 // class org/jboss/security/negotiation/NegotiationMechanism
       2: invokestatic  #75                 // Method org/jboss/logging/Logger.getLogger:(Ljava/lang/Class;)Lorg/jboss/logging/Logger;
       5: putstatic     #3                  // Field log:Lorg/jboss/logging/Logger;
       8: getstatic     #76                 // Field io/undertow/util/Headers.NEGOTIATE:Lio/undertow/util/HttpString;
      11: invokevirtual #77                 // Method io/undertow/util/HttpString.toString:()Ljava/lang/String;
      14: putstatic     #69                 // Field NEGOTIATION_PLAIN:Ljava/lang/String;
      17: new           #58                 // class java/lang/StringBuilder
      20: dup
      21: invokespecial #59                 // Method java/lang/StringBuilder."<init>":()V
      24: getstatic     #76                 // Field io/undertow/util/Headers.NEGOTIATE:Lio/undertow/util/HttpString;
      27: invokevirtual #78                 // Method java/lang/StringBuilder.append:(Ljava/lang/Object;)Ljava/lang/StringBuilder;
      30: ldc           #79                 // String
      32: invokevirtual #60                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      35: invokevirtual #61                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      38: putstatic     #13                 // Field NEGOTIATE_PREFIX:Ljava/lang/String;
      41: return
}
