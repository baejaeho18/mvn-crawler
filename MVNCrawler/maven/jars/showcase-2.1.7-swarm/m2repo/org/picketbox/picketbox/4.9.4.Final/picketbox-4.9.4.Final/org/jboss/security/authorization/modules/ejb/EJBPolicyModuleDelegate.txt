Compiled from "EJBPolicyModuleDelegate.java"
public class org.jboss.security.authorization.modules.ejb.EJBPolicyModuleDelegate extends org.jboss.security.authorization.modules.AuthorizationModuleDelegate {
  protected java.lang.String ejbName;

  protected java.lang.reflect.Method ejbMethod;

  protected java.security.Principal ejbPrincipal;

  private org.jboss.security.identity.RoleGroup methodRoles;

  private java.lang.String methodInterface;

  protected org.jboss.security.RunAs callerRunAs;

  protected java.lang.String roleName;

  private java.lang.Boolean roleRefCheck;

  protected java.util.Set<org.jboss.security.javaee.SecurityRoleRef> securityRoleReferences;

  private final org.jboss.security.identity.Role ANYBODY_ROLE;

  private final org.jboss.security.identity.Role STAR_ROLE;

  private final java.security.Principal UNAUTHENTICATED_PRINCIPAL;

  protected boolean ejbRestrictions;

  public org.jboss.security.authorization.modules.ejb.EJBPolicyModuleDelegate();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method org/jboss/security/authorization/modules/AuthorizationModuleDelegate."<init>":()V
       4: aload_0
       5: aconst_null
       6: putfield      #2                  // Field ejbName:Ljava/lang/String;
       9: aload_0
      10: aconst_null
      11: putfield      #3                  // Field ejbMethod:Ljava/lang/reflect/Method;
      14: aload_0
      15: aconst_null
      16: putfield      #4                  // Field ejbPrincipal:Ljava/security/Principal;
      19: aload_0
      20: aconst_null
      21: putfield      #5                  // Field methodRoles:Lorg/jboss/security/identity/RoleGroup;
      24: aload_0
      25: aconst_null
      26: putfield      #6                  // Field methodInterface:Ljava/lang/String;
      29: aload_0
      30: aconst_null
      31: putfield      #7                  // Field callerRunAs:Lorg/jboss/security/RunAs;
      34: aload_0
      35: aconst_null
      36: putfield      #8                  // Field roleName:Ljava/lang/String;
      39: aload_0
      40: getstatic     #9                  // Field java/lang/Boolean.FALSE:Ljava/lang/Boolean;
      43: putfield      #10                 // Field roleRefCheck:Ljava/lang/Boolean;
      46: aload_0
      47: aconst_null
      48: putfield      #11                 // Field securityRoleReferences:Ljava/util/Set;
      51: aload_0
      52: new           #12                 // class org/jboss/security/identity/plugins/SimpleRole
      55: dup
      56: ldc           #14                 // String <ANYBODY>
      58: invokespecial #15                 // Method org/jboss/security/identity/plugins/SimpleRole."<init>":(Ljava/lang/String;)V
      61: putfield      #16                 // Field ANYBODY_ROLE:Lorg/jboss/security/identity/Role;
      64: aload_0
      65: new           #12                 // class org/jboss/security/identity/plugins/SimpleRole
      68: dup
      69: ldc           #17                 // String **
      71: invokespecial #15                 // Method org/jboss/security/identity/plugins/SimpleRole."<init>":(Ljava/lang/String;)V
      74: putfield      #18                 // Field STAR_ROLE:Lorg/jboss/security/identity/Role;
      77: aload_0
      78: new           #19                 // class org/jboss/security/SimplePrincipal
      81: dup
      82: ldc           #20                 // String anonymous
      84: invokespecial #21                 // Method org/jboss/security/SimplePrincipal."<init>":(Ljava/lang/String;)V
      87: putfield      #22                 // Field UNAUTHENTICATED_PRINCIPAL:Ljava/security/Principal;
      90: aload_0
      91: iconst_0
      92: putfield      #23                 // Field ejbRestrictions:Z
      95: return

  public int authorize(org.jboss.security.authorization.Resource, javax.security.auth.Subject, org.jboss.security.identity.RoleGroup);
    Code:
       0: aload_1
       1: instanceof    #24                 // class org/jboss/security/authorization/resources/EJBResource
       4: ifne          21
       7: getstatic     #25                 // Field org/jboss/security/PicketBoxMessages.MESSAGES:Lorg/jboss/security/PicketBoxMessages;
      10: ldc           #24                 // class org/jboss/security/authorization/resources/EJBResource
      12: invokevirtual #26                 // Method java/lang/Class.getName:()Ljava/lang/String;
      15: invokeinterface #27,  2           // InterfaceMethod org/jboss/security/PicketBoxMessages.invalidType:(Ljava/lang/String;)Ljava/lang/IllegalArgumentException;
      20: athrow
      21: aload_1
      22: checkcast     #24                 // class org/jboss/security/authorization/resources/EJBResource
      25: astore        4
      27: aload_1
      28: invokeinterface #28,  1           // InterfaceMethod org/jboss/security/authorization/Resource.getMap:()Ljava/util/Map;
      33: astore        5
      35: aload         5
      37: ifnonnull     51
      40: getstatic     #25                 // Field org/jboss/security/PicketBoxMessages.MESSAGES:Lorg/jboss/security/PicketBoxMessages;
      43: ldc           #29                 // String resourceMap
      45: invokeinterface #30,  2           // InterfaceMethod org/jboss/security/PicketBoxMessages.invalidNullProperty:(Ljava/lang/String;)Ljava/lang/IllegalStateException;
      50: athrow
      51: aload_0
      52: aload         5
      54: ldc           #32                 // String policyRegistration
      56: invokeinterface #33,  2           // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
      61: checkcast     #34                 // class org/jboss/security/authorization/PolicyRegistration
      64: putfield      #35                 // Field policyRegistration:Lorg/jboss/security/authorization/PolicyRegistration;
      67: aload_0
      68: aload         5
      70: ldc           #36                 // String roleName
      72: invokeinterface #33,  2           // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
      77: checkcast     #37                 // class java/lang/String
      80: putfield      #8                  // Field roleName:Ljava/lang/String;
      83: aload_0
      84: aload         5
      86: ldc           #38                 // String roleRefPermissionCheck
      88: invokeinterface #33,  2           // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
      93: checkcast     #39                 // class java/lang/Boolean
      96: putfield      #10                 // Field roleRefCheck:Ljava/lang/Boolean;
      99: aload_0
     100: aload         4
     102: invokevirtual #40                 // Method org/jboss/security/authorization/resources/EJBResource.getCallerRunAsIdentity:()Lorg/jboss/security/RunAs;
     105: putfield      #7                  // Field callerRunAs:Lorg/jboss/security/RunAs;
     108: aload_0
     109: aload         4
     111: invokevirtual #41                 // Method org/jboss/security/authorization/resources/EJBResource.getEjbMethod:()Ljava/lang/reflect/Method;
     114: putfield      #3                  // Field ejbMethod:Ljava/lang/reflect/Method;
     117: aload_0
     118: aload         4
     120: invokevirtual #42                 // Method org/jboss/security/authorization/resources/EJBResource.getEjbName:()Ljava/lang/String;
     123: putfield      #2                  // Field ejbName:Ljava/lang/String;
     126: aload_0
     127: aload         4
     129: invokevirtual #43                 // Method org/jboss/security/authorization/resources/EJBResource.getPrincipal:()Ljava/security/Principal;
     132: putfield      #4                  // Field ejbPrincipal:Ljava/security/Principal;
     135: aload_0
     136: aload         4
     138: invokevirtual #44                 // Method org/jboss/security/authorization/resources/EJBResource.getEjbMethodInterface:()Ljava/lang/String;
     141: putfield      #6                  // Field methodInterface:Ljava/lang/String;
     144: aload_0
     145: aload         4
     147: invokevirtual #45                 // Method org/jboss/security/authorization/resources/EJBResource.getEjbMethodRoles:()Lorg/jboss/security/identity/RoleGroup;
     150: putfield      #5                  // Field methodRoles:Lorg/jboss/security/identity/RoleGroup;
     153: aload_0
     154: aload         4
     156: invokevirtual #46                 // Method org/jboss/security/authorization/resources/EJBResource.getSecurityRoleReferences:()Ljava/util/Set;
     159: putfield      #11                 // Field securityRoleReferences:Ljava/util/Set;
     162: aload_0
     163: aload         4
     165: invokevirtual #47                 // Method org/jboss/security/authorization/resources/EJBResource.isEnforceEJBRestrictions:()Z
     168: putfield      #23                 // Field ejbRestrictions:Z
     171: aload_0
     172: getfield      #10                 // Field roleRefCheck:Ljava/lang/Boolean;
     175: getstatic     #48                 // Field java/lang/Boolean.TRUE:Ljava/lang/Boolean;
     178: if_acmpne     187
     181: aload_0
     182: aload_3
     183: invokevirtual #49                 // Method checkRoleRef:(Lorg/jboss/security/identity/RoleGroup;)I
     186: ireturn
     187: aload_0
     188: aload_3
     189: invokespecial #50                 // Method process:(Lorg/jboss/security/identity/RoleGroup;)I
     192: ireturn

  private int process(org.jboss.security.identity.RoleGroup);
    Code:
       0: iconst_1
       1: istore_2
       2: aload_0
       3: getfield      #3                  // Field ejbMethod:Ljava/lang/reflect/Method;
       6: ifnonnull     20
       9: getstatic     #25                 // Field org/jboss/security/PicketBoxMessages.MESSAGES:Lorg/jboss/security/PicketBoxMessages;
      12: ldc           #51                 // String ejbMethod
      14: invokeinterface #30,  2           // InterfaceMethod org/jboss/security/PicketBoxMessages.invalidNullProperty:(Ljava/lang/String;)Ljava/lang/IllegalStateException;
      19: athrow
      20: aload_0
      21: getfield      #5                  // Field methodRoles:Lorg/jboss/security/identity/RoleGroup;
      24: ifnonnull     61
      27: getstatic     #52                 // Field org/jboss/security/PicketBoxLogger.LOGGER:Lorg/jboss/security/PicketBoxLogger;
      30: invokeinterface #53,  1           // InterfaceMethod org/jboss/security/PicketBoxLogger.isTraceEnabled:()Z
      35: ifeq          59
      38: aload_0
      39: getfield      #3                  // Field ejbMethod:Ljava/lang/reflect/Method;
      42: invokevirtual #54                 // Method java/lang/reflect/Method.getName:()Ljava/lang/String;
      45: astore_3
      46: getstatic     #52                 // Field org/jboss/security/PicketBoxLogger.LOGGER:Lorg/jboss/security/PicketBoxLogger;
      49: aload_3
      50: aload_0
      51: getfield      #6                  // Field methodInterface:Ljava/lang/String;
      54: invokeinterface #55,  3           // InterfaceMethod org/jboss/security/PicketBoxLogger.traceNoMethodPermissions:(Ljava/lang/String;Ljava/lang/String;)V
      59: iconst_m1
      60: ireturn
      61: getstatic     #52                 // Field org/jboss/security/PicketBoxLogger.LOGGER:Lorg/jboss/security/PicketBoxLogger;
      64: invokeinterface #57,  1           // InterfaceMethod org/jboss/security/PicketBoxLogger.isDebugEnabled:()Z
      69: ifeq          98
      72: getstatic     #52                 // Field org/jboss/security/PicketBoxLogger.LOGGER:Lorg/jboss/security/PicketBoxLogger;
      75: aload_0
      76: getfield      #3                  // Field ejbMethod:Ljava/lang/reflect/Method;
      79: invokevirtual #54                 // Method java/lang/reflect/Method.getName:()Ljava/lang/String;
      82: aload_0
      83: getfield      #6                  // Field methodInterface:Ljava/lang/String;
      86: aload_0
      87: getfield      #5                  // Field methodRoles:Lorg/jboss/security/identity/RoleGroup;
      90: invokevirtual #58                 // Method java/lang/Object.toString:()Ljava/lang/String;
      93: invokeinterface #59,  4           // InterfaceMethod org/jboss/security/PicketBoxLogger.debugEJBPolicyModuleDelegateState:(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
      98: aload_0
      99: getfield      #5                  // Field methodRoles:Lorg/jboss/security/identity/RoleGroup;
     102: aload_0
     103: getfield      #16                 // Field ANYBODY_ROLE:Lorg/jboss/security/identity/Role;
     106: invokeinterface #60,  2           // InterfaceMethod org/jboss/security/identity/RoleGroup.containsAll:(Lorg/jboss/security/identity/Role;)Z
     111: ifne          378
     114: aload_0
     115: getfield      #7                  // Field callerRunAs:Lorg/jboss/security/RunAs;
     118: ifnonnull     263
     121: aload_0
     122: getfield      #4                  // Field ejbPrincipal:Ljava/security/Principal;
     125: ifnull        178
     128: aload_0
     129: getfield      #4                  // Field ejbPrincipal:Ljava/security/Principal;
     132: aload_0
     133: getfield      #22                 // Field UNAUTHENTICATED_PRINCIPAL:Ljava/security/Principal;
     136: invokeinterface #61,  2           // InterfaceMethod java/security/Principal.equals:(Ljava/lang/Object;)Z
     141: ifne          178
     144: aload_1
     145: ifnonnull     168
     148: new           #62                 // class org/jboss/security/identity/plugins/SimpleRoleGroup
     151: dup
     152: aload_0
     153: getfield      #18                 // Field STAR_ROLE:Lorg/jboss/security/identity/Role;
     156: invokeinterface #63,  1           // InterfaceMethod org/jboss/security/identity/Role.getRoleName:()Ljava/lang/String;
     161: invokespecial #64                 // Method org/jboss/security/identity/plugins/SimpleRoleGroup."<init>":(Ljava/lang/String;)V
     164: astore_1
     165: goto          178
     168: aload_1
     169: aload_0
     170: getfield      #18                 // Field STAR_ROLE:Lorg/jboss/security/identity/Role;
     173: invokeinterface #65,  2           // InterfaceMethod org/jboss/security/identity/RoleGroup.addRole:(Lorg/jboss/security/identity/Role;)V
     178: aload_1
     179: ifnonnull     193
     182: getstatic     #25                 // Field org/jboss/security/PicketBoxMessages.MESSAGES:Lorg/jboss/security/PicketBoxMessages;
     185: ldc           #66                 // String principalRole
     187: invokeinterface #30,  2           // InterfaceMethod org/jboss/security/PicketBoxMessages.invalidNullProperty:(Ljava/lang/String;)Ljava/lang/IllegalStateException;
     192: athrow
     193: aload_0
     194: getfield      #5                  // Field methodRoles:Lorg/jboss/security/identity/RoleGroup;
     197: aload_1
     198: invokeinterface #67,  2           // InterfaceMethod org/jboss/security/identity/RoleGroup.containsAtleastOneRole:(Lorg/jboss/security/identity/RoleGroup;)Z
     203: ifne          378
     206: getstatic     #52                 // Field org/jboss/security/PicketBoxLogger.LOGGER:Lorg/jboss/security/PicketBoxLogger;
     209: invokeinterface #57,  1           // InterfaceMethod org/jboss/security/PicketBoxLogger.isDebugEnabled:()Z
     214: ifeq          258
     217: aload_0
     218: getfield      #3                  // Field ejbMethod:Ljava/lang/reflect/Method;
     221: invokevirtual #54                 // Method java/lang/reflect/Method.getName:()Ljava/lang/String;
     224: astore_3
     225: getstatic     #52                 // Field org/jboss/security/PicketBoxLogger.LOGGER:Lorg/jboss/security/PicketBoxLogger;
     228: aload_0
     229: getfield      #4                  // Field ejbPrincipal:Ljava/security/Principal;
     232: aload_0
     233: getfield      #2                  // Field ejbName:Ljava/lang/String;
     236: aload_3
     237: aload_0
     238: getfield      #6                  // Field methodInterface:Ljava/lang/String;
     241: aload_0
     242: getfield      #5                  // Field methodRoles:Lorg/jboss/security/identity/RoleGroup;
     245: invokevirtual #58                 // Method java/lang/Object.toString:()Ljava/lang/String;
     248: aload_1
     249: invokevirtual #58                 // Method java/lang/Object.toString:()Ljava/lang/String;
     252: aconst_null
     253: invokeinterface #68,  8           // InterfaceMethod org/jboss/security/PicketBoxLogger.debugInsufficientMethodPermissions:(Ljava/security/Principal;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
     258: iconst_0
     259: istore_2
     260: goto          378
     263: aload_0
     264: getfield      #7                  // Field callerRunAs:Lorg/jboss/security/RunAs;
     267: instanceof    #69                 // class org/jboss/security/RunAsIdentity
     270: ifeq          378
     273: aload_0
     274: getfield      #7                  // Field callerRunAs:Lorg/jboss/security/RunAs;
     277: checkcast     #69                 // class org/jboss/security/RunAsIdentity
     280: astore_3
     281: new           #62                 // class org/jboss/security/identity/plugins/SimpleRoleGroup
     284: dup
     285: aload_3
     286: invokevirtual #70                 // Method org/jboss/security/RunAsIdentity.getRunAsRoles:()Ljava/util/Set;
     289: invokespecial #71                 // Method org/jboss/security/identity/plugins/SimpleRoleGroup."<init>":(Ljava/util/Set;)V
     292: astore        4
     294: aload         4
     296: aload_0
     297: getfield      #18                 // Field STAR_ROLE:Lorg/jboss/security/identity/Role;
     300: invokeinterface #65,  2           // InterfaceMethod org/jboss/security/identity/RoleGroup.addRole:(Lorg/jboss/security/identity/Role;)V
     305: aload         4
     307: aload_0
     308: getfield      #5                  // Field methodRoles:Lorg/jboss/security/identity/RoleGroup;
     311: invokeinterface #67,  2           // InterfaceMethod org/jboss/security/identity/RoleGroup.containsAtleastOneRole:(Lorg/jboss/security/identity/RoleGroup;)Z
     316: ifne          378
     319: aload_0
     320: getfield      #3                  // Field ejbMethod:Ljava/lang/reflect/Method;
     323: invokevirtual #54                 // Method java/lang/reflect/Method.getName:()Ljava/lang/String;
     326: astore        5
     328: getstatic     #52                 // Field org/jboss/security/PicketBoxLogger.LOGGER:Lorg/jboss/security/PicketBoxLogger;
     331: invokeinterface #57,  1           // InterfaceMethod org/jboss/security/PicketBoxLogger.isDebugEnabled:()Z
     336: ifeq          376
     339: getstatic     #52                 // Field org/jboss/security/PicketBoxLogger.LOGGER:Lorg/jboss/security/PicketBoxLogger;
     342: aload_0
     343: getfield      #4                  // Field ejbPrincipal:Ljava/security/Principal;
     346: aload_0
     347: getfield      #2                  // Field ejbName:Ljava/lang/String;
     350: aload         5
     352: aload_0
     353: getfield      #6                  // Field methodInterface:Ljava/lang/String;
     356: aload_0
     357: getfield      #5                  // Field methodRoles:Lorg/jboss/security/identity/RoleGroup;
     360: invokevirtual #58                 // Method java/lang/Object.toString:()Ljava/lang/String;
     363: aconst_null
     364: aload_3
     365: invokevirtual #70                 // Method org/jboss/security/RunAsIdentity.getRunAsRoles:()Ljava/util/Set;
     368: invokevirtual #58                 // Method java/lang/Object.toString:()Ljava/lang/String;
     371: invokeinterface #68,  8           // InterfaceMethod org/jboss/security/PicketBoxLogger.debugInsufficientMethodPermissions:(Ljava/security/Principal;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
     376: iconst_0
     377: istore_2
     378: iload_2
     379: ifeq          386
     382: iconst_1
     383: goto          387
     386: iconst_m1
     387: ireturn

  protected int checkRoleRef(org.jboss.security.identity.RoleGroup);
    Code:
       0: aload_0
       1: getfield      #4                  // Field ejbPrincipal:Ljava/security/Principal;
       4: ifnonnull     16
       7: aload_0
       8: getfield      #7                  // Field callerRunAs:Lorg/jboss/security/RunAs;
      11: ifnonnull     16
      14: iconst_m1
      15: ireturn
      16: iconst_0
      17: istore_2
      18: aload_0
      19: getfield      #11                 // Field securityRoleReferences:Ljava/util/Set;
      22: invokeinterface #72,  1           // InterfaceMethod java/util/Set.iterator:()Ljava/util/Iterator;
      27: astore_3
      28: aload_3
      29: invokeinterface #73,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
      34: ifeq          80
      37: aload_3
      38: invokeinterface #74,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      43: checkcast     #75                 // class org/jboss/security/javaee/SecurityRoleRef
      46: astore        4
      48: aload         4
      50: invokevirtual #76                 // Method org/jboss/security/javaee/SecurityRoleRef.getName:()Ljava/lang/String;
      53: aload_0
      54: getfield      #8                  // Field roleName:Ljava/lang/String;
      57: invokevirtual #77                 // Method java/lang/String.equals:(Ljava/lang/Object;)Z
      60: ifeq          77
      63: aload_0
      64: aload         4
      66: invokevirtual #78                 // Method org/jboss/security/javaee/SecurityRoleRef.getLink:()Ljava/lang/String;
      69: putfield      #8                  // Field roleName:Ljava/lang/String;
      72: iconst_1
      73: istore_2
      74: goto          80
      77: goto          28
      80: iload_2
      81: ifne          104
      84: aload_0
      85: getfield      #23                 // Field ejbRestrictions:Z
      88: ifeq          104
      91: getstatic     #25                 // Field org/jboss/security/PicketBoxMessages.MESSAGES:Lorg/jboss/security/PicketBoxMessages;
      94: aload_0
      95: getfield      #8                  // Field roleName:Ljava/lang/String;
      98: invokeinterface #79,  2           // InterfaceMethod org/jboss/security/PicketBoxMessages.noMatchingRoleFoundInDescriptor:(Ljava/lang/String;)Ljava/lang/RuntimeException;
     103: athrow
     104: new           #12                 // class org/jboss/security/identity/plugins/SimpleRole
     107: dup
     108: aload_0
     109: getfield      #8                  // Field roleName:Ljava/lang/String;
     112: invokespecial #15                 // Method org/jboss/security/identity/plugins/SimpleRole."<init>":(Ljava/lang/String;)V
     115: astore        4
     117: iconst_0
     118: istore        5
     120: aload_0
     121: getfield      #7                  // Field callerRunAs:Lorg/jboss/security/RunAs;
     124: ifnonnull     140
     127: aload_1
     128: aload         4
     130: invokeinterface #80,  2           // InterfaceMethod org/jboss/security/identity/RoleGroup.containsRole:(Lorg/jboss/security/identity/Role;)Z
     135: istore        5
     137: goto          182
     140: aload_0
     141: getfield      #7                  // Field callerRunAs:Lorg/jboss/security/RunAs;
     144: instanceof    #69                 // class org/jboss/security/RunAsIdentity
     147: ifeq          182
     150: aload_0
     151: getfield      #7                  // Field callerRunAs:Lorg/jboss/security/RunAs;
     154: checkcast     #69                 // class org/jboss/security/RunAsIdentity
     157: astore        6
     159: new           #62                 // class org/jboss/security/identity/plugins/SimpleRoleGroup
     162: dup
     163: aload         6
     165: invokevirtual #70                 // Method org/jboss/security/RunAsIdentity.getRunAsRoles:()Ljava/util/Set;
     168: invokespecial #71                 // Method org/jboss/security/identity/plugins/SimpleRoleGroup."<init>":(Ljava/util/Set;)V
     171: astore        7
     173: aload         7
     175: aload         4
     177: invokevirtual #81                 // Method org/jboss/security/identity/plugins/SimpleRoleGroup.containsRole:(Lorg/jboss/security/identity/Role;)Z
     180: istore        5
     182: iload         5
     184: ifeq          191
     187: iconst_1
     188: goto          192
     191: iconst_m1
     192: ireturn
}
