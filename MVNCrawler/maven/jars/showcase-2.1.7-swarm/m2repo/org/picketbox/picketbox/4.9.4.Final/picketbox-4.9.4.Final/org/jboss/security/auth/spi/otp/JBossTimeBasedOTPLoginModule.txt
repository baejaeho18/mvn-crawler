Compiled from "JBossTimeBasedOTPLoginModule.java"
public class org.jboss.security.auth.spi.otp.JBossTimeBasedOTPLoginModule implements javax.security.auth.spi.LoginModule {
  private static final java.lang.String PASSWORD_STACKING;

  private static final java.lang.String USE_FIRST_PASSWORD;

  private static final java.lang.String NUM_OF_DIGITS_OPT;

  private static final java.lang.String ALGORITHM;

  private static final java.lang.String ADDITIONAL_ROLES;

  private static final java.lang.String[] ALL_VALID_OPTIONS;

  public static final java.lang.String TOTP;

  private java.util.Map<java.lang.String, java.lang.Object> lmSharedState;

  private java.util.Map<java.lang.String, java.lang.Object> lmOptions;

  private javax.security.auth.callback.CallbackHandler callbackHandler;

  private boolean useFirstPass;

  private int NUMBER_OF_DIGITS;

  private java.lang.String additionalRoles;

  private java.lang.String algorithm;

  private javax.security.auth.Subject subject;

  public org.jboss.security.auth.spi.otp.JBossTimeBasedOTPLoginModule();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object."<init>":()V
       4: aload_0
       5: new           #2                  // class java/util/HashMap
       8: dup
       9: invokespecial #3                  // Method java/util/HashMap."<init>":()V
      12: putfield      #4                  // Field lmSharedState:Ljava/util/Map;
      15: aload_0
      16: new           #2                  // class java/util/HashMap
      19: dup
      20: invokespecial #3                  // Method java/util/HashMap."<init>":()V
      23: putfield      #5                  // Field lmOptions:Ljava/util/Map;
      26: aload_0
      27: bipush        6
      29: putfield      #6                  // Field NUMBER_OF_DIGITS:I
      32: aload_0
      33: aconst_null
      34: putfield      #7                  // Field additionalRoles:Ljava/lang/String;
      37: aload_0
      38: ldc           #9                  // String HmacSHA1
      40: putfield      #10                 // Field algorithm:Ljava/lang/String;
      43: return

  public void initialize(javax.security.auth.Subject, javax.security.auth.callback.CallbackHandler, java.util.Map<java.lang.String, ?>, java.util.Map<java.lang.String, ?>);
    Code:
       0: new           #11                 // class java/util/HashSet
       3: dup
       4: getstatic     #12                 // Field ALL_VALID_OPTIONS:[Ljava/lang/String;
       7: invokestatic  #13                 // Method java/util/Arrays.asList:([Ljava/lang/Object;)Ljava/util/List;
      10: invokespecial #14                 // Method java/util/HashSet."<init>":(Ljava/util/Collection;)V
      13: astore        5
      15: aload         4
      17: invokeinterface #15,  1           // InterfaceMethod java/util/Map.keySet:()Ljava/util/Set;
      22: invokeinterface #16,  1           // InterfaceMethod java/util/Set.iterator:()Ljava/util/Iterator;
      27: astore        6
      29: aload         6
      31: invokeinterface #17,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
      36: ifeq          74
      39: aload         6
      41: invokeinterface #18,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      46: checkcast     #19                 // class java/lang/String
      49: astore        7
      51: aload         5
      53: aload         7
      55: invokevirtual #20                 // Method java/util/HashSet.contains:(Ljava/lang/Object;)Z
      58: ifne          71
      61: getstatic     #21                 // Field org/jboss/security/PicketBoxLogger.LOGGER:Lorg/jboss/security/PicketBoxLogger;
      64: aload         7
      66: invokeinterface #22,  2           // InterfaceMethod org/jboss/security/PicketBoxLogger.warnInvalidModuleOption:(Ljava/lang/String;)V
      71: goto          29
      74: aload_0
      75: aload_1
      76: putfield      #23                 // Field subject:Ljavax/security/auth/Subject;
      79: aload_0
      80: aload_2
      81: putfield      #24                 // Field callbackHandler:Ljavax/security/auth/callback/CallbackHandler;
      84: aload_0
      85: getfield      #4                  // Field lmSharedState:Ljava/util/Map;
      88: aload_3
      89: invokeinterface #25,  2           // InterfaceMethod java/util/Map.putAll:(Ljava/util/Map;)V
      94: aload_0
      95: getfield      #5                  // Field lmOptions:Ljava/util/Map;
      98: aload         4
     100: invokeinterface #25,  2           // InterfaceMethod java/util/Map.putAll:(Ljava/util/Map;)V
     105: aload         4
     107: ldc           #27                 // String password-stacking
     109: invokeinterface #28,  2           // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
     114: checkcast     #19                 // class java/lang/String
     117: astore        6
     119: aload         6
     121: ifnull        139
     124: aload         6
     126: ldc           #29                 // String useFirstPass
     128: invokevirtual #30                 // Method java/lang/String.equalsIgnoreCase:(Ljava/lang/String;)Z
     131: ifeq          139
     134: aload_0
     135: iconst_1
     136: putfield      #31                 // Field useFirstPass:Z
     139: aload         4
     141: ldc           #32                 // String numOfDigits
     143: invokeinterface #28,  2           // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
     148: checkcast     #19                 // class java/lang/String
     151: astore        7
     153: aload         7
     155: ifnull        175
     158: aload         7
     160: invokevirtual #33                 // Method java/lang/String.length:()I
     163: ifle          175
     166: aload_0
     167: aload         7
     169: invokestatic  #34                 // Method java/lang/Integer.parseInt:(Ljava/lang/String;)I
     172: putfield      #6                  // Field NUMBER_OF_DIGITS:I
     175: aload         4
     177: ldc           #35                 // String algorithm
     179: invokeinterface #28,  2           // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
     184: checkcast     #19                 // class java/lang/String
     187: astore        8
     189: aload         8
     191: ifnull        234
     194: aload         8
     196: invokevirtual #36                 // Method java/lang/String.isEmpty:()Z
     199: ifne          234
     202: aload         8
     204: ldc           #37                 // String HmacSHA256
     206: invokevirtual #30                 // Method java/lang/String.equalsIgnoreCase:(Ljava/lang/String;)Z
     209: ifeq          218
     212: aload_0
     213: ldc           #37                 // String HmacSHA256
     215: putfield      #10                 // Field algorithm:Ljava/lang/String;
     218: aload         8
     220: ldc           #38                 // String HmacSHA512
     222: invokevirtual #30                 // Method java/lang/String.equalsIgnoreCase:(Ljava/lang/String;)Z
     225: ifeq          234
     228: aload_0
     229: ldc           #38                 // String HmacSHA512
     231: putfield      #10                 // Field algorithm:Ljava/lang/String;
     234: aload_0
     235: aload         4
     237: ldc           #39                 // String additionalRoles
     239: invokeinterface #28,  2           // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
     244: checkcast     #19                 // class java/lang/String
     247: putfield      #7                  // Field additionalRoles:Ljava/lang/String;
     250: return

  public boolean login() throws javax.security.auth.login.LoginException;
    Code:
       0: aload_0
       1: getfield      #31                 // Field useFirstPass:Z
       4: ifeq          25
       7: aload_0
       8: getfield      #4                  // Field lmSharedState:Ljava/util/Map;
      11: ldc           #40                 // String javax.security.auth.login.name
      13: invokeinterface #28,  2           // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
      18: checkcast     #19                 // class java/lang/String
      21: astore_1
      22: goto          92
      25: new           #41                 // class javax/security/auth/callback/NameCallback
      28: dup
      29: getstatic     #42                 // Field org/jboss/security/PicketBoxMessages.MESSAGES:Lorg/jboss/security/PicketBoxMessages;
      32: invokeinterface #43,  1           // InterfaceMethod org/jboss/security/PicketBoxMessages.enterUsernameMessage:()Ljava/lang/String;
      37: ldc           #44                 // String guest
      39: invokespecial #45                 // Method javax/security/auth/callback/NameCallback."<init>":(Ljava/lang/String;Ljava/lang/String;)V
      42: astore_2
      43: iconst_1
      44: anewarray     #46                 // class javax/security/auth/callback/Callback
      47: dup
      48: iconst_0
      49: aload_2
      50: aastore
      51: astore_3
      52: aload_0
      53: getfield      #24                 // Field callbackHandler:Ljavax/security/auth/callback/CallbackHandler;
      56: aload_3
      57: invokeinterface #47,  2           // InterfaceMethod javax/security/auth/callback/CallbackHandler.handle:([Ljavax/security/auth/callback/Callback;)V
      62: goto          87
      65: astore        4
      67: new           #49                 // class javax/security/auth/login/LoginException
      70: dup
      71: invokespecial #50                 // Method javax/security/auth/login/LoginException."<init>":()V
      74: astore        5
      76: aload         5
      78: aload         4
      80: invokevirtual #51                 // Method javax/security/auth/login/LoginException.initCause:(Ljava/lang/Throwable;)Ljava/lang/Throwable;
      83: pop
      84: aload         5
      86: athrow
      87: aload_2
      88: invokevirtual #52                 // Method javax/security/auth/callback/NameCallback.getName:()Ljava/lang/String;
      91: astore_1
      92: invokestatic  #53                 // Method org/jboss/security/auth/spi/otp/SecurityActions.getContextClassLoader:()Ljava/lang/ClassLoader;
      95: astore_2
      96: aconst_null
      97: astore_3
      98: new           #54                 // class java/util/Properties
     101: dup
     102: invokespecial #55                 // Method java/util/Properties."<init>":()V
     105: astore        4
     107: aload_2
     108: ldc           #56                 // String otp-users.properties
     110: invokevirtual #57                 // Method java/lang/ClassLoader.getResourceAsStream:(Ljava/lang/String;)Ljava/io/InputStream;
     113: astore_3
     114: aload         4
     116: aload_3
     117: invokevirtual #58                 // Method java/util/Properties.load:(Ljava/io/InputStream;)V
     120: aload_0
     121: aload_3
     122: invokespecial #59                 // Method safeClose:(Ljava/io/InputStream;)V
     125: goto          160
     128: astore        5
     130: new           #49                 // class javax/security/auth/login/LoginException
     133: dup
     134: invokespecial #50                 // Method javax/security/auth/login/LoginException."<init>":()V
     137: astore        6
     139: aload         6
     141: aload         5
     143: invokevirtual #51                 // Method javax/security/auth/login/LoginException.initCause:(Ljava/lang/Throwable;)Ljava/lang/Throwable;
     146: pop
     147: aload         6
     149: athrow
     150: astore        7
     152: aload_0
     153: aload_3
     154: invokespecial #59                 // Method safeClose:(Ljava/io/InputStream;)V
     157: aload         7
     159: athrow
     160: aload         4
     162: aload_1
     163: invokevirtual #61                 // Method java/util/Properties.getProperty:(Ljava/lang/String;)Ljava/lang/String;
     166: astore        5
     168: aload_0
     169: invokespecial #62                 // Method getTimeBasedOTPFromRequest:()Ljava/lang/String;
     172: astore        6
     174: aload         6
     176: ifnull        187
     179: aload         6
     181: invokevirtual #33                 // Method java/lang/String.length:()I
     184: ifne          195
     187: new           #49                 // class javax/security/auth/login/LoginException
     190: dup
     191: invokespecial #50                 // Method javax/security/auth/login/LoginException."<init>":()V
     194: athrow
     195: iconst_0
     196: istore        7
     198: aload_0
     199: getfield      #10                 // Field algorithm:Ljava/lang/String;
     202: ldc           #9                  // String HmacSHA1
     204: invokevirtual #63                 // Method java/lang/String.equals:(Ljava/lang/Object;)Z
     207: ifeq          229
     210: aload         6
     212: aload         5
     214: invokevirtual #64                 // Method java/lang/String.getBytes:()[B
     217: aload_0
     218: getfield      #6                  // Field NUMBER_OF_DIGITS:I
     221: invokestatic  #65                 // Method org/jboss/security/otp/TimeBasedOTPUtil.validate:(Ljava/lang/String;[BI)Z
     224: istore        7
     226: goto          288
     229: aload_0
     230: getfield      #10                 // Field algorithm:Ljava/lang/String;
     233: ldc           #37                 // String HmacSHA256
     235: invokevirtual #63                 // Method java/lang/String.equals:(Ljava/lang/Object;)Z
     238: ifeq          260
     241: aload         6
     243: aload         5
     245: invokevirtual #64                 // Method java/lang/String.getBytes:()[B
     248: aload_0
     249: getfield      #6                  // Field NUMBER_OF_DIGITS:I
     252: invokestatic  #66                 // Method org/jboss/security/otp/TimeBasedOTPUtil.validate256:(Ljava/lang/String;[BI)Z
     255: istore        7
     257: goto          288
     260: aload_0
     261: getfield      #10                 // Field algorithm:Ljava/lang/String;
     264: ldc           #38                 // String HmacSHA512
     266: invokevirtual #63                 // Method java/lang/String.equals:(Ljava/lang/Object;)Z
     269: ifeq          288
     272: aload         6
     274: aload         5
     276: invokevirtual #64                 // Method java/lang/String.getBytes:()[B
     279: aload_0
     280: getfield      #6                  // Field NUMBER_OF_DIGITS:I
     283: invokestatic  #67                 // Method org/jboss/security/otp/TimeBasedOTPUtil.validate512:(Ljava/lang/String;[BI)Z
     286: istore        7
     288: iload         7
     290: ifne          301
     293: new           #49                 // class javax/security/auth/login/LoginException
     296: dup
     297: invokespecial #50                 // Method javax/security/auth/login/LoginException."<init>":()V
     300: athrow
     301: aload_0
     302: getfield      #23                 // Field subject:Ljavax/security/auth/Subject;
     305: ldc           #68                 // class java/security/acl/Group
     307: invokevirtual #69                 // Method javax/security/auth/Subject.getPrincipals:(Ljava/lang/Class;)Ljava/util/Set;
     310: astore        8
     312: aload         8
     314: ifnull        346
     317: aload         8
     319: invokeinterface #70,  1           // InterfaceMethod java/util/Set.size:()I
     324: ifle          346
     327: aload_0
     328: aload         8
     330: invokeinterface #16,  1           // InterfaceMethod java/util/Set.iterator:()Ljava/util/Iterator;
     335: invokeinterface #18,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
     340: checkcast     #68                 // class java/security/acl/Group
     343: invokespecial #71                 // Method appendRoles:(Ljava/security/acl/Group;)V
     346: iload         7
     348: ireturn
     349: astore        7
     351: new           #49                 // class javax/security/auth/login/LoginException
     354: dup
     355: invokespecial #50                 // Method javax/security/auth/login/LoginException."<init>":()V
     358: astore        8
     360: aload         8
     362: aload         7
     364: invokevirtual #51                 // Method javax/security/auth/login/LoginException.initCause:(Ljava/lang/Throwable;)Ljava/lang/Throwable;
     367: pop
     368: aload         8
     370: athrow
    Exception table:
       from    to  target type
          52    62    65   Class java/lang/Exception
         107   120   128   Class java/io/IOException
         107   120   150   any
         128   152   150   any
         195   348   349   Class java/security/GeneralSecurityException

  public boolean commit() throws javax.security.auth.login.LoginException;
    Code:
       0: iconst_1
       1: ireturn

  public boolean abort() throws javax.security.auth.login.LoginException;
    Code:
       0: iconst_1
       1: ireturn

  public boolean logout() throws javax.security.auth.login.LoginException;
    Code:
       0: iconst_1
       1: ireturn

  private java.lang.String getTimeBasedOTPFromRequest();
    Code:
       0: aconst_null
       1: astore_1
       2: ldc           #73                 // String javax.servlet.http.HttpServletRequest
       4: astore_2
       5: aload_2
       6: invokestatic  #74                 // Method javax/security/jacc/PolicyContext.getContext:(Ljava/lang/String;)Ljava/lang/Object;
       9: checkcast     #75                 // class javax/servlet/http/HttpServletRequest
      12: astore_3
      13: aload_3
      14: ldc           #76                 // String totp
      16: invokeinterface #77,  2           // InterfaceMethod javax/servlet/http/HttpServletRequest.getParameter:(Ljava/lang/String;)Ljava/lang/String;
      21: astore_1
      22: goto          35
      25: astore_3
      26: getstatic     #21                 // Field org/jboss/security/PicketBoxLogger.LOGGER:Lorg/jboss/security/PicketBoxLogger;
      29: aload_3
      30: invokeinterface #79,  2           // InterfaceMethod org/jboss/security/PicketBoxLogger.debugErrorGettingRequestFromPolicyContext:(Ljava/lang/Throwable;)V
      35: aload_1
      36: areturn
    Exception table:
       from    to  target type
           5    22    25   Class javax/security/jacc/PolicyContextException

  private void appendRoles(java.security.acl.Group);
    Code:
       0: aload_1
       1: invokeinterface #80,  1           // InterfaceMethod java/security/acl/Group.getName:()Ljava/lang/String;
       6: ldc           #82                 // String Roles
       8: invokevirtual #63                 // Method java/lang/String.equals:(Ljava/lang/Object;)Z
      11: ifne          15
      14: return
      15: aload_0
      16: getfield      #7                  // Field additionalRoles:Ljava/lang/String;
      19: ifnull        77
      22: aload_0
      23: getfield      #7                  // Field additionalRoles:Ljava/lang/String;
      26: invokevirtual #36                 // Method java/lang/String.isEmpty:()Z
      29: ifne          77
      32: new           #83                 // class java/util/StringTokenizer
      35: dup
      36: aload_0
      37: getfield      #7                  // Field additionalRoles:Ljava/lang/String;
      40: ldc           #84                 // String ,
      42: invokespecial #85                 // Method java/util/StringTokenizer."<init>":(Ljava/lang/String;Ljava/lang/String;)V
      45: astore_2
      46: aload_2
      47: invokevirtual #86                 // Method java/util/StringTokenizer.hasMoreTokens:()Z
      50: ifeq          77
      53: aload_1
      54: new           #87                 // class org/jboss/security/SimplePrincipal
      57: dup
      58: aload_2
      59: invokevirtual #88                 // Method java/util/StringTokenizer.nextToken:()Ljava/lang/String;
      62: invokevirtual #89                 // Method java/lang/String.trim:()Ljava/lang/String;
      65: invokespecial #90                 // Method org/jboss/security/SimplePrincipal."<init>":(Ljava/lang/String;)V
      68: invokeinterface #91,  2           // InterfaceMethod java/security/acl/Group.addMember:(Ljava/security/Principal;)Z
      73: pop
      74: goto          46
      77: return

  private void safeClose(java.io.InputStream);
    Code:
       0: aload_1
       1: ifnull        8
       4: aload_1
       5: invokevirtual #92                 // Method java/io/InputStream.close:()V
       8: goto          12
      11: astore_2
      12: return
    Exception table:
       from    to  target type
           0     8    11   Class java/lang/Exception

  static {};
    Code:
       0: iconst_5
       1: anewarray     #19                 // class java/lang/String
       4: dup
       5: iconst_0
       6: ldc           #27                 // String password-stacking
       8: aastore
       9: dup
      10: iconst_1
      11: ldc           #29                 // String useFirstPass
      13: aastore
      14: dup
      15: iconst_2
      16: ldc           #32                 // String numOfDigits
      18: aastore
      19: dup
      20: iconst_3
      21: ldc           #35                 // String algorithm
      23: aastore
      24: dup
      25: iconst_4
      26: ldc           #39                 // String additionalRoles
      28: aastore
      29: putstatic     #12                 // Field ALL_VALID_OPTIONS:[Ljava/lang/String;
      32: return
}
