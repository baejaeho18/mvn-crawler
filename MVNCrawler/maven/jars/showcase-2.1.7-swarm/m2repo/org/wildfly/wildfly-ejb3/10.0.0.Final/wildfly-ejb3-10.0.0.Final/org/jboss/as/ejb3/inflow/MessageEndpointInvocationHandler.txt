Compiled from "MessageEndpointInvocationHandler.java"
public class org.jboss.as.ejb3.inflow.MessageEndpointInvocationHandler extends org.jboss.as.ejb3.inflow.AbstractInvocationHandler implements javax.resource.spi.endpoint.MessageEndpoint {
  private final org.jboss.as.ejb3.inflow.MessageEndpointService service;

  private final java.lang.Object delegate;

  private final javax.transaction.xa.XAResource xaRes;

  private final java.util.concurrent.atomic.AtomicBoolean released;

  private javax.transaction.Transaction currentTx;

  private java.lang.ClassLoader previousClassLoader;

  private javax.transaction.Transaction previousTx;

  org.jboss.as.ejb3.inflow.MessageEndpointInvocationHandler(org.jboss.as.ejb3.inflow.MessageEndpointService, java.lang.Object, javax.transaction.xa.XAResource);
    Code:
       0: aload_0
       1: invokespecial #1                  // Method org/jboss/as/ejb3/inflow/AbstractInvocationHandler."<init>":()V
       4: aload_0
       5: new           #2                  // class java/util/concurrent/atomic/AtomicBoolean
       8: dup
       9: iconst_0
      10: invokespecial #3                  // Method java/util/concurrent/atomic/AtomicBoolean."<init>":(Z)V
      13: putfield      #4                  // Field released:Ljava/util/concurrent/atomic/AtomicBoolean;
      16: aload_0
      17: aload_1
      18: putfield      #5                  // Field service:Lorg/jboss/as/ejb3/inflow/MessageEndpointService;
      21: aload_0
      22: aload_2
      23: putfield      #6                  // Field delegate:Ljava/lang/Object;
      26: aload_0
      27: aload_3
      28: putfield      #7                  // Field xaRes:Ljavax/transaction/xa/XAResource;
      31: return

  public void afterDelivery() throws javax.resource.ResourceException;
    Code:
       0: aload_0
       1: invokevirtual #8                  // Method getTransactionManager:()Ljavax/transaction/TransactionManager;
       4: astore_1
       5: aload_0
       6: getfield      #9                  // Field currentTx:Ljavax/transaction/Transaction;
       9: ifnull        45
      12: aload_0
      13: getfield      #9                  // Field currentTx:Ljavax/transaction/Transaction;
      16: invokeinterface #10,  1           // InterfaceMethod javax/transaction/Transaction.getStatus:()I
      21: iconst_1
      22: if_icmpne     34
      25: aload_1
      26: invokeinterface #12,  1           // InterfaceMethod javax/transaction/TransactionManager.rollback:()V
      31: goto          40
      34: aload_1
      35: invokeinterface #13,  1           // InterfaceMethod javax/transaction/TransactionManager.commit:()V
      40: aload_0
      41: aconst_null
      42: putfield      #9                  // Field currentTx:Ljavax/transaction/Transaction;
      45: aload_0
      46: getfield      #14                 // Field previousTx:Ljavax/transaction/Transaction;
      49: ifnull        67
      52: aload_1
      53: aload_0
      54: getfield      #14                 // Field previousTx:Ljavax/transaction/Transaction;
      57: invokeinterface #15,  2           // InterfaceMethod javax/transaction/TransactionManager.resume:(Ljavax/transaction/Transaction;)V
      62: aload_0
      63: aconst_null
      64: putfield      #14                 // Field previousTx:Ljavax/transaction/Transaction;
      67: aload_0
      68: getfield      #16                 // Field previousClassLoader:Ljava/lang/ClassLoader;
      71: invokestatic  #17                 // Method org/wildfly/security/manager/WildFlySecurityManager.setCurrentContextClassLoaderPrivileged:(Ljava/lang/ClassLoader;)Ljava/lang/ClassLoader;
      74: pop
      75: aload_0
      76: aconst_null
      77: putfield      #16                 // Field previousClassLoader:Ljava/lang/ClassLoader;
      80: goto          149
      83: astore_2
      84: new           #19                 // class javax/resource/spi/LocalTransactionException
      87: dup
      88: aload_2
      89: invokespecial #20                 // Method javax/resource/spi/LocalTransactionException."<init>":(Ljava/lang/Throwable;)V
      92: athrow
      93: astore_2
      94: new           #19                 // class javax/resource/spi/LocalTransactionException
      97: dup
      98: aload_2
      99: invokespecial #20                 // Method javax/resource/spi/LocalTransactionException."<init>":(Ljava/lang/Throwable;)V
     102: athrow
     103: astore_2
     104: new           #19                 // class javax/resource/spi/LocalTransactionException
     107: dup
     108: aload_2
     109: invokespecial #20                 // Method javax/resource/spi/LocalTransactionException."<init>":(Ljava/lang/Throwable;)V
     112: athrow
     113: astore_2
     114: new           #19                 // class javax/resource/spi/LocalTransactionException
     117: dup
     118: aload_2
     119: invokespecial #20                 // Method javax/resource/spi/LocalTransactionException."<init>":(Ljava/lang/Throwable;)V
     122: athrow
     123: astore_2
     124: new           #19                 // class javax/resource/spi/LocalTransactionException
     127: dup
     128: aload_2
     129: invokespecial #20                 // Method javax/resource/spi/LocalTransactionException."<init>":(Ljava/lang/Throwable;)V
     132: athrow
     133: astore_3
     134: aload_0
     135: getfield      #16                 // Field previousClassLoader:Ljava/lang/ClassLoader;
     138: invokestatic  #17                 // Method org/wildfly/security/manager/WildFlySecurityManager.setCurrentContextClassLoaderPrivileged:(Ljava/lang/ClassLoader;)Ljava/lang/ClassLoader;
     141: pop
     142: aload_0
     143: aconst_null
     144: putfield      #16                 // Field previousClassLoader:Ljava/lang/ClassLoader;
     147: aload_3
     148: athrow
     149: return
    Exception table:
       from    to  target type
           5    67    83   Class javax/transaction/InvalidTransactionException
           5    67    93   Class javax/transaction/HeuristicMixedException
           5    67   103   Class javax/transaction/SystemException
           5    67   113   Class javax/transaction/HeuristicRollbackException
           5    67   123   Class javax/transaction/RollbackException
           5    67   133   any
          83   134   133   any

  public void beforeDelivery(java.lang.reflect.Method) throws java.lang.NoSuchMethodException, javax.resource.ResourceException;
    Code:
       0: aload_0
       1: aload_0
       2: invokevirtual #25                 // Method getApplicationClassLoader:()Ljava/lang/ClassLoader;
       5: invokestatic  #17                 // Method org/wildfly/security/manager/WildFlySecurityManager.setCurrentContextClassLoaderPrivileged:(Ljava/lang/ClassLoader;)Ljava/lang/ClassLoader;
       8: putfield      #16                 // Field previousClassLoader:Ljava/lang/ClassLoader;
      11: aload_0
      12: invokevirtual #8                  // Method getTransactionManager:()Ljavax/transaction/TransactionManager;
      15: astore_2
      16: aload_0
      17: aload_2
      18: invokeinterface #26,  1           // InterfaceMethod javax/transaction/TransactionManager.suspend:()Ljavax/transaction/Transaction;
      23: putfield      #14                 // Field previousTx:Ljavax/transaction/Transaction;
      26: aload_0
      27: getfield      #5                  // Field service:Lorg/jboss/as/ejb3/inflow/MessageEndpointService;
      30: aload_1
      31: invokeinterface #27,  2           // InterfaceMethod org/jboss/as/ejb3/inflow/MessageEndpointService.isDeliveryTransacted:(Ljava/lang/reflect/Method;)Z
      36: istore_3
      37: iload_3
      38: ifeq          78
      41: aload_2
      42: invokeinterface #28,  1           // InterfaceMethod javax/transaction/TransactionManager.begin:()V
      47: aload_0
      48: aload_2
      49: invokeinterface #29,  1           // InterfaceMethod javax/transaction/TransactionManager.getTransaction:()Ljavax/transaction/Transaction;
      54: putfield      #9                  // Field currentTx:Ljavax/transaction/Transaction;
      57: aload_0
      58: getfield      #7                  // Field xaRes:Ljavax/transaction/xa/XAResource;
      61: ifnull        78
      64: aload_0
      65: getfield      #9                  // Field currentTx:Ljavax/transaction/Transaction;
      68: aload_0
      69: getfield      #7                  // Field xaRes:Ljavax/transaction/xa/XAResource;
      72: invokeinterface #30,  2           // InterfaceMethod javax/transaction/Transaction.enlistResource:(Ljavax/transaction/xa/XAResource;)Z
      77: pop
      78: aload_0
      79: getfield      #16                 // Field previousClassLoader:Ljava/lang/ClassLoader;
      82: invokestatic  #17                 // Method org/wildfly/security/manager/WildFlySecurityManager.setCurrentContextClassLoaderPrivileged:(Ljava/lang/ClassLoader;)Ljava/lang/ClassLoader;
      85: pop
      86: goto          112
      89: astore_2
      90: new           #32                 // class javax/resource/spi/ApplicationServerInternalException
      93: dup
      94: aload_2
      95: invokespecial #33                 // Method javax/resource/spi/ApplicationServerInternalException."<init>":(Ljava/lang/Throwable;)V
      98: athrow
      99: astore        4
     101: aload_0
     102: getfield      #16                 // Field previousClassLoader:Ljava/lang/ClassLoader;
     105: invokestatic  #17                 // Method org/wildfly/security/manager/WildFlySecurityManager.setCurrentContextClassLoaderPrivileged:(Ljava/lang/ClassLoader;)Ljava/lang/ClassLoader;
     108: pop
     109: aload         4
     111: athrow
     112: return
    Exception table:
       from    to  target type
          11    78    89   Class java/lang/Throwable
          11    78    99   any
          89   101    99   any

  protected boolean doEquals(java.lang.Object);
    Code:
       0: aload_1
       1: instanceof    #34                 // class org/jboss/as/ejb3/inflow/MessageEndpointInvocationHandler
       4: ifne          9
       7: iconst_0
       8: ireturn
       9: aload_0
      10: getfield      #6                  // Field delegate:Ljava/lang/Object;
      13: aload_1
      14: checkcast     #34                 // class org/jboss/as/ejb3/inflow/MessageEndpointInvocationHandler
      17: getfield      #6                  // Field delegate:Ljava/lang/Object;
      20: invokevirtual #35                 // Method java/lang/Object.equals:(Ljava/lang/Object;)Z
      23: ireturn

  protected java.lang.Object doInvoke(java.lang.Object, java.lang.reflect.Method, java.lang.Object[]) throws java.lang.Throwable;
    Code:
       0: aload_0
       1: getfield      #4                  // Field released:Ljava/util/concurrent/atomic/AtomicBoolean;
       4: invokevirtual #36                 // Method java/util/concurrent/atomic/AtomicBoolean.get:()Z
       7: ifeq          20
      10: getstatic     #37                 // Field org/jboss/as/ejb3/logging/EjbLogger.ROOT_LOGGER:Lorg/jboss/as/ejb3/logging/EjbLogger;
      13: aload_0
      14: invokeinterface #38,  2           // InterfaceMethod org/jboss/as/ejb3/logging/EjbLogger.messageEndpointAlreadyReleased:(Ljavax/resource/spi/endpoint/MessageEndpoint;)Ljavax/resource/spi/UnavailableException;
      19: athrow
      20: aload_2
      21: invokevirtual #39                 // Method java/lang/reflect/Method.getDeclaringClass:()Ljava/lang/Class;
      24: ldc           #40                 // class javax/resource/spi/endpoint/MessageEndpoint
      26: invokevirtual #35                 // Method java/lang/Object.equals:(Ljava/lang/Object;)Z
      29: ifeq          39
      32: aload_0
      33: aload_2
      34: aload_3
      35: invokevirtual #41                 // Method handle:(Ljava/lang/reflect/Method;[Ljava/lang/Object;)Ljava/lang/Object;
      38: areturn
      39: aload_2
      40: aload_0
      41: getfield      #6                  // Field delegate:Ljava/lang/Object;
      44: aload_3
      45: invokevirtual #42                 // Method java/lang/reflect/Method.invoke:(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;
      48: areturn
      49: astore        4
      51: aload         4
      53: invokevirtual #44                 // Method java/lang/reflect/InvocationTargetException.getCause:()Ljava/lang/Throwable;
      56: athrow
    Exception table:
       from    to  target type
          39    48    49   Class java/lang/reflect/InvocationTargetException

  public int hashCode();
    Code:
       0: aload_0
       1: getfield      #6                  // Field delegate:Ljava/lang/Object;
       4: invokevirtual #45                 // Method java/lang/Object.hashCode:()I
       7: ireturn

  protected final java.lang.ClassLoader getApplicationClassLoader();
    Code:
       0: aload_0
       1: getfield      #5                  // Field service:Lorg/jboss/as/ejb3/inflow/MessageEndpointService;
       4: invokeinterface #46,  1           // InterfaceMethod org/jboss/as/ejb3/inflow/MessageEndpointService.getClassLoader:()Ljava/lang/ClassLoader;
       9: areturn

  protected final javax.transaction.TransactionManager getTransactionManager();
    Code:
       0: aload_0
       1: getfield      #5                  // Field service:Lorg/jboss/as/ejb3/inflow/MessageEndpointService;
       4: invokeinterface #47,  1           // InterfaceMethod org/jboss/as/ejb3/inflow/MessageEndpointService.getTransactionManager:()Ljavax/transaction/TransactionManager;
       9: areturn

  public void release();
    Code:
       0: aload_0
       1: getfield      #4                  // Field released:Ljava/util/concurrent/atomic/AtomicBoolean;
       4: iconst_1
       5: invokevirtual #48                 // Method java/util/concurrent/atomic/AtomicBoolean.getAndSet:(Z)Z
       8: ifeq          43
      11: new           #49                 // class java/lang/IllegalStateException
      14: dup
      15: new           #50                 // class java/lang/StringBuilder
      18: dup
      19: invokespecial #51                 // Method java/lang/StringBuilder."<init>":()V
      22: ldc           #52                 // String Message endpoint
      24: invokevirtual #53                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      27: aload_0
      28: invokevirtual #54                 // Method java/lang/StringBuilder.append:(Ljava/lang/Object;)Ljava/lang/StringBuilder;
      31: ldc           #55                 // String  has already been released
      33: invokevirtual #53                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      36: invokevirtual #56                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      39: invokespecial #57                 // Method java/lang/IllegalStateException."<init>":(Ljava/lang/String;)V
      42: athrow
      43: aload_0
      44: getfield      #5                  // Field service:Lorg/jboss/as/ejb3/inflow/MessageEndpointService;
      47: aload_0
      48: getfield      #6                  // Field delegate:Ljava/lang/Object;
      51: invokeinterface #58,  2           // InterfaceMethod org/jboss/as/ejb3/inflow/MessageEndpointService.release:(Ljava/lang/Object;)V
      56: return
}
