Compiled from "SimpleSecurityManager.java"
public class org.jboss.as.security.service.SimpleSecurityManager implements org.jboss.as.core.security.ServerSecurityManager {
  private org.jboss.as.security.service.ThreadLocalStack<org.jboss.security.SecurityContext> contexts;

  private boolean propagate;

  private org.jboss.security.ISecurityManagement securityManagement;

  public org.jboss.as.security.service.SimpleSecurityManager();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object."<init>":()V
       4: aload_0
       5: new           #2                  // class org/jboss/as/security/service/ThreadLocalStack
       8: dup
       9: invokespecial #3                  // Method org/jboss/as/security/service/ThreadLocalStack."<init>":()V
      12: putfield      #4                  // Field contexts:Lorg/jboss/as/security/service/ThreadLocalStack;
      15: aload_0
      16: iconst_1
      17: putfield      #5                  // Field propagate:Z
      20: aload_0
      21: aconst_null
      22: putfield      #6                  // Field securityManagement:Lorg/jboss/security/ISecurityManagement;
      25: return

  public org.jboss.as.security.service.SimpleSecurityManager(org.jboss.as.security.service.SimpleSecurityManager);
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object."<init>":()V
       4: aload_0
       5: new           #2                  // class org/jboss/as/security/service/ThreadLocalStack
       8: dup
       9: invokespecial #3                  // Method org/jboss/as/security/service/ThreadLocalStack."<init>":()V
      12: putfield      #4                  // Field contexts:Lorg/jboss/as/security/service/ThreadLocalStack;
      15: aload_0
      16: iconst_1
      17: putfield      #5                  // Field propagate:Z
      20: aload_0
      21: aconst_null
      22: putfield      #6                  // Field securityManagement:Lorg/jboss/security/ISecurityManagement;
      25: aload_0
      26: aload_1
      27: getfield      #6                  // Field securityManagement:Lorg/jboss/security/ISecurityManagement;
      30: putfield      #6                  // Field securityManagement:Lorg/jboss/security/ISecurityManagement;
      33: aload_0
      34: iconst_0
      35: putfield      #5                  // Field propagate:Z
      38: return

  private java.security.PrivilegedAction<org.jboss.security.SecurityContext> securityContext();
    Code:
       0: new           #7                  // class org/jboss/as/security/service/SimpleSecurityManager$1
       3: dup
       4: aload_0
       5: invokespecial #8                  // Method org/jboss/as/security/service/SimpleSecurityManager$1."<init>":(Lorg/jboss/as/security/service/SimpleSecurityManager;)V
       8: areturn

  private org.jboss.security.SecurityContext establishSecurityContext(java.lang.String);
    Code:
       0: aload_1
       1: invokestatic  #9                  // Method org/jboss/security/SecurityContextFactory.createSecurityContext:(Ljava/lang/String;)Lorg/jboss/security/SecurityContext;
       4: astore_2
       5: aload_0
       6: getfield      #6                  // Field securityManagement:Lorg/jboss/security/ISecurityManagement;
       9: ifnonnull     21
      12: getstatic     #10                 // Field org/jboss/as/security/logging/SecurityLogger.ROOT_LOGGER:Lorg/jboss/as/security/logging/SecurityLogger;
      15: invokeinterface #11,  1           // InterfaceMethod org/jboss/as/security/logging/SecurityLogger.securityManagementNotInjected:()Ljava/lang/SecurityException;
      20: athrow
      21: aload_2
      22: aload_0
      23: getfield      #6                  // Field securityManagement:Lorg/jboss/security/ISecurityManagement;
      26: invokeinterface #12,  2           // InterfaceMethod org/jboss/security/SecurityContext.setSecurityManagement:(Lorg/jboss/security/ISecurityManagement;)V
      31: aload_2
      32: invokestatic  #13                 // Method org/jboss/security/SecurityContextAssociation.setSecurityContext:(Lorg/jboss/security/SecurityContext;)V
      35: aload_2
      36: areturn
      37: astore_2
      38: getstatic     #10                 // Field org/jboss/as/security/logging/SecurityLogger.ROOT_LOGGER:Lorg/jboss/as/security/logging/SecurityLogger;
      41: aload_2
      42: invokeinterface #15,  2           // InterfaceMethod org/jboss/as/security/logging/SecurityLogger.securityException:(Ljava/lang/Throwable;)Ljava/lang/SecurityException;
      47: athrow
    Exception table:
       from    to  target type
           0    36    37   Class java/lang/Exception

  public void setSecurityManagement(org.jboss.security.ISecurityManagement);
    Code:
       0: aload_0
       1: aload_1
       2: putfield      #6                  // Field securityManagement:Lorg/jboss/security/ISecurityManagement;
       5: return

  public java.security.Principal getCallerPrincipal();
    Code:
       0: aload_0
       1: invokespecial #16                 // Method securityContext:()Ljava/security/PrivilegedAction;
       4: invokestatic  #17                 // Method java/security/AccessController.doPrivileged:(Ljava/security/PrivilegedAction;)Ljava/lang/Object;
       7: checkcast     #18                 // class org/jboss/security/SecurityContext
      10: astore_1
      11: aload_1
      12: ifnonnull     25
      15: aload_0
      16: invokespecial #19                 // Method getUnauthenticatedIdentity:()Lorg/jboss/security/identity/Identity;
      19: invokeinterface #20,  1           // InterfaceMethod org/jboss/security/identity/Identity.asPrincipal:()Ljava/security/Principal;
      24: areturn
      25: aload_1
      26: invokeinterface #21,  1           // InterfaceMethod org/jboss/security/SecurityContext.getIncomingRunAs:()Lorg/jboss/security/RunAs;
      31: astore_2
      32: aload_2
      33: ifnonnull     49
      36: aload_0
      37: aload_0
      38: aload_1
      39: invokespecial #22                 // Method getSubjectInfo:(Lorg/jboss/security/SecurityContext;)Lorg/jboss/security/SubjectInfo;
      42: invokevirtual #23                 // Method org/jboss/security/SubjectInfo.getAuthenticatedSubject:()Ljavax/security/auth/Subject;
      45: invokespecial #24                 // Method getPrincipal:(Ljavax/security/auth/Subject;)Ljava/security/Principal;
      48: astore_2
      49: aload_2
      50: ifnonnull     63
      53: aload_0
      54: invokespecial #19                 // Method getUnauthenticatedIdentity:()Lorg/jboss/security/identity/Identity;
      57: invokeinterface #20,  1           // InterfaceMethod org/jboss/security/identity/Identity.asPrincipal:()Ljava/security/Principal;
      62: areturn
      63: aload_2
      64: areturn

  public javax.security.auth.Subject getSubject();
    Code:
       0: aload_0
       1: invokespecial #16                 // Method securityContext:()Ljava/security/PrivilegedAction;
       4: invokestatic  #17                 // Method java/security/AccessController.doPrivileged:(Ljava/security/PrivilegedAction;)Ljava/lang/Object;
       7: checkcast     #18                 // class org/jboss/security/SecurityContext
      10: astore_1
      11: aload_1
      12: ifnull        24
      15: aload_0
      16: aload_1
      17: invokespecial #22                 // Method getSubjectInfo:(Lorg/jboss/security/SecurityContext;)Lorg/jboss/security/SubjectInfo;
      20: invokevirtual #23                 // Method org/jboss/security/SubjectInfo.getAuthenticatedSubject:()Ljavax/security/auth/Subject;
      23: areturn
      24: aconst_null
      25: areturn

  private java.security.Principal getPrincipal(javax.security.auth.Subject);
    Code:
       0: aconst_null
       1: astore_2
       2: aconst_null
       3: astore_3
       4: aload_1
       5: ifnull        147
       8: aload_1
       9: invokevirtual #25                 // Method javax/security/auth/Subject.getPrincipals:()Ljava/util/Set;
      12: astore        4
      14: aload         4
      16: ifnull        147
      19: aload         4
      21: invokeinterface #26,  1           // InterfaceMethod java/util/Set.isEmpty:()Z
      26: ifne          147
      29: aload         4
      31: invokeinterface #27,  1           // InterfaceMethod java/util/Set.iterator:()Ljava/util/Iterator;
      36: astore        5
      38: aload         5
      40: invokeinterface #28,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
      45: ifeq          147
      48: aload         5
      50: invokeinterface #29,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      55: checkcast     #30                 // class java/security/Principal
      58: astore        6
      60: aload         6
      62: instanceof    #31                 // class java/security/acl/Group
      65: ifne          75
      68: aload_2
      69: ifnonnull     75
      72: aload         6
      74: astore_2
      75: aload         6
      77: instanceof    #31                 // class java/security/acl/Group
      80: ifeq          144
      83: ldc           #31                 // class java/security/acl/Group
      85: aload         6
      87: invokevirtual #32                 // Method java/lang/Class.cast:(Ljava/lang/Object;)Ljava/lang/Object;
      90: checkcast     #31                 // class java/security/acl/Group
      93: astore        7
      95: aload         7
      97: invokeinterface #33,  1           // InterfaceMethod java/security/acl/Group.getName:()Ljava/lang/String;
     102: ldc           #34                 // String CallerPrincipal
     104: invokevirtual #35                 // Method java/lang/String.equals:(Ljava/lang/Object;)Z
     107: ifeq          144
     110: aload_3
     111: ifnonnull     144
     114: aload         7
     116: invokeinterface #36,  1           // InterfaceMethod java/security/acl/Group.members:()Ljava/util/Enumeration;
     121: astore        8
     123: aload         8
     125: invokeinterface #37,  1           // InterfaceMethod java/util/Enumeration.hasMoreElements:()Z
     130: ifeq          144
     133: aload         8
     135: invokeinterface #38,  1           // InterfaceMethod java/util/Enumeration.nextElement:()Ljava/lang/Object;
     140: checkcast     #30                 // class java/security/Principal
     143: astore_3
     144: goto          38
     147: aload_3
     148: ifnonnull     155
     151: aload_2
     152: goto          156
     155: aload_3
     156: areturn

  public boolean isCallerInRole(java.lang.String, java.lang.Object, java.util.Map<java.lang.String, java.util.Collection<java.lang.String>>, java.lang.String...);
    Code:
       0: aload_0
       1: aload_1
       2: invokestatic  #39                 // Method javax/security/jacc/PolicyContext.getContextID:()Ljava/lang/String;
       5: aload_2
       6: aload_3
       7: aload         4
       9: invokevirtual #40                 // Method isCallerInRole:(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Object;Ljava/util/Map;[Ljava/lang/String;)Z
      12: ireturn

  public boolean isCallerInRole(java.lang.String, java.lang.String, java.lang.Object, java.util.Map<java.lang.String, java.util.Collection<java.lang.String>>, java.lang.String...);
    Code:
       0: aload_0
       1: invokespecial #16                 // Method securityContext:()Ljava/security/PrivilegedAction;
       4: invokestatic  #17                 // Method java/security/AccessController.doPrivileged:(Ljava/security/PrivilegedAction;)Ljava/lang/Object;
       7: checkcast     #18                 // class org/jboss/security/SecurityContext
      10: astore        6
      12: aload         6
      14: ifnonnull     19
      17: iconst_0
      18: ireturn
      19: new           #41                 // class org/jboss/security/authorization/resources/EJBResource
      22: dup
      23: new           #42                 // class java/util/HashMap
      26: dup
      27: invokespecial #43                 // Method java/util/HashMap."<init>":()V
      30: invokespecial #44                 // Method org/jboss/security/authorization/resources/EJBResource."<init>":(Ljava/util/Map;)V
      33: astore        7
      35: aload         7
      37: aload_1
      38: invokevirtual #45                 // Method org/jboss/security/authorization/resources/EJBResource.setEjbName:(Ljava/lang/String;)V
      41: aload         7
      43: aload_2
      44: invokevirtual #46                 // Method org/jboss/security/authorization/resources/EJBResource.setPolicyContextID:(Ljava/lang/String;)V
      47: aload         7
      49: aload         6
      51: invokeinterface #21,  1           // InterfaceMethod org/jboss/security/SecurityContext.getIncomingRunAs:()Lorg/jboss/security/RunAs;
      56: invokevirtual #47                 // Method org/jboss/security/authorization/resources/EJBResource.setCallerRunAsIdentity:(Lorg/jboss/security/RunAs;)V
      59: aload         7
      61: aload         6
      63: invokeinterface #48,  1           // InterfaceMethod org/jboss/security/SecurityContext.getUtil:()Lorg/jboss/security/SecurityContextUtil;
      68: invokevirtual #49                 // Method org/jboss/security/SecurityContextUtil.getSubject:()Ljavax/security/auth/Subject;
      71: invokevirtual #50                 // Method org/jboss/security/authorization/resources/EJBResource.setCallerSubject:(Ljavax/security/auth/Subject;)V
      74: aload         6
      76: invokeinterface #48,  1           // InterfaceMethod org/jboss/security/SecurityContext.getUtil:()Lorg/jboss/security/SecurityContextUtil;
      81: invokevirtual #51                 // Method org/jboss/security/SecurityContextUtil.getUserPrincipal:()Ljava/security/Principal;
      84: astore        8
      86: aload         7
      88: aload         8
      90: invokevirtual #52                 // Method org/jboss/security/authorization/resources/EJBResource.setPrincipal:(Ljava/security/Principal;)V
      93: aload         4
      95: ifnull        225
      98: new           #53                 // class java/util/HashSet
     101: dup
     102: invokespecial #54                 // Method java/util/HashSet."<init>":()V
     105: astore        9
     107: aload         4
     109: invokeinterface #55,  1           // InterfaceMethod java/util/Map.keySet:()Ljava/util/Set;
     114: invokeinterface #27,  1           // InterfaceMethod java/util/Set.iterator:()Ljava/util/Iterator;
     119: astore        10
     121: aload         10
     123: invokeinterface #28,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
     128: ifeq          218
     131: aload         10
     133: invokeinterface #29,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
     138: checkcast     #56                 // class java/lang/String
     141: astore        11
     143: aload         4
     145: aload         11
     147: invokeinterface #57,  2           // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
     152: checkcast     #58                 // class java/util/Collection
     155: astore        12
     157: aload         12
     159: ifnull        215
     162: aload         12
     164: invokeinterface #59,  1           // InterfaceMethod java/util/Collection.iterator:()Ljava/util/Iterator;
     169: astore        13
     171: aload         13
     173: invokeinterface #28,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
     178: ifeq          215
     181: aload         13
     183: invokeinterface #29,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
     188: checkcast     #56                 // class java/lang/String
     191: astore        14
     193: aload         9
     195: new           #60                 // class org/jboss/security/javaee/SecurityRoleRef
     198: dup
     199: aload         11
     201: aload         14
     203: invokespecial #61                 // Method org/jboss/security/javaee/SecurityRoleRef."<init>":(Ljava/lang/String;Ljava/lang/String;)V
     206: invokeinterface #62,  2           // InterfaceMethod java/util/Set.add:(Ljava/lang/Object;)Z
     211: pop
     212: goto          171
     215: goto          121
     218: aload         7
     220: aload         9
     222: invokevirtual #63                 // Method org/jboss/security/authorization/resources/EJBResource.setSecurityRoleReferences:(Ljava/util/Set;)V
     225: aconst_null
     226: astore        9
     228: aload_3
     229: ifnull        249
     232: aload_3
     233: checkcast     #64                 // class org/jboss/metadata/javaee/spec/SecurityRolesMetaData
     236: astore        10
     238: aload_0
     239: aload         10
     241: invokevirtual #65                 // Method org/jboss/metadata/javaee/spec/SecurityRolesMetaData.getPrincipalVersusRolesMap:()Ljava/util/Map;
     244: invokespecial #66                 // Method setSecurityRolesAssociation:(Ljava/util/Map;)Ljava/util/Map;
     247: astore        9
     249: aload         6
     251: invokestatic  #67                 // Method org/jboss/security/javaee/SecurityHelperFactory.getEJBAuthorizationHelper:(Lorg/jboss/security/SecurityContext;)Lorg/jboss/security/javaee/AbstractEJBAuthorizationHelper;
     254: astore        10
     256: aload         5
     258: astore        11
     260: aload         11
     262: arraylength
     263: istore        12
     265: iconst_0
     266: istore        13
     268: iload         13
     270: iload         12
     272: if_icmpge     317
     275: aload         11
     277: iload         13
     279: aaload
     280: astore        14
     282: aload         10
     284: aload         7
     286: aload         14
     288: invokevirtual #68                 // Method org/jboss/security/javaee/AbstractEJBAuthorizationHelper.isCallerInRole:(Lorg/jboss/security/authorization/Resource;Ljava/lang/String;)Z
     291: ifeq          311
     294: iconst_1
     295: istore        15
     297: aload_3
     298: ifnull        308
     301: aload_0
     302: aload         9
     304: invokespecial #66                 // Method setSecurityRolesAssociation:(Ljava/util/Map;)Ljava/util/Map;
     307: pop
     308: iload         15
     310: ireturn
     311: iinc          13, 1
     314: goto          268
     317: iconst_0
     318: istore        11
     320: aload_3
     321: ifnull        331
     324: aload_0
     325: aload         9
     327: invokespecial #66                 // Method setSecurityRolesAssociation:(Ljava/util/Map;)Ljava/util/Map;
     330: pop
     331: iload         11
     333: ireturn
     334: astore        10
     336: new           #69                 // class java/lang/RuntimeException
     339: dup
     340: aload         10
     342: invokespecial #70                 // Method java/lang/RuntimeException."<init>":(Ljava/lang/Throwable;)V
     345: athrow
     346: astore        16
     348: aload_3
     349: ifnull        359
     352: aload_0
     353: aload         9
     355: invokespecial #66                 // Method setSecurityRolesAssociation:(Ljava/util/Map;)Ljava/util/Map;
     358: pop
     359: aload         16
     361: athrow
    Exception table:
       from    to  target type
         228   297   334   Class java/lang/Exception
         311   320   334   Class java/lang/Exception
         228   297   346   any
         311   320   346   any
         334   348   346   any

  public boolean authorize(java.lang.String, java.security.CodeSource, java.lang.String, java.lang.reflect.Method, java.util.Set<java.security.Principal>, java.lang.String);
    Code:
       0: aload_0
       1: invokespecial #16                 // Method securityContext:()Ljava/security/PrivilegedAction;
       4: invokestatic  #17                 // Method java/security/AccessController.doPrivileged:(Ljava/security/PrivilegedAction;)Ljava/lang/Object;
       7: checkcast     #18                 // class org/jboss/security/SecurityContext
      10: astore        7
      12: aload         7
      14: ifnonnull     19
      17: iconst_0
      18: ireturn
      19: new           #41                 // class org/jboss/security/authorization/resources/EJBResource
      22: dup
      23: new           #42                 // class java/util/HashMap
      26: dup
      27: invokespecial #43                 // Method java/util/HashMap."<init>":()V
      30: invokespecial #44                 // Method org/jboss/security/authorization/resources/EJBResource."<init>":(Ljava/util/Map;)V
      33: astore        8
      35: aload         8
      37: aload_1
      38: invokevirtual #45                 // Method org/jboss/security/authorization/resources/EJBResource.setEjbName:(Ljava/lang/String;)V
      41: aload         8
      43: aload         4
      45: invokevirtual #71                 // Method org/jboss/security/authorization/resources/EJBResource.setEjbMethod:(Ljava/lang/reflect/Method;)V
      48: aload         8
      50: aload_3
      51: invokevirtual #72                 // Method org/jboss/security/authorization/resources/EJBResource.setEjbMethodInterface:(Ljava/lang/String;)V
      54: aload         8
      56: new           #73                 // class org/jboss/security/identity/plugins/SimpleRoleGroup
      59: dup
      60: aload         5
      62: invokespecial #74                 // Method org/jboss/security/identity/plugins/SimpleRoleGroup."<init>":(Ljava/util/Set;)V
      65: invokevirtual #75                 // Method org/jboss/security/authorization/resources/EJBResource.setEjbMethodRoles:(Lorg/jboss/security/identity/RoleGroup;)V
      68: aload         8
      70: aload_2
      71: invokevirtual #76                 // Method org/jboss/security/authorization/resources/EJBResource.setCodeSource:(Ljava/security/CodeSource;)V
      74: aload         8
      76: aload         6
      78: invokevirtual #46                 // Method org/jboss/security/authorization/resources/EJBResource.setPolicyContextID:(Ljava/lang/String;)V
      81: aload         8
      83: aload         7
      85: invokeinterface #21,  1           // InterfaceMethod org/jboss/security/SecurityContext.getIncomingRunAs:()Lorg/jboss/security/RunAs;
      90: invokevirtual #47                 // Method org/jboss/security/authorization/resources/EJBResource.setCallerRunAsIdentity:(Lorg/jboss/security/RunAs;)V
      93: aload         8
      95: aload         7
      97: invokeinterface #48,  1           // InterfaceMethod org/jboss/security/SecurityContext.getUtil:()Lorg/jboss/security/SecurityContextUtil;
     102: invokevirtual #49                 // Method org/jboss/security/SecurityContextUtil.getSubject:()Ljavax/security/auth/Subject;
     105: invokevirtual #50                 // Method org/jboss/security/authorization/resources/EJBResource.setCallerSubject:(Ljavax/security/auth/Subject;)V
     108: aload         7
     110: invokeinterface #48,  1           // InterfaceMethod org/jboss/security/SecurityContext.getUtil:()Lorg/jboss/security/SecurityContextUtil;
     115: invokevirtual #51                 // Method org/jboss/security/SecurityContextUtil.getUserPrincipal:()Ljava/security/Principal;
     118: astore        9
     120: aload         8
     122: aload         9
     124: invokevirtual #52                 // Method org/jboss/security/authorization/resources/EJBResource.setPrincipal:(Ljava/security/Principal;)V
     127: aload         7
     129: invokestatic  #67                 // Method org/jboss/security/javaee/SecurityHelperFactory.getEJBAuthorizationHelper:(Lorg/jboss/security/SecurityContext;)Lorg/jboss/security/javaee/AbstractEJBAuthorizationHelper;
     132: astore        10
     134: aload         10
     136: aload         8
     138: invokevirtual #77                 // Method org/jboss/security/javaee/AbstractEJBAuthorizationHelper.authorize:(Lorg/jboss/security/authorization/Resource;)Z
     141: ireturn
     142: astore        10
     144: new           #69                 // class java/lang/RuntimeException
     147: dup
     148: aload         10
     150: invokespecial #70                 // Method java/lang/RuntimeException."<init>":(Ljava/lang/Throwable;)V
     153: athrow
    Exception table:
       from    to  target type
         127   141   142   Class java/lang/Exception

  public void push(java.lang.String);
    Code:
       0: invokestatic  #78                 // Method org/jboss/security/SecurityContextAssociation.getSecurityContext:()Lorg/jboss/security/SecurityContext;
       3: astore_2
       4: aload_0
       5: getfield      #4                  // Field contexts:Lorg/jboss/as/security/service/ThreadLocalStack;
       8: aload_2
       9: invokevirtual #79                 // Method org/jboss/as/security/service/ThreadLocalStack.push:(Ljava/lang/Object;)V
      12: aload_0
      13: aload_1
      14: invokespecial #80                 // Method establishSecurityContext:(Ljava/lang/String;)Lorg/jboss/security/SecurityContext;
      17: astore_3
      18: aload_0
      19: getfield      #5                  // Field propagate:Z
      22: ifeq          52
      25: aload_2
      26: ifnull        52
      29: aload_3
      30: aload_0
      31: aload_2
      32: invokespecial #22                 // Method getSubjectInfo:(Lorg/jboss/security/SecurityContext;)Lorg/jboss/security/SubjectInfo;
      35: invokeinterface #81,  2           // InterfaceMethod org/jboss/security/SecurityContext.setSubjectInfo:(Lorg/jboss/security/SubjectInfo;)V
      40: aload_3
      41: aload_2
      42: invokeinterface #82,  1           // InterfaceMethod org/jboss/security/SecurityContext.getOutgoingRunAs:()Lorg/jboss/security/RunAs;
      47: invokeinterface #83,  2           // InterfaceMethod org/jboss/security/SecurityContext.setIncomingRunAs:(Lorg/jboss/security/RunAs;)V
      52: aload_3
      53: invokeinterface #21,  1           // InterfaceMethod org/jboss/security/SecurityContext.getIncomingRunAs:()Lorg/jboss/security/RunAs;
      58: astore        4
      60: aload         4
      62: ifnull        77
      65: aload         4
      67: instanceof    #84                 // class org/jboss/security/RunAsIdentity
      70: ifeq          77
      73: iconst_1
      74: goto          78
      77: iconst_0
      78: istore        5
      80: iload         5
      82: ifne          252
      85: invokestatic  #85                 // Method org/jboss/as/security/service/SecurityActions.remotingContextIsSet:()Z
      88: ifeq          252
      91: aload_3
      92: invokeinterface #48,  1           // InterfaceMethod org/jboss/security/SecurityContext.getUtil:()Lorg/jboss/security/SecurityContextUtil;
      97: astore        6
      99: invokestatic  #86                 // Method org/jboss/as/security/service/SecurityActions.remotingContextGetConnection:()Lorg/jboss/remoting3/Connection;
     102: astore        7
     104: aload         7
     106: invokeinterface #87,  1           // InterfaceMethod org/jboss/remoting3/Connection.getUserInfo:()Lorg/jboss/remoting3/security/UserInfo;
     111: astore        8
     113: aconst_null
     114: astore        9
     116: aconst_null
     117: astore        10
     119: aload         8
     121: instanceof    #88                 // class org/jboss/as/core/security/SubjectUserInfo
     124: ifeq          207
     127: aload         8
     129: checkcast     #88                 // class org/jboss/as/core/security/SubjectUserInfo
     132: astore        11
     134: aload         11
     136: invokeinterface #89,  1           // InterfaceMethod org/jboss/as/core/security/SubjectUserInfo.getSubject:()Ljavax/security/auth/Subject;
     141: astore        12
     143: aload         12
     145: ldc           #90                 // class org/jboss/as/domain/management/security/PasswordCredential
     147: invokevirtual #91                 // Method javax/security/auth/Subject.getPrivateCredentials:(Ljava/lang/Class;)Ljava/util/Set;
     150: astore        13
     152: aload         13
     154: invokeinterface #92,  1           // InterfaceMethod java/util/Set.size:()I
     159: ifle          207
     162: aload         13
     164: invokeinterface #27,  1           // InterfaceMethod java/util/Set.iterator:()Ljava/util/Iterator;
     169: invokeinterface #29,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
     174: checkcast     #90                 // class org/jboss/as/domain/management/security/PasswordCredential
     177: astore        14
     179: new           #93                 // class org/jboss/security/SimplePrincipal
     182: dup
     183: aload         14
     185: invokevirtual #94                 // Method org/jboss/as/domain/management/security/PasswordCredential.getUserName:()Ljava/lang/String;
     188: invokespecial #95                 // Method org/jboss/security/SimplePrincipal."<init>":(Ljava/lang/String;)V
     191: astore        9
     193: new           #56                 // class java/lang/String
     196: dup
     197: aload         14
     199: invokevirtual #96                 // Method org/jboss/as/domain/management/security/PasswordCredential.getCredential:()[C
     202: invokespecial #97                 // Method java/lang/String."<init>":([C)V
     205: astore        10
     207: aload         9
     209: ifnull        217
     212: aload         10
     214: ifnonnull     239
     217: new           #98                 // class org/jboss/as/security/remoting/RemotingConnectionPrincipal
     220: dup
     221: aload         7
     223: invokespecial #99                 // Method org/jboss/as/security/remoting/RemotingConnectionPrincipal."<init>":(Lorg/jboss/remoting3/Connection;)V
     226: astore        9
     228: new           #100                // class org/jboss/as/security/remoting/RemotingConnectionCredential
     231: dup
     232: aload         7
     234: invokespecial #101                // Method org/jboss/as/security/remoting/RemotingConnectionCredential."<init>":(Lorg/jboss/remoting3/Connection;)V
     237: astore        10
     239: invokestatic  #102                // Method org/jboss/as/security/service/SecurityActions.remotingContextClear:()V
     242: aload         6
     244: aload         9
     246: aload         10
     248: aconst_null
     249: invokevirtual #103                // Method org/jboss/security/SecurityContextUtil.createSubjectInfo:(Ljava/security/Principal;Ljava/lang/Object;Ljavax/security/auth/Subject;)V
     252: return

  public void push(java.lang.String, java.lang.String, char[], javax.security.auth.Subject);
    Code:
       0: invokestatic  #78                 // Method org/jboss/security/SecurityContextAssociation.getSecurityContext:()Lorg/jboss/security/SecurityContext;
       3: astore        5
       5: aload_0
       6: getfield      #4                  // Field contexts:Lorg/jboss/as/security/service/ThreadLocalStack;
       9: aload         5
      11: invokevirtual #79                 // Method org/jboss/as/security/service/ThreadLocalStack.push:(Ljava/lang/Object;)V
      14: aload_0
      15: aload_1
      16: invokespecial #80                 // Method establishSecurityContext:(Ljava/lang/String;)Lorg/jboss/security/SecurityContext;
      19: astore        6
      21: aload_0
      22: getfield      #5                  // Field propagate:Z
      25: ifeq          60
      28: aload         5
      30: ifnull        60
      33: aload         6
      35: aload_0
      36: aload         5
      38: invokespecial #22                 // Method getSubjectInfo:(Lorg/jboss/security/SecurityContext;)Lorg/jboss/security/SubjectInfo;
      41: invokeinterface #81,  2           // InterfaceMethod org/jboss/security/SecurityContext.setSubjectInfo:(Lorg/jboss/security/SubjectInfo;)V
      46: aload         6
      48: aload         5
      50: invokeinterface #82,  1           // InterfaceMethod org/jboss/security/SecurityContext.getOutgoingRunAs:()Lorg/jboss/security/RunAs;
      55: invokeinterface #83,  2           // InterfaceMethod org/jboss/security/SecurityContext.setIncomingRunAs:(Lorg/jboss/security/RunAs;)V
      60: aload         6
      62: invokeinterface #21,  1           // InterfaceMethod org/jboss/security/SecurityContext.getIncomingRunAs:()Lorg/jboss/security/RunAs;
      67: astore        7
      69: aload         7
      71: ifnull        86
      74: aload         7
      76: instanceof    #84                 // class org/jboss/security/RunAsIdentity
      79: ifeq          86
      82: iconst_1
      83: goto          87
      86: iconst_0
      87: istore        8
      89: iload         8
      91: ifne          126
      94: aload         6
      96: invokeinterface #48,  1           // InterfaceMethod org/jboss/security/SecurityContext.getUtil:()Lorg/jboss/security/SecurityContextUtil;
     101: astore        9
     103: aload         9
     105: new           #93                 // class org/jboss/security/SimplePrincipal
     108: dup
     109: aload_2
     110: invokespecial #95                 // Method org/jboss/security/SimplePrincipal."<init>":(Ljava/lang/String;)V
     113: new           #56                 // class java/lang/String
     116: dup
     117: aload_3
     118: invokespecial #97                 // Method java/lang/String."<init>":([C)V
     121: aload         4
     123: invokevirtual #103                // Method org/jboss/security/SecurityContextUtil.createSubjectInfo:(Ljava/security/Principal;Ljava/lang/Object;Ljavax/security/auth/Subject;)V
     126: return

  public void authenticate();
    Code:
       0: aload_0
       1: aconst_null
       2: aconst_null
       3: aconst_null
       4: invokevirtual #104                // Method authenticate:(Ljava/lang/String;Ljava/lang/String;Ljava/util/Set;)V
       7: return

  public void authenticate(java.lang.String, java.lang.String, java.util.Set<java.lang.String>);
    Code:
       0: invokestatic  #78                 // Method org/jboss/security/SecurityContextAssociation.getSecurityContext:()Lorg/jboss/security/SecurityContext;
       3: astore        4
       5: aload_0
       6: getfield      #4                  // Field contexts:Lorg/jboss/as/security/service/ThreadLocalStack;
       9: invokevirtual #105                // Method org/jboss/as/security/service/ThreadLocalStack.peek:()Ljava/lang/Object;
      12: checkcast     #18                 // class org/jboss/security/SecurityContext
      15: astore        5
      17: aload         4
      19: invokeinterface #106,  1          // InterfaceMethod org/jboss/security/SecurityContext.getSubjectInfo:()Lorg/jboss/security/SubjectInfo;
      24: ifnull        69
      27: aload         4
      29: invokeinterface #106,  1          // InterfaceMethod org/jboss/security/SecurityContext.getSubjectInfo:()Lorg/jboss/security/SubjectInfo;
      34: invokevirtual #23                 // Method org/jboss/security/SubjectInfo.getAuthenticatedSubject:()Ljavax/security/auth/Subject;
      37: ifnull        69
      40: aload         5
      42: ifnull        69
      45: aload         4
      47: invokeinterface #107,  1          // InterfaceMethod org/jboss/security/SecurityContext.getSecurityDomain:()Ljava/lang/String;
      52: aload         5
      54: invokeinterface #107,  1          // InterfaceMethod org/jboss/security/SecurityContext.getSecurityDomain:()Ljava/lang/String;
      59: invokevirtual #35                 // Method java/lang/String.equals:(Ljava/lang/Object;)Z
      62: ifeq          69
      65: iconst_1
      66: goto          70
      69: iconst_0
      70: istore        6
      72: iload         6
      74: ifne          134
      77: aload         4
      79: invokeinterface #48,  1           // InterfaceMethod org/jboss/security/SecurityContext.getUtil:()Lorg/jboss/security/SecurityContextUtil;
      84: astore        7
      86: aload         7
      88: invokevirtual #108                // Method org/jboss/security/SecurityContextUtil.getCredential:()Ljava/lang/Object;
      91: astore        8
      93: aconst_null
      94: astore        9
      96: aload         8
      98: instanceof    #100                // class org/jboss/as/security/remoting/RemotingConnectionCredential
     101: ifeq          114
     104: aload         8
     106: checkcast     #100                // class org/jboss/as/security/remoting/RemotingConnectionCredential
     109: invokevirtual #109                // Method org/jboss/as/security/remoting/RemotingConnectionCredential.getSubject:()Ljavax/security/auth/Subject;
     112: astore        9
     114: aload_0
     115: aload         4
     117: aload         9
     119: invokespecial #110                // Method authenticate:(Lorg/jboss/security/SecurityContext;Ljavax/security/auth/Subject;)Z
     122: ifne          134
     125: getstatic     #10                 // Field org/jboss/as/security/logging/SecurityLogger.ROOT_LOGGER:Lorg/jboss/as/security/logging/SecurityLogger;
     128: invokeinterface #111,  1          // InterfaceMethod org/jboss/as/security/logging/SecurityLogger.invalidUserException:()Ljava/lang/SecurityException;
     133: athrow
     134: aload_1
     135: ifnull        162
     138: new           #84                 // class org/jboss/security/RunAsIdentity
     141: dup
     142: aload_1
     143: aload_2
     144: aload_3
     145: invokespecial #112                // Method org/jboss/security/RunAsIdentity."<init>":(Ljava/lang/String;Ljava/lang/String;Ljava/util/Set;)V
     148: astore        7
     150: aload         4
     152: aload         7
     154: invokeinterface #113,  2          // InterfaceMethod org/jboss/security/SecurityContext.setOutgoingRunAs:(Lorg/jboss/security/RunAs;)V
     159: goto          198
     162: aload_0
     163: getfield      #5                  // Field propagate:Z
     166: ifeq          198
     169: aload         5
     171: ifnull        198
     174: aload         5
     176: invokeinterface #82,  1           // InterfaceMethod org/jboss/security/SecurityContext.getOutgoingRunAs:()Lorg/jboss/security/RunAs;
     181: ifnull        198
     184: aload         4
     186: aload         5
     188: invokeinterface #82,  1           // InterfaceMethod org/jboss/security/SecurityContext.getOutgoingRunAs:()Lorg/jboss/security/RunAs;
     193: invokeinterface #113,  2          // InterfaceMethod org/jboss/security/SecurityContext.setOutgoingRunAs:(Lorg/jboss/security/RunAs;)V
     198: return

  private boolean authenticate(org.jboss.security.SecurityContext, javax.security.auth.Subject);
    Code:
       0: aload_1
       1: invokeinterface #48,  1           // InterfaceMethod org/jboss/security/SecurityContext.getUtil:()Lorg/jboss/security/SecurityContextUtil;
       6: astore_3
       7: aload_0
       8: aload_1
       9: invokespecial #22                 // Method getSubjectInfo:(Lorg/jboss/security/SecurityContext;)Lorg/jboss/security/SubjectInfo;
      12: astore        4
      14: aload_2
      15: ifnonnull     26
      18: new           #114                // class javax/security/auth/Subject
      21: dup
      22: invokespecial #115                // Method javax/security/auth/Subject."<init>":()V
      25: astore_2
      26: aload_3
      27: invokevirtual #51                 // Method org/jboss/security/SecurityContextUtil.getUserPrincipal:()Ljava/security/Principal;
      30: astore        5
      32: aload         5
      34: astore        6
      36: aload_3
      37: invokevirtual #108                // Method org/jboss/security/SecurityContextUtil.getCredential:()Ljava/lang/Object;
      40: astore        7
      42: aconst_null
      43: astore        8
      45: iconst_0
      46: istore        9
      48: aload         5
      50: ifnonnull     93
      53: aload_0
      54: invokespecial #19                 // Method getUnauthenticatedIdentity:()Lorg/jboss/security/identity/Identity;
      57: astore        8
      59: aload         4
      61: aload         8
      63: invokevirtual #116                // Method org/jboss/security/SubjectInfo.addIdentity:(Lorg/jboss/security/identity/Identity;)V
      66: aload         8
      68: invokeinterface #20,  1           // InterfaceMethod org/jboss/security/identity/Identity.asPrincipal:()Ljava/security/Principal;
      73: astore        6
      75: aload_2
      76: invokevirtual #25                 // Method javax/security/auth/Subject.getPrincipals:()Ljava/util/Set;
      79: aload         6
      81: invokeinterface #62,  2           // InterfaceMethod java/util/Set.add:(Ljava/lang/Object;)Z
      86: pop
      87: iconst_1
      88: istore        9
      90: goto          105
      93: aload_2
      94: invokevirtual #25                 // Method javax/security/auth/Subject.getPrincipals:()Ljava/util/Set;
      97: aload         5
      99: invokeinterface #62,  2           // InterfaceMethod java/util/Set.add:(Ljava/lang/Object;)Z
     104: pop
     105: iload         9
     107: ifne          132
     110: aload_1
     111: invokeinterface #117,  1          // InterfaceMethod org/jboss/security/SecurityContext.getAuthenticationManager:()Lorg/jboss/security/AuthenticationManager;
     116: astore        10
     118: aload         10
     120: aload         5
     122: aload         7
     124: aload_2
     125: invokeinterface #118,  4          // InterfaceMethod org/jboss/security/AuthenticationManager.isValid:(Ljava/security/Principal;Ljava/lang/Object;Ljavax/security/auth/Subject;)Z
     130: istore        9
     132: iload         9
     134: iconst_1
     135: if_icmpne     144
     138: aload         4
     140: aload_2
     141: invokevirtual #119                // Method org/jboss/security/SubjectInfo.setAuthenticatedSubject:(Ljavax/security/auth/Subject;)V
     144: aload_1
     145: invokeinterface #120,  1          // InterfaceMethod org/jboss/security/SecurityContext.getAuditManager:()Lorg/jboss/security/audit/AuditManager;
     150: astore        10
     152: aload         10
     154: ifnull        177
     157: aload_0
     158: iload         9
     160: ifeq          168
     163: ldc           #121                // String Success
     165: goto          170
     168: ldc           #122                // String Failure
     170: aload         10
     172: aload         6
     174: invokespecial #123                // Method audit:(Ljava/lang/String;Lorg/jboss/security/audit/AuditManager;Ljava/security/Principal;)V
     177: iload         9
     179: ireturn

  private org.jboss.security.identity.Identity getUnauthenticatedIdentity();
    Code:
       0: new           #124                // class org/jboss/security/identity/plugins/SimpleIdentity
       3: dup
       4: ldc           #125                // String anonymous
       6: invokespecial #126                // Method org/jboss/security/identity/plugins/SimpleIdentity."<init>":(Ljava/lang/String;)V
       9: areturn

  public void pop();
    Code:
       0: aload_0
       1: getfield      #4                  // Field contexts:Lorg/jboss/as/security/service/ThreadLocalStack;
       4: invokevirtual #127                // Method org/jboss/as/security/service/ThreadLocalStack.pop:()Ljava/lang/Object;
       7: checkcast     #18                 // class org/jboss/security/SecurityContext
      10: astore_1
      11: aload_1
      12: invokestatic  #13                 // Method org/jboss/security/SecurityContextAssociation.setSecurityContext:(Lorg/jboss/security/SecurityContext;)V
      15: return

  private void audit(java.lang.String, org.jboss.security.audit.AuditManager, java.security.Principal);
    Code:
       0: new           #128                // class org/jboss/security/audit/AuditEvent
       3: dup
       4: aload_1
       5: invokespecial #129                // Method org/jboss/security/audit/AuditEvent."<init>":(Ljava/lang/String;)V
       8: astore        4
      10: new           #42                 // class java/util/HashMap
      13: dup
      14: invokespecial #43                 // Method java/util/HashMap."<init>":()V
      17: astore        5
      19: aload         5
      21: ldc           #130                // String principal
      23: aload_3
      24: ifnull        36
      27: aload_3
      28: invokeinterface #131,  1          // InterfaceMethod java/security/Principal.getName:()Ljava/lang/String;
      33: goto          38
      36: ldc           #132                // String null
      38: invokeinterface #133,  3          // InterfaceMethod java/util/Map.put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
      43: pop
      44: aload         5
      46: ldc           #134                // String Source
      48: aload_0
      49: invokevirtual #135                // Method java/lang/Object.getClass:()Ljava/lang/Class;
      52: invokevirtual #136                // Method java/lang/Class.getCanonicalName:()Ljava/lang/String;
      55: invokeinterface #133,  3          // InterfaceMethod java/util/Map.put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
      60: pop
      61: aload         5
      63: ldc           #137                // String Action
      65: ldc           #138                // String authentication
      67: invokeinterface #133,  3          // InterfaceMethod java/util/Map.put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
      72: pop
      73: aload         4
      75: aload         5
      77: invokevirtual #139                // Method org/jboss/security/audit/AuditEvent.setContextMap:(Ljava/util/Map;)V
      80: aload_2
      81: aload         4
      83: invokeinterface #140,  2          // InterfaceMethod org/jboss/security/audit/AuditManager.audit:(Lorg/jboss/security/audit/AuditEvent;)V
      88: return

  private org.jboss.security.SubjectInfo getSubjectInfo(org.jboss.security.SecurityContext);
    Code:
       0: invokestatic  #141                // Method java/lang/System.getSecurityManager:()Ljava/lang/SecurityManager;
       3: ifnonnull     13
       6: aload_1
       7: invokeinterface #106,  1          // InterfaceMethod org/jboss/security/SecurityContext.getSubjectInfo:()Lorg/jboss/security/SubjectInfo;
      12: areturn
      13: new           #142                // class org/jboss/as/security/service/SimpleSecurityManager$2
      16: dup
      17: aload_0
      18: aload_1
      19: invokespecial #143                // Method org/jboss/as/security/service/SimpleSecurityManager$2."<init>":(Lorg/jboss/as/security/service/SimpleSecurityManager;Lorg/jboss/security/SecurityContext;)V
      22: invokestatic  #17                 // Method java/security/AccessController.doPrivileged:(Ljava/security/PrivilegedAction;)Ljava/lang/Object;
      25: checkcast     #144                // class org/jboss/security/SubjectInfo
      28: areturn

  private java.util.Map<java.lang.String, java.util.Set<java.lang.String>> setSecurityRolesAssociation(java.util.Map<java.lang.String, java.util.Set<java.lang.String>>);
    Code:
       0: invokestatic  #141                // Method java/lang/System.getSecurityManager:()Ljava/lang/SecurityManager;
       3: ifnonnull     16
       6: invokestatic  #145                // Method org/jboss/security/SecurityRolesAssociation.getSecurityRoles:()Ljava/util/Map;
       9: astore_2
      10: aload_1
      11: invokestatic  #146                // Method org/jboss/security/SecurityRolesAssociation.setSecurityRoles:(Ljava/util/Map;)V
      14: aload_2
      15: areturn
      16: new           #147                // class org/jboss/as/security/service/SimpleSecurityManager$SetSecurityRolesAssociationAction
      19: dup
      20: aload_1
      21: invokespecial #148                // Method org/jboss/as/security/service/SimpleSecurityManager$SetSecurityRolesAssociationAction."<init>":(Ljava/util/Map;)V
      24: astore_2
      25: aload_2
      26: invokestatic  #17                 // Method java/security/AccessController.doPrivileged:(Ljava/security/PrivilegedAction;)Ljava/lang/Object;
      29: checkcast     #149                // class java/util/Map
      32: areturn
}
