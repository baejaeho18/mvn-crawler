Compiled from "ConnectionImpl.java"
final class org.jboss.as.process.protocol.ConnectionImpl implements org.jboss.as.process.protocol.Connection {
  private final java.net.Socket socket;

  private final java.lang.Object lock;

  private java.io.OutputStream sender;

  private boolean readDone;

  private boolean writeDone;

  private volatile org.jboss.as.process.protocol.MessageHandler messageHandler;

  private final java.util.concurrent.Executor readExecutor;

  private volatile java.lang.Object attachment;

  private volatile org.jboss.as.process.protocol.MessageHandler backupHandler;

  private final org.jboss.as.process.protocol.Connection$ClosedCallback callback;

  org.jboss.as.process.protocol.ConnectionImpl(java.net.Socket, org.jboss.as.process.protocol.MessageHandler, java.util.concurrent.Executor, org.jboss.as.process.protocol.Connection$ClosedCallback);
    Code:
       0: aload_0
       1: invokespecial #8                  // Method java/lang/Object."<init>":()V
       4: aload_0
       5: new           #9                  // class java/lang/Object
       8: dup
       9: invokespecial #8                  // Method java/lang/Object."<init>":()V
      12: putfield      #6                  // Field lock:Ljava/lang/Object;
      15: aload_0
      16: aload_1
      17: putfield      #7                  // Field socket:Ljava/net/Socket;
      20: aload_0
      21: aload_2
      22: putfield      #10                 // Field messageHandler:Lorg/jboss/as/process/protocol/MessageHandler;
      25: aload_0
      26: aload_3
      27: putfield      #2                  // Field readExecutor:Ljava/util/concurrent/Executor;
      30: aload_0
      31: aload         4
      33: putfield      #11                 // Field callback:Lorg/jboss/as/process/protocol/Connection$ClosedCallback;
      36: return

  public java.io.OutputStream writeMessage() throws java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #6                  // Field lock:Ljava/lang/Object;
       4: dup
       5: astore_2
       6: monitorenter
       7: aload_0
       8: getfield      #4                  // Field writeDone:Z
      11: ifeq          23
      14: getstatic     #12                 // Field org/jboss/as/process/logging/ProcessLogger.ROOT_LOGGER:Lorg/jboss/as/process/logging/ProcessLogger;
      17: invokeinterface #13,  1           // InterfaceMethod org/jboss/as/process/logging/ProcessLogger.writesAlreadyShutdown:()Ljava/io/IOException;
      22: athrow
      23: aload_0
      24: getfield      #1                  // Field sender:Ljava/io/OutputStream;
      27: ifnull        55
      30: aload_0
      31: getfield      #6                  // Field lock:Ljava/lang/Object;
      34: invokevirtual #14                 // Method java/lang/Object.wait:()V
      37: goto          23
      40: astore_3
      41: invokestatic  #16                 // Method java/lang/Thread.currentThread:()Ljava/lang/Thread;
      44: invokevirtual #17                 // Method java/lang/Thread.interrupt:()V
      47: new           #18                 // class java/io/InterruptedIOException
      50: dup
      51: invokespecial #19                 // Method java/io/InterruptedIOException."<init>":()V
      54: athrow
      55: iconst_0
      56: istore_3
      57: aload_0
      58: new           #20                 // class org/jboss/as/process/protocol/ConnectionImpl$MessageOutputStream
      61: dup
      62: aload_0
      63: invokespecial #21                 // Method org/jboss/as/process/protocol/ConnectionImpl$MessageOutputStream."<init>":(Lorg/jboss/as/process/protocol/ConnectionImpl;)V
      66: putfield      #1                  // Field sender:Ljava/io/OutputStream;
      69: new           #22                 // class java/io/BufferedOutputStream
      72: dup
      73: aload_0
      74: getfield      #1                  // Field sender:Ljava/io/OutputStream;
      77: invokespecial #23                 // Method java/io/BufferedOutputStream."<init>":(Ljava/io/OutputStream;)V
      80: astore_1
      81: iconst_1
      82: istore_3
      83: iload_3
      84: ifne          113
      87: aload_0
      88: getfield      #6                  // Field lock:Ljava/lang/Object;
      91: invokevirtual #24                 // Method java/lang/Object.notify:()V
      94: goto          113
      97: astore        4
      99: iload_3
     100: ifne          110
     103: aload_0
     104: getfield      #6                  // Field lock:Ljava/lang/Object;
     107: invokevirtual #24                 // Method java/lang/Object.notify:()V
     110: aload         4
     112: athrow
     113: aload_2
     114: monitorexit
     115: goto          125
     118: astore        5
     120: aload_2
     121: monitorexit
     122: aload         5
     124: athrow
     125: aload_1
     126: areturn
    Exception table:
       from    to  target type
          30    37    40   Class java/lang/InterruptedException
          57    83    97   any
          97    99    97   any
           7   115   118   any
         118   122   118   any

  public void shutdownWrites() throws java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #6                  // Field lock:Ljava/lang/Object;
       4: dup
       5: astore_1
       6: monitorenter
       7: aload_0
       8: getfield      #4                  // Field writeDone:Z
      11: ifeq          17
      14: aload_1
      15: monitorexit
      16: return
      17: aload_0
      18: getfield      #1                  // Field sender:Ljava/io/OutputStream;
      21: ifnull        49
      24: aload_0
      25: getfield      #6                  // Field lock:Ljava/lang/Object;
      28: invokevirtual #14                 // Method java/lang/Object.wait:()V
      31: goto          17
      34: astore_2
      35: invokestatic  #16                 // Method java/lang/Thread.currentThread:()Ljava/lang/Thread;
      38: invokevirtual #17                 // Method java/lang/Thread.interrupt:()V
      41: new           #18                 // class java/io/InterruptedIOException
      44: dup
      45: invokespecial #19                 // Method java/io/InterruptedIOException."<init>":()V
      48: athrow
      49: aload_0
      50: iconst_1
      51: putfield      #4                  // Field writeDone:Z
      54: aload_0
      55: getfield      #5                  // Field readDone:Z
      58: ifeq          71
      61: aload_0
      62: getfield      #7                  // Field socket:Ljava/net/Socket;
      65: invokevirtual #25                 // Method java/net/Socket.close:()V
      68: goto          78
      71: aload_0
      72: getfield      #7                  // Field socket:Ljava/net/Socket;
      75: invokevirtual #26                 // Method java/net/Socket.shutdownOutput:()V
      78: aload_0
      79: getfield      #6                  // Field lock:Ljava/lang/Object;
      82: invokevirtual #27                 // Method java/lang/Object.notifyAll:()V
      85: aload_1
      86: monitorexit
      87: goto          95
      90: astore_3
      91: aload_1
      92: monitorexit
      93: aload_3
      94: athrow
      95: return
    Exception table:
       from    to  target type
          24    31    34   Class java/lang/InterruptedException
           7    16    90   any
          17    87    90   any
          90    93    90   any

  public void close() throws java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #6                  // Field lock:Ljava/lang/Object;
       4: dup
       5: astore_1
       6: monitorenter
       7: aload_0
       8: getfield      #6                  // Field lock:Ljava/lang/Object;
      11: invokevirtual #27                 // Method java/lang/Object.notifyAll:()V
      14: aload_0
      15: aconst_null
      16: putfield      #1                  // Field sender:Ljava/io/OutputStream;
      19: aload_0
      20: iconst_1
      21: putfield      #5                  // Field readDone:Z
      24: aload_0
      25: iconst_1
      26: putfield      #4                  // Field writeDone:Z
      29: aload_0
      30: getfield      #7                  // Field socket:Ljava/net/Socket;
      33: invokevirtual #25                 // Method java/net/Socket.close:()V
      36: aload_0
      37: getfield      #6                  // Field lock:Ljava/lang/Object;
      40: invokevirtual #27                 // Method java/lang/Object.notifyAll:()V
      43: aload_1
      44: monitorexit
      45: goto          53
      48: astore_2
      49: aload_1
      50: monitorexit
      51: aload_2
      52: athrow
      53: return
    Exception table:
       from    to  target type
           7    45    48   any
          48    51    48   any

  public void setMessageHandler(org.jboss.as.process.protocol.MessageHandler);
    Code:
       0: aload_1
       1: ifnonnull     15
       4: getstatic     #12                 // Field org/jboss/as/process/logging/ProcessLogger.ROOT_LOGGER:Lorg/jboss/as/process/logging/ProcessLogger;
       7: ldc           #28                 // String messageHandler
       9: invokeinterface #29,  2           // InterfaceMethod org/jboss/as/process/logging/ProcessLogger.nullVar:(Ljava/lang/String;)Ljava/lang/IllegalArgumentException;
      14: athrow
      15: aload_0
      16: aload_1
      17: putfield      #10                 // Field messageHandler:Lorg/jboss/as/process/protocol/MessageHandler;
      20: return

  public java.net.InetAddress getPeerAddress();
    Code:
       0: aload_0
       1: getfield      #6                  // Field lock:Ljava/lang/Object;
       4: dup
       5: astore_1
       6: monitorenter
       7: aload_0
       8: getfield      #7                  // Field socket:Ljava/net/Socket;
      11: astore_2
      12: aload_2
      13: ifnull        23
      16: aload_2
      17: invokevirtual #30                 // Method java/net/Socket.getInetAddress:()Ljava/net/InetAddress;
      20: aload_1
      21: monitorexit
      22: areturn
      23: aconst_null
      24: aload_1
      25: monitorexit
      26: areturn
      27: astore_3
      28: aload_1
      29: monitorexit
      30: aload_3
      31: athrow
    Exception table:
       from    to  target type
           7    22    27   any
          23    26    27   any
          27    30    27   any

  public void attach(java.lang.Object);
    Code:
       0: aload_0
       1: aload_1
       2: putfield      #31                 // Field attachment:Ljava/lang/Object;
       5: return

  public java.lang.Object getAttachment();
    Code:
       0: aload_0
       1: getfield      #31                 // Field attachment:Ljava/lang/Object;
       4: areturn

  public void backupMessageHandler();
    Code:
       0: aload_0
       1: aload_0
       2: getfield      #10                 // Field messageHandler:Lorg/jboss/as/process/protocol/MessageHandler;
       5: putfield      #32                 // Field backupHandler:Lorg/jboss/as/process/protocol/MessageHandler;
       8: return

  public void restoreMessageHandler();
    Code:
       0: aload_0
       1: getfield      #32                 // Field backupHandler:Lorg/jboss/as/process/protocol/MessageHandler;
       4: astore_1
       5: aload_0
       6: aload_1
       7: ifnonnull     16
      10: getstatic     #33                 // Field org/jboss/as/process/protocol/MessageHandler.NULL:Lorg/jboss/as/process/protocol/MessageHandler;
      13: goto          17
      16: aload_1
      17: invokevirtual #34                 // Method setMessageHandler:(Lorg/jboss/as/process/protocol/MessageHandler;)V
      20: return

  java.lang.Runnable getReadTask();
    Code:
       0: new           #35                 // class org/jboss/as/process/protocol/ConnectionImpl$1
       3: dup
       4: aload_0
       5: invokespecial #36                 // Method org/jboss/as/process/protocol/ConnectionImpl$1."<init>":(Lorg/jboss/as/process/protocol/ConnectionImpl;)V
       8: areturn

  void safeHandleMessage(java.io.InputStream);
    Code:
       0: aload_0
       1: getfield      #10                 // Field messageHandler:Lorg/jboss/as/process/protocol/MessageHandler;
       4: aload_0
       5: aload_1
       6: invokeinterface #37,  3           // InterfaceMethod org/jboss/as/process/protocol/MessageHandler.handleMessage:(Lorg/jboss/as/process/protocol/Connection;Ljava/io/InputStream;)V
      11: aload_1
      12: invokestatic  #38                 // Method org/jboss/as/process/protocol/StreamUtils.safeClose:(Ljava/io/Closeable;)V
      15: goto          88
      18: astore_2
      19: getstatic     #40                 // Field org/jboss/as/process/logging/ProcessLogger.PROTOCOL_CONNECTION_LOGGER:Lorg/jboss/as/process/logging/ProcessLogger;
      22: aload_2
      23: invokeinterface #41,  2           // InterfaceMethod org/jboss/as/process/logging/ProcessLogger.failedToReadMessage:(Ljava/lang/Throwable;)V
      28: aload_1
      29: invokestatic  #38                 // Method org/jboss/as/process/protocol/StreamUtils.safeClose:(Ljava/io/Closeable;)V
      32: goto          88
      35: astore_2
      36: getstatic     #40                 // Field org/jboss/as/process/logging/ProcessLogger.PROTOCOL_CONNECTION_LOGGER:Lorg/jboss/as/process/logging/ProcessLogger;
      39: aload_2
      40: invokeinterface #41,  2           // InterfaceMethod org/jboss/as/process/logging/ProcessLogger.failedToReadMessage:(Ljava/lang/Throwable;)V
      45: aload_1
      46: invokestatic  #38                 // Method org/jboss/as/process/protocol/StreamUtils.safeClose:(Ljava/io/Closeable;)V
      49: goto          88
      52: astore_2
      53: getstatic     #40                 // Field org/jboss/as/process/logging/ProcessLogger.PROTOCOL_CONNECTION_LOGGER:Lorg/jboss/as/process/logging/ProcessLogger;
      56: aload_2
      57: invokeinterface #41,  2           // InterfaceMethod org/jboss/as/process/logging/ProcessLogger.failedToReadMessage:(Ljava/lang/Throwable;)V
      62: aload_1
      63: invokestatic  #38                 // Method org/jboss/as/process/protocol/StreamUtils.safeClose:(Ljava/io/Closeable;)V
      66: goto          88
      69: astore_2
      70: getstatic     #40                 // Field org/jboss/as/process/logging/ProcessLogger.PROTOCOL_CONNECTION_LOGGER:Lorg/jboss/as/process/logging/ProcessLogger;
      73: aload_2
      74: invokeinterface #41,  2           // InterfaceMethod org/jboss/as/process/logging/ProcessLogger.failedToReadMessage:(Ljava/lang/Throwable;)V
      79: aload_2
      80: athrow
      81: astore_3
      82: aload_1
      83: invokestatic  #38                 // Method org/jboss/as/process/protocol/StreamUtils.safeClose:(Ljava/io/Closeable;)V
      86: aload_3
      87: athrow
      88: return
    Exception table:
       from    to  target type
           0    11    18   Class java/lang/RuntimeException
           0    11    35   Class java/io/IOException
           0    11    52   Class java/lang/NoClassDefFoundError
           0    11    69   Class java/lang/Error
           0    11    81   any
          18    28    81   any
          35    45    81   any
          52    62    81   any
          69    82    81   any

  void safeHandleShutdown();
    Code:
       0: aload_0
       1: getfield      #10                 // Field messageHandler:Lorg/jboss/as/process/protocol/MessageHandler;
       4: aload_0
       5: invokeinterface #45,  2           // InterfaceMethod org/jboss/as/process/protocol/MessageHandler.handleShutdown:(Lorg/jboss/as/process/protocol/Connection;)V
      10: goto          23
      13: astore_1
      14: getstatic     #40                 // Field org/jboss/as/process/logging/ProcessLogger.PROTOCOL_CONNECTION_LOGGER:Lorg/jboss/as/process/logging/ProcessLogger;
      17: aload_1
      18: invokeinterface #46,  2           // InterfaceMethod org/jboss/as/process/logging/ProcessLogger.failedToHandleSocketShutdown:(Ljava/lang/Throwable;)V
      23: return
    Exception table:
       from    to  target type
           0    10    13   Class java/io/IOException

  void safeHandleFinished();
    Code:
       0: aload_0
       1: getfield      #10                 // Field messageHandler:Lorg/jboss/as/process/protocol/MessageHandler;
       4: aload_0
       5: invokeinterface #47,  2           // InterfaceMethod org/jboss/as/process/protocol/MessageHandler.handleFinished:(Lorg/jboss/as/process/protocol/Connection;)V
      10: goto          23
      13: astore_1
      14: getstatic     #40                 // Field org/jboss/as/process/logging/ProcessLogger.PROTOCOL_CONNECTION_LOGGER:Lorg/jboss/as/process/logging/ProcessLogger;
      17: aload_1
      18: invokeinterface #48,  2           // InterfaceMethod org/jboss/as/process/logging/ProcessLogger.failedToHandleSocketFinished:(Ljava/lang/Throwable;)V
      23: return
    Exception table:
       from    to  target type
           0    10    13   Class java/io/IOException

  void safeHandlerFailure(java.io.IOException);
    Code:
       0: aload_0
       1: getfield      #10                 // Field messageHandler:Lorg/jboss/as/process/protocol/MessageHandler;
       4: aload_0
       5: aload_1
       6: invokeinterface #49,  3           // InterfaceMethod org/jboss/as/process/protocol/MessageHandler.handleFailure:(Lorg/jboss/as/process/protocol/Connection;Ljava/io/IOException;)V
      11: goto          24
      14: astore_2
      15: getstatic     #40                 // Field org/jboss/as/process/logging/ProcessLogger.PROTOCOL_CONNECTION_LOGGER:Lorg/jboss/as/process/logging/ProcessLogger;
      18: aload_1
      19: invokeinterface #50,  2           // InterfaceMethod org/jboss/as/process/logging/ProcessLogger.failedToHandleSocketFailure:(Ljava/lang/Throwable;)V
      24: return
    Exception table:
       from    to  target type
           0    11    14   Class java/io/IOException

  private void closed();
    Code:
       0: aload_0
       1: getfield      #11                 // Field callback:Lorg/jboss/as/process/protocol/Connection$ClosedCallback;
       4: astore_1
       5: aload_1
       6: ifnull        15
       9: aload_1
      10: invokeinterface #51,  1           // InterfaceMethod org/jboss/as/process/protocol/Connection$ClosedCallback.connectionClosed:()V
      15: return

  static java.net.Socket access$000(org.jboss.as.process.protocol.ConnectionImpl);
    Code:
       0: aload_0
       1: getfield      #7                  // Field socket:Ljava/net/Socket;
       4: areturn

  static java.lang.Object access$100(org.jboss.as.process.protocol.ConnectionImpl);
    Code:
       0: aload_0
       1: getfield      #6                  // Field lock:Ljava/lang/Object;
       4: areturn

  static boolean access$202(org.jboss.as.process.protocol.ConnectionImpl, boolean);
    Code:
       0: aload_0
       1: iload_1
       2: dup_x1
       3: putfield      #5                  // Field readDone:Z
       6: ireturn

  static boolean access$300(org.jboss.as.process.protocol.ConnectionImpl);
    Code:
       0: aload_0
       1: getfield      #4                  // Field writeDone:Z
       4: ireturn

  static void access$400(org.jboss.as.process.protocol.ConnectionImpl);
    Code:
       0: aload_0
       1: invokespecial #3                  // Method closed:()V
       4: return

  static java.util.concurrent.Executor access$500(org.jboss.as.process.protocol.ConnectionImpl);
    Code:
       0: aload_0
       1: getfield      #2                  // Field readExecutor:Ljava/util/concurrent/Executor;
       4: areturn

  static java.io.OutputStream access$600(org.jboss.as.process.protocol.ConnectionImpl);
    Code:
       0: aload_0
       1: getfield      #1                  // Field sender:Ljava/io/OutputStream;
       4: areturn

  static java.io.OutputStream access$602(org.jboss.as.process.protocol.ConnectionImpl, java.io.OutputStream);
    Code:
       0: aload_0
       1: aload_1
       2: dup_x1
       3: putfield      #1                  // Field sender:Ljava/io/OutputStream;
       6: areturn

  static boolean access$200(org.jboss.as.process.protocol.ConnectionImpl);
    Code:
       0: aload_0
       1: getfield      #5                  // Field readDone:Z
       4: ireturn
}
