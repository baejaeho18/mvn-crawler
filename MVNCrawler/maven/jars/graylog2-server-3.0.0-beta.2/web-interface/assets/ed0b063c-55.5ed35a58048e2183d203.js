(window.webpackJsonp=window.webpackJsonp||[]).push([["ed0b063c-55"],{DlNzmOHC:function(e,exports,t){var a=t("J9tE8DRW");"string"==typeof a&&(a=[[e.i,a,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};t("HkU00dYq")(a,n);a.locals&&(e.exports=a.locals)},J9tE8DRW:function(e,exports,t){(exports=e.exports=t("wTjlWjHz")(!1)).push([e.i,"._3HrW10n1kzGWl5PDY4B2uD{background-color:#fff;border:1px solid #d1d1d1;z-index:auto}",""]),exports.locals={widgetContainer:"_3HrW10n1kzGWl5PDY4B2uD"}},bvXZ6Zz2:function(e,exports,t){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var a=k(t("ii0bleBb")),s=k(t("ivGQtwpr")),n=k(t("PcYM+wZ7")),o=k(t("4KF7VOU5")),i=t("wMSvutaJ"),d=t("AztyBNMT"),l=k(t("HL1wWrxB")),r=k(t("21p8kIWv")),c=k(t("1VnJesae")),u=k(t("mc0qlNhN")),h=k(t("8GJ6oOEd")),f=k(t("+CppQpVm")),m=k(t("W+sNG9T1")),p=t("oBIKikY9"),g=k(t("dOmQZ9N/")),b=k(t("jHp4XH0b")),D=k(t("Kocg5ZsN")),w=k(t("CmJdQ6Fu")),E=k(t("DlNzmOHC"));function k(e){return e&&e.__esModule?e:{default:e}}var v=c.default.getStore("Streams"),I=c.default.getStore("CurrentUser"),_=r.default.get("Dashboards"),S=_.DashboardsActions,U=_.DashboardsStore,y=c.default.getStore("Focus"),B=c.default.getStore("Widgets"),H=(0,n.default)({displayName:"ShowDashboardPage",propTypes:{params:a.default.object.isRequired},mixins:[o.default.connect(I),o.default.connect(y),g.default],getInitialState:function(){return{locked:!0,forceUpdateInBackground:!1,streamIds:null}},componentDidMount:function(){var a=this;this.loadData(),this.listenTo(B,this.removeWidget),v.load(function(e){var t=e.reduce(function(e,t){return e[t.id]=t.id,e},{});a.setState({streamIds:t})}),this.loadInterval=setInterval(this.loadData,2e3),this.setState({forceUpdateInBackground:this.state.currentUser.preferences.updateUnfocussed})},componentWillUnmount:function(){this.loadInterval&&clearInterval(this.loadInterval),this.promise&&this.promise.cancel()},DASHBOARDS_EDIT:"dashboards:edit",DEFAULT_HEIGHT:2,DEFAULT_WIDTH:4,loadData:function(){var t=this,a=this.props.params.dashboardId;this.promise=U.get(a).then(function(e){t.promise.isCancelled()||(e.widgets.sort(function(e,t){return e.id.localeCompare(t.id)}),t.state.dashboard&&(0,l.default)(t.state.dashboard,e)||t.setState({dashboard:e}))},function(e){e.additional&&404===e.additional.status&&(h.default.error("Unable to find a dashboard with the id <".concat(a,">. Maybe it was deleted in the meantime.")),f.default.push(m.default.DASHBOARDS))})},shouldUpdate:function(){return Boolean(this.state.forceUpdateInBackground||this.state.focus)},removeWidget:function(e){e.delete&&this.loadData()},emptyDashboard:function(){return s.default.createElement(i.Row,{className:"content"},s.default.createElement(i.Col,{md:12},s.default.createElement(i.Alert,{className:"no-widgets"},"This dashboard has no widgets yet. Learn how to add widgets in the ",s.default.createElement(b.default,{page:u.default.PAGES.DASHBOARDS,text:"documentation"}),".")))},_defaultWidgetDimensions:function(t){var e={col:0,row:0},a=d.PluginStore.exports("widgets").filter(function(e){return e.type.toUpperCase()===t.type.toUpperCase()})[0];return e.width=a?(e.height=a.defaultHeight,a.defaultWidth):(e.height=this.DEFAULT_HEIGHT,this.DEFAULT_WIDTH),e},_dashboardIsEmpty:function(e){return 0===e.widgets.length},_validDimension:function(e){return Number.isInteger(e)&&0<e},formatDashboard:function(n){var o=this;if(this._dashboardIsEmpty(n))return this.emptyDashboard();var d={};n.widgets.forEach(function(e){var t=n.positions[e.id]||{},a=o._defaultWidgetDimensions(e);d[e.id]={col:void 0===t.col?a.col:t.col,row:void 0===t.row?a.row:t.row,height:o._validDimension(t.height)?t.height:a.height,width:o._validDimension(t.width)?t.width:a.width}});var e=n.widgets.sort(function(e,t){var a=d[e.id],n=d[t.id];return a.col===n.col?a.row-n.row:a.col-n.col}).map(function(e){return s.default.createElement("div",{key:e.id,className:E.default.widgetContainer},s.default.createElement(w.default,{id:e.id,key:"widget-".concat(e.id),widget:e,dashboardId:n.id,locked:o.state.locked,shouldUpdate:o.shouldUpdate(),streamIds:o.state.streamIds}))});return s.default.createElement(i.Row,null,s.default.createElement("div",{className:"dashboard"},s.default.createElement(p.ReactGridContainer,{positions:d,onPositionsChange:this._onPositionsChange,locked:this.state.locked},e)))},_unlockDashboard:function(e){e.preventDefault(),this.state.locked&&this._toggleUnlock()},_toggleUnlock:function(){this.setState({locked:!this.state.locked})},_onPositionsChange:function(e){S.updatePositions(this.state.dashboard,e)},_toggleFullscreen:function(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},_toggleUpdateInBackground:function(){var e=!this.state.forceUpdateInBackground;this.setState({forceUpdateInBackground:e}),h.default.success("Graphs will be updated ".concat(e?"even":"only"," when the browser is in the ").concat(e?"background":"foreground"),"")},_handleDashboardUpdate:function(){this.loadData()},render:function(){if(!this.state.dashboard)return s.default.createElement(p.Spinner,null);var e,t,a=this.state.dashboard;this._dashboardIsEmpty(a)||(e=s.default.createElement("div",null,s.default.createElement(i.Button,{id:"update-unfocussed",bsStyle:"info",onClick:this._toggleUpdateInBackground},"Update in ",this.state.forceUpdateInBackground?"foreground":"background")," ",s.default.createElement(i.Button,{className:"toggle-fullscreen",bsStyle:"info",onClick:this._toggleFullscreen},"Fullscreen"),s.default.createElement(p.IfPermitted,{permissions:"".concat(this.DASHBOARDS_EDIT,":").concat(a.id)}," ",s.default.createElement(i.Button,{bsStyle:"success",onClick:this._toggleUnlock},this.state.locked?"Unlock / Edit":"Lock")))),this._dashboardIsEmpty(a)||(t=s.default.createElement(p.IfPermitted,{permissions:"".concat(this.DASHBOARDS_EDIT,":").concat(a.id)},s.default.createElement("div",{id:"drag-widgets-description"},"Drag widgets to any position you like in ",s.default.createElement("a",{href:"#",role:"button",onClick:this._unlockDashboard},"unlock / edit")," mode.")));var n=this.state.locked||this._dashboardIsEmpty(a)?null:s.default.createElement(D.default,{id:a.id,action:"edit",title:a.title,description:a.description,onSaved:this._handleDashboardUpdate,buttonClass:"btn-info btn-xs"},s.default.createElement("i",{className:"fa fa-pencil"})),o=s.default.createElement("span",null,a.title,"Â ",n);return s.default.createElement(p.DocumentTitle,{title:"Dashboard ".concat(a.title)},s.default.createElement("span",null,s.default.createElement(p.PageHeader,{title:o},a.description,t,e),this.formatDashboard(a),s.default.createElement("div",{className:"clearfix"})))}});exports.default=H,e.exports=exports.default}}]);