(window.webpackJsonp=window.webpackJsonp||[]).push([["ed0b063c-62"],{"0Sxz/HKf":function(e,exports,t){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r=f(t("ii0bleBb")),a=f(t("ivGQtwpr")),n=f(t("PcYM+wZ7")),i=f(t("4KF7VOU5")),s=f(t("VPaD/Np4")),o=f(t("2gEPIf6i")),u=f(t("21p8kIWv")),l=t("oBIKikY9"),c=t("GceFy7Zr");function f(e){return e&&e.__esModule?e:{default:e}}var p=u.default.get("Nodes"),h=p.NodesStore,d=p.NodesActions,m=u.default.get("CurrentUser").CurrentUserStore,g=u.default.get("Inputs"),S=g.InputsStore,v=g.InputsActions,y=u.default.get("MessageFields").MessageFieldsStore,b=u.default.get("Refresh").RefreshStore,_=u.default.get("Streams").StreamsStore,I=u.default.get("UniversalSearch").UniversalSearchStore,w=u.default.get("Search").SearchStore,D=u.default.get("Decorators").DecoratorsStore,R=(0,n.default)({displayName:"SearchPage",propTypes:{location:r.default.object.isRequired,searchConfig:r.default.object.isRequired,searchInStream:r.default.object,forceFetch:r.default.bool},mixins:[i.default.connect(h),i.default.connect(y),i.default.connect(m),i.default.listenTo(S,"_formatInputs"),i.default.listenTo(b,"_setupTimer","_setupTimer"),i.default.listenTo(D,"_refreshDataFromDecoratorStore","_refreshDataFromDecoratorStore")],getInitialState:function(){return{error:void 0,updatingSearch:!1,updatingHistogram:!1}},componentDidMount:function(){var r=this;v.list.triggerPromise(),_.listStreams().then(function(e){var t={};e.forEach(function(e){t[e.id]=e}),r.setState({streams:s.default.Map(t)})}),d.list()},componentWillReceiveProps:function(e){var t=this.props.location||{},r=e.location||{};(t.search!==r.search||this.props.searchInStream!==e.searchInStream||e.forceFetch)&&(this.promise&&this.promise.cancel(),this._refreshData(e.searchInStream))},componentWillUnmount:function(){this.promise&&this.promise.cancel(),this._stopTimer()},_setupTimer:function(e){this._stopTimer(),e.enabled&&(this.timer=setInterval(this._refreshData,e.interval))},_stopTimer:function(){this.timer&&clearInterval(this.timer)},_refreshDataFromDecoratorStore:function(){var e=this.props.searchInStream;this._refreshData(e)},_refreshData:function(e){var r=this,a=w.originalQuery,n=(e||this.props.searchInStream||{}).id;if(this.promise&&!this.promise.isCancelled())return this.promise;(!b.enabled||b.enabled&&5e3<parseInt(b.interval))&&this.setState({updatingSearch:!0}),this.promise=I.search(w.originalRangeType,a,w.originalRangeParams.toJS(),n,null,w.page,w.sortField,w.sortOrder).then(function(e){r.setState({searchResult:e,error:void 0});var t=r.props.location.query.interval?r.props.location.query.interval:r._determineHistogramResolution(e);return(!b.enabled||b.enabled&&5e3<parseInt(b.interval))&&r.setState({updatingHistogram:!0}),I.histogram(w.originalRangeType,a,w.originalRangeParams.toJS(),t,n).then(function(e){return r.setState({histogram:e}),e}).finally(function(){return r.setState({updatingHistogram:!1})}),e},function(e){e.additional&&e.additional.status&&r.setState({error:e.additional})}).finally(function(){r.setState({updatingSearch:!1}),r.promise=void 0})},_formatInputs:function(e){var t=S.inputsAsMap(e.inputs);this.setState({inputs:s.default.Map(t)})},_determineSearchDuration:function(e){var t,r=e.to;if("relative"===w.originalRangeType&&0===w.originalRangeParams.get("relative")){var a=e.used_indices.sort(function(e,t){return(0,o.default)(e.end)-(0,o.default)(t.end)}),n=0===(0,o.default)(a[0].end).valueOf()?a[1]:a[0];t=void 0!==n?n.begin:r}else t=e.from;var i=(0,o.default)(r).diff(t,"minutes");return o.default.duration(i,"minutes")},_determineHistogramResolution:function(e){var t=this._determineSearchDuration(e);return t.asHours()<12?"minute":t.asDays()<3?"hour":t.asDays()<30?"day":t.asMonths()<2?"week":t.asMonths()<18?"month":t.asYears()<3?"quarter":"year"},_isLoading:function(){return!(this.state.searchResult&&this.state.inputs&&this.state.streams&&this.state.nodes&&this.state.fields&&this.state.histogram)},render:function(){if(this.state.error){var e;switch(this.state.error.status){case 400:e=a.default.createElement(c.MalformedSearchQuery,{error:this.state.error});break;default:e=a.default.createElement(c.SearchExecutionError,{error:this.state.error})}return a.default.createElement(l.DocumentTitle,{title:"Search error"},e)}if(this._isLoading())return a.default.createElement(l.Spinner,null);var t=this.state.searchResult;return t.all_fields=this.state.fields,a.default.createElement(l.DocumentTitle,{title:"Search"},a.default.createElement(c.SearchResult,{query:w.originalQuery,page:w.page,builtQuery:t.built_query,result:t,histogram:this.state.histogram,formattedHistogram:this.state.histogram.histogram,streams:this.state.streams,inputs:this.state.inputs,nodes:s.default.Map(this.state.nodes),searchInStream:this.props.searchInStream,permissions:this.state.currentUser.permissions,searchConfig:this.props.searchConfig,loadingSearch:this.state.updatingSearch||this.state.updatingHistogram,forceFetch:this.props.forceFetch}))}});exports.default=R,e.exports=exports.default},JqlWova6:function(e,exports,t){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r=a(t("ii0bleBb")),n=a(t("ivGQtwpr")),i=a(t("0Sxz/HKf")),s=t("oBIKikY9");function a(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function c(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var m=a(t("1VnJesae")).default.getStore("Streams"),o=function(e){function o(){var e,t,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return r=this,a=(e=f(o)).call.apply(e,[this].concat(i)),d(h(h(t=!a||"object"!==u(a)&&"function"!=typeof a?h(r):a)),"state",{stream:void 0}),d(h(h(t)),"_fetchStream",function(e){m.get(e,function(e){return t.setState({stream:e})})}),t}var t,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(o,n.default.Component),t=o,(r=[{key:"componentDidMount",value:function(){this._fetchStream(this.props.params.streamId)}},{key:"componentWillReceiveProps",value:function(e){this.props.params.streamId!==e.params.streamId&&this._fetchStream(e.params.streamId)}},{key:"render",value:function(){return this.state.stream?n.default.createElement(s.DocumentTitle,{title:"Stream ".concat(this.state.stream.title)},n.default.createElement(i.default,l({searchInStream:this.state.stream},this.props))):n.default.createElement(s.Spinner,null)}}])&&c(t.prototype,r),a&&c(t,a),o}();d(o,"propTypes",{params:r.default.object.isRequired});var g=o;exports.default=g,e.exports=exports.default}}]);