(window.webpackJsonp=window.webpackJsonp||[]).push([["ed0b063c-61"],{"0Sxz/HKf":function(e,exports,t){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r=d(t("ii0bleBb")),a=d(t("ivGQtwpr")),s=d(t("PcYM+wZ7")),i=d(t("4KF7VOU5")),n=d(t("VPaD/Np4")),o=d(t("2gEPIf6i")),u=d(t("21p8kIWv")),l=t("oBIKikY9"),c=t("GceFy7Zr");function d(e){return e&&e.__esModule?e:{default:e}}var f=u.default.get("Nodes"),h=f.NodesStore,p=f.NodesActions,m=u.default.get("CurrentUser").CurrentUserStore,g=u.default.get("Inputs"),S=g.InputsStore,v=g.InputsActions,_=u.default.get("MessageFields").MessageFieldsStore,y=u.default.get("Refresh").RefreshStore,I=u.default.get("Streams").StreamsStore,b=u.default.get("UniversalSearch").UniversalSearchStore,D=u.default.get("Search").SearchStore,R=u.default.get("Decorators").DecoratorsStore,M=(0,s.default)({displayName:"SearchPage",propTypes:{location:r.default.object.isRequired,searchConfig:r.default.object.isRequired,searchInStream:r.default.object,forceFetch:r.default.bool},mixins:[i.default.connect(h),i.default.connect(_),i.default.connect(m),i.default.listenTo(S,"_formatInputs"),i.default.listenTo(y,"_setupTimer","_setupTimer"),i.default.listenTo(R,"_refreshDataFromDecoratorStore","_refreshDataFromDecoratorStore")],getInitialState:function(){return{error:void 0,updatingSearch:!1,updatingHistogram:!1}},componentDidMount:function(){var r=this;v.list.triggerPromise(),I.listStreams().then(function(e){var t={};e.forEach(function(e){t[e.id]=e}),r.setState({streams:n.default.Map(t)})}),p.list()},componentWillReceiveProps:function(e){var t=this.props.location||{},r=e.location||{};(t.search!==r.search||this.props.searchInStream!==e.searchInStream||e.forceFetch)&&(this.promise&&this.promise.cancel(),this._refreshData(e.searchInStream))},componentWillUnmount:function(){this.promise&&this.promise.cancel(),this._stopTimer()},_setupTimer:function(e){this._stopTimer(),e.enabled&&(this.timer=setInterval(this._refreshData,e.interval))},_stopTimer:function(){this.timer&&clearInterval(this.timer)},_refreshDataFromDecoratorStore:function(){var e=this.props.searchInStream;this._refreshData(e)},_refreshData:function(e){var r=this,a=D.originalQuery,s=(e||this.props.searchInStream||{}).id;if(this.promise&&!this.promise.isCancelled())return this.promise;(!y.enabled||y.enabled&&5e3<parseInt(y.interval))&&this.setState({updatingSearch:!0}),this.promise=b.search(D.originalRangeType,a,D.originalRangeParams.toJS(),s,null,D.page,D.sortField,D.sortOrder).then(function(e){r.setState({searchResult:e,error:void 0});var t=r.props.location.query.interval?r.props.location.query.interval:r._determineHistogramResolution(e);return(!y.enabled||y.enabled&&5e3<parseInt(y.interval))&&r.setState({updatingHistogram:!0}),b.histogram(D.originalRangeType,a,D.originalRangeParams.toJS(),t,s).then(function(e){return r.setState({histogram:e}),e}).finally(function(){return r.setState({updatingHistogram:!1})}),e},function(e){e.additional&&e.additional.status&&r.setState({error:e.additional})}).finally(function(){r.setState({updatingSearch:!1}),r.promise=void 0})},_formatInputs:function(e){var t=S.inputsAsMap(e.inputs);this.setState({inputs:n.default.Map(t)})},_determineSearchDuration:function(e){var t,r=e.to;if("relative"===D.originalRangeType&&0===D.originalRangeParams.get("relative")){var a=e.used_indices.sort(function(e,t){return(0,o.default)(e.end)-(0,o.default)(t.end)}),s=0===(0,o.default)(a[0].end).valueOf()?a[1]:a[0];t=void 0!==s?s.begin:r}else t=e.from;var i=(0,o.default)(r).diff(t,"minutes");return o.default.duration(i,"minutes")},_determineHistogramResolution:function(e){var t=this._determineSearchDuration(e);return t.asHours()<12?"minute":t.asDays()<3?"hour":t.asDays()<30?"day":t.asMonths()<2?"week":t.asMonths()<18?"month":t.asYears()<3?"quarter":"year"},_isLoading:function(){return!(this.state.searchResult&&this.state.inputs&&this.state.streams&&this.state.nodes&&this.state.fields&&this.state.histogram)},render:function(){if(this.state.error){var e;switch(this.state.error.status){case 400:e=a.default.createElement(c.MalformedSearchQuery,{error:this.state.error});break;default:e=a.default.createElement(c.SearchExecutionError,{error:this.state.error})}return a.default.createElement(l.DocumentTitle,{title:"Search error"},e)}if(this._isLoading())return a.default.createElement(l.Spinner,null);var t=this.state.searchResult;return t.all_fields=this.state.fields,a.default.createElement(l.DocumentTitle,{title:"Search"},a.default.createElement(c.SearchResult,{query:D.originalQuery,page:D.page,builtQuery:t.built_query,result:t,histogram:this.state.histogram,formattedHistogram:this.state.histogram.histogram,streams:this.state.streams,inputs:this.state.inputs,nodes:n.default.Map(this.state.nodes),searchInStream:this.props.searchInStream,permissions:this.state.currentUser.permissions,searchConfig:this.props.searchConfig,loadingSearch:this.state.updatingSearch||this.state.updatingHistogram,forceFetch:this.props.forceFetch}))}});exports.default=M,e.exports=exports.default},l5f7ZvXC:function(e,exports,t){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r=i(t("ivGQtwpr")),a=t("AztyBNMT"),s=i(t("0Sxz/HKf"));function i(e){return e&&e.__esModule?e:{default:e}}exports.default=function(e){var t=(a.PluginStore.exports("pages").map(function(e){return e.search||{}}).map(function(e){return e.component}).filter(function(e){return e})||[])[0]||s.default;return r.default.createElement(t,e)},e.exports=exports.default}}]);