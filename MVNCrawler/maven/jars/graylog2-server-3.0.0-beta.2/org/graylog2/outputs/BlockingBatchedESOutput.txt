Compiled from "BlockingBatchedESOutput.java"
public class org.graylog2.outputs.BlockingBatchedESOutput extends org.graylog2.outputs.ElasticSearchOutput {
  private static final org.slf4j.Logger log;

  private final int maxBufferSize;

  private final com.codahale.metrics.Timer processTime;

  private final com.codahale.metrics.Histogram batchSize;

  private final com.codahale.metrics.Meter bufferFlushes;

  private final com.codahale.metrics.Meter bufferFlushFailures;

  private final com.codahale.metrics.Meter bufferFlushesRequested;

  private volatile java.util.List<java.util.Map$Entry<org.graylog2.indexer.IndexSet, org.graylog2.plugin.Message>> buffer;

  private static final java.util.concurrent.atomic.AtomicInteger activeFlushThreads;

  private final java.util.concurrent.atomic.AtomicLong lastFlushTime;

  private final int outputFlushInterval;

  public org.graylog2.outputs.BlockingBatchedESOutput(com.codahale.metrics.MetricRegistry, org.graylog2.indexer.messages.Messages, org.graylog2.Configuration, org.graylog2.shared.journal.Journal, org.graylog2.plugin.streams.Stream, org.graylog2.plugin.configuration.Configuration);
    Code:
       0: aload_0
       1: aload_1
       2: aload_2
       3: aload_3
       4: aload         4
       6: invokespecial #1                  // Method "<init>":(Lcom/codahale/metrics/MetricRegistry;Lorg/graylog2/indexer/messages/Messages;Lorg/graylog2/Configuration;Lorg/graylog2/shared/journal/Journal;)V
       9: return

  public org.graylog2.outputs.BlockingBatchedESOutput(com.codahale.metrics.MetricRegistry, org.graylog2.indexer.messages.Messages, org.graylog2.Configuration, org.graylog2.shared.journal.Journal);
    Code:
       0: aload_0
       1: aload_1
       2: aload_2
       3: aload         4
       5: invokespecial #2                  // Method org/graylog2/outputs/ElasticSearchOutput."<init>":(Lcom/codahale/metrics/MetricRegistry;Lorg/graylog2/indexer/messages/Messages;Lorg/graylog2/shared/journal/Journal;)V
       8: aload_0
       9: new           #3                  // class java/util/concurrent/atomic/AtomicLong
      12: dup
      13: invokespecial #4                  // Method java/util/concurrent/atomic/AtomicLong."<init>":()V
      16: putfield      #5                  // Field lastFlushTime:Ljava/util/concurrent/atomic/AtomicLong;
      19: aload_0
      20: aload_3
      21: invokevirtual #6                  // Method org/graylog2/Configuration.getOutputBatchSize:()I
      24: putfield      #7                  // Field maxBufferSize:I
      27: aload_0
      28: aload_3
      29: invokevirtual #8                  // Method org/graylog2/Configuration.getOutputFlushInterval:()I
      32: putfield      #9                  // Field outputFlushInterval:I
      35: aload_0
      36: aload_1
      37: aload_0
      38: invokevirtual #10                 // Method java/lang/Object.getClass:()Ljava/lang/Class;
      41: iconst_1
      42: anewarray     #11                 // class java/lang/String
      45: dup
      46: iconst_0
      47: ldc           #12                 // String processTime
      49: aastore
      50: invokestatic  #13                 // Method com/codahale/metrics/MetricRegistry.name:(Ljava/lang/Class;[Ljava/lang/String;)Ljava/lang/String;
      53: invokevirtual #14                 // Method com/codahale/metrics/MetricRegistry.timer:(Ljava/lang/String;)Lcom/codahale/metrics/Timer;
      56: putfield      #15                 // Field processTime:Lcom/codahale/metrics/Timer;
      59: aload_0
      60: aload_1
      61: aload_0
      62: invokevirtual #10                 // Method java/lang/Object.getClass:()Ljava/lang/Class;
      65: iconst_1
      66: anewarray     #11                 // class java/lang/String
      69: dup
      70: iconst_0
      71: ldc           #16                 // String batchSize
      73: aastore
      74: invokestatic  #13                 // Method com/codahale/metrics/MetricRegistry.name:(Ljava/lang/Class;[Ljava/lang/String;)Ljava/lang/String;
      77: invokevirtual #17                 // Method com/codahale/metrics/MetricRegistry.histogram:(Ljava/lang/String;)Lcom/codahale/metrics/Histogram;
      80: putfield      #18                 // Field batchSize:Lcom/codahale/metrics/Histogram;
      83: aload_0
      84: aload_1
      85: aload_0
      86: invokevirtual #10                 // Method java/lang/Object.getClass:()Ljava/lang/Class;
      89: iconst_1
      90: anewarray     #11                 // class java/lang/String
      93: dup
      94: iconst_0
      95: ldc           #19                 // String bufferFlushes
      97: aastore
      98: invokestatic  #13                 // Method com/codahale/metrics/MetricRegistry.name:(Ljava/lang/Class;[Ljava/lang/String;)Ljava/lang/String;
     101: invokevirtual #20                 // Method com/codahale/metrics/MetricRegistry.meter:(Ljava/lang/String;)Lcom/codahale/metrics/Meter;
     104: putfield      #21                 // Field bufferFlushes:Lcom/codahale/metrics/Meter;
     107: aload_0
     108: aload_1
     109: aload_0
     110: invokevirtual #10                 // Method java/lang/Object.getClass:()Ljava/lang/Class;
     113: iconst_1
     114: anewarray     #11                 // class java/lang/String
     117: dup
     118: iconst_0
     119: ldc           #22                 // String bufferFlushFailures
     121: aastore
     122: invokestatic  #13                 // Method com/codahale/metrics/MetricRegistry.name:(Ljava/lang/Class;[Ljava/lang/String;)Ljava/lang/String;
     125: invokevirtual #20                 // Method com/codahale/metrics/MetricRegistry.meter:(Ljava/lang/String;)Lcom/codahale/metrics/Meter;
     128: putfield      #23                 // Field bufferFlushFailures:Lcom/codahale/metrics/Meter;
     131: aload_0
     132: aload_1
     133: aload_0
     134: invokevirtual #10                 // Method java/lang/Object.getClass:()Ljava/lang/Class;
     137: iconst_1
     138: anewarray     #11                 // class java/lang/String
     141: dup
     142: iconst_0
     143: ldc           #24                 // String bufferFlushesRequested
     145: aastore
     146: invokestatic  #13                 // Method com/codahale/metrics/MetricRegistry.name:(Ljava/lang/Class;[Ljava/lang/String;)Ljava/lang/String;
     149: invokevirtual #20                 // Method com/codahale/metrics/MetricRegistry.meter:(Ljava/lang/String;)Lcom/codahale/metrics/Meter;
     152: putfield      #25                 // Field bufferFlushesRequested:Lcom/codahale/metrics/Meter;
     155: aload_0
     156: new           #26                 // class java/util/ArrayList
     159: dup
     160: aload_0
     161: getfield      #7                  // Field maxBufferSize:I
     164: invokespecial #27                 // Method java/util/ArrayList."<init>":(I)V
     167: putfield      #28                 // Field buffer:Ljava/util/List;
     170: return

  public void write(org.graylog2.plugin.Message) throws java.lang.Exception;
    Code:
       0: aload_1
       1: invokevirtual #29                 // Method org/graylog2/plugin/Message.getIndexSets:()Ljava/util/Set;
       4: invokeinterface #30,  1           // InterfaceMethod java/util/Set.iterator:()Ljava/util/Iterator;
       9: astore_2
      10: aload_2
      11: invokeinterface #31,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
      16: ifeq          41
      19: aload_2
      20: invokeinterface #32,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      25: checkcast     #33                 // class org/graylog2/indexer/IndexSet
      28: astore_3
      29: aload_0
      30: aload_3
      31: aload_1
      32: invokestatic  #34                 // Method com/google/common/collect/Maps.immutableEntry:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/util/Map$Entry;
      35: invokevirtual #35                 // Method writeMessageEntry:(Ljava/util/Map$Entry;)V
      38: goto          10
      41: return

  public void writeMessageEntry(java.util.Map$Entry<org.graylog2.indexer.IndexSet, org.graylog2.plugin.Message>) throws java.lang.Exception;
    Code:
       0: aconst_null
       1: astore_2
       2: aload_0
       3: dup
       4: astore_3
       5: monitorenter
       6: aload_0
       7: getfield      #28                 // Field buffer:Ljava/util/List;
      10: aload_1
      11: invokeinterface #36,  2           // InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z
      16: pop
      17: aload_0
      18: getfield      #28                 // Field buffer:Ljava/util/List;
      21: invokeinterface #37,  1           // InterfaceMethod java/util/List.size:()I
      26: aload_0
      27: getfield      #7                  // Field maxBufferSize:I
      30: if_icmplt     53
      33: aload_0
      34: getfield      #28                 // Field buffer:Ljava/util/List;
      37: astore_2
      38: aload_0
      39: new           #26                 // class java/util/ArrayList
      42: dup
      43: aload_0
      44: getfield      #7                  // Field maxBufferSize:I
      47: invokespecial #27                 // Method java/util/ArrayList."<init>":(I)V
      50: putfield      #28                 // Field buffer:Ljava/util/List;
      53: aload_3
      54: monitorexit
      55: goto          65
      58: astore        4
      60: aload_3
      61: monitorexit
      62: aload         4
      64: athrow
      65: aload_2
      66: ifnull        74
      69: aload_0
      70: aload_2
      71: invokespecial #38                 // Method flush:(Ljava/util/List;)V
      74: return
    Exception table:
       from    to  target type
           6    55    58   any
          58    62    58   any

  private void flush(java.util.List<java.util.Map$Entry<org.graylog2.indexer.IndexSet, org.graylog2.plugin.Message>>);
    Code:
       0: aload_1
       1: invokeinterface #39,  1           // InterfaceMethod java/util/List.isEmpty:()Z
       6: ifeq          10
       9: return
      10: getstatic     #40                 // Field activeFlushThreads:Ljava/util/concurrent/atomic/AtomicInteger;
      13: invokevirtual #41                 // Method java/util/concurrent/atomic/AtomicInteger.incrementAndGet:()I
      16: pop
      17: getstatic     #42                 // Field log:Lorg/slf4j/Logger;
      20: invokeinterface #43,  1           // InterfaceMethod org/slf4j/Logger.isDebugEnabled:()Z
      25: ifeq          56
      28: getstatic     #42                 // Field log:Lorg/slf4j/Logger;
      31: ldc           #44                 // String Starting flushing {} messages, flush threads active {}
      33: aload_1
      34: invokeinterface #37,  1           // InterfaceMethod java/util/List.size:()I
      39: invokestatic  #45                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;
      42: getstatic     #40                 // Field activeFlushThreads:Ljava/util/concurrent/atomic/AtomicInteger;
      45: invokevirtual #46                 // Method java/util/concurrent/atomic/AtomicInteger.get:()I
      48: invokestatic  #45                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;
      51: invokeinterface #47,  4           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
      56: aload_0
      57: getfield      #15                 // Field processTime:Lcom/codahale/metrics/Timer;
      60: invokevirtual #48                 // Method com/codahale/metrics/Timer.time:()Lcom/codahale/metrics/Timer$Context;
      63: astore_2
      64: aconst_null
      65: astore_3
      66: aload_0
      67: getfield      #5                  // Field lastFlushTime:Ljava/util/concurrent/atomic/AtomicLong;
      70: invokestatic  #49                 // Method java/lang/System.nanoTime:()J
      73: invokevirtual #50                 // Method java/util/concurrent/atomic/AtomicLong.set:(J)V
      76: aload_0
      77: aload_1
      78: invokevirtual #51                 // Method writeMessageEntries:(Ljava/util/List;)V
      81: aload_0
      82: getfield      #18                 // Field batchSize:Lcom/codahale/metrics/Histogram;
      85: aload_1
      86: invokeinterface #37,  1           // InterfaceMethod java/util/List.size:()I
      91: invokevirtual #52                 // Method com/codahale/metrics/Histogram.update:(I)V
      94: aload_0
      95: getfield      #21                 // Field bufferFlushes:Lcom/codahale/metrics/Meter;
      98: invokevirtual #53                 // Method com/codahale/metrics/Meter.mark:()V
     101: aload_2
     102: ifnull        177
     105: aload_3
     106: ifnull        127
     109: aload_2
     110: invokevirtual #54                 // Method com/codahale/metrics/Timer$Context.close:()V
     113: goto          177
     116: astore        4
     118: aload_3
     119: aload         4
     121: invokevirtual #56                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     124: goto          177
     127: aload_2
     128: invokevirtual #54                 // Method com/codahale/metrics/Timer$Context.close:()V
     131: goto          177
     134: astore        4
     136: aload         4
     138: astore_3
     139: aload         4
     141: athrow
     142: astore        5
     144: aload_2
     145: ifnull        174
     148: aload_3
     149: ifnull        170
     152: aload_2
     153: invokevirtual #54                 // Method com/codahale/metrics/Timer$Context.close:()V
     156: goto          174
     159: astore        6
     161: aload_3
     162: aload         6
     164: invokevirtual #56                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     167: goto          174
     170: aload_2
     171: invokevirtual #54                 // Method com/codahale/metrics/Timer$Context.close:()V
     174: aload         5
     176: athrow
     177: goto          199
     180: astore_2
     181: getstatic     #42                 // Field log:Lorg/slf4j/Logger;
     184: ldc           #58                 // String Unable to flush message buffer
     186: aload_2
     187: invokeinterface #59,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Throwable;)V
     192: aload_0
     193: getfield      #23                 // Field bufferFlushFailures:Lcom/codahale/metrics/Meter;
     196: invokevirtual #53                 // Method com/codahale/metrics/Meter.mark:()V
     199: getstatic     #40                 // Field activeFlushThreads:Ljava/util/concurrent/atomic/AtomicInteger;
     202: invokevirtual #60                 // Method java/util/concurrent/atomic/AtomicInteger.decrementAndGet:()I
     205: pop
     206: getstatic     #42                 // Field log:Lorg/slf4j/Logger;
     209: ldc           #61                 // String Flushing {} messages completed
     211: aload_1
     212: invokeinterface #37,  1           // InterfaceMethod java/util/List.size:()I
     217: invokestatic  #45                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;
     220: invokeinterface #62,  3           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;Ljava/lang/Object;)V
     225: return
    Exception table:
       from    to  target type
         109   113   116   Class java/lang/Throwable
          66   101   134   Class java/lang/Throwable
          66   101   142   any
         152   156   159   Class java/lang/Throwable
         134   144   142   any
          56   177   180   Class java/lang/Exception

  public void forceFlushIfTimedout();
    Code:
       0: aload_0
       1: getfield      #5                  // Field lastFlushTime:Ljava/util/concurrent/atomic/AtomicLong;
       4: invokevirtual #63                 // Method java/util/concurrent/atomic/AtomicLong.get:()J
       7: lconst_0
       8: lcmp
       9: ifeq          39
      12: aload_0
      13: getfield      #9                  // Field outputFlushInterval:I
      16: i2l
      17: getstatic     #64                 // Field java/util/concurrent/TimeUnit.NANOSECONDS:Ljava/util/concurrent/TimeUnit;
      20: invokestatic  #49                 // Method java/lang/System.nanoTime:()J
      23: aload_0
      24: getfield      #5                  // Field lastFlushTime:Ljava/util/concurrent/atomic/AtomicLong;
      27: invokevirtual #63                 // Method java/util/concurrent/atomic/AtomicLong.get:()J
      30: lsub
      31: invokevirtual #65                 // Method java/util/concurrent/TimeUnit.toSeconds:(J)J
      34: lcmp
      35: ifle          39
      38: return
      39: aload_0
      40: dup
      41: astore_2
      42: monitorenter
      43: aload_0
      44: getfield      #28                 // Field buffer:Ljava/util/List;
      47: astore_1
      48: aload_0
      49: new           #26                 // class java/util/ArrayList
      52: dup
      53: aload_0
      54: getfield      #7                  // Field maxBufferSize:I
      57: invokespecial #27                 // Method java/util/ArrayList."<init>":(I)V
      60: putfield      #28                 // Field buffer:Ljava/util/List;
      63: aload_2
      64: monitorexit
      65: goto          73
      68: astore_3
      69: aload_2
      70: monitorexit
      71: aload_3
      72: athrow
      73: aload_1
      74: ifnull        89
      77: aload_0
      78: getfield      #25                 // Field bufferFlushesRequested:Lcom/codahale/metrics/Meter;
      81: invokevirtual #53                 // Method com/codahale/metrics/Meter.mark:()V
      84: aload_0
      85: aload_1
      86: invokespecial #38                 // Method flush:(Ljava/util/List;)V
      89: return
    Exception table:
       from    to  target type
          43    65    68   any
          68    71    68   any

  static {};
    Code:
       0: ldc           #66                 // class org/graylog2/outputs/BlockingBatchedESOutput
       2: invokestatic  #67                 // Method org/slf4j/LoggerFactory.getLogger:(Ljava/lang/Class;)Lorg/slf4j/Logger;
       5: putstatic     #42                 // Field log:Lorg/slf4j/Logger;
       8: new           #68                 // class java/util/concurrent/atomic/AtomicInteger
      11: dup
      12: iconst_0
      13: invokespecial #69                 // Method java/util/concurrent/atomic/AtomicInteger."<init>":(I)V
      16: putstatic     #40                 // Field activeFlushThreads:Ljava/util/concurrent/atomic/AtomicInteger;
      19: return
}
