Compiled from "UserPermissionMigrationPeriodical.java"
public class org.graylog2.periodical.UserPermissionMigrationPeriodical extends org.graylog2.plugin.periodical.Periodical {
  private static final org.slf4j.Logger log;

  private final org.graylog2.shared.users.UserService userService;

  private final org.graylog2.users.RoleService roleService;

  private final org.graylog2.shared.security.Permissions permissions;

  private final org.graylog2.plugin.cluster.ClusterConfigService clusterConfigService;

  public org.graylog2.periodical.UserPermissionMigrationPeriodical(org.graylog2.shared.users.UserService, org.graylog2.users.RoleService, org.graylog2.shared.security.Permissions, org.graylog2.plugin.cluster.ClusterConfigService);
    Code:
       0: aload_0
       1: invokespecial #1                  // Method org/graylog2/plugin/periodical/Periodical."<init>":()V
       4: aload_0
       5: aload_1
       6: putfield      #2                  // Field userService:Lorg/graylog2/shared/users/UserService;
       9: aload_0
      10: aload_2
      11: putfield      #3                  // Field roleService:Lorg/graylog2/users/RoleService;
      14: aload_0
      15: aload_3
      16: putfield      #4                  // Field permissions:Lorg/graylog2/shared/security/Permissions;
      19: aload_0
      20: aload         4
      22: putfield      #5                  // Field clusterConfigService:Lorg/graylog2/plugin/cluster/ClusterConfigService;
      25: return

  public void doRun();
    Code:
       0: aload_0
       1: getfield      #2                  // Field userService:Lorg/graylog2/shared/users/UserService;
       4: invokeinterface #6,  1            // InterfaceMethod org/graylog2/shared/users/UserService.loadAll:()Ljava/util/List;
       9: astore_1
      10: aload_0
      11: getfield      #3                  // Field roleService:Lorg/graylog2/users/RoleService;
      14: invokeinterface #7,  1            // InterfaceMethod org/graylog2/users/RoleService.getAdminRoleObjectId:()Ljava/lang/String;
      19: astore_2
      20: aload_0
      21: getfield      #3                  // Field roleService:Lorg/graylog2/users/RoleService;
      24: invokeinterface #8,  1            // InterfaceMethod org/graylog2/users/RoleService.getReaderRoleObjectId:()Ljava/lang/String;
      29: astore_3
      30: aload_1
      31: invokeinterface #9,  1            // InterfaceMethod java/util/List.iterator:()Ljava/util/Iterator;
      36: astore        4
      38: aload         4
      40: invokeinterface #10,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
      45: ifeq          429
      48: aload         4
      50: invokeinterface #11,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      55: checkcast     #12                 // class org/graylog2/plugin/database/users/User
      58: astore        5
      60: aload         5
      62: invokeinterface #13,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.isLocalAdmin:()Z
      67: ifeq          83
      70: getstatic     #14                 // Field log:Lorg/slf4j/Logger;
      73: ldc           #15                 // String Skipping local admin user.
      75: invokeinterface #16,  2           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;)V
      80: goto          38
      83: invokestatic  #17                 // Method com/google/common/collect/Sets.newHashSet:()Ljava/util/HashSet;
      86: astore        6
      88: aload         5
      90: invokeinterface #18,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getRoleIds:()Ljava/util/Set;
      95: invokestatic  #19                 // Method com/google/common/collect/Sets.newHashSet:(Ljava/lang/Iterable;)Ljava/util/HashSet;
      98: astore        7
     100: aload         5
     102: invokeinterface #20,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getPermissions:()Ljava/util/List;
     107: invokestatic  #19                 // Method com/google/common/collect/Sets.newHashSet:(Ljava/lang/Iterable;)Ljava/util/HashSet;
     110: astore        8
     112: aload         8
     114: ldc           #21                 // String *
     116: invokeinterface #22,  2           // InterfaceMethod java/util/Set.contains:(Ljava/lang/Object;)Z
     121: istore        9
     123: iload         9
     125: ifeq          153
     128: aload         5
     130: invokeinterface #18,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getRoleIds:()Ljava/util/Set;
     135: aload_2
     136: invokeinterface #22,  2           // InterfaceMethod java/util/Set.contains:(Ljava/lang/Object;)Z
     141: ifne          153
     144: aload         7
     146: aload_2
     147: invokeinterface #23,  2           // InterfaceMethod java/util/Set.add:(Ljava/lang/Object;)Z
     152: pop
     153: aload_0
     154: getfield      #4                  // Field permissions:Lorg/graylog2/shared/security/Permissions;
     157: aload         5
     159: invokeinterface #24,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getName:()Ljava/lang/String;
     164: invokevirtual #25                 // Method org/graylog2/shared/security/Permissions.readerPermissions:(Ljava/lang/String;)Ljava/util/Set;
     167: astore        10
     169: aload         8
     171: aload         10
     173: invokeinterface #26,  2           // InterfaceMethod java/util/Set.containsAll:(Ljava/util/Collection;)Z
     178: istore        11
     180: aload         5
     182: invokeinterface #18,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getRoleIds:()Ljava/util/Set;
     187: invokeinterface #27,  1           // InterfaceMethod java/util/Set.isEmpty:()Z
     192: ifne          225
     195: iload         11
     197: ifeq          225
     200: iload         9
     202: ifeq          225
     205: getstatic     #14                 // Field log:Lorg/slf4j/Logger;
     208: ldc           #28                 // String Not migrating user {}, it has already been migrated.
     210: aload         5
     212: invokeinterface #24,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getName:()Ljava/lang/String;
     217: invokeinterface #29,  3           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;Ljava/lang/Object;)V
     222: goto          38
     225: iload         11
     227: ifeq          255
     230: aload         5
     232: invokeinterface #18,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getRoleIds:()Ljava/util/Set;
     237: aload_3
     238: invokeinterface #22,  2           // InterfaceMethod java/util/Set.contains:(Ljava/lang/Object;)Z
     243: ifne          255
     246: aload         7
     248: aload_3
     249: invokeinterface #23,  2           // InterfaceMethod java/util/Set.add:(Ljava/lang/Object;)Z
     254: pop
     255: aload         8
     257: aload         10
     259: invokedynamic #30,  0             // InvokeDynamic #0:apply:(Ljava/util/Set;)Lcom/google/common/base/Predicate;
     264: invokestatic  #31                 // Method com/google/common/collect/Sets.filter:(Ljava/util/Set;Lcom/google/common/base/Predicate;)Ljava/util/Set;
     267: invokestatic  #32                 // Method com/google/common/collect/Lists.newArrayList:(Ljava/lang/Iterable;)Ljava/util/ArrayList;
     270: astore        12
     272: aload         6
     274: aload_0
     275: getfield      #4                  // Field permissions:Lorg/graylog2/shared/security/Permissions;
     278: aload         5
     280: invokeinterface #24,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getName:()Ljava/lang/String;
     285: invokevirtual #33                 // Method org/graylog2/shared/security/Permissions.userSelfEditPermissions:(Ljava/lang/String;)Ljava/util/Set;
     288: invokeinterface #34,  2           // InterfaceMethod java/util/Set.addAll:(Ljava/util/Collection;)Z
     293: pop
     294: aload         6
     296: aload         12
     298: invokeinterface #34,  2           // InterfaceMethod java/util/Set.addAll:(Ljava/util/Collection;)Z
     303: pop
     304: getstatic     #14                 // Field log:Lorg/slf4j/Logger;
     307: ldc           #35                 // String Migrating permissions to roles for user {} from permissions {} and roles {} to new permissions {} and roles {}
     309: iconst_5
     310: anewarray     #36                 // class java/lang/Object
     313: dup
     314: iconst_0
     315: aload         5
     317: invokeinterface #24,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getName:()Ljava/lang/String;
     322: aastore
     323: dup
     324: iconst_1
     325: aload         8
     327: aastore
     328: dup
     329: iconst_2
     330: aload         5
     332: invokeinterface #18,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getRoleIds:()Ljava/util/Set;
     337: aastore
     338: dup
     339: iconst_3
     340: aload         6
     342: aastore
     343: dup
     344: iconst_4
     345: aload         7
     347: aastore
     348: invokeinterface #37,  3           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;[Ljava/lang/Object;)V
     353: aload         5
     355: aload         7
     357: invokeinterface #38,  2           // InterfaceMethod org/graylog2/plugin/database/users/User.setRoleIds:(Ljava/util/Set;)V
     362: aload         5
     364: aload         6
     366: invokestatic  #32                 // Method com/google/common/collect/Lists.newArrayList:(Ljava/lang/Iterable;)Ljava/util/ArrayList;
     369: invokeinterface #39,  2           // InterfaceMethod org/graylog2/plugin/database/users/User.setPermissions:(Ljava/util/List;)V
     374: aload_0
     375: getfield      #2                  // Field userService:Lorg/graylog2/shared/users/UserService;
     378: aload         5
     380: invokeinterface #40,  2           // InterfaceMethod org/graylog2/shared/users/UserService.save:(Lorg/graylog2/plugin/database/Persisted;)Ljava/lang/String;
     385: pop
     386: goto          426
     389: astore        13
     391: getstatic     #14                 // Field log:Lorg/slf4j/Logger;
     394: new           #42                 // class java/lang/StringBuilder
     397: dup
     398: invokespecial #43                 // Method java/lang/StringBuilder."<init>":()V
     401: ldc           #44                 // String Unable to migrate user permissions for user
     403: invokevirtual #45                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     406: aload         5
     408: invokeinterface #24,  1           // InterfaceMethod org/graylog2/plugin/database/users/User.getName:()Ljava/lang/String;
     413: invokevirtual #45                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     416: invokevirtual #46                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     419: aload         13
     421: invokeinterface #47,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Throwable;)V
     426: goto          38
     429: getstatic     #14                 // Field log:Lorg/slf4j/Logger;
     432: ldc           #48                 // String Marking user permission migration as done.
     434: invokeinterface #49,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
     439: aload_0
     440: getfield      #5                  // Field clusterConfigService:Lorg/graylog2/plugin/cluster/ClusterConfigService;
     443: iconst_1
     444: invokestatic  #50                 // Method org/graylog2/cluster/UserPermissionMigrationState.create:(Z)Lorg/graylog2/cluster/UserPermissionMigrationState;
     447: invokeinterface #51,  2           // InterfaceMethod org/graylog2/plugin/cluster/ClusterConfigService.write:(Ljava/lang/Object;)V
     452: return
    Exception table:
       from    to  target type
         374   386   389   Class org/graylog2/plugin/database/ValidationException

  public boolean runsForever();
    Code:
       0: iconst_1
       1: ireturn

  public boolean stopOnGracefulShutdown();
    Code:
       0: iconst_0
       1: ireturn

  public boolean masterOnly();
    Code:
       0: iconst_1
       1: ireturn

  public boolean startOnThisNode();
    Code:
       0: aload_0
       1: getfield      #5                  // Field clusterConfigService:Lorg/graylog2/plugin/cluster/ClusterConfigService;
       4: ldc           #52                 // class org/graylog2/cluster/UserPermissionMigrationState
       6: iconst_0
       7: invokestatic  #50                 // Method org/graylog2/cluster/UserPermissionMigrationState.create:(Z)Lorg/graylog2/cluster/UserPermissionMigrationState;
      10: invokeinterface #53,  3           // InterfaceMethod org/graylog2/plugin/cluster/ClusterConfigService.getOrDefault:(Ljava/lang/Class;Ljava/lang/Object;)Ljava/lang/Object;
      15: checkcast     #52                 // class org/graylog2/cluster/UserPermissionMigrationState
      18: astore_1
      19: aload_1
      20: invokevirtual #54                 // Method org/graylog2/cluster/UserPermissionMigrationState.migrationDone:()Z
      23: ifne          30
      26: iconst_1
      27: goto          31
      30: iconst_0
      31: ireturn

  public boolean isDaemon();
    Code:
       0: iconst_0
       1: ireturn

  public int getInitialDelaySeconds();
    Code:
       0: iconst_0
       1: ireturn

  public int getPeriodSeconds();
    Code:
       0: iconst_0
       1: ireturn

  protected org.slf4j.Logger getLogger();
    Code:
       0: getstatic     #14                 // Field log:Lorg/slf4j/Logger;
       3: areturn

  private static boolean lambda$doRun$0(java.util.Set, java.lang.String);
    Code:
       0: aload_0
       1: aload_1
       2: invokeinterface #22,  2           // InterfaceMethod java/util/Set.contains:(Ljava/lang/Object;)Z
       7: ifne          23
      10: ldc           #21                 // String *
      12: aload_1
      13: invokevirtual #55                 // Method java/lang/String.equals:(Ljava/lang/Object;)Z
      16: ifne          23
      19: iconst_1
      20: goto          24
      23: iconst_0
      24: ireturn

  static {};
    Code:
       0: ldc           #56                 // class org/graylog2/periodical/UserPermissionMigrationPeriodical
       2: invokestatic  #57                 // Method org/slf4j/LoggerFactory.getLogger:(Ljava/lang/Class;)Lorg/slf4j/Logger;
       5: putstatic     #14                 // Field log:Lorg/slf4j/Logger;
       8: return
}
