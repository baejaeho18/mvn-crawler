

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PySparkling &mdash; H2O Sparkling Water 3.36.1.4-1-3.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/contentui.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/contentui.css" type="text/css" />
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RSparkling" href="rsparkling.html" />
    <link rel="prev" title="Scala Interpreter via REST API" href="devel/rest_api/scala_interpreter_endpoints.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.36.1.4-1-3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About Sparkling Water</a></li>
<li class="toctree-l1"><a class="reference internal" href="typical_use_case.html">Typical Use Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Sparkling Water Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="install/install_and_start.html">Installing and Starting</a></li>
<li class="toctree-l1"><a class="reference internal" href="design/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment/deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="ml/ml.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics/metrics.html">Metric Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_details/model_details.html">Model Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters/parameters.html">Algorithm Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/tutorials.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="devel/devel.html">Development</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PySparkling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-h2o">What is H2O?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-spark">What is Spark?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-sparkling-water">What is Sparkling Water?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-pysparkling">What is PySparkling?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pysparkling-and-spark-version">PySparkling and Spark Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-sparkling-water-python-module">The Sparkling Water Python Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prepare-the-environment">Prepare the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-pysparkling-interactive-shell">Run PySparkling interactive shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-ipython-notebook-with-pysparkling">Run IPython Notebook with PySparkling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-ipython-with-pysparkling">Run IPython with PySparkling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-pysparkling-in-databricks-cloud">Use PySparkling in Databricks Cloud</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rsparkling.html">RSparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration_guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">H2O Sparkling Water</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>PySparkling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/pysparkling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pysparkling">
<span id="id1"></span><h1>PySparkling<a class="headerlink" href="#pysparkling" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="Jointhechatathttps://gitter.im/h2oai/sparkling-water?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img alt="Join the chat at https://gitter.im/h2oai/sparkling-water" src="https://badges.gitter.im/Join%20Chat.svg" /></a> <a class="reference external" href="LICENSE"><img alt="License" src="https://img.shields.io/badge/License-Apache%202-blue.svg" /></a> <a class="reference external" href="https://github.com/h2oai/"><img alt="Powered by H2O.ai" src="https://img.shields.io/badge/powered%20by-h2oai-yellow.svg" /></a></p>
<p>This section provides an introduction to PySparkling. To understand more about PySparkling, it’s better to understand H2O, Spark, and Sparkling Water first.</p>
<div class="section" id="what-is-h2o">
<h2>What is H2O?<a class="headerlink" href="#what-is-h2o" title="Permalink to this headline">¶</a></h2>
<p>H2O is an open-source, in-memory, distributed, fast and scalable machine learning and predictive analytics platform that provides the capability to build machine learning models on big data and enable easy productionalization of them in an enterprise environment.</p>
<p>H2O core code is written in Java. Inside H2O, a Distributed Key/Value (DKV) store is used to access and reference data, models, objects, etc., across all nodes/machines, has a non-blocking hashmap, and a memory manager. The algorithms are implemented in the map-reduce style and utilize the Java Fork/Join framework.</p>
<p>The data is read in parallel and distributed across the cluster, stored in memory in a columnar format in a compressed way. H2O’s data parser has built-in intelligence to guess the schema of the incoming dataset and supports data ingestion from multiple sources in various formats.</p>
<p>H2O’s REST API enables to access all the capabilities of H2O from an external program or script, via JSON over HTTP. The REST API is used by H2O’s web interface (Flow UI), the R binding (H2O-R), and the Python binding (H2O-Python).</p>
<p>The speed, quality, ease of use, and model deployment, for the various cutting-edge supervised and unsupervised algorithms like Deep Learning, Tree Ensembles, and Generalized Low-Rank Models, makes H2O a highly sought after API for big data analytics.</p>
</div>
<div class="section" id="what-is-spark">
<h2>What is Spark?<a class="headerlink" href="#what-is-spark" title="Permalink to this headline">¶</a></h2>
<p>Apache Spark is an open-source, in-memory, distributed cluster computing framework that provides a comprehensive capability of building efficient big data pipelines.</p>
<p>Spark core implements a distributed memory abstraction, called Resilient Distributed Datasets (RDDs) and manages distributed task dispatching and scheduling. RDDs represents the first API for transforming data with Apache Spark and became essential building blocks for higher abstractions like Datasets and Dataframes (Datasets of Row objects).</p>
<p>Datasets/Dataframes in contrast to RDDs track the schema of transformed data and offer faster execution in most cases due to the Tungsten memory representation and utilization of the Catalyst optimizer. Furthermore, Dataset/Dataframe API is very similar to SQL of standard database engines, thus data engineers and scientists can learn the API very fast.</p>
<p>RDDs and Datasets/Dataframes represent distributed data that sits on disk. Any transformation applied on RDDs and Datasets/Dataframes is lazy and nothing is executed until a user calls an action on a given abstraction. RDDs and Datasets/Dataframes can be cashed to avoid multiple executions of the same sequence of transformations.</p>
<p>Spark provides APIs in Java, Python, Scala, and R for building and manipulating RDDs and Datasets/Dataframes. Spark also comes with libraries having capabilities to process streamed data, graph data, and to apply basic ML algorithms.</p>
<p>The fast and unified framework to manage data processing makes Spark a preferred solution for big data analysis.</p>
</div>
<div class="section" id="what-is-sparkling-water">
<h2>What is Sparkling Water?<a class="headerlink" href="#what-is-sparkling-water" title="Permalink to this headline">¶</a></h2>
<p>Sparkling Water is an integration of H2O into the Spark ecosystem. It facilitates the use of H2O algorithms in Spark workflows. It is designed as a regular Spark application and provides a way to start H2O services on each node of a Spark cluster and access data stored in data structures of Spark and H2O.</p>
<p>A Spark cluster is composed of one Driver JVM and one or many Executor JVMs. A Spark Context is a connection to a Spark cluster. Each Spark application creates a <code class="docutils literal notranslate"><span class="pre">SparkSession</span></code>. The machine where the Spark application process, which creates a <code class="docutils literal notranslate"><span class="pre">SparkSession</span></code> (spark), is running, is the Driver node. The Spark Context connects to the cluster manager (either Spark standalone cluster manager, Mesos or YARN), that allocates executors to spark cluster for the application. Then, Spark sends the application code (defined by JAR or Python files) to the executors. Finally, the Spark Context sends tasks to the executors to run.</p>
<p>The driver program in Sparkling Water, creates a <code class="docutils literal notranslate"><span class="pre">SparkSession</span></code> (spark) which in turn is used to create an <code class="docutils literal notranslate"><span class="pre">H2OContext</span></code> (hc) that is used to start H2O services on the spark executors. An H2O Context is a connection to the H2O cluster and also facilitates communication between H2O and Spark. When an H2O cluster starts, it has the same topology as the Spark cluster and H2O nodes share the same JVMs as the Spark Executors.</p>
<p>To leverage H2O’s algorithms, data in a Spark cluster, stored as an RDD or Dataset/Dataframe, needs to be converted to an H2OFrame (H2O’s distributed data frame). This requires a data copy because of the difference in data layout in Spark (blocks/rows) and H2O (columns). But as data is stored in H2O in a highly compressed format, the overhead of making a data copy is low. When converting an H2OFrame to an RDD or Dataframe, Sparkling Water creates a wrapper around the H2OFrame to provide a given Spark API. In this case, no data is duplicated and data is served directly from the underlying H2OFrame. As H2O runs in the same JVMs as the Spark Executors, moving data from Spark to H2O or vice-versa requires a simple in memory, in-process call.</p>
</div>
<div class="section" id="what-is-pysparkling">
<h2>What is PySparkling?<a class="headerlink" href="#what-is-pysparkling" title="Permalink to this headline">¶</a></h2>
<p>PySparkling is an integration of Python with Sparkling Water. It allows the user to start H2O services on a Spark cluster from Python API.</p>
<p>In the PySparkling driver program, the Spark Context, which uses Py4J to start the driver JVM and the Java Spark Context, is used to create the H2O Context (hc). That, in turn, starts an H2O cloud (cluster) in the Spark ecosystem. Once the H2O cluster is up, the H2O Python package is used to interact with it and run H2O algorithms. All pure H2O calls are executed via H2O’s REST API interface. Users can easily integrate their regular PySpark workflow with H2O algorithms using PySparkling.</p>
<p>PySparkling programs can be launched as an application or in an interactive shell or notebook environment.</p>
</div>
<div class="section" id="pysparkling-and-spark-version">
<h2>PySparkling and Spark Version<a class="headerlink" href="#pysparkling-and-spark-version" title="Permalink to this headline">¶</a></h2>
<p>There are multiple PySparkling packages, each is intended to be used with different Spark versions.</p>
<p>For example, to install PySparkling for Spark 3.1, the command would look like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install h2o_pysparkling_3.1
</pre></div>
</div>
</div>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>Supported Python versions are Python 2.7 or Python 3+.</p>
<p>The major dependency is Spark. Please make sure that your Python environment has functional Spark with all its
dependencies.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install requests
$ pip install tabulate
$ pip install future
</pre></div>
</div>
<p>These dependencies are installed automatically in case PySparkling is installed from PyPI.</p>
</div>
<div class="section" id="the-sparkling-water-python-module">
<h2>The Sparkling Water Python Module<a class="headerlink" href="#the-sparkling-water-python-module" title="Permalink to this headline">¶</a></h2>
<div class="section" id="prepare-the-environment">
<h3>Prepare the environment<a class="headerlink" href="#prepare-the-environment" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Download and unpack Sparkling Water release from <a class="reference external" href="https://www.h2o.ai/download/">https://www.h2o.ai/download/</a>.</p></li>
<li><p>Configure the location of Spark distribution and cluster:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SPARK_HOME</span><span class="o">=</span><span class="s2">&quot;/path/to/spark/installation&quot;</span>
<span class="nb">export</span> <span class="nv">MASTER</span><span class="o">=</span><span class="s1">&#39;local[*]&#39;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="run-pysparkling-interactive-shell">
<h3>Run PySparkling interactive shell<a class="headerlink" href="#run-pysparkling-interactive-shell" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Ensure you are in the Sparkling Water project directory and run PySparkling shell:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bin/pysparkling
</pre></div>
</div>
</div></blockquote>
<p>The <em>pysparkling</em> shell accepts common <em>pyspark</em> arguments.</p>
<p>For running on YARN and other supported platforms please see <a class="reference internal" href="design/supported_platforms.html#supported-platforms"><span class="std std-ref">Supported Platforms</span></a>.</p>
<ol class="arabic simple" start="2">
<li><p>Initialize H2OContext</p></li>
</ol>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">h2o</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="run-ipython-notebook-with-pysparkling">
<h3>Run IPython Notebook with PySparkling<a class="headerlink" href="#run-ipython-notebook-with-pysparkling" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PYSPARK_DRIVER_PYTHON</span><span class="o">=</span><span class="s2">&quot;ipython&quot;</span> <span class="nv">PYSPARK_DRIVER_PYTHON_OPTS</span><span class="o">=</span><span class="s2">&quot;notebook&quot;</span> bin/pysparkling
</pre></div>
</div>
<p>For running on Windows, the syntax would be:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SET <span class="nv">PYSPARK_DRIVER_PYTHON</span><span class="o">=</span>ipython
SET <span class="nv">PYSPARK_DRIVER_PYTHON_OPTS</span><span class="o">=</span>notebook
bin/pysparkling
</pre></div>
</div>
</div>
<div class="section" id="run-ipython-with-pysparkling">
<h3>Run IPython with PySparkling<a class="headerlink" href="#run-ipython-with-pysparkling" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PYSPARK_DRIVER_PYTHON</span><span class="o">=</span><span class="s2">&quot;ipython&quot;</span> bin/pysparkling
</pre></div>
</div>
</div>
<div class="section" id="use-pysparkling-in-databricks-cloud">
<h3>Use PySparkling in Databricks Cloud<a class="headerlink" href="#use-pysparkling-in-databricks-cloud" title="Permalink to this headline">¶</a></h3>
<p>In order to use PySparkling in Databricks cloud, PySparkling module has to be added as a library to the current cluster.
PySparkling can be added as a library in two ways. You can either upload the PySparkling source zip file or add the
PySparkling module from PyPI.</p>
<p>If you choose to upload PySparkling zip file, don’t forget to add PySparkling <a class="reference internal" href="#dependencies">Dependencies</a>.
The PySparkling zip file is available in <em>py/dist</em> directory of Sparkling Water distribution package.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rsparkling.html" class="btn btn-neutral float-right" title="RSparkling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="devel/rest_api/scala_interpreter_endpoints.html" class="btn btn-neutral float-left" title="Scala Interpreter via REST API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020 H2O.ai
      <span class="lastupdated">
        Last updated on Aug 04, 2022.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>