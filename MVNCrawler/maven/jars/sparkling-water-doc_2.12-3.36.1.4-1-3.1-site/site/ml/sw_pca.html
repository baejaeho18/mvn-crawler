

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Principal Component Analysis (PCA) in Sparkling Water &mdash; H2O Sparkling Water 3.36.1.4-1-3.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Generalized Low Rank Models (GLRM) in Sparkling Water" href="sw_glrm.html" />
    <link rel="prev" title="Train Word2Vec Model in Sparkling Water" href="sw_w2v.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.36.1.4-1-3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About Sparkling Water</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typical_use_case.html">Typical Use Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Sparkling Water Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install_and_start.html">Installing and Starting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/deployment.html">Deployment</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="ml.html">Machine Learning</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sw_automl.html">Train AutoML Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_gam.html">Train GAM Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_glm.html">Train GLM Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_drf.html">Train DRF Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_grid.html">Train Sparkling Water Algorithms with Grid Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_kmeans.html">Train KMeans Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_xgboost.html">Train XGBoost Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_isolation_forest.html">Train Isolation Forest Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_coxph.html">Train CoxPH Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_deep_learning.html">Train Deep Learning Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_rule_fit.html">Train RuleFit Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_stacked_ensemble.html">Train Stacked Ensemble Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_auto_encoder.html">Autoencoder in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_target_encoder.html">Target Encoding in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_w2v.html">Train Word2Vec Model in Sparkling Water</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Principal Component Analysis (PCA) in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_glrm.html">Generalized Low Rank Models (GLRM) in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="shap_values.html">Obtain SHAP values from MOJO model</a></li>
<li class="toctree-l2"><a class="reference internal" href="binary_model.html">Using H2O Binary Model in Sparkling Water</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/metrics.html">Metric Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_details/model_details.html">Model Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters/parameters.html">Algorithm Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorials.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devel/devel.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pysparkling.html">PySparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rsparkling.html">RSparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">H2O Sparkling Water</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="ml.html">Machine Learning</a> &raquo;</li>
        
      <li>Principal Component Analysis (PCA) in Sparkling Water</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/ml/sw_pca.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="principal-component-analysis-pca-in-sparkling-water">
<h1>Principal Component Analysis (PCA) in Sparkling Water<a class="headerlink" href="#principal-component-analysis-pca-in-sparkling-water" title="Permalink to this headline">¶</a></h1>
<p>The Principal Component Analysis (PCA) in Sparkling Water is an feature estimator, which serves to reduce number of
features in Spark pipeline. Sparkling Water provides API for PCA in Scala and Python. The following sections describe
how to train and use the Sparkling Water PCA in both languages. See also <a class="reference internal" href="../parameters/parameters_H2OPCA.html#parameters-h2opca"><span class="std std-ref">Parameters of H2OPCA</span></a>
and <a class="reference internal" href="../model_details/model_details_H2OPCAMOJOModel.html#model-details-h2opcamojomodel"><span class="std std-ref">Details of H2OPCAMOJOModel</span></a>.</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<p>First, let’s start Sparkling Shell as</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./bin/sparkling-shell
</pre></div>
</div>
<p>Start H2O cluster inside the Spark environment</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling._</span>
<span class="k">import</span> <span class="nn">java.net.URI</span>
<span class="k">val</span> <span class="n">hc</span> <span class="k">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="o">()</span>
</pre></div>
</div>
<p>Parse the data using H2O and convert them to Spark Frame</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.SparkFiles</span>
<span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">addFile</span><span class="o">(</span><span class="s">&quot;https://raw.githubusercontent.com/h2oai/sparkling-water/master/examples/smalldata/prostate/prostate.csv&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">rawSparkDF</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">).</span><span class="n">csv</span><span class="o">(</span><span class="nc">SparkFiles</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;prostate.csv&quot;</span><span class="o">))</span>
<span class="k">val</span> <span class="n">sparkDF</span> <span class="k">=</span> <span class="n">rawSparkDF</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;CAPSULE&quot;</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;CAPSULE&quot;</span> <span class="n">cast</span> <span class="s">&quot;string&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="nc">Array</span><span class="o">(</span><span class="n">trainingDF</span><span class="o">,</span> <span class="n">testingDF</span><span class="o">)</span> <span class="k">=</span> <span class="n">sparkDF</span><span class="o">.</span><span class="n">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.8</span><span class="o">,</span> <span class="mf">0.2</span><span class="o">))</span>
</pre></div>
</div>
<p>Create <code class="docutils literal notranslate"><span class="pre">H2OPCA</span></code> and set input columns, <code class="docutils literal notranslate"><span class="pre">k</span></code> representing a number of output features and other parameters
(see <a class="reference internal" href="../parameters/parameters_H2OPCA.html#parameters-h2opca"><span class="std std-ref">Parameters of H2OPCA</span></a>). An input column could be of any simple type or represent multiple features
in form of the Spark vector type (<code class="docutils literal notranslate"><span class="pre">org.apache.spark.ml.linalg.VectorUDT</span></code>).</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling.ml.features.H2OPCA</span>
<span class="k">val</span> <span class="n">pca</span> <span class="k">=</span> <span class="k">new</span> <span class="n">H2OPCA</span><span class="o">()</span>
<span class="n">pca</span><span class="o">.</span><span class="n">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">&quot;RACE&quot;</span><span class="o">,</span> <span class="s">&quot;DPROS&quot;</span><span class="o">,</span> <span class="s">&quot;DCAPS&quot;</span><span class="o">,</span> <span class="s">&quot;PSA&quot;</span><span class="o">,</span> <span class="s">&quot;VOL&quot;</span><span class="o">,</span> <span class="s">&quot;GLEASON&quot;</span><span class="o">))</span>
<span class="n">pca</span><span class="o">.</span><span class="n">setK</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
</pre></div>
</div>
<p>Define other pipeline stages.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling.ml.algos.H2OGBM</span>
<span class="k">val</span> <span class="n">gbm</span> <span class="k">=</span> <span class="k">new</span> <span class="n">H2OGBM</span><span class="o">()</span>
<span class="n">gbm</span><span class="o">.</span><span class="n">setFeaturesCol</span><span class="o">(</span><span class="n">pca</span><span class="o">.</span><span class="n">getOutputCol</span><span class="o">())</span>
<span class="n">gbm</span><span class="o">.</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;CAPSULE&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>Construct and fit the pipeline.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>
<span class="k">val</span> <span class="n">pipeline</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pipeline</span><span class="o">().</span><span class="n">setStages</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="n">pca</span><span class="o">,</span> <span class="n">gbm</span><span class="o">))</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">trainingDF</span><span class="o">)</span>
</pre></div>
</div>
<p>Now, you can score with the pipeline model.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">resultDF</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">testingDF</span><span class="o">)</span>
<span class="n">resultDF</span><span class="o">.</span><span class="n">show</span><span class="o">(</span><span class="n">truncate</span><span class="k">=</span><span class="kc">false</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<p>First, let’s start PySparkling Shell as</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./bin/pysparkling
</pre></div>
</div>
<p>Start H2O cluster inside the Spark environment</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
<p>Parse the data using H2O and convert them to Spark Frame</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h2o</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">h2o</span><span class="o">.</span><span class="n">import_file</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/h2oai/sparkling-water/master/examples/smalldata/prostate/prostate.csv&quot;</span><span class="p">)</span>
<span class="n">sparkDF</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">asSparkFrame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="n">sparkDF</span> <span class="o">=</span> <span class="n">sparkDF</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;CAPSULE&quot;</span><span class="p">,</span> <span class="n">sparkDF</span><span class="o">.</span><span class="n">CAPSULE</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">))</span>
<span class="p">[</span><span class="n">trainingDF</span><span class="p">,</span> <span class="n">testingDF</span><span class="p">]</span> <span class="o">=</span> <span class="n">sparkDF</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
</pre></div>
</div>
<p>Create <code class="docutils literal notranslate"><span class="pre">H2OPCA</span></code> and set input columns, <code class="docutils literal notranslate"><span class="pre">k</span></code> representing a number of output features and other parameters
(see <a class="reference internal" href="../parameters/parameters_H2OPCA.html#parameters-h2opca"><span class="std std-ref">Parameters of H2OPCA</span></a>). An input column could be of any simple type or represent multiple features
in form of the Spark vector type (<code class="docutils literal notranslate"><span class="pre">pyspark.ml.linalg.VectorUDT</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling.ml</span> <span class="kn">import</span> <span class="n">H2OPCA</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">H2OPCA</span><span class="p">()</span>
<span class="n">pca</span><span class="o">.</span><span class="n">setInputCols</span><span class="p">([</span><span class="s2">&quot;RACE&quot;</span><span class="p">,</span> <span class="s2">&quot;DPROS&quot;</span><span class="p">,</span> <span class="s2">&quot;DCAPS&quot;</span><span class="p">,</span> <span class="s2">&quot;PSA&quot;</span><span class="p">,</span> <span class="s2">&quot;VOL&quot;</span><span class="p">,</span> <span class="s2">&quot;GLEASON&quot;</span><span class="p">])</span>
<span class="n">pca</span><span class="o">.</span><span class="n">setK</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>Define other pipeline stages.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling.ml</span> <span class="kn">import</span> <span class="n">H2OGBM</span>
<span class="n">gbm</span> <span class="o">=</span> <span class="n">H2OGBM</span><span class="p">()</span>
<span class="n">gbm</span><span class="o">.</span><span class="n">setFeaturesCols</span><span class="p">([</span><span class="n">pca</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">()])</span>
<span class="n">gbm</span><span class="o">.</span><span class="n">setLabelCol</span><span class="p">(</span><span class="s2">&quot;CAPSULE&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Construct and fit the pipeline.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">pca</span><span class="p">,</span> <span class="n">gbm</span><span class="p">])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingDF</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, you can score with the pipeline model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">resultDF</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testingDF</span><span class="p">)</span>
<span class="n">resultDF</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sw_glrm.html" class="btn btn-neutral float-right" title="Generalized Low Rank Models (GLRM) in Sparkling Water" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sw_w2v.html" class="btn btn-neutral float-left" title="Train Word2Vec Model in Sparkling Water" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020 H2O.ai
      <span class="lastupdated">
        Last updated on Aug 04, 2022.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>