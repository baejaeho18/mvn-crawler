

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using H2O Binary Model in Sparkling Water &mdash; H2O Sparkling Water 3.36.1.4-1-3.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Metric Classes" href="../metrics/metrics.html" />
    <link rel="prev" title="Obtain SHAP values from MOJO model" href="shap_values.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.36.1.4-1-3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About Sparkling Water</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typical_use_case.html">Typical Use Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Sparkling Water Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install_and_start.html">Installing and Starting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/deployment.html">Deployment</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="ml.html">Machine Learning</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sw_automl.html">Train AutoML Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_gam.html">Train GAM Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_glm.html">Train GLM Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_drf.html">Train DRF Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_grid.html">Train Sparkling Water Algorithms with Grid Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_kmeans.html">Train KMeans Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_xgboost.html">Train XGBoost Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_isolation_forest.html">Train Isolation Forest Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_coxph.html">Train CoxPH Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_deep_learning.html">Train Deep Learning Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_rule_fit.html">Train RuleFit Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_stacked_ensemble.html">Train Stacked Ensemble Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_auto_encoder.html">Autoencoder in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_target_encoder.html">Target Encoding in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_w2v.html">Train Word2Vec Model in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_pca.html">Principal Component Analysis (PCA) in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_glrm.html">Generalized Low Rank Models (GLRM) in Sparkling Water</a></li>
<li class="toctree-l2"><a class="reference internal" href="shap_values.html">Obtain SHAP values from MOJO model</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using H2O Binary Model in Sparkling Water</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#train-model-in-sparkling-water-and-obtain-binary-model">Train Model in Sparkling Water and Obtain Binary model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utilization-of-binary-model-in-h2o-3-api">Utilization of Binary Model in H2O-3 API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#save-binary-model-to-file-system">Save Binary Model to File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-existing-binary-model">Load Existing Binary Model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/metrics.html">Metric Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_details/model_details.html">Model Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters/parameters.html">Algorithm Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorials.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devel/devel.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pysparkling.html">PySparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rsparkling.html">RSparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">H2O Sparkling Water</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="ml.html">Machine Learning</a> &raquo;</li>
        
      <li>Using H2O Binary Model in Sparkling Water</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/ml/binary_model.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-h2o-binary-model-in-sparkling-water">
<h1>Using H2O Binary Model in Sparkling Water<a class="headerlink" href="#using-h2o-binary-model-in-sparkling-water" title="Permalink to this headline">¶</a></h1>
<p>Sparkling Water can generate binary models and can also load already existing
models trained for example in H2O-3.</p>
<div class="section" id="train-model-in-sparkling-water-and-obtain-binary-model">
<h2>Train Model in Sparkling Water and Obtain Binary model<a class="headerlink" href="#train-model-in-sparkling-water-and-obtain-binary-model" title="Permalink to this headline">¶</a></h2>
<p>We first train a model using Sparkling Water API from which we can extract the binary model class.
The binary model class contains methods used to work with binary models.</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling._</span>
<span class="k">val</span> <span class="n">hc</span> <span class="k">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="o">()</span>
</pre></div>
</div>
<p>Parse the data using H2O and convert them to Spark Frame</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">org.apache.spark.SparkFiles</span>
<span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">addFile</span><span class="o">(</span><span class="s">&quot;https://raw.githubusercontent.com/h2oai/sparkling-water/master/examples/smalldata/prostate/prostate.csv&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sparkDF</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;header&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">&quot;inferSchema&quot;</span><span class="o">,</span> <span class="s">&quot;true&quot;</span><span class="o">).</span><span class="n">csv</span><span class="o">(</span><span class="nc">SparkFiles</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;prostate.csv&quot;</span><span class="o">))</span>
</pre></div>
</div>
<p>Select algorithm, set the parameter <code class="docutils literal notranslate"><span class="pre">keepBinaryModels</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code>, train the model.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling.ml.algos.H2OXGBoostClassifier</span>
<span class="k">val</span> <span class="n">estimator</span> <span class="k">=</span> <span class="k">new</span> <span class="n">H2OXGBoostClassifier</span><span class="o">().</span><span class="n">setLabelCol</span><span class="o">(</span><span class="s">&quot;CAPSULE&quot;</span><span class="o">).</span><span class="n">setKeepBinaryModels</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="k">val</span> <span class="n">mojoModel</span> <span class="k">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">sparkDF</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
<p>Parse the data using H2O and convert them to Spark Frame</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h2o</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">h2o</span><span class="o">.</span><span class="n">import_file</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/h2oai/sparkling-water/master/examples/smalldata/prostate/prostate.csv&quot;</span><span class="p">)</span>
<span class="n">sparkDF</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">asSparkFrame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
</pre></div>
</div>
<p>Select algorithm, set the parameter <code class="docutils literal notranslate"><span class="pre">keepBinaryModels</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>, train the model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling.ml</span> <span class="kn">import</span> <span class="n">H2OXGBoostClassifier</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">H2OXGBoostClassifier</span><span class="p">(</span><span class="n">labelCol</span> <span class="o">=</span> <span class="s2">&quot;CAPSULE&quot;</span><span class="p">,</span> <span class="n">keepBinaryModels</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">mojoModel</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sparkDF</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To obtain the binary model once the model training has finished, run:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">binaryModel</span> <span class="k">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">getBinaryModel</span><span class="o">()</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">binaryModel</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">getBinaryModel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="utilization-of-binary-model-in-h2o-3-api">
<h2>Utilization of Binary Model in H2O-3 API<a class="headerlink" href="#utilization-of-binary-model-in-h2o-3-api" title="Permalink to this headline">¶</a></h2>
<p>The following scoring example demonstrates how a binary model trained with the SW API can be utilized with the H2O-3 API:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">h2oBinaryModel</span> <span class="o">=</span> <span class="n">h2o</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">binaryModel</span><span class="o">.</span><span class="n">modelId</span><span class="p">)</span>
<span class="n">h2oBinaryModel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="o">=</span><span class="n">frame</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="save-binary-model-to-file-system">
<h2>Save Binary Model to File System<a class="headerlink" href="#save-binary-model-to-file-system" title="Permalink to this headline">¶</a></h2>
<p>The following example demonstrates how a binary model can be stored on a file system:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">binaryModel</span> <span class="k">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">getBinaryModel</span><span class="o">()</span>
<span class="n">binaryModel</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="s">&quot;/tmp/binary.model&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">binaryModel</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">getBinaryModel</span><span class="p">()</span>
<span class="n">binaryModel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;/tmp/binary.model&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In case of a Hadoop-enabled system, the command by default uses HDFS. To reference a path on the local file system of
the Spark driver, the path must be prefixed with <code class="docutils literal notranslate"><span class="pre">file://</span></code> when HDFS is enabled.</p>
</div>
<div class="section" id="load-existing-binary-model">
<h2>Load Existing Binary Model<a class="headerlink" href="#load-existing-binary-model" title="Permalink to this headline">¶</a></h2>
<p>Before you start, please make sure that your <code class="docutils literal notranslate"><span class="pre">H2OContext</span></code> is running as we need H2O to be running.
Also please make sure that Sparkling Water is of the same version as the H2O version in which
the binary model was trained. If this condition is not met, Sparkling Water throws an exception.</p>
<p>To load binary model, run:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-Scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling._</span>
<span class="k">import</span> <span class="nn">ai.h2o.sparkling.ml.models.H2OBinaryModel</span>
<span class="k">val</span> <span class="n">hc</span> <span class="k">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="o">()</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">H2OBinaryModel</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="n">path</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pysparkling.ml</span> <span class="kn">import</span> <span class="n">H2OBinaryModel</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">H2OBinaryModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-R">
<p class="tab-title">R</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">rsparkling</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">&lt;-</span> <span class="nf">spark_connect</span><span class="p">(</span><span class="n">master</span> <span class="o">=</span> <span class="s">&quot;local&quot;</span><span class="p">)</span>
<span class="n">hc</span> <span class="o">&lt;-</span> <span class="nf">H2OContext.getOrCreate</span><span class="p">()</span>
<span class="n">model</span> <span class="o">&lt;-</span> <span class="nf">H2OBinaryModel.read</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../metrics/metrics.html" class="btn btn-neutral float-right" title="Metric Classes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="shap_values.html" class="btn btn-neutral float-left" title="Obtain SHAP values from MOJO model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020 H2O.ai
      <span class="lastupdated">
        Last updated on Aug 04, 2022.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>