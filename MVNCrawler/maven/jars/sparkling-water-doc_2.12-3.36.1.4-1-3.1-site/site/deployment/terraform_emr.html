

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Start Sparkling Water on Amazon EMR using our Terraform Template &mdash; H2O Sparkling Water 3.36.1.4-1-3.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running Sparkling Water in Kubernetes" href="kubernetes.html" />
    <link rel="prev" title="Use Sparkling Water with Amazon EMR from the Edge Node" href="aws_emr_edge_node.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.36.1.4-1-3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About Sparkling Water</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typical_use_case.html">Typical Use Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Sparkling Water Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install_and_start.html">Installing and Starting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="deployment.html">Deployment</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="backends.html">Sparkling Water Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="load_mojo.html">Importing H2O MOJOs from H2O-3</a></li>
<li class="toctree-l2"><a class="reference internal" href="load_mojo_pipeline.html">Importing MOJO Pipelines from Driverless AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysparkling_pipeline.html">Deploying PySparkling Pipeline Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_emr.html">Use Sparkling Water with Amazon EMR</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_emr_edge_node.html">Use Sparkling Water with Amazon EMR from the Edge Node</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Start Sparkling Water on Amazon EMR using our Terraform Template</a></li>
<li class="toctree-l2"><a class="reference internal" href="kubernetes.html">Running Sparkling Water in Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_azure_dbc.html">Running Sparkling Water on Databricks Azure Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="rsparkling_azure_dbc.html">Running RSparkling on Databricks Azure Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysparkling_azure_dbc.html">Running PySparkling on Databricks Azure Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="databricks_logs.html">Download H2O Logs from Databricks Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_google_cloud_dataproc.html">Running Sparkling Water on Google Cloud Dataproc</a></li>
<li class="toctree-l2"><a class="reference internal" href="azure_hdi.html">Using Sparkling Water with Microsoft Azure HDInsight - Beta</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_on_windows.html">Use Sparkling Water in Windows Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="rsparkling_on_windows.html">Use RSparkling in Windows Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="use_on_zeppelin.html">Sparkling Water and Zeppelin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ml/ml.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/metrics.html">Metric Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_details/model_details.html">Model Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters/parameters.html">Algorithm Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorials.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devel/devel.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pysparkling.html">PySparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rsparkling.html">RSparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">H2O Sparkling Water</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="deployment.html">Deployment</a> &raquo;</li>
        
      <li>Start Sparkling Water on Amazon EMR using our Terraform Template</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/deployment/terraform_emr.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="start-sparkling-water-on-amazon-emr-using-our-terraform-template">
<h1>Start Sparkling Water on Amazon EMR using our Terraform Template<a class="headerlink" href="#start-sparkling-water-on-amazon-emr-using-our-terraform-template" title="Permalink to this headline">¶</a></h1>
<p><strong>This terraform template supports only Sparkling Water builds for Apache Spark 2.4 and higher.</strong></p>
<p>Sparkling Water comes with the pre-defined Terraform templates that can be used to
deploy Sparkling Water to Amazon EMR.</p>
<p>Before you start, you need to have Terraform installed on your machine.
If you are not familiar with Terraform, we suggest reading the <a class="reference external" href="https://www.terraform.io/intro/index.html">Terraform documentation</a>.</p>
<p>The Terraform scripts for EMR are available in the release distribution in the
<strong>templates/build/terraform/aws</strong> directory or on-line in S3 as part of each Sparkling Water
release.</p>
<p>Sparkling Water provides 3 templates/modules:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">network</span></code> module (<strong>/templates/build/terraform/aws/modules/network</strong>). This module is used to set up network infrastructure on your AWS. It sets up VPC, internet gateway, subnet, routing tables and default DHCP settings.</p></li>
</ul>
<blockquote>
<div><p>This module accepts the following arguments:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aws_access_key</span></code> (mandatory) - access key to access AWS</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_secret_key</span></code> (mandatory) - secret key to access AWS</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_region</span></code> (optional) - AWS region. Defaults to <code class="docutils literal notranslate"><span class="pre">us-east-1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_availability_zone</span></code> (optional) - AWS availability zone. Defaults to <code class="docutils literal notranslate"><span class="pre">us-east-1e</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_vpc_cidr_block</span></code> (optional) - VPC CIDR block. Defaults to <code class="docutils literal notranslate"><span class="pre">10.0.0.0/16</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_subnet_cidr_block</span></code> (optional) - VPC subnet CIDR block. Defaults to <code class="docutils literal notranslate"><span class="pre">10.0.0.0/24</span></code>.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">emr</span></code> module  (<strong>/templates/build/terraform/aws/modules/emr</strong>). This module is used to start the EMR cluster on an already existing AWS network infrastructure. It sets up the correct roles, instance profiles, and security groups, and it starts EMR with the correct dependencies to run Sparkling Water.</p></li>
</ul>
<blockquote>
<div><p>This module accepts the following arguments:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aws_access_key</span></code> (mandatory) - access key to access AWS</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_secret_key</span></code> (mandatory) - secret key to access AWS</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_ssh_public_key</span></code> (optional) - public key (to be able to access EC2 instances via ssh later)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_vpc_id</span></code> (mandatory) - ID of existing VPC</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_subnet_id</span></code> (mandatory) - ID of existing VPC subnet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_region</span></code> (optional) - AWS region. Defaults to <code class="docutils literal notranslate"><span class="pre">us-east-1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_emr_version</span></code> (optional) - EMR version. Defaults to <code class="docutils literal notranslate"><span class="pre">emr-5.26.0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_core_instance_count</span></code> (optional) - Number of worker nodes. Defaults to <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_instance_type</span></code> (optional) - type of EC2 instances. Defaults to <code class="docutils literal notranslate"><span class="pre">m5.xlarge</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sw_version</span></code> (optional) - Sparkling Water version. Defaults to <code class="docutils literal notranslate"><span class="pre">3.36.1.4-1-3.1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jupyter_name</span></code> (optional) - User name for Jupyter Notebook. Defaults to <code class="docutils literal notranslate"><span class="pre">admin</span></code>.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code> module  (<strong>/templates/build/terraform/aws</strong>). This module is a combination of the two previous modules. It starts the network infrastructure and starts EMR with Sparkling Water on top of it.</p></li>
</ul>
<blockquote>
<div><p>This module accepts the following arguments:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aws_access_key</span></code> (mandatory) - access key to access AWS</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_secret_key</span></code> (mandatory) - secret key to access AWS</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_ssh_public_key</span></code> (optional) - public key (to be able to access EC2 instances via ssh later)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_region</span></code> (optional) - AWS region. Defaults to <code class="docutils literal notranslate"><span class="pre">us-east-1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_emr_version</span></code> (optional) - EMR version. Defaults to <code class="docutils literal notranslate"><span class="pre">emr-5.26.0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_core_instance_count</span></code> (optional) - Number of worker nodes. Defaults to <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aws_instance_type</span></code> (optional) - type of EC2 instances. Defaults to <code class="docutils literal notranslate"><span class="pre">m5.xlarge</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sw_version</span></code> (optional) - Sparkling Water version. Defaults to <code class="docutils literal notranslate"><span class="pre">3.36.1.4-1-3.1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jupyter_name</span></code> (optional) - User name for Jupyter Notebook. Defaults to <code class="docutils literal notranslate"><span class="pre">admin</span></code>.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<p>We provide these 3 templates as we realize some users already have some network infrastructure on their
AWS clusters available, and they don’t want to use a template that creates it again.</p>
<p>You can see that one of the mandatory arguments is a public key. This public key is associated with
EC2 machines so you can actually log in via ssh. You can create yourself a key-pair using <code class="docutils literal notranslate"><span class="pre">ssh-keygen</span> <span class="pre">-t</span> <span class="pre">rsa</span></code> tool.</p>
<p>To start any template you want, please run the following in the corresponding module directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>terraform init
terraform apply
</pre></div>
</div>
<p>You will be asked to provide mandatory variables. Please see
<a class="reference external" href="https://www.terraform.io/intro/index.html">Terraform documentation</a> for more information how to set up
variables.</p>
<p>To access the Jupyter Notebook, please go to the URL returned by <code class="docutils literal notranslate"><span class="pre">jupyter_notebook_url</span></code> Terraform output.
You need to approve the security exception (self-signed certificate) in your browser. The only way how to access the
notebook is by using the link above (with the token). Password login is not enabled.</p>
<p>If you would like to connect to the master machine via SSH, make sure you have filled <code class="docutils literal notranslate"><span class="pre">aws_ssh_public_key</span></code> argument
and please run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh -i path/to/private.key hadoop@public_master_dns
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">private.key</span></code> is the private key for the public key we specified as input and <code class="docutils literal notranslate"><span class="pre">public_master_dns</span></code>
is public DNS name of the master node. This DNS name is printed as output after <code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">apply</span></code> finishes.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="kubernetes.html" class="btn btn-neutral float-right" title="Running Sparkling Water in Kubernetes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="aws_emr_edge_node.html" class="btn btn-neutral float-left" title="Use Sparkling Water with Amazon EMR from the Edge Node" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020 H2O.ai
      <span class="lastupdated">
        Last updated on Aug 04, 2022.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>