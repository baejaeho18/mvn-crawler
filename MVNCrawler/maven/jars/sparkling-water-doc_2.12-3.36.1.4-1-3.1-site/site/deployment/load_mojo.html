

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Importing H2O MOJOs from H2O-3 &mdash; H2O Sparkling Water 3.36.1.4-1-3.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Importing MOJO Pipelines from Driverless AI" href="load_mojo_pipeline.html" />
    <link rel="prev" title="Sparkling Water Backends" href="backends.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.36.1.4-1-3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About Sparkling Water</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typical_use_case.html">Typical Use Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Sparkling Water Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install_and_start.html">Installing and Starting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="deployment.html">Deployment</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="backends.html">Sparkling Water Backends</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Importing H2O MOJOs from H2O-3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#starting-a-scoring-environment">Starting a Scoring Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-and-usage-of-h2o-3-mojo-model">Loading and Usage of H2O-3 MOJO Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exporting-the-loaded-mojo-model-using-sparkling-water">Exporting the loaded MOJO model using Sparkling Water</a></li>
<li class="toctree-l3"><a class="reference internal" href="#importing-the-previously-exported-mojo-model-from-sparkling-water">Importing the previously exported MOJO model from Sparkling Water</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-additional-prediction-details">Accessing additional prediction details</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-the-mojo-settings">Customizing the MOJO Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#methods-available-on-mojo-model">Methods available on MOJO Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-domain-values">Obtaining Domain Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-model-category">Obtaining Model Category</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-feature-types">Obtaining Feature Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-feature-importances">Obtaining Feature Importances</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-scoring-history">Obtaining Scoring History</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-metrics">Obtaining Metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-cross-validation-metrics-summary">Obtaining Cross Validation Metrics Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-cross-validation-models">Obtaining Cross Validation Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-leaf-node-assignments">Obtaining Leaf Node Assignments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#obtaining-stage-probabilities">Obtaining Stage Probabilities</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="load_mojo_pipeline.html">Importing MOJO Pipelines from Driverless AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysparkling_pipeline.html">Deploying PySparkling Pipeline Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_emr.html">Use Sparkling Water with Amazon EMR</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_emr_edge_node.html">Use Sparkling Water with Amazon EMR from the Edge Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="terraform_emr.html">Start Sparkling Water on Amazon EMR using our Terraform Template</a></li>
<li class="toctree-l2"><a class="reference internal" href="kubernetes.html">Running Sparkling Water in Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_azure_dbc.html">Running Sparkling Water on Databricks Azure Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="rsparkling_azure_dbc.html">Running RSparkling on Databricks Azure Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysparkling_azure_dbc.html">Running PySparkling on Databricks Azure Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="databricks_logs.html">Download H2O Logs from Databricks Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_google_cloud_dataproc.html">Running Sparkling Water on Google Cloud Dataproc</a></li>
<li class="toctree-l2"><a class="reference internal" href="azure_hdi.html">Using Sparkling Water with Microsoft Azure HDInsight - Beta</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_on_windows.html">Use Sparkling Water in Windows Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="rsparkling_on_windows.html">Use RSparkling in Windows Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="use_on_zeppelin.html">Sparkling Water and Zeppelin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ml/ml.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/metrics.html">Metric Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_details/model_details.html">Model Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters/parameters.html">Algorithm Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorials.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devel/devel.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pysparkling.html">PySparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rsparkling.html">RSparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">H2O Sparkling Water</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="deployment.html">Deployment</a> &raquo;</li>
        
      <li>Importing H2O MOJOs from H2O-3</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/deployment/load_mojo.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="importing-h2o-mojos-from-h2o-3">
<h1>Importing H2O MOJOs from H2O-3<a class="headerlink" href="#importing-h2o-mojos-from-h2o-3" title="Permalink to this headline">¶</a></h1>
<p>When training algorithm using Sparkling Water API, Sparkling Water always produces <code class="docutils literal notranslate"><span class="pre">H2OMOJOModel</span></code>. It is also possible
to import existing MOJO models into the Sparkling Water ecosystem from H2O-3. Such MOJO models then have the same scoring
capabilities as MOJO models trained via Sparkling Water API.</p>
<p><strong>Note</strong>: Sparkling Water is backward compatible with MOJO versions produced by different H2O-3 versions.</p>
<p>One advantage of scoring the MOJO artifacts is that <code class="docutils literal notranslate"><span class="pre">H2OContext</span></code> does not have to be created if we only want to
run predictions on MOJOs using Spark. It is important to mention that the format of prediction on MOJOs from
Driverless AI differs from predictions on H2O-3 MOJOs. The format of H2O-3 predictions is explained bellow.</p>
<div class="section" id="starting-a-scoring-environment">
<h2>Starting a Scoring Environment<a class="headerlink" href="#starting-a-scoring-environment" title="Permalink to this headline">¶</a></h2>
<p>First, we need to start a scoring environment for the desired language. There are two variants.
We can use Sparkling Water prepared scripts which put required dependencies on the Spark classpath or we can use Spark
directly and add the dependencies manually.</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./bin/spark-shell --jars jars/sparkling-water-assembly-scoring_2.12-3.36.1.4-1-3.1-all.jar
</pre></div>
</div>
<p>If there is a need to train H2O-3/SW models at the same time when we score with existing MOJO models, use
<code class="docutils literal notranslate"><span class="pre">jars/sparkling-water-assembly_2.12-3.36.1.4-1-3.1-all.jar</span></code> instead.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./bin/sparkling-shell
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./bin/pyspark --py-files py/h2o_pysparkling_scoring_3.1-3.36.1.4-1-3.1.zip
</pre></div>
</div>
<p>If there is a need to train H2O-3/SW models at the same time when we score with existing MOJO models, use
<code class="docutils literal notranslate"><span class="pre">py/h2o_pysparkling_3.1-3.36.1.4-1-3.1.zip</span></code> instead.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./bin/pysparkling
</pre></div>
</div>
</div>
</div>
<p>At this point, we have a Spark interactive terminal where we can carry out predictions. If we don’t require an interactive environment,
we can deploy our scoring logic with <code class="docutils literal notranslate"><span class="pre">./bin/spark-submit</span></code>. The parameters will be the same as in the example above.</p>
</div>
<div class="section" id="loading-and-usage-of-h2o-3-mojo-model">
<h2>Loading and Usage of H2O-3 MOJO Model<a class="headerlink" href="#loading-and-usage-of-h2o-3-mojo-model" title="Permalink to this headline">¶</a></h2>
<p>H2O MOJOs can be imported to Sparkling Water from all data sources supported by Apache Spark such as a local file, S3 or
HDFS and the semantics of the import is the same as in the Spark API.</p>
<p>When creating a MOJO specified by a relative path and HDFS is enabled, the method attempts to load
the MOJO from the HDFS home directory of the current user. In case we are not running on a HDFS-enabled system, we create
the mojo from a current working directory.</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling.ml.models._</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="o">(</span><span class="s">&quot;prostate_mojo.zip&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling.ml</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="p">(</span><span class="s2">&quot;prostate_mojo.zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-R">
<p class="tab-title">R</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">rsparkling</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">&lt;-</span> <span class="nf">spark_connect</span><span class="p">(</span><span class="n">master</span> <span class="o">=</span> <span class="s">&quot;local&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">&lt;-</span> <span class="nf">H2OMOJOModel.createFromMojo</span><span class="p">(</span><span class="s">&quot;prostate_mojo.zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>An absolute local path can also be used. To create a MOJO model from a locally available MOJO, call:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling.ml.models._</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="o">(</span><span class="s">&quot;/Users/peter/prostate_mojo.zip&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling.ml</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="p">(</span><span class="s2">&quot;/Users/peter/prostate_mojo.zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-R">
<p class="tab-title">R</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">rsparkling</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">&lt;-</span> <span class="nf">spark_connect</span><span class="p">(</span><span class="n">master</span> <span class="o">=</span> <span class="s">&quot;local&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">&lt;-</span> <span class="nf">H2OMOJOModel.createFromMojo</span><span class="p">(</span><span class="s">&quot;/Users/peter/prostate_mojo.zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Absolute paths on Hadoop can also be used. To create a MOJO model from a MOJO stored on HDFS, call:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling.ml.models._</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="o">(</span><span class="s">&quot;/user/peter/prostate_mojo.zip&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling.ml</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="p">(</span><span class="s2">&quot;/user/peter/prostate_mojo.zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-R">
<p class="tab-title">R</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">rsparkling</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">&lt;-</span> <span class="nf">spark_connect</span><span class="p">(</span><span class="n">master</span> <span class="o">=</span> <span class="s">&quot;local&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">&lt;-</span> <span class="nf">H2OMOJOModel.createFromMojo</span><span class="p">(</span><span class="s">&quot;/user/peter/prostate_mojo.zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The call loads the mojo file from the following location <code class="docutils literal notranslate"><span class="pre">hdfs://{server}:{port}/user/peter/prostate_mojo.zip</span></code>, where <code class="docutils literal notranslate"><span class="pre">{server}</span></code> and <code class="docutils literal notranslate"><span class="pre">{port}</span></code> is automatically filled in by Spark.</p>
<p>We can also manually specify the type of data source we need to use, in that case, we need to provide the schema:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling.ml.models._</span>
<span class="c1">// HDFS</span>
<span class="k">val</span> <span class="n">modelHDFS</span> <span class="k">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="o">(</span><span class="s">&quot;hdfs:///user/peter/prostate_mojo.zip&quot;</span><span class="o">)</span>
<span class="c1">// Local file</span>
<span class="k">val</span> <span class="n">modelLocal</span> <span class="k">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="o">(</span><span class="s">&quot;file:///Users/peter/prostate_mojo.zip&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling.ml</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># HDFS</span>
<span class="n">modelHDFS</span> <span class="o">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="p">(</span><span class="s2">&quot;hdfs:///user/peter/prostate_mojo.zip&quot;</span><span class="p">)</span>
<span class="c1"># Local file</span>
<span class="n">modelLocal</span> <span class="o">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="p">(</span><span class="s2">&quot;file:///Users/peter/prostate_mojo.zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-R">
<p class="tab-title">R</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">rsparkling</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">&lt;-</span> <span class="nf">spark_connect</span><span class="p">(</span><span class="n">master</span> <span class="o">=</span> <span class="s">&quot;local&quot;</span><span class="p">)</span>
 <span class="c1"># HDFS</span>
<span class="n">modelHDFS</span> <span class="o">&lt;-</span> <span class="nf">H2OMOJOModel.createFromMojo</span><span class="p">(</span><span class="s">&quot;hdfs:///user/peter/prostate_mojo.zip&quot;</span><span class="p">)</span>
<span class="c1"># Local file</span>
<span class="n">modelLocal</span> <span class="o">&lt;-</span> <span class="nf">H2OMOJOModel.createFromMojo</span><span class="p">(</span><span class="s">&quot;file:///Users/peter/prostate_mojo.zip&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The loaded model is an immutable instance, so it’s not possible to change the configuration of the model during its existence.
On the other hand, the model can be configured during its creation via <code class="docutils literal notranslate"><span class="pre">H2OMOJOSettings</span></code>:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling.ml.models._</span>
<span class="k">val</span> <span class="n">settings</span> <span class="k">=</span> <span class="n">H2OMOJOSettings</span><span class="o">(</span><span class="n">convertUnknownCategoricalLevelsToNa</span> <span class="k">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">convertInvalidNumbersToNa</span> <span class="k">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="o">(</span><span class="s">&quot;prostate_mojo.zip&quot;</span><span class="o">,</span> <span class="n">settings</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling.ml</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">H2OMOJOSettings</span><span class="p">(</span><span class="n">convertUnknownCategoricalLevelsToNa</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">convertInvalidNumbersToNa</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">H2OMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="p">(</span><span class="s2">&quot;prostate_mojo.zip&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-R">
<p class="tab-title">R</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">rsparkling</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">&lt;-</span> <span class="nf">spark_connect</span><span class="p">(</span><span class="n">master</span> <span class="o">=</span> <span class="s">&quot;local&quot;</span><span class="p">)</span>
<span class="n">settings</span> <span class="o">&lt;-</span> <span class="nf">H2OMOJOSettings</span><span class="p">(</span><span class="n">convertUnknownCategoricalLevelsToNa</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">convertInvalidNumbersToNa</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="n">model</span> <span class="o">&lt;-</span> <span class="nf">H2OMOJOModel.createFromMojo</span><span class="p">(</span><span class="s">&quot;prostate_mojo.zip&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To score the dataset using the loaded mojo, call:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-R">
<p class="tab-title">R</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">$</span><span class="nf">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In Scala, the <code class="docutils literal notranslate"><span class="pre">createFromMojo</span></code> method returns a mojo model instance cast as a base class <code class="docutils literal notranslate"><span class="pre">H2OMOJOModel</span></code>. This class holds
only properties common for all mojo models across different Sparkling Water algorithms.</p>
<p>If a Scala user wants to get a property specific for a given MOJO model type, he/she must utilize casting or
call the <code class="docutils literal notranslate"><span class="pre">createFromMojo</span></code> method on the specific MOJO model type.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling.ml.models._</span>
<span class="k">val</span> <span class="n">specificModel</span> <span class="k">=</span> <span class="n">H2OGBMMOJOModel</span><span class="o">.</span><span class="n">createFromMojo</span><span class="o">(</span><span class="s">&quot;prostate_mojo.zip&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Ntrees: </span><span class="si">${</span><span class="n">specificModel</span><span class="o">.</span><span class="n">getNTrees</span><span class="o">()</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>The list of specific MOJO models:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">H2OXGBoostMOJOModel</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H2OGBMMOJOModel</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H2ODRFMOJOModel</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H2OGLMMOJOModel</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H2OGAMMOJOModel</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H2ODeepLearningMOJOModel</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H2OKMeansMOJOModel</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H2OIsolationForestMOJOModel</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H2OCoxPHMOJOModel</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H2OTargetEncoderMOJOModel</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">H2OAutoEncoderMOJOModel</span></code></p></li>
</ul>
</div>
<div class="section" id="exporting-the-loaded-mojo-model-using-sparkling-water">
<h2>Exporting the loaded MOJO model using Sparkling Water<a class="headerlink" href="#exporting-the-loaded-mojo-model-using-sparkling-water" title="Permalink to this headline">¶</a></h2>
<p>To export the MOJO model, call <code class="docutils literal notranslate"><span class="pre">model.write.save(&quot;/some/path&quot;)</span></code>. In case of a Hadoop-enabled system, the command by default
uses HDFS. To reference a path on the local file system of the Spark driver, the path must be prefixed with <code class="docutils literal notranslate"><span class="pre">file://</span></code> when HDFS is enabled.</p>
</div>
<div class="section" id="importing-the-previously-exported-mojo-model-from-sparkling-water">
<h2>Importing the previously exported MOJO model from Sparkling Water<a class="headerlink" href="#importing-the-previously-exported-mojo-model-from-sparkling-water" title="Permalink to this headline">¶</a></h2>
<p>To import the MOJO model, call <code class="docutils literal notranslate"><span class="pre">H2OMOJOModel.read.load(&quot;/some/path&quot;)</span></code>. In case of a Hadoop-enabled system, the command by default
uses HDFS. To reference a path on the local file system of the Spark driver, the path must be prefixed with <code class="docutils literal notranslate"><span class="pre">file://</span></code> when HDFS is enabled.</p>
</div>
<div class="section" id="accessing-additional-prediction-details">
<h2>Accessing additional prediction details<a class="headerlink" href="#accessing-additional-prediction-details" title="Permalink to this headline">¶</a></h2>
<p>After computing predictions, the <code class="docutils literal notranslate"><span class="pre">prediction</span></code> column contains in case of classification problem the predicted label
and in case regression problem the predicted number. If we need to access more details for each prediction, see the content
of a detailed prediction column. By default, the column is named named <code class="docutils literal notranslate"><span class="pre">detailed_prediction</span></code>. It could contain, for example,
predicted probabilities for each predicted label in case of classification problem, Shapley values, and other information.</p>
</div>
<div class="section" id="customizing-the-mojo-settings">
<h2>Customizing the MOJO Settings<a class="headerlink" href="#customizing-the-mojo-settings" title="Permalink to this headline">¶</a></h2>
<p>We can configure the output and format of predictions via the H2OMOJOSettings. The available options are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">predictionCol</span></code> - Specifies the name of the generated prediction column. The default value is <cite>prediction</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">detailedPredictionCol</span></code> - Specifies the name of the generated detailed prediction column. The detailed prediction column,
if enabled, contains additional details, such as probabilities, Shapley values etc. The default value is <cite>detailed_prediction</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">convertUnknownCategoricalLevelsToNa</span></code> - Enables or disables conversion of unseen categoricals to NAs. By default, it is disabled.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">convertInvalidNumbersToNa</span></code> - Enables or disables conversion of invalid numbers to NAs. By default, it is disabled.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">withContributions</span></code> - Enables or disables computing Shapley values. Shapley values are generated as a sub-column for the
detailed prediction column. Shapley values are supported only by tree-based binomial and regression models.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">withLeafNodeAssignments</span></code> - When enabled, a user can obtain the leaf node assignments after the model training
has finished. By default, it is disabled.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">withStageResults</span></code> - When enabled, a user can obtain the stage results for tree-based models. By default,
it is disabled and also it’s not supported by XGBoost although it’s a tree-based algorithm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dataFrameSerializer</span></code> - A full name of a serializer used for serialization and deserialization of Spark DataFrames
to a JSON value within <code class="docutils literal notranslate"><span class="pre">NullableDataFrameParam</span></code>.</p></li>
</ul>
</div>
<div class="section" id="methods-available-on-mojo-model">
<h2>Methods available on MOJO Model<a class="headerlink" href="#methods-available-on-mojo-model" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>See <a class="reference internal" href="../model_details/model_details.html#model-details"><span class="std std-ref">Model Details</span></a> for methods available on particular model types.</p></li>
</ul>
<div class="section" id="obtaining-domain-values">
<h3>Obtaining Domain Values<a class="headerlink" href="#obtaining-domain-values" title="Permalink to this headline">¶</a></h3>
<p>To obtain domain values of the trained model, we can run <code class="docutils literal notranslate"><span class="pre">getDomainValues()</span></code> on the model. This call
returns a mapping from a column name to its domain in a form of an array.</p>
</div>
<div class="section" id="obtaining-model-category">
<h3>Obtaining Model Category<a class="headerlink" href="#obtaining-model-category" title="Permalink to this headline">¶</a></h3>
<p>The method <code class="docutils literal notranslate"><span class="pre">getModelCategory</span></code> can be used to get the model category (such as <code class="docutils literal notranslate"><span class="pre">binomial</span></code>, <code class="docutils literal notranslate"><span class="pre">multinomial</span></code> etc).</p>
</div>
<div class="section" id="obtaining-feature-types">
<h3>Obtaining Feature Types<a class="headerlink" href="#obtaining-feature-types" title="Permalink to this headline">¶</a></h3>
<p>The method <code class="docutils literal notranslate"><span class="pre">getFeatureTypes</span></code> returns a map/dictionary from a feature name to a corresponding feature type
[<code class="docutils literal notranslate"><span class="pre">enum</span></code> (categorical), <code class="docutils literal notranslate"><span class="pre">numeric</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code>, etc.]. These pieces helps to understand how individual columns of
the training dataset were treated during the model training.</p>
</div>
<div class="section" id="obtaining-feature-importances">
<h3>Obtaining Feature Importances<a class="headerlink" href="#obtaining-feature-importances" title="Permalink to this headline">¶</a></h3>
<p>The method <code class="docutils literal notranslate"><span class="pre">getFeatureImportances</span></code> returns a data frame describing importance of each feature. The importance is expressed
by several numbers (Relative Importance, Scaled Importance and Percentage). <a class="reference external" href="https://h2o-release.s3.amazonaws.com/h2o/rel-zumbo/4/docs-website/h2o-docs/variable-importance.html">H2O-3 documentation</a>
describes how the numbers are calculated.</p>
</div>
<div class="section" id="obtaining-scoring-history">
<h3>Obtaining Scoring History<a class="headerlink" href="#obtaining-scoring-history" title="Permalink to this headline">¶</a></h3>
<p>The method <code class="docutils literal notranslate"><span class="pre">getScoringHistory</span></code> returns a data frame describing how the model evolved during the training process according to
a certain training and validation metrics.</p>
</div>
<div class="section" id="obtaining-metrics">
<h3>Obtaining Metrics<a class="headerlink" href="#obtaining-metrics" title="Permalink to this headline">¶</a></h3>
<p>There are two sets of methods to obtain metrics from the MOJO model.</p>
<ol class="arabic simple">
<li><p>The first set of methods return a map from the metric name to its double value.</p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getTrainingMetrics()</span></code> - to obtain training metrics</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getValidationMetrics()</span></code> - to obtain validation metrics</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCrossValidationMetrics()</span></code> - to obtain metrics combined from cross-validation holdouts</p></li>
</ul>
<p>There is also the method <code class="docutils literal notranslate"><span class="pre">getCurrentMetrics()</span></code> which gets one of the metrics above based on the following algorithm:</p>
<p>If cross-validation was used, ie, <code class="docutils literal notranslate"><span class="pre">setNfolds</span></code> was called and the value was higher than zero, this method returns cross-validation
metrics. If cross-validation was not used, but the validation frame was used, the method returns validation metrics. The validation
frame is used if <code class="docutils literal notranslate"><span class="pre">setSplitRatio</span></code> was called with the value lower than one. If neither cross-validation nor validation frame
was used, this method returns the training metrics.</p>
<p>2. The second set of methods returns typed instances. The instances make individual metrics available via getter methods and
the metrics could be also of a complex type. (see <a class="reference internal" href="../metrics/metrics.html#metrics"><span class="std std-ref">Metric Classes</span></a> for details)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getTrainingMetricsObject()</span></code> - to obtain training metrics</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getValidationMetricsObject()</span></code> - to obtain validation metrics</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getCrossValidationMetricsObject()</span></code> - to obtain metrics combined from cross-validation holdouts</p></li>
</ul>
<p>There is also the  method <code class="docutils literal notranslate"><span class="pre">getCurrentMetricsObject()</span></code> working a similar way as <code class="docutils literal notranslate"><span class="pre">getCurrentMetrics()</span></code>.</p>
</div>
<div class="section" id="obtaining-cross-validation-metrics-summary">
<h3>Obtaining Cross Validation Metrics Summary<a class="headerlink" href="#obtaining-cross-validation-metrics-summary" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">getCrossValidationMetricsSummary</span></code> method returns data frame with information about performance of individual folds
according to various model metrics.</p>
</div>
<div class="section" id="obtaining-cross-validation-models">
<h3>Obtaining Cross Validation Models<a class="headerlink" href="#obtaining-cross-validation-models" title="Permalink to this headline">¶</a></h3>
<p>If the model was trained with SW API (i.e. the model wasn’t loaded with the method <code class="docutils literal notranslate"><span class="pre">H2OMOJOModel.createFromMojo()</span></code>),
the algorithm parameter <code class="docutils literal notranslate"><span class="pre">keepCrossValidationModels</span></code> was set to <code class="docutils literal notranslate"><span class="pre">true</span></code> and cross-validation was enabled during
the training phase, a user can access the sequence cross-validation models by calling the method <code class="docutils literal notranslate"><span class="pre">getCrossValidationModels()</span></code>.
The returned models are regular Sparkling Water MOJO models with model metrics and other important information.
<em>[This feature is not available in SW R API.]</em></p>
</div>
<div class="section" id="obtaining-leaf-node-assignments">
<h3>Obtaining Leaf Node Assignments<a class="headerlink" href="#obtaining-leaf-node-assignments" title="Permalink to this headline">¶</a></h3>
<p>To obtain the leaf node assignments, please first make sure to set <code class="docutils literal notranslate"><span class="pre">withLeafNodeAssignments</span></code>
to true on your MOJO settings object. The leaf node assignments are now stored
in the <code class="docutils literal notranslate"><span class="pre">${detailedPredictionCol}.leafNodeAssignments</span></code> column on the dataset obtained from the prediction.
Please replace <code class="docutils literal notranslate"><span class="pre">${detailedPredictionCol}</span></code> with the actual value of your detailed prediction col. By default,
it is <code class="docutils literal notranslate"><span class="pre">detailed_prediction</span></code>.</p>
</div>
<div class="section" id="obtaining-stage-probabilities">
<h3>Obtaining Stage Probabilities<a class="headerlink" href="#obtaining-stage-probabilities" title="Permalink to this headline">¶</a></h3>
<p>To obtain the stage results, please first make sure to set <code class="docutils literal notranslate"><span class="pre">withStageResults</span></code> to true on your MOJO settings object.
The stage results for regression and anomaly detection problems are stored in the <code class="docutils literal notranslate"><span class="pre">${detailedPredictionCol}.stageResults</span></code>
on the dataset obtained from the prediction. The stage results for classification (binomial, multinomial) problems
are stored under <code class="docutils literal notranslate"><span class="pre">${detailedPredictionCol}.stageProbabilities</span></code> Please replace <code class="docutils literal notranslate"><span class="pre">${detailedPredictionCol}</span></code>
with the actual value of your detailed prediction col. By default, it is <code class="docutils literal notranslate"><span class="pre">detailed_prediction</span></code>.</p>
<p>The stage results are an array of values, where a value at the position <em>t</em> is the prediction/probability combined from contributions of trees <em>T1, T2, …, Tt</em>.
For <em>t</em> equal to a number of model trees, the value is the same as the final prediction/probability. The stage results (probabilities) for the classification problem
are represented by a list of columns, where one column contains stage probabilities for a given prediction class.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="load_mojo_pipeline.html" class="btn btn-neutral float-right" title="Importing MOJO Pipelines from Driverless AI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="backends.html" class="btn btn-neutral float-left" title="Sparkling Water Backends" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020 H2O.ai
      <span class="lastupdated">
        Last updated on Aug 04, 2022.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>