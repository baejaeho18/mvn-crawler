

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sparkling Water Backends &mdash; H2O Sparkling Water 3.36.1.4-1-3.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Importing H2O MOJOs from H2O-3" href="load_mojo.html" />
    <link rel="prev" title="Deployment" href="deployment.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.36.1.4-1-3.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About Sparkling Water</a></li>
<li class="toctree-l1"><a class="reference internal" href="../typical_use_case.html">Typical Use Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Sparkling Water Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install_and_start.html">Installing and Starting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="deployment.html">Deployment</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Sparkling Water Backends</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#internal-backend">Internal Backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="#external-backend">External Backend</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#automatic-mode-of-external-backend">Automatic Mode of External Backend</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manual-mode-of-external-backend-on-hadoop">Manual Mode of External Backend on Hadoop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manual-mode-of-external-backend-without-hadoop-standalone">Manual Mode of External Backend without Hadoop (standalone)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#specifying-the-client-network-in-scala">Specifying the Client Network in Scala</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="load_mojo.html">Importing H2O MOJOs from H2O-3</a></li>
<li class="toctree-l2"><a class="reference internal" href="load_mojo_pipeline.html">Importing MOJO Pipelines from Driverless AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysparkling_pipeline.html">Deploying PySparkling Pipeline Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_emr.html">Use Sparkling Water with Amazon EMR</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_emr_edge_node.html">Use Sparkling Water with Amazon EMR from the Edge Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="terraform_emr.html">Start Sparkling Water on Amazon EMR using our Terraform Template</a></li>
<li class="toctree-l2"><a class="reference internal" href="kubernetes.html">Running Sparkling Water in Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_azure_dbc.html">Running Sparkling Water on Databricks Azure Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="rsparkling_azure_dbc.html">Running RSparkling on Databricks Azure Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysparkling_azure_dbc.html">Running PySparkling on Databricks Azure Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="databricks_logs.html">Download H2O Logs from Databricks Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="sw_google_cloud_dataproc.html">Running Sparkling Water on Google Cloud Dataproc</a></li>
<li class="toctree-l2"><a class="reference internal" href="azure_hdi.html">Using Sparkling Water with Microsoft Azure HDInsight - Beta</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_on_windows.html">Use Sparkling Water in Windows Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="rsparkling_on_windows.html">Use RSparkling in Windows Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="use_on_zeppelin.html">Sparkling Water and Zeppelin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ml/ml.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/metrics.html">Metric Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_details/model_details.html">Model Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters/parameters.html">Algorithm Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorials.html">How to…</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devel/devel.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pysparkling.html">PySparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rsparkling.html">RSparkling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration_guide.html">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">H2O Sparkling Water</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="deployment.html">Deployment</a> &raquo;</li>
        
      <li>Sparkling Water Backends</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/deployment/backends.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sparkling-water-backends">
<span id="backend"></span><h1>Sparkling Water Backends<a class="headerlink" href="#sparkling-water-backends" title="Permalink to this headline">¶</a></h1>
<div class="section" id="internal-backend">
<h2>Internal Backend<a class="headerlink" href="#internal-backend" title="Permalink to this headline">¶</a></h2>
<p>In the internal backend, an H2O cluster is created automatically during the <code class="docutils literal notranslate"><span class="pre">H2OContext.getOrCreate</span></code> call.
Because it’s not technically possible to get the number of executors in Spark, we try to discover all executors
at the initiation of <code class="docutils literal notranslate"><span class="pre">H2OContext</span></code>, and we start the H2O instance inside of each discovered executor. This
solution is easiest to deploy; however, when Spark or YARN kills the executor the whole H2O cluster goes down
since H2O does not support high availability.</p>
<p>The internal backend is the default behavior for Sparkling Water. The alternative is the external backend. The behavior
can be changed via the Spark configuration property <code class="docutils literal notranslate"><span class="pre">spark.ext.h2o.backend.cluster.mode</span></code> by specifying either
<code class="docutils literal notranslate"><span class="pre">external</span></code> or <code class="docutils literal notranslate"><span class="pre">internal</span></code>. It is also possible to change the type of the backend on our configuration object
, <code class="docutils literal notranslate"><span class="pre">H2OConf</span></code>. <code class="docutils literal notranslate"><span class="pre">H2OConf</span></code> is a simple wrapper around <code class="docutils literal notranslate"><span class="pre">SparkConf</span></code> and inherits all properties in the Spark configuration.</p>
<p>Here we show a few examples of how <code class="docutils literal notranslate"><span class="pre">H2OContext</span></code> can be started with the internal backend.</p>
<p>Explicitly specify internal backend on <code class="docutils literal notranslate"><span class="pre">H2OConf</span></code>:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<blockquote>
<div><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling._</span>
<span class="k">val</span> <span class="n">conf</span> <span class="k">=</span> <span class="k">new</span> <span class="n">H2OConf</span><span class="o">().</span><span class="n">setInternalClusterMode</span><span class="o">()</span>
<span class="k">val</span> <span class="n">hc</span> <span class="k">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="o">(</span><span class="n">conf</span><span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">H2OConf</span><span class="p">()</span><span class="o">.</span><span class="n">setInternalClusterMode</span><span class="p">()</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">spark.ext.h2o.backend.cluster.mode</span></code> property was set to <code class="docutils literal notranslate"><span class="pre">internal</span></code> either on the command
line or on the <code class="docutils literal notranslate"><span class="pre">SparkConf</span></code> class,  we can call just the following as <code class="docutils literal notranslate"><span class="pre">H2OContext</span></code> internally creates
<code class="docutils literal notranslate"><span class="pre">H2OConf</span></code> which is picking up the value of the property:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<blockquote>
<div><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling._</span>
<span class="k">val</span> <span class="n">hc</span> <span class="k">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="o">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<p>We can however also explicitly pass the <code class="docutils literal notranslate"><span class="pre">H2OConf</span></code>:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<blockquote>
<div><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling._</span>
<span class="k">val</span> <span class="n">conf</span> <span class="k">=</span> <span class="k">new</span> <span class="n">H2OConf</span><span class="o">()</span>
<span class="k">val</span> <span class="n">hc</span> <span class="k">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="o">(</span><span class="n">conf</span><span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">H2OConf</span><span class="p">()</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="external-backend">
<span id="id1"></span><h2>External Backend<a class="headerlink" href="#external-backend" title="Permalink to this headline">¶</a></h2>
<p>In the external cluster, we use the H2O cluster running separately from the rest of the Spark application. This separation
gives us more stability because we are no longer affected by Spark executors being killed, which can
lead (as in the previous mode) to h2o cluster being killed as well.</p>
<p>There are two deployment strategies of the external cluster: manual and automatic. In manual mode, we need to start
the H2O cluster, and in the automatic mode, the cluster is started for us automatically based on our configuration.
In Hadoop environments, the creation of the cluster is performed by a simple process called H2O driver.
When the cluster is fully formed, the H2O driver terminates. In both modes, we have to store a path of H2O driver jar
to the environment variable <code class="docutils literal notranslate"><span class="pre">H2O_DRIVER_JAR</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">H2O_DRIVER_JAR</span><span class="o">=</span><span class="k">$(</span>./bin/get-h2o-driver.sh some_hadoop_distribution<span class="k">)</span>
</pre></div>
</div>
<div class="section" id="automatic-mode-of-external-backend">
<h3>Automatic Mode of External Backend<a class="headerlink" href="#automatic-mode-of-external-backend" title="Permalink to this headline">¶</a></h3>
<p>In automatic mode, the H2O cluster is started automatically. The cluster can be started automatically only in YARN
environment at the moment. We recommend this approach, as it is easier to deploy external clusters in this mode
and it is also more suitable for production environments. When the H2O cluster is started on YARN, it is started
as a map-reduce job, and it always uses the flat-file approach for nodes to cloud up.</p>
<p>Get H2O driver, for example, for cdh 5.8:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">H2O_DRIVER_JAR</span><span class="o">=</span><span class="k">$(</span>./bin/get-h2o-driver.sh cdh5.8<span class="k">)</span>
</pre></div>
</div>
<p>To start an H2O cluster and connect to it, run:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<blockquote>
<div><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling._</span>
<span class="k">val</span> <span class="n">conf</span> <span class="k">=</span> <span class="k">new</span> <span class="n">H2OConf</span><span class="o">()</span>
            <span class="o">.</span><span class="n">setExternalClusterMode</span><span class="o">()</span>
            <span class="o">.</span><span class="n">useAutoClusterStart</span><span class="o">()</span>
            <span class="o">.</span><span class="n">setH2ODriverPath</span><span class="o">(</span><span class="s">&quot;path_to_h2o_driver&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="n">setClusterSize</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="c1">// Number of H2O worker nodes to start</span>
            <span class="o">.</span><span class="n">setExternalMemory</span><span class="o">(</span><span class="s">&quot;2G&quot;</span><span class="o">)</span> <span class="c1">// Memory per single H2O worker node</span>
            <span class="o">.</span><span class="n">setYARNQueue</span><span class="o">(</span><span class="s">&quot;abc&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">hc</span> <span class="k">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="o">(</span><span class="n">conf</span><span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
<p>In case we stored the path of the driver H2O jar to environmental variable <code class="docutils literal notranslate"><span class="pre">H2O_DRIVER_JAR</span></code>, we don’t
have to specify <code class="docutils literal notranslate"><span class="pre">setH2ODriverPath</span></code> as Sparkling Water will read the path from the environmental variable.</p>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">H2OConf</span><span class="p">()</span>
        <span class="o">.</span><span class="n">setExternalClusterMode</span><span class="p">()</span>
        <span class="o">.</span><span class="n">useAutoClusterStart</span><span class="p">()</span>
        <span class="o">.</span><span class="n">setH2ODriverPath</span><span class="p">(</span><span class="s2">&quot;path_to_h2o_driver&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">setClusterSize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Number of H2O worker nodes to start</span>
        <span class="o">.</span><span class="n">setExternalMemory</span><span class="p">(</span><span class="s2">&quot;2G&quot;</span><span class="p">)</span> <span class="c1"># Memory per single H2O worker node</span>
        <span class="o">.</span><span class="n">setYARNQueue</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">)</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>In case we stored the path of the driver H2O jar to environmental variable <code class="docutils literal notranslate"><span class="pre">H2O_DRIVER_JAR</span></code>, we don’t
have to specify <code class="docutils literal notranslate"><span class="pre">setH2ODriverPath</span></code> as Sparkling Water will read the path from the environmental variable.</p>
</div>
</div>
<p>When specifying the queue, we recommend that this queue has YARN preemption off in order to have stable an H2O cluster.</p>
<p>In the case of Scala, it can also happen that we might need to explicitly set the client’s IP or network. To see how this can be configured, please
see <a class="reference internal" href="#specifying-the-client-network-in-scala">Specifying the Client Network in Scala</a>.</p>
</div>
<div class="section" id="manual-mode-of-external-backend-on-hadoop">
<h3>Manual Mode of External Backend on Hadoop<a class="headerlink" href="#manual-mode-of-external-backend-on-hadoop" title="Permalink to this headline">¶</a></h3>
<p>In manual mode, we need to start the H2O cluster before connecting to it manually. At this section, we will start the cluster
on Hadoop.</p>
<p>Get H2O driver, for example, for cdh 5.8:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">H2O_DRIVER_JAR</span><span class="o">=</span><span class="k">$(</span>./bin/get-h2o-driver.sh cdh5.8<span class="k">)</span>
</pre></div>
</div>
<p>Set path to sparkling-water-assembly-extensions-3.36.1.4-1-3.1-all.jar which is bundled in Sparkling Water archive.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SW_EXTENSIONS_ASSEMBLY</span><span class="o">=</span>/path/to/sparkling-water-3.36.1.4-1-3.1/jars/sparkling-water-assembly-extensions-3.36.1.4-1-3.1-all.jar
</pre></div>
</div>
<p>Start H2O cluster on Hadoop:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hadoop -jar <span class="nv">$H2O_DRIVER_JAR</span> -libjars <span class="nv">$SW_EXTENSIONS_ASSEMBLY</span> -sw_ext_backend -jobname <span class="nb">test</span> -nodes <span class="m">3</span> -mapperXmx 6g
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-sw_ext_backend</span></code> is required as without it, the cluster won’t allow Sparkling Water client to connect to it.</p>
<p>After this step, we should have an H2O cluster with 3 nodes running on Hadoop.</p>
<p>To connect to this external cluster, run the following commands:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<blockquote>
<div><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling._</span>
<span class="k">val</span> <span class="n">conf</span> <span class="k">=</span> <span class="k">new</span> <span class="n">H2OConf</span><span class="o">()</span>
            <span class="o">.</span><span class="n">setExternalClusterMode</span><span class="o">()</span>
            <span class="o">.</span><span class="n">useManualClusterStart</span><span class="o">()</span>
            <span class="o">.</span><span class="n">setH2OCluster</span><span class="o">(</span><span class="s">&quot;representant_ip&quot;</span><span class="o">,</span> <span class="n">representant_port</span><span class="o">)</span>
            <span class="o">.</span><span class="n">setCloudName</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">hc</span> <span class="k">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="o">(</span><span class="n">conf</span><span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">H2OConf</span><span class="p">()</span>
        <span class="o">.</span><span class="n">setExternalClusterMode</span><span class="p">()</span>
        <span class="o">.</span><span class="n">useManualClusterStart</span><span class="p">()</span>
        <span class="o">.</span><span class="n">setH2OCluster</span><span class="p">(</span><span class="s2">&quot;representant_ip&quot;</span><span class="p">,</span> <span class="n">representant_port</span><span class="p">)</span>
        <span class="o">.</span><span class="n">setCloudName</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">representant_ip</span></code> and <code class="docutils literal notranslate"><span class="pre">representant_port</span></code> are IP and port of any node in the external cluster to which Sparkling
Water should connect.</p>
</div>
<div class="section" id="manual-mode-of-external-backend-without-hadoop-standalone">
<span id="external-backend-manual-standalone"></span><h3>Manual Mode of External Backend without Hadoop (standalone)<a class="headerlink" href="#manual-mode-of-external-backend-without-hadoop-standalone" title="Permalink to this headline">¶</a></h3>
<p>In manual mode, we need to start the H2O cluster before connecting to it manually. At this section, we will start the cluster
as a standalone application (without Hadoop).</p>
<p>Get assembly H2O jar:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">H2O_JAR</span><span class="o">=</span><span class="k">$(</span>./bin/get-h2o-driver.sh standalone<span class="k">)</span>
</pre></div>
</div>
<p>Set path to sparkling-water-assembly-extensions-3.36.1.4-1-3.1-all.jar which is bundled in Sparkling Water archive.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">SW_EXTENSIONS_ASSEMBLY</span><span class="o">=</span>/path/to/sparkling-water-3.36.1.4-1-3.1/jars/sparkling-water-assembly-extensions_2.12-3.36.1.4-1-3.1-all.jar
</pre></div>
</div>
<p>To start an external H2O cluster, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>java -cp <span class="s2">&quot;</span><span class="nv">$H2O_JAR</span><span class="s2">:</span><span class="nv">$SW_EXTENSIONS_ASSEMBLY</span><span class="s2">&quot;</span> water.H2OApp -allow_clients -name <span class="nb">test</span> -flatfile path_to_flatfile
</pre></div>
</div>
<p>where the flat-file’s content are lines in the format of IP:port of the nodes where H2O is supposed to run. To
read more about flat-file and its format, please
see <a class="reference external" href="https://github.com/h2oai/h2o-3/blob/master/h2o-docs/src/product/howto/H2O-DevCmdLine.md#flatfile">H2O’s flat-file configuration property</a>.</p>
<p>To connect to this external cluster, run the following commands:</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-Scala">
<p class="tab-title">Scala</p>
<blockquote>
<div><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling._</span>
<span class="k">val</span> <span class="n">conf</span> <span class="k">=</span> <span class="k">new</span> <span class="n">H2OConf</span><span class="o">()</span>
            <span class="o">.</span><span class="n">setExternalClusterMode</span><span class="o">()</span>
            <span class="o">.</span><span class="n">useManualClusterStart</span><span class="o">()</span>
            <span class="o">.</span><span class="n">setH2OCluster</span><span class="o">(</span><span class="s">&quot;representant_ip&quot;</span><span class="o">,</span> <span class="n">representant_port</span><span class="o">)</span>
            <span class="o">.</span><span class="n">setClusterSize</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
            <span class="o">.</span><span class="n">setCloudName</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">hc</span> <span class="k">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="o">(</span><span class="n">conf</span><span class="o">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="tab-content docutils container" id="tab-Python">
<p class="tab-title">Python</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysparkling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">H2OConf</span><span class="p">()</span>
        <span class="o">.</span><span class="n">setExternalClusterMode</span><span class="p">()</span>
        <span class="o">.</span><span class="n">useManualClusterStart</span><span class="p">()</span>
        <span class="o">.</span><span class="n">setH2OCluster</span><span class="p">(</span><span class="s2">&quot;representant_ip&quot;</span><span class="p">,</span> <span class="n">representant_port</span><span class="p">)</span>
        <span class="o">.</span><span class="n">setClusterSize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="o">.</span><span class="n">setCloudName</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">representant_ip</span></code> and <code class="docutils literal notranslate"><span class="pre">representant_port</span></code> are ip and port of any node in the external cluster to which Sparkling
Water should connect.</p>
</div>
<div class="section" id="specifying-the-client-network-in-scala">
<h3>Specifying the Client Network in Scala<a class="headerlink" href="#specifying-the-client-network-in-scala" title="Permalink to this headline">¶</a></h3>
<p>It is possible that Spark driver, in which we are running H2O client which is connecting to the external H2O cluster, is
connected to multiple networks.</p>
<p>In this case, it can happen that external H2O cluster decides to use addresses from network A while Spark decides to use
addresses for its executors and driver from network B. When we start <code class="docutils literal notranslate"><span class="pre">H2OContext</span></code>, the H2O
client running inside of the Spark Driver can get the same IP address as the Spark driver, and, thus, the rest
of the H2O cluster can’t see it. This shouldn’t happen in environments where the nodes are connected to only one
network; however, we provide a configuration for how to deal with this case as well. This problem exists only in
Sparkling Water Scala client.</p>
<p>Let’s assume we have two H2O nodes on addresses 192.168.0.1 and 192.168.0.2. Let’s also assume that the Spark driver
is available on 172.16.1.1, and the only executor is available on 172.16.1.2. The node with the Spark driver
is also connected to the 192.168.0.x network with address 192.168.0.3.</p>
<p>In this case, there is a chance that the H2O client will use the address from 172.16.x.x network instead
of the 192.168.0.x one, which can lead to the problem that the H2O cluster and H2O client can’t see each other.</p>
<p>We can force the client to use the correct network or address using the following configuration:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">ai.h2o.sparkling._</span>
<span class="k">val</span> <span class="n">conf</span> <span class="k">=</span> <span class="k">new</span> <span class="n">H2OConf</span><span class="o">()</span>
            <span class="o">.</span><span class="n">setExternalClusterMode</span><span class="o">()</span>
            <span class="o">.</span><span class="n">useManualClusterStart</span><span class="o">()</span>
            <span class="o">.</span><span class="n">setH2OCluster</span><span class="o">(</span><span class="s">&quot;ip&quot;</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span>
            <span class="o">.</span><span class="n">setClientNetworkMask</span><span class="o">(</span><span class="s">&quot;192.168.0.0/24&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="n">setClusterSize</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
            <span class="o">.</span><span class="n">setCloudName</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">hc</span> <span class="k">=</span> <span class="n">H2OContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="o">(</span><span class="n">conf</span><span class="o">)</span>
</pre></div>
</div>
<p>Instead of <code class="docutils literal notranslate"><span class="pre">setClientNetworkMask</span></code>, we can also use more strict variant and specify the IP address directly using
<code class="docutils literal notranslate"><span class="pre">setClientIp(&quot;192.168.0.3&quot;)</span></code>. This IP address needs to be one of the IP addresses of the Spark driver and in
the same network as the rest of the H2O worker nodes.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="load_mojo.html" class="btn btn-neutral float-right" title="Importing H2O MOJOs from H2O-3" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="deployment.html" class="btn btn-neutral float-left" title="Deployment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2020 H2O.ai
      <span class="lastupdated">
        Last updated on Aug 04, 2022.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>