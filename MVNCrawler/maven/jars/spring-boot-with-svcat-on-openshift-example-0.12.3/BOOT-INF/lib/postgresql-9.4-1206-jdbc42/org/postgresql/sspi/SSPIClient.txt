Compiled from "SSPIClient.java"
public class org.postgresql.sspi.SSPIClient {
  public static java.lang.String SSPI_DEFAULT_SPN_SERVICE_CLASS;

  private final org.postgresql.core.Logger logger;

  private final org.postgresql.core.PGStream pgStream;

  private final java.lang.String spnServiceClass;

  private final boolean enableNegotiate;

  private waffle.windows.auth.IWindowsCredentialsHandle clientCredentials;

  private waffle.windows.auth.impl.WindowsSecurityContextImpl sspiContext;

  private java.lang.String targetName;

  public org.postgresql.sspi.SSPIClient(org.postgresql.core.PGStream, java.lang.String, boolean, org.postgresql.core.Logger);
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object."<init>":()V
       4: aload_0
       5: aload         4
       7: putfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      10: aload_0
      11: aload_1
      12: putfield      #3                  // Field pgStream:Lorg/postgresql/core/PGStream;
      15: aload_2
      16: astore        5
      18: aload_2
      19: ifnull        31
      22: aload_2
      23: invokevirtual #4                  // Method java/lang/String.isEmpty:()Z
      26: ifeq          31
      29: aconst_null
      30: astore_2
      31: aload_2
      32: ifnonnull     39
      35: getstatic     #5                  // Field SSPI_DEFAULT_SPN_SERVICE_CLASS:Ljava/lang/String;
      38: astore_2
      39: aload_0
      40: aload_2
      41: putfield      #6                  // Field spnServiceClass:Ljava/lang/String;
      44: aload_0
      45: iload_3
      46: putfield      #7                  // Field enableNegotiate:Z
      49: return

  public boolean isSSPISupported();
    Code:
       0: invokestatic  #8                  // Method com/sun/jna/Platform.isWindows:()Z
       3: ifne          17
       6: aload_0
       7: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      10: ldc           #9                  // String SSPI not supported: non-Windows host
      12: invokevirtual #10                 // Method org/postgresql/core/Logger.debug:(Ljava/lang/String;)V
      15: iconst_0
      16: ireturn
      17: ldc           #11                 // String waffle.windows.auth.impl.WindowsSecurityContextImpl
      19: invokestatic  #12                 // Method java/lang/Class.forName:(Ljava/lang/String;)Ljava/lang/Class;
      22: pop
      23: iconst_1
      24: ireturn
      25: astore_1
      26: aload_0
      27: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      30: invokevirtual #14                 // Method org/postgresql/core/Logger.logDebug:()Z
      33: ifeq          46
      36: aload_0
      37: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      40: ldc           #15                 // String SSPI unavailable (no Waffle/JNA libraries?)
      42: aload_1
      43: invokevirtual #16                 // Method org/postgresql/core/Logger.debug:(Ljava/lang/String;Ljava/lang/Throwable;)V
      46: iconst_0
      47: ireturn
      48: astore_1
      49: aload_0
      50: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      53: invokevirtual #14                 // Method org/postgresql/core/Logger.logDebug:()Z
      56: ifeq          69
      59: aload_0
      60: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      63: ldc           #15                 // String SSPI unavailable (no Waffle/JNA libraries?)
      65: aload_1
      66: invokevirtual #16                 // Method org/postgresql/core/Logger.debug:(Ljava/lang/String;Ljava/lang/Throwable;)V
      69: iconst_0
      70: ireturn
    Exception table:
       from    to  target type
           0    16    25   Class java/lang/NoClassDefFoundError
          17    24    25   Class java/lang/NoClassDefFoundError
           0    16    48   Class java/lang/ClassNotFoundException
          17    24    48   Class java/lang/ClassNotFoundException

  private java.lang.String makeSPN() throws org.postgresql.util.PSQLException;
    Code:
       0: aload_0
       1: getfield      #3                  // Field pgStream:Lorg/postgresql/core/PGStream;
       4: invokevirtual #18                 // Method org/postgresql/core/PGStream.getHostSpec:()Lorg/postgresql/util/HostSpec;
       7: astore_1
       8: getstatic     #19                 // Field org/postgresql/sspi/NTDSAPIWrapper.instance:Lorg/postgresql/sspi/NTDSAPIWrapper;
      11: aload_0
      12: getfield      #6                  // Field spnServiceClass:Ljava/lang/String;
      15: aload_1
      16: invokevirtual #20                 // Method org/postgresql/util/HostSpec.getHost:()Ljava/lang/String;
      19: aconst_null
      20: aload_1
      21: invokevirtual #21                 // Method org/postgresql/util/HostSpec.getPort:()I
      24: i2s
      25: aconst_null
      26: invokevirtual #22                 // Method org/postgresql/sspi/NTDSAPIWrapper.DsMakeSpn:(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;SLjava/lang/String;)Ljava/lang/String;
      29: areturn
      30: astore_2
      31: new           #24                 // class org/postgresql/util/PSQLException
      34: dup
      35: ldc           #25                 // String SSPI setup failed to determine SPN
      37: getstatic     #26                 // Field org/postgresql/util/PSQLState.CONNECTION_UNABLE_TO_CONNECT:Lorg/postgresql/util/PSQLState;
      40: aload_2
      41: invokespecial #27                 // Method org/postgresql/util/PSQLException."<init>":(Ljava/lang/String;Lorg/postgresql/util/PSQLState;Ljava/lang/Throwable;)V
      44: athrow
    Exception table:
       from    to  target type
           8    29    30   Class com/sun/jna/LastErrorException

  public void startSSPI() throws java.sql.SQLException, java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #7                  // Field enableNegotiate:Z
       4: ifeq          12
       7: ldc           #28                 // String negotiate
       9: goto          14
      12: ldc           #29                 // String kerberos
      14: astore_1
      15: aload_0
      16: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      19: new           #30                 // class java/lang/StringBuilder
      22: dup
      23: invokespecial #31                 // Method java/lang/StringBuilder."<init>":()V
      26: ldc           #32                 // String Beginning SSPI/Kerberos negotiation with SSPI package:
      28: invokevirtual #33                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      31: aload_1
      32: invokevirtual #33                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      35: invokevirtual #34                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      38: invokevirtual #10                 // Method org/postgresql/core/Logger.debug:(Ljava/lang/String;)V
      41: aload_0
      42: aload_1
      43: invokestatic  #35                 // Method waffle/windows/auth/impl/WindowsCredentialsHandleImpl.getCurrent:(Ljava/lang/String;)Lwaffle/windows/auth/IWindowsCredentialsHandle;
      46: putfield      #36                 // Field clientCredentials:Lwaffle/windows/auth/IWindowsCredentialsHandle;
      49: aload_0
      50: getfield      #36                 // Field clientCredentials:Lwaffle/windows/auth/IWindowsCredentialsHandle;
      53: invokeinterface #37,  1           // InterfaceMethod waffle/windows/auth/IWindowsCredentialsHandle.initialize:()V
      58: goto          76
      61: astore_2
      62: new           #24                 // class org/postgresql/util/PSQLException
      65: dup
      66: ldc           #39                 // String Could not obtain local Windows credentials for SSPI
      68: getstatic     #26                 // Field org/postgresql/util/PSQLState.CONNECTION_UNABLE_TO_CONNECT:Lorg/postgresql/util/PSQLState;
      71: aload_2
      72: invokespecial #27                 // Method org/postgresql/util/PSQLException."<init>":(Ljava/lang/String;Lorg/postgresql/util/PSQLState;Ljava/lang/Throwable;)V
      75: athrow
      76: aload_0
      77: aload_0
      78: invokespecial #40                 // Method makeSPN:()Ljava/lang/String;
      81: putfield      #41                 // Field targetName:Ljava/lang/String;
      84: aload_0
      85: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      88: invokevirtual #14                 // Method org/postgresql/core/Logger.logDebug:()Z
      91: ifeq          123
      94: aload_0
      95: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      98: new           #30                 // class java/lang/StringBuilder
     101: dup
     102: invokespecial #31                 // Method java/lang/StringBuilder."<init>":()V
     105: ldc           #42                 // String SSPI target name:
     107: invokevirtual #33                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     110: aload_0
     111: getfield      #41                 // Field targetName:Ljava/lang/String;
     114: invokevirtual #33                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     117: invokevirtual #34                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     120: invokevirtual #10                 // Method org/postgresql/core/Logger.debug:(Ljava/lang/String;)V
     123: aload_0
     124: new           #43                 // class waffle/windows/auth/impl/WindowsSecurityContextImpl
     127: dup
     128: invokespecial #44                 // Method waffle/windows/auth/impl/WindowsSecurityContextImpl."<init>":()V
     131: putfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
     134: aload_0
     135: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
     138: aload_0
     139: getfield      #41                 // Field targetName:Ljava/lang/String;
     142: invokevirtual #46                 // Method waffle/windows/auth/impl/WindowsSecurityContextImpl.setPrincipalName:(Ljava/lang/String;)V
     145: aload_0
     146: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
     149: aload_0
     150: getfield      #36                 // Field clientCredentials:Lwaffle/windows/auth/IWindowsCredentialsHandle;
     153: invokeinterface #47,  1           // InterfaceMethod waffle/windows/auth/IWindowsCredentialsHandle.getHandle:()Lcom/sun/jna/platform/win32/Sspi$CredHandle;
     158: invokevirtual #48                 // Method waffle/windows/auth/impl/WindowsSecurityContextImpl.setCredentialsHandle:(Lcom/sun/jna/platform/win32/Sspi$CredHandle;)V
     161: aload_0
     162: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
     165: aload_1
     166: invokevirtual #49                 // Method waffle/windows/auth/impl/WindowsSecurityContextImpl.setSecurityPackage:(Ljava/lang/String;)V
     169: aload_0
     170: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
     173: aconst_null
     174: aconst_null
     175: aload_0
     176: getfield      #41                 // Field targetName:Ljava/lang/String;
     179: invokevirtual #50                 // Method waffle/windows/auth/impl/WindowsSecurityContextImpl.initialize:(Lcom/sun/jna/platform/win32/Sspi$CtxtHandle;Lcom/sun/jna/platform/win32/Sspi$SecBufferDesc;Ljava/lang/String;)V
     182: goto          200
     185: astore_2
     186: new           #24                 // class org/postgresql/util/PSQLException
     189: dup
     190: ldc           #51                 // String Could not initialize SSPI security context
     192: getstatic     #26                 // Field org/postgresql/util/PSQLState.CONNECTION_UNABLE_TO_CONNECT:Lorg/postgresql/util/PSQLState;
     195: aload_2
     196: invokespecial #27                 // Method org/postgresql/util/PSQLException."<init>":(Ljava/lang/String;Lorg/postgresql/util/PSQLState;Ljava/lang/Throwable;)V
     199: athrow
     200: aload_0
     201: aload_0
     202: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
     205: invokevirtual #52                 // Method waffle/windows/auth/impl/WindowsSecurityContextImpl.getToken:()[B
     208: invokespecial #53                 // Method sendSSPIResponse:([B)V
     211: aload_0
     212: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
     215: ldc           #54                 // String Sent first SSPI negotiation message
     217: invokevirtual #10                 // Method org/postgresql/core/Logger.debug:(Ljava/lang/String;)V
     220: goto          238
     223: astore_2
     224: new           #24                 // class org/postgresql/util/PSQLException
     227: dup
     228: ldc           #55                 // String SSPI cannot be used, Waffle or its dependencies are missing from the classpath
     230: getstatic     #56                 // Field org/postgresql/util/PSQLState.NOT_IMPLEMENTED:Lorg/postgresql/util/PSQLState;
     233: aload_2
     234: invokespecial #27                 // Method org/postgresql/util/PSQLException."<init>":(Ljava/lang/String;Lorg/postgresql/util/PSQLState;Ljava/lang/Throwable;)V
     237: athrow
     238: return
    Exception table:
       from    to  target type
          41    58    61   Class com/sun/jna/platform/win32/Win32Exception
          76   182   185   Class com/sun/jna/platform/win32/Win32Exception
          41   220   223   Class java/lang/NoClassDefFoundError

  public void continueSSPI(int) throws java.sql.SQLException, java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
       4: ifnonnull     17
       7: new           #57                 // class java/lang/IllegalStateException
      10: dup
      11: ldc           #58                 // String Cannot continue SSPI authentication that we didn\'t begin
      13: invokespecial #59                 // Method java/lang/IllegalStateException."<init>":(Ljava/lang/String;)V
      16: athrow
      17: aload_0
      18: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      21: ldc           #60                 // String Continuing SSPI negotiation
      23: invokevirtual #10                 // Method org/postgresql/core/Logger.debug:(Ljava/lang/String;)V
      26: aload_0
      27: getfield      #3                  // Field pgStream:Lorg/postgresql/core/PGStream;
      30: iload_1
      31: invokevirtual #61                 // Method org/postgresql/core/PGStream.Receive:(I)[B
      34: astore_2
      35: new           #62                 // class com/sun/jna/platform/win32/Sspi$SecBufferDesc
      38: dup
      39: iconst_2
      40: aload_2
      41: invokespecial #64                 // Method com/sun/jna/platform/win32/Sspi$SecBufferDesc."<init>":(I[B)V
      44: astore_3
      45: aload_0
      46: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
      49: aload_0
      50: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
      53: invokevirtual #65                 // Method waffle/windows/auth/impl/WindowsSecurityContextImpl.getHandle:()Lcom/sun/jna/platform/win32/Sspi$CtxtHandle;
      56: aload_3
      57: aload_0
      58: getfield      #41                 // Field targetName:Ljava/lang/String;
      61: invokevirtual #50                 // Method waffle/windows/auth/impl/WindowsSecurityContextImpl.initialize:(Lcom/sun/jna/platform/win32/Sspi$CtxtHandle;Lcom/sun/jna/platform/win32/Sspi$SecBufferDesc;Ljava/lang/String;)V
      64: aload_0
      65: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
      68: invokevirtual #52                 // Method waffle/windows/auth/impl/WindowsSecurityContextImpl.getToken:()[B
      71: astore        4
      73: aload         4
      75: arraylength
      76: ifle          97
      79: aload_0
      80: aload         4
      82: invokespecial #53                 // Method sendSSPIResponse:([B)V
      85: aload_0
      86: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
      89: ldc           #66                 // String Sent SSPI negotiation continuation message
      91: invokevirtual #10                 // Method org/postgresql/core/Logger.debug:(Ljava/lang/String;)V
      94: goto          106
      97: aload_0
      98: getfield      #2                  // Field logger:Lorg/postgresql/core/Logger;
     101: ldc           #67                 // String SSPI authentication complete, no reply required
     103: invokevirtual #10                 // Method org/postgresql/core/Logger.debug:(Ljava/lang/String;)V
     106: return

  private void sendSSPIResponse(byte[]) throws java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #3                  // Field pgStream:Lorg/postgresql/core/PGStream;
       4: bipush        112
       6: invokevirtual #68                 // Method org/postgresql/core/PGStream.SendChar:(I)V
       9: aload_0
      10: getfield      #3                  // Field pgStream:Lorg/postgresql/core/PGStream;
      13: iconst_4
      14: aload_1
      15: arraylength
      16: iadd
      17: invokevirtual #69                 // Method org/postgresql/core/PGStream.SendInteger4:(I)V
      20: aload_0
      21: getfield      #3                  // Field pgStream:Lorg/postgresql/core/PGStream;
      24: aload_1
      25: invokevirtual #70                 // Method org/postgresql/core/PGStream.Send:([B)V
      28: aload_0
      29: getfield      #3                  // Field pgStream:Lorg/postgresql/core/PGStream;
      32: invokevirtual #71                 // Method org/postgresql/core/PGStream.flush:()V
      35: return

  public void dispose();
    Code:
       0: aload_0
       1: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
       4: ifnull        19
       7: aload_0
       8: getfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
      11: invokevirtual #72                 // Method waffle/windows/auth/impl/WindowsSecurityContextImpl.dispose:()V
      14: aload_0
      15: aconst_null
      16: putfield      #45                 // Field sspiContext:Lwaffle/windows/auth/impl/WindowsSecurityContextImpl;
      19: aload_0
      20: getfield      #36                 // Field clientCredentials:Lwaffle/windows/auth/IWindowsCredentialsHandle;
      23: ifnull        40
      26: aload_0
      27: getfield      #36                 // Field clientCredentials:Lwaffle/windows/auth/IWindowsCredentialsHandle;
      30: invokeinterface #73,  1           // InterfaceMethod waffle/windows/auth/IWindowsCredentialsHandle.dispose:()V
      35: aload_0
      36: aconst_null
      37: putfield      #36                 // Field clientCredentials:Lwaffle/windows/auth/IWindowsCredentialsHandle;
      40: return

  static {};
    Code:
       0: ldc           #74                 // String POSTGRES
       2: putstatic     #5                  // Field SSPI_DEFAULT_SPN_SERVICE_CLASS:Ljava/lang/String;
       5: return
}
