Compiled from "AbstractUserDetailsAuthenticationProvider.java"
public abstract class cn.herodotus.engine.oauth2.authentication.provider.AbstractUserDetailsAuthenticationProvider extends cn.herodotus.engine.oauth2.authentication.provider.AbstractAuthenticationProvider {
  private static final org.slf4j.Logger log;

  private final org.springframework.context.support.MessageSourceAccessor messages;

  private final org.springframework.security.core.userdetails.UserDetailsService userDetailsService;

  private final org.springframework.security.oauth2.server.authorization.OAuth2AuthorizationService authorizationService;

  private final cn.herodotus.engine.oauth2.authentication.properties.OAuth2AuthenticationProperties authenticationProperties;

  private org.springframework.security.crypto.password.PasswordEncoder passwordEncoder;

  public cn.herodotus.engine.oauth2.authentication.provider.AbstractUserDetailsAuthenticationProvider(org.springframework.security.oauth2.server.authorization.OAuth2AuthorizationService, org.springframework.security.core.userdetails.UserDetailsService, cn.herodotus.engine.oauth2.authentication.properties.OAuth2AuthenticationProperties);
    Code:
       0: aload_0
       1: invokespecial #1                  // Method cn/herodotus/engine/oauth2/authentication/provider/AbstractAuthenticationProvider."<init>":()V
       4: aload_0
       5: invokestatic  #7                  // Method org/springframework/security/core/SpringSecurityMessageSource.getAccessor:()Lorg/springframework/context/support/MessageSourceAccessor;
       8: putfield      #13                 // Field messages:Lorg/springframework/context/support/MessageSourceAccessor;
      11: aload_0
      12: aload_2
      13: putfield      #19                 // Field userDetailsService:Lorg/springframework/security/core/userdetails/UserDetailsService;
      16: aload_0
      17: aload_1
      18: putfield      #23                 // Field authorizationService:Lorg/springframework/security/oauth2/server/authorization/OAuth2AuthorizationService;
      21: aload_0
      22: aload_3
      23: putfield      #27                 // Field authenticationProperties:Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties;
      26: aload_0
      27: invokestatic  #31                 // Method org/springframework/security/crypto/factory/PasswordEncoderFactories.createDelegatingPasswordEncoder:()Lorg/springframework/security/crypto/password/PasswordEncoder;
      30: invokevirtual #37                 // Method setPasswordEncoder:(Lorg/springframework/security/crypto/password/PasswordEncoder;)V
      33: return

  public cn.herodotus.engine.oauth2.core.definition.service.EnhanceUserDetailsService getUserDetailsService();
    Code:
       0: aload_0
       1: getfield      #19                 // Field userDetailsService:Lorg/springframework/security/core/userdetails/UserDetailsService;
       4: checkcast     #41                 // class cn/herodotus/engine/oauth2/core/definition/service/EnhanceUserDetailsService
       7: areturn

  public void setPasswordEncoder(org.springframework.security.crypto.password.PasswordEncoder);
    Code:
       0: aload_1
       1: ldc           #43                 // String passwordEncoder cannot be null
       3: invokestatic  #45                 // Method org/springframework/util/Assert.notNull:(Ljava/lang/Object;Ljava/lang/String;)V
       6: aload_0
       7: aload_1
       8: putfield      #51                 // Field passwordEncoder:Lorg/springframework/security/crypto/password/PasswordEncoder;
      11: return

  protected org.springframework.security.crypto.password.PasswordEncoder getPasswordEncoder();
    Code:
       0: aload_0
       1: getfield      #51                 // Field passwordEncoder:Lorg/springframework/security/crypto/password/PasswordEncoder;
       4: areturn

  protected abstract void additionalAuthenticationChecks(org.springframework.security.core.userdetails.UserDetails, java.util.Map<java.lang.String, java.lang.Object>) throws org.springframework.security.core.AuthenticationException;

  protected abstract org.springframework.security.core.userdetails.UserDetails retrieveUser(java.util.Map<java.lang.String, java.lang.Object>) throws org.springframework.security.core.AuthenticationException;

  private org.springframework.security.core.Authentication authenticateUserDetails(java.util.Map<java.lang.String, java.lang.Object>, java.lang.String) throws org.springframework.security.core.AuthenticationException;
    Code:
       0: aload_0
       1: aload_1
       2: invokevirtual #55                 // Method retrieveUser:(Ljava/util/Map;)Lorg/springframework/security/core/userdetails/UserDetails;
       5: astore_3
       6: aload_3
       7: invokeinterface #59,  1           // InterfaceMethod org/springframework/security/core/userdetails/UserDetails.isAccountNonLocked:()Z
      12: ifne          44
      15: getstatic     #65                 // Field log:Lorg/slf4j/Logger;
      18: ldc           #69                 // String [Herodotus] |- Failed to authenticate since user account is locked
      20: invokeinterface #71,  2           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;)V
      25: new           #77                 // class org/springframework/security/authentication/LockedException
      28: dup
      29: aload_0
      30: getfield      #13                 // Field messages:Lorg/springframework/context/support/MessageSourceAccessor;
      33: ldc           #79                 // String AbstractUserDetailsAuthenticationProvider.locked
      35: ldc           #81                 // String User account is locked
      37: invokevirtual #83                 // Method org/springframework/context/support/MessageSourceAccessor.getMessage:(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
      40: invokespecial #89                 // Method org/springframework/security/authentication/LockedException."<init>":(Ljava/lang/String;)V
      43: athrow
      44: aload_3
      45: invokeinterface #91,  1           // InterfaceMethod org/springframework/security/core/userdetails/UserDetails.isEnabled:()Z
      50: ifne          82
      53: getstatic     #65                 // Field log:Lorg/slf4j/Logger;
      56: ldc           #94                 // String [Herodotus] |- Failed to authenticate since user account is disabled
      58: invokeinterface #71,  2           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;)V
      63: new           #96                 // class org/springframework/security/authentication/DisabledException
      66: dup
      67: aload_0
      68: getfield      #13                 // Field messages:Lorg/springframework/context/support/MessageSourceAccessor;
      71: ldc           #98                 // String AbstractUserDetailsAuthenticationProvider.disabled
      73: ldc           #100                // String User is disabled
      75: invokevirtual #83                 // Method org/springframework/context/support/MessageSourceAccessor.getMessage:(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
      78: invokespecial #102                // Method org/springframework/security/authentication/DisabledException."<init>":(Ljava/lang/String;)V
      81: athrow
      82: aload_3
      83: invokeinterface #103,  1          // InterfaceMethod org/springframework/security/core/userdetails/UserDetails.isAccountNonExpired:()Z
      88: ifne          120
      91: getstatic     #65                 // Field log:Lorg/slf4j/Logger;
      94: ldc           #106                // String [Herodotus] |- Failed to authenticate since user account has expired
      96: invokeinterface #71,  2           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;)V
     101: new           #108                // class org/springframework/security/authentication/AccountExpiredException
     104: dup
     105: aload_0
     106: getfield      #13                 // Field messages:Lorg/springframework/context/support/MessageSourceAccessor;
     109: ldc           #110                // String AbstractUserDetailsAuthenticationProvider.expired
     111: ldc           #112                // String User account has expired
     113: invokevirtual #83                 // Method org/springframework/context/support/MessageSourceAccessor.getMessage:(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
     116: invokespecial #114                // Method org/springframework/security/authentication/AccountExpiredException."<init>":(Ljava/lang/String;)V
     119: athrow
     120: aload_0
     121: aload_3
     122: aload_1
     123: invokevirtual #115                // Method additionalAuthenticationChecks:(Lorg/springframework/security/core/userdetails/UserDetails;Ljava/util/Map;)V
     126: aload_3
     127: invokeinterface #119,  1          // InterfaceMethod org/springframework/security/core/userdetails/UserDetails.isCredentialsNonExpired:()Z
     132: ifne          164
     135: getstatic     #65                 // Field log:Lorg/slf4j/Logger;
     138: ldc           #122                // String [Herodotus] |- Failed to authenticate since user account credentials have expired
     140: invokeinterface #71,  2           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;)V
     145: new           #124                // class org/springframework/security/authentication/CredentialsExpiredException
     148: dup
     149: aload_0
     150: getfield      #13                 // Field messages:Lorg/springframework/context/support/MessageSourceAccessor;
     153: ldc           #126                // String AbstractUserDetailsAuthenticationProvider.credentialsExpired
     155: ldc           #128                // String User credentials have expired
     157: invokevirtual #83                 // Method org/springframework/context/support/MessageSourceAccessor.getMessage:(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
     160: invokespecial #130                // Method org/springframework/security/authentication/CredentialsExpiredException."<init>":(Ljava/lang/String;)V
     163: athrow
     164: aload_0
     165: getfield      #27                 // Field authenticationProperties:Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties;
     168: invokevirtual #131                // Method cn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties.getSignInEndpointLimited:()Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties$SignInEndpointLimited;
     171: invokevirtual #137                // Method cn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties$SignInEndpointLimited.getEnabled:()Ljava/lang/Boolean;
     174: invokevirtual #143                // Method java/lang/Boolean.booleanValue:()Z
     177: ifeq          259
     180: aload_0
     181: getfield      #27                 // Field authenticationProperties:Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties;
     184: invokevirtual #148                // Method cn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties.getSignInKickOutLimited:()Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties$SignInKickOutLimited;
     187: invokevirtual #152                // Method cn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties$SignInKickOutLimited.getEnabled:()Ljava/lang/Boolean;
     190: invokevirtual #143                // Method java/lang/Boolean.booleanValue:()Z
     193: ifne          259
     196: aload_0
     197: getfield      #23                 // Field authorizationService:Lorg/springframework/security/oauth2/server/authorization/OAuth2AuthorizationService;
     200: astore        5
     202: aload         5
     204: instanceof    #155                // class cn/herodotus/engine/oauth2/data/jpa/storage/JpaOAuth2AuthorizationService
     207: ifeq          259
     210: aload         5
     212: checkcast     #155                // class cn/herodotus/engine/oauth2/data/jpa/storage/JpaOAuth2AuthorizationService
     215: astore        4
     217: aload         4
     219: aload_2
     220: aload_3
     221: invokeinterface #157,  1          // InterfaceMethod org/springframework/security/core/userdetails/UserDetails.getUsername:()Ljava/lang/String;
     226: invokevirtual #161                // Method cn/herodotus/engine/oauth2/data/jpa/storage/JpaOAuth2AuthorizationService.findAuthorizationCount:(Ljava/lang/String;Ljava/lang/String;)I
     229: istore        5
     231: iload         5
     233: aload_0
     234: getfield      #27                 // Field authenticationProperties:Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties;
     237: invokevirtual #131                // Method cn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties.getSignInEndpointLimited:()Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties$SignInEndpointLimited;
     240: invokevirtual #165                // Method cn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties$SignInEndpointLimited.getMaximum:()Ljava/lang/Integer;
     243: invokevirtual #169                // Method java/lang/Integer.intValue:()I
     246: if_icmplt     259
     249: new           #175                // class cn/herodotus/engine/oauth2/core/exception/AccountEndpointLimitedException
     252: dup
     253: ldc           #177                // String Use same endpoint signIn exceed limit
     255: invokespecial #179                // Method cn/herodotus/engine/oauth2/core/exception/AccountEndpointLimitedException."<init>":(Ljava/lang/String;)V
     258: athrow
     259: aload_0
     260: getfield      #27                 // Field authenticationProperties:Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties;
     263: invokevirtual #131                // Method cn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties.getSignInEndpointLimited:()Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties$SignInEndpointLimited;
     266: invokevirtual #137                // Method cn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties$SignInEndpointLimited.getEnabled:()Ljava/lang/Boolean;
     269: invokevirtual #143                // Method java/lang/Boolean.booleanValue:()Z
     272: ifne          349
     275: aload_0
     276: getfield      #27                 // Field authenticationProperties:Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties;
     279: invokevirtual #148                // Method cn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties.getSignInKickOutLimited:()Lcn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties$SignInKickOutLimited;
     282: invokevirtual #152                // Method cn/herodotus/engine/oauth2/authentication/properties/OAuth2AuthenticationProperties$SignInKickOutLimited.getEnabled:()Ljava/lang/Boolean;
     285: invokevirtual #143                // Method java/lang/Boolean.booleanValue:()Z
     288: ifeq          349
     291: aload_0
     292: getfield      #23                 // Field authorizationService:Lorg/springframework/security/oauth2/server/authorization/OAuth2AuthorizationService;
     295: astore        5
     297: aload         5
     299: instanceof    #155                // class cn/herodotus/engine/oauth2/data/jpa/storage/JpaOAuth2AuthorizationService
     302: ifeq          349
     305: aload         5
     307: checkcast     #155                // class cn/herodotus/engine/oauth2/data/jpa/storage/JpaOAuth2AuthorizationService
     310: astore        4
     312: aload         4
     314: aload_2
     315: aload_3
     316: invokeinterface #157,  1          // InterfaceMethod org/springframework/security/core/userdetails/UserDetails.getUsername:()Ljava/lang/String;
     321: invokevirtual #180                // Method cn/herodotus/engine/oauth2/data/jpa/storage/JpaOAuth2AuthorizationService.findAvailableAuthorizations:(Ljava/lang/String;Ljava/lang/String;)Ljava/util/List;
     324: astore        5
     326: aload         5
     328: invokestatic  #184                // Method org/apache/commons/collections4/CollectionUtils.isNotEmpty:(Ljava/util/Collection;)Z
     331: ifeq          349
     334: aload         5
     336: aload_3
     337: aload         4
     339: invokedynamic #190,  0            // InvokeDynamic #0:accept:(Lorg/springframework/security/core/userdetails/UserDetails;Lcn/herodotus/engine/oauth2/data/jpa/storage/JpaOAuth2AuthorizationService;)Ljava/util/function/Consumer;
     344: invokeinterface #194,  2          // InterfaceMethod java/util/List.forEach:(Ljava/util/function/Consumer;)V
     349: new           #200                // class org/springframework/security/authentication/UsernamePasswordAuthenticationToken
     352: dup
     353: aload_3
     354: aload_3
     355: invokeinterface #202,  1          // InterfaceMethod org/springframework/security/core/userdetails/UserDetails.getPassword:()Ljava/lang/String;
     360: aload_3
     361: invokeinterface #205,  1          // InterfaceMethod org/springframework/security/core/userdetails/UserDetails.getAuthorities:()Ljava/util/Collection;
     366: invokespecial #209                // Method org/springframework/security/authentication/UsernamePasswordAuthenticationToken."<init>":(Ljava/lang/Object;Ljava/lang/Object;Ljava/util/Collection;)V
     369: areturn

  protected org.springframework.security.core.Authentication getUsernamePasswordAuthentication(java.util.Map<java.lang.String, java.lang.Object>, java.lang.String) throws org.springframework.security.core.AuthenticationException;
    Code:
       0: aconst_null
       1: astore_3
       2: aload_0
       3: aload_1
       4: aload_2
       5: invokevirtual #212                // Method authenticateUserDetails:(Ljava/util/Map;Ljava/lang/String;)Lorg/springframework/security/core/Authentication;
       8: astore_3
       9: goto          70
      12: astore        4
      14: aload         4
      16: invokevirtual #218                // Method java/lang/Object.getClass:()Ljava/lang/Class;
      19: invokevirtual #224                // Method java/lang/Class.getSimpleName:()Ljava/lang/String;
      22: astore        5
      24: aload         5
      26: aload         4
      28: invokevirtual #229                // Method org/springframework/security/authentication/AccountStatusException.getMessage:()Ljava/lang/String;
      31: ldc           #233                // String https://datatracker.ietf.org/doc/html/rfc6749#section-5.2
      33: invokestatic  #235                // Method cn/herodotus/engine/oauth2/authentication/utils/OAuth2EndpointUtils.throwError:(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
      36: goto          70
      39: astore        4
      41: ldc           #243                // String BadCredentialsException
      43: aload         4
      45: invokevirtual #245                // Method org/springframework/security/authentication/BadCredentialsException.getMessage:()Ljava/lang/String;
      48: ldc           #233                // String https://datatracker.ietf.org/doc/html/rfc6749#section-5.2
      50: invokestatic  #235                // Method cn/herodotus/engine/oauth2/authentication/utils/OAuth2EndpointUtils.throwError:(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
      53: goto          70
      56: astore        4
      58: ldc           #248                // String UsernameNotFoundException
      60: aload         4
      62: invokevirtual #250                // Method org/springframework/security/core/userdetails/UsernameNotFoundException.getMessage:()Ljava/lang/String;
      65: ldc           #233                // String https://datatracker.ietf.org/doc/html/rfc6749#section-5.2
      67: invokestatic  #235                // Method cn/herodotus/engine/oauth2/authentication/utils/OAuth2EndpointUtils.throwError:(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
      70: aload_3
      71: areturn
    Exception table:
       from    to  target type
           2     9    12   Class org/springframework/security/authentication/AccountStatusException
           2     9    39   Class org/springframework/security/authentication/BadCredentialsException
           2     9    56   Class org/springframework/security/core/userdetails/UsernameNotFoundException

  private static void lambda$authenticateUserDetails$0(org.springframework.security.core.userdetails.UserDetails, cn.herodotus.engine.oauth2.data.jpa.storage.JpaOAuth2AuthorizationService, org.springframework.security.oauth2.server.authorization.OAuth2Authorization);
    Code:
       0: aload_2
       1: ldc           #251                // class org/springframework/security/oauth2/core/OAuth2RefreshToken
       3: invokevirtual #253                // Method org/springframework/security/oauth2/server/authorization/OAuth2Authorization.getToken:(Ljava/lang/Class;)Lorg/springframework/security/oauth2/server/authorization/OAuth2Authorization$Token;
       6: astore_3
       7: aload_3
       8: invokestatic  #259                // Method org/apache/commons/lang3/ObjectUtils.isNotEmpty:(Ljava/lang/Object;)Z
      11: ifeq          26
      14: aload_2
      15: aload_3
      16: invokevirtual #264                // Method org/springframework/security/oauth2/server/authorization/OAuth2Authorization$Token.getToken:()Lorg/springframework/security/oauth2/core/OAuth2Token;
      19: checkcast     #251                // class org/springframework/security/oauth2/core/OAuth2RefreshToken
      22: invokestatic  #269                // Method cn/herodotus/engine/oauth2/authentication/utils/OAuth2AuthenticationProviderUtils.invalidate:(Lorg/springframework/security/oauth2/server/authorization/OAuth2Authorization;Lorg/springframework/security/oauth2/core/OAuth2Token;)Lorg/springframework/security/oauth2/server/authorization/OAuth2Authorization;
      25: astore_2
      26: getstatic     #65                 // Field log:Lorg/slf4j/Logger;
      29: ldc_w         #275                // String [Herodotus] |- Sign in user [{}] with token id [{}] will be kicked out.
      32: aload_0
      33: invokeinterface #157,  1          // InterfaceMethod org/springframework/security/core/userdetails/UserDetails.getUsername:()Ljava/lang/String;
      38: aload_2
      39: invokevirtual #277                // Method org/springframework/security/oauth2/server/authorization/OAuth2Authorization.getId:()Ljava/lang/String;
      42: invokeinterface #280,  4          // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
      47: aload_1
      48: aload_2
      49: invokevirtual #283                // Method cn/herodotus/engine/oauth2/data/jpa/storage/JpaOAuth2AuthorizationService.save:(Lorg/springframework/security/oauth2/server/authorization/OAuth2Authorization;)V
      52: return

  static {};
    Code:
       0: ldc           #14                 // class cn/herodotus/engine/oauth2/authentication/provider/AbstractUserDetailsAuthenticationProvider
       2: invokestatic  #287                // Method org/slf4j/LoggerFactory.getLogger:(Ljava/lang/Class;)Lorg/slf4j/Logger;
       5: putstatic     #65                 // Field log:Lorg/slf4j/Logger;
       8: return
}
