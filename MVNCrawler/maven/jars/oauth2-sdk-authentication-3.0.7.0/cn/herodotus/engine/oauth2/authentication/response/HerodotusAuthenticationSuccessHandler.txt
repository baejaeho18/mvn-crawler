Compiled from "HerodotusAuthenticationSuccessHandler.java"
public class cn.herodotus.engine.oauth2.authentication.response.HerodotusAuthenticationSuccessHandler implements org.springframework.security.web.authentication.AuthenticationSuccessHandler {
  private static final org.slf4j.Logger log;

  private final org.springframework.http.converter.HttpMessageConverter<org.springframework.security.oauth2.core.endpoint.OAuth2AccessTokenResponse> accessTokenHttpResponseConverter;

  private final cn.herodotus.engine.rest.protect.crypto.processor.HttpCryptoProcessor httpCryptoProcessor;

  public cn.herodotus.engine.oauth2.authentication.response.HerodotusAuthenticationSuccessHandler(cn.herodotus.engine.rest.protect.crypto.processor.HttpCryptoProcessor);
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object."<init>":()V
       4: aload_0
       5: new           #7                  // class org/springframework/security/oauth2/core/http/converter/OAuth2AccessTokenResponseHttpMessageConverter
       8: dup
       9: invokespecial #9                  // Method org/springframework/security/oauth2/core/http/converter/OAuth2AccessTokenResponseHttpMessageConverter."<init>":()V
      12: putfield      #10                 // Field accessTokenHttpResponseConverter:Lorg/springframework/http/converter/HttpMessageConverter;
      15: aload_0
      16: aload_1
      17: putfield      #16                 // Field httpCryptoProcessor:Lcn/herodotus/engine/rest/protect/crypto/processor/HttpCryptoProcessor;
      20: return

  public void onAuthenticationSuccess(jakarta.servlet.http.HttpServletRequest, jakarta.servlet.http.HttpServletResponse, org.springframework.security.core.Authentication) throws java.io.IOException, jakarta.servlet.ServletException;
    Code:
       0: getstatic     #20                 // Field log:Lorg/slf4j/Logger;
       3: ldc           #24                 // String [Herodotus] |- OAuth2 authentication success for [{}]
       5: aload_1
       6: invokeinterface #26,  1           // InterfaceMethod jakarta/servlet/http/HttpServletRequest.getRequestURI:()Ljava/lang/String;
      11: invokeinterface #32,  3           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;Ljava/lang/Object;)V
      16: aload_3
      17: checkcast     #38                 // class org/springframework/security/oauth2/server/authorization/authentication/OAuth2AccessTokenAuthenticationToken
      20: astore        4
      22: aload         4
      24: invokevirtual #40                 // Method org/springframework/security/oauth2/server/authorization/authentication/OAuth2AccessTokenAuthenticationToken.getAccessToken:()Lorg/springframework/security/oauth2/core/OAuth2AccessToken;
      27: astore        5
      29: aload         4
      31: invokevirtual #44                 // Method org/springframework/security/oauth2/server/authorization/authentication/OAuth2AccessTokenAuthenticationToken.getRefreshToken:()Lorg/springframework/security/oauth2/core/OAuth2RefreshToken;
      34: astore        6
      36: aload         4
      38: invokevirtual #48                 // Method org/springframework/security/oauth2/server/authorization/authentication/OAuth2AccessTokenAuthenticationToken.getAdditionalParameters:()Ljava/util/Map;
      41: astore        7
      43: aload         5
      45: invokevirtual #52                 // Method org/springframework/security/oauth2/core/OAuth2AccessToken.getTokenValue:()Ljava/lang/String;
      48: invokestatic  #57                 // Method org/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse.withToken:(Ljava/lang/String;)Lorg/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder;
      51: aload         5
      53: invokevirtual #63                 // Method org/springframework/security/oauth2/core/OAuth2AccessToken.getTokenType:()Lorg/springframework/security/oauth2/core/OAuth2AccessToken$TokenType;
      56: invokevirtual #67                 // Method org/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder.tokenType:(Lorg/springframework/security/oauth2/core/OAuth2AccessToken$TokenType;)Lorg/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder;
      59: aload         5
      61: invokevirtual #73                 // Method org/springframework/security/oauth2/core/OAuth2AccessToken.getScopes:()Ljava/util/Set;
      64: invokevirtual #77                 // Method org/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder.scopes:(Ljava/util/Set;)Lorg/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder;
      67: astore        8
      69: aload         5
      71: invokevirtual #81                 // Method org/springframework/security/oauth2/core/OAuth2AccessToken.getIssuedAt:()Ljava/time/Instant;
      74: ifnull        107
      77: aload         5
      79: invokevirtual #85                 // Method org/springframework/security/oauth2/core/OAuth2AccessToken.getExpiresAt:()Ljava/time/Instant;
      82: ifnull        107
      85: aload         8
      87: getstatic     #88                 // Field java/time/temporal/ChronoUnit.SECONDS:Ljava/time/temporal/ChronoUnit;
      90: aload         5
      92: invokevirtual #81                 // Method org/springframework/security/oauth2/core/OAuth2AccessToken.getIssuedAt:()Ljava/time/Instant;
      95: aload         5
      97: invokevirtual #85                 // Method org/springframework/security/oauth2/core/OAuth2AccessToken.getExpiresAt:()Ljava/time/Instant;
     100: invokevirtual #94                 // Method java/time/temporal/ChronoUnit.between:(Ljava/time/temporal/Temporal;Ljava/time/temporal/Temporal;)J
     103: invokevirtual #98                 // Method org/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder.expiresIn:(J)Lorg/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder;
     106: pop
     107: aload         6
     109: ifnull        123
     112: aload         8
     114: aload         6
     116: invokevirtual #102                // Method org/springframework/security/oauth2/core/OAuth2RefreshToken.getTokenValue:()Ljava/lang/String;
     119: invokevirtual #105                // Method org/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder.refreshToken:(Ljava/lang/String;)Lorg/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder;
     122: pop
     123: aload_0
     124: aload         7
     126: invokevirtual #108                // Method isOidcUserInfoPattern:(Ljava/util/Map;)Z
     129: ifeq          143
     132: aload         8
     134: aload         7
     136: invokevirtual #112                // Method org/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder.additionalParameters:(Ljava/util/Map;)Lorg/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder;
     139: pop
     140: goto          243
     143: aload_1
     144: ldc           #118                // String X-Herodotus-Session
     146: invokeinterface #120,  2          // InterfaceMethod jakarta/servlet/http/HttpServletRequest.getHeader:(Ljava/lang/String;)Ljava/lang/String;
     151: astore        9
     153: aload_3
     154: invokeinterface #124,  1          // InterfaceMethod org/springframework/security/core/Authentication.getDetails:()Ljava/lang/Object;
     159: astore        10
     161: aload_0
     162: aload         9
     164: aload         10
     166: invokevirtual #130                // Method isHerodotusUserInfoPattern:(Ljava/lang/String;Ljava/lang/Object;)Z
     169: ifeq          233
     172: aload         10
     174: checkcast     #134                // class cn/herodotus/engine/assistant/core/domain/PrincipalDetails
     177: astore        11
     179: aload         11
     181: invokestatic  #136                // Method cn/herodotus/engine/assistant/core/json/jackson2/utils/Jackson2Utils.toJson:(Ljava/lang/Object;)Ljava/lang/String;
     184: astore        12
     186: aload_0
     187: getfield      #16                 // Field httpCryptoProcessor:Lcn/herodotus/engine/rest/protect/crypto/processor/HttpCryptoProcessor;
     190: aload         9
     192: aload         12
     194: invokevirtual #142                // Method cn/herodotus/engine/rest/protect/crypto/processor/HttpCryptoProcessor.encrypt:(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
     197: astore        13
     199: new           #148                // class java/util/HashMap
     202: dup
     203: aload         7
     205: invokespecial #150                // Method java/util/HashMap."<init>":(Ljava/util/Map;)V
     208: astore        14
     210: aload         14
     212: ldc           #155                // String openid
     214: aload         13
     216: invokeinterface #157,  3          // InterfaceMethod java/util/Map.put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
     221: pop
     222: aload         8
     224: aload         14
     226: invokevirtual #112                // Method org/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder.additionalParameters:(Ljava/util/Map;)Lorg/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder;
     229: pop
     230: goto          243
     233: getstatic     #20                 // Field log:Lorg/slf4j/Logger;
     236: ldc           #163                // String [Herodotus] |- OAuth2 authentication can not get use info.
     238: invokeinterface #165,  2          // InterfaceMethod org/slf4j/Logger.warn:(Ljava/lang/String;)V
     243: aload         8
     245: invokevirtual #169                // Method org/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse$Builder.build:()Lorg/springframework/security/oauth2/core/endpoint/OAuth2AccessTokenResponse;
     248: astore        9
     250: new           #173                // class org/springframework/http/server/ServletServerHttpResponse
     253: dup
     254: aload_2
     255: invokespecial #175                // Method org/springframework/http/server/ServletServerHttpResponse."<init>":(Ljakarta/servlet/http/HttpServletResponse;)V
     258: astore        10
     260: aload_0
     261: getfield      #10                 // Field accessTokenHttpResponseConverter:Lorg/springframework/http/converter/HttpMessageConverter;
     264: aload         9
     266: aconst_null
     267: aload         10
     269: invokeinterface #178,  4          // InterfaceMethod org/springframework/http/converter/HttpMessageConverter.write:(Ljava/lang/Object;Lorg/springframework/http/MediaType;Lorg/springframework/http/HttpOutputMessage;)V
     274: return

  private boolean isHerodotusUserInfoPattern(java.lang.String, java.lang.Object);
    Code:
       0: aload_1
       1: invokestatic  #184                // Method org/apache/commons/lang3/StringUtils.isNotBlank:(Ljava/lang/CharSequence;)Z
       4: ifeq          25
       7: aload_2
       8: invokestatic  #190                // Method org/apache/commons/lang3/ObjectUtils.isNotEmpty:(Ljava/lang/Object;)Z
      11: ifeq          25
      14: aload_2
      15: instanceof    #134                // class cn/herodotus/engine/assistant/core/domain/PrincipalDetails
      18: ifeq          25
      21: iconst_1
      22: goto          26
      25: iconst_0
      26: ireturn

  private boolean isOidcUserInfoPattern(java.util.Map<java.lang.String, java.lang.Object>);
    Code:
       0: aload_1
       1: invokestatic  #196                // Method org/apache/commons/collections4/MapUtils.isNotEmpty:(Ljava/util/Map;)Z
       4: ifeq          22
       7: aload_1
       8: ldc           #202                // String id_token
      10: invokeinterface #204,  2          // InterfaceMethod java/util/Map.containsKey:(Ljava/lang/Object;)Z
      15: ifeq          22
      18: iconst_1
      19: goto          23
      22: iconst_0
      23: ireturn

  static {};
    Code:
       0: ldc           #11                 // class cn/herodotus/engine/oauth2/authentication/response/HerodotusAuthenticationSuccessHandler
       2: invokestatic  #207                // Method org/slf4j/LoggerFactory.getLogger:(Ljava/lang/Class;)Lorg/slf4j/Logger;
       5: putstatic     #20                 // Field log:Lorg/slf4j/Logger;
       8: return
}
