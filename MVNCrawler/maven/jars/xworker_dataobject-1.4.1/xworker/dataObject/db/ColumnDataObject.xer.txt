^1383060726229
@xworker.dataObject.db.ColumnDataObject
sname
ColumnDataObject
slabel
ColumnDataObject
sdescriptors
xworker.lang.MetaDescriptor3
sextends
xworker.dataObject.java.ListDataObject
smany
true
seditCols
2
sinitialization
false
smodifier
public
sinheritDescription
false
Sdescription
#$@text#$@
<p>只有查询功能，一般用于查询数据库中的列。</p>
<p>查询时可以在附带如下参数。</p>
<div id="content">
<ul>
    <li>catalog</li>
    <li>schemaPattern</li>
    <li>tableNamePattern</li>
    <li>columnNamePattern</li>
</ul>
</div>
<p>&nbsp;</p>
#$@text#$@
sth_createIndex
false
@xworker.dataObject.db.ColumnDataObject/@actions1
sname
actions
sdescriptors
xworker.dataObject.db.DbDataObject/@actions1
sth_createIndex
false
@xworker.dataObject.db.ColumnDataObject/@actions1/@query
sname
doQuery
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Global
sdisableGlobalContext
false
Scode
#$@text#$@
import xworker.dataObject.DataObject;

import ognl.Ognl;

//获取全部的表
def datas = [];
def metadata = con.getMetaData();
def catalog = getConditionData(actionContext, "catalog");
def schemaPattern = getConditionData(actionContext, "schemaPattern");
def tableNamePattern = getConditionData(actionContext, "tableNamePattern");
def columnNamePattern = getConditionData(actionContext, "columnNamePattern");
def rs = metadata.getColumns(catalog, schemaPattern, tableNamePattern, columnNamePattern);
try{    
    while(rs.next()){
        def data = [:];
        data.put("TABLE_CAT", getData(rs, "TABLE_CAT"));
        data.put("TABLE_SCHEM", getData(rs, "TABLE_SCHEM"));
        data.put("TABLE_NAME", getData(rs, "TABLE_NAME"));        
        data.put("COLUMN_NAME", getData(rs, "COLUMN_NAME"));
        data.put("DATA_TYPE", getData(rs, "DATA_TYPE"));
        data.put("TYPE_NAME", getData(rs, "TYPE_NAME"));
        data.put("COLUMN_SIZE", getData(rs, "COLUMN_SIZE"));
        data.put("DECIMAL_DIGITS", getData(rs, "DECIMAL_DIGITS"));
        data.put("NUM_PREC_RADIX", getData(rs, "NUM_PREC_RADIX"));
        data.put("NULLABLE", getData(rs, "NULLABLE"));
        data.put("REMARKS", getData(rs, "REMARKS"));
        data.put("CHAR_OCTET_LENGTH", getData(rs, "CHAR_OCTET_LENGTH"));
        data.put("ORDINAL_POSITION", getData(rs, "ORDINAL_POSITION"));
        data.put("IS_NULLABLE", getData(rs, "IS_NULLABLE"));
        data.put("SCOPE_CATLOG", getData(rs, "SCOPE_CATLOG"));
        data.put("SCOPE_SCHEMA", getData(rs, "SCOPE_SCHEMA"));
        data.put("SCOPE_TABLE", getData(rs, "SCOPE_TABLE"));
        data.put("SOURCE_DATA_TYPE", getData(rs, "SOURCE_DATA_TYPE"));
        data.put("IS_AUTOINCREMENT", getData(rs, "IS_AUTOINCREMENT"));
        datas.add(data);
    }
}finally{
    rs.close();
}

def listDataName = "__datas__";
self.set("listData", listDataName);
self.set("dataClassName", "java.util.HashMap");

try{
    def bindings = actionContext.push(null);
    bindings.put(listDataName, datas);

    //使用ListDataObject的load方法    
    def action = world.getAction("xworker.dataObject.java.ListDataObject/@actions1/@query");
    
    return action.run(actionContext);
}finally{
    actionContext.pop();
}

def getData(rs, name){
    try{
        return rs.getString(name);
    }catch(Exception e){
        return null;
    }
}
def getConditionData(actionContext, name){
    if(actionContext.get("conditionData") == null){
        return null;
    }else{
        try{
            def v = Ognl.getValue(name, conditionData);
            if(v instanceof String && v.trim() == ""){
                return null;
            }else{
                return v;
            }
        }catch(Exception e){
            return null;
        }
    }
}
#$@text#$@
Sdescription
#$@text#$@
<p>额外可以附加以下参数：</p>
<ul>
    <li>catalog</li>
    <li>schemaPattern</li>
    <li>tableNamePattern</li>
    <li>columnNamePattern</li>
</ul>
#$@text#$@
sinitBreakPoint
false
ssuccessBreakPoint
false
sexceptionBreakPoint
false
seditBreakPoint
false
sinterpretationType
Action
screateLocalVarScope
false
ssaveReturn
false
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
sth_createIndex
false
@xworker.dataObject.db.ColumnDataObject/@actions1/@query/@contexts
sname
contexts
sid
contexts
slabel
contexts
sdescriptors
xworker.lang.actions.Inout/@contexts
@xworker.dataObject.db.ColumnDataObject/@actions1/@query/@contexts/@dataSource
sname
dataSource
sconnectionName
con
stransaction
false
sdataSourcePath
self.dataSource
sconflicting
ignore
sdisable
false
sonError
ignore
spreventError
false
sinherit
true
sid
dataSource
sdescriptors
xworker.db.jdbc.DataSouceActionContext,xworker.lang.actions.Inout/@contexts/@context
@xworker.dataObject.db.ColumnDataObject/@actions1/@isMappingAble
sname
isMappingAble
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
scode
return true;
Sdescription
#$@text#$@
<p>返回属性是否可以映射，比如数据库数据对象、CSV数据对象和Excel等数据对象的属性适合表字段、CSV或Excel的列映射的。</p>
<p>如果不能映射，直接抛出有说明文字的异常。</p>
<p>映射用于快速编辑属性。</p>
#$@text#$@
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
sth_createIndex
false
@xworker.dataObject.db.ColumnDataObject/@actions1/@isMappingAble/@contexts
sname
contexts
sid
contexts
slabel
contexts
sdescriptors
xworker.lang.actions.Inout/@contexts
@xworker.dataObject.db.ColumnDataObject/@actions1/@isMappingAble/@contexts/@dataSource
sname
dataSource
sconnectionName
con
stransaction
false
sdataSourcePath
self.dataSource
sconflicting
ignore
sdisable
false
sonError
ignore
spreventError
false
sinherit
true
sid
dataSource
sdescriptors
xworker.db.jdbc.DataSouceActionContext,xworker.lang.actions.Inout/@contexts/@context
@xworker.dataObject.db.ColumnDataObject/@actions1/@getMappingFields
sname
getMappingFields
sisSynchronized
false
sthrowException
true
suseOtherAction
false
svarScope
Local
sdisableGlobalContext
false
Scode
#$@text#$@
def fields = [
    ["colName":"TABLE_CAT", "colTitle":"表类别"],
    ["colName":"TABLE_SCHEM", "colTitle":"表模式"],
    ["colName":"TABLE_NAME", "colTitle":"表名称"],
    ["colName":"COLUMN_NAME", "colTitle":"列名称"],
    ["colName":"DATA_TYPE", "colTitle":"数据类型"],
    ["colName":"TYPE_NAME", "colTitle":"类型名称"],
    ["colName":"COLUMN_SIZE", "colTitle":"列的大小"],
    ["colName":"DECIMAL_DIGITS", "colTitle":"小数位数"],
    ["colName":"NUM_PREC_RADIX", "colTitle":"基数"],
    ["colName":"NULLABLE", "colTitle":"是否允许使用 NULL"],
    ["colName":"REMARKS", "colTitle":"注释"],
    ["colName":"COLUMN_DEF", "colTitle":"默认值"],
    ["colName":"CHAR_OCTET_LENGTH", "colTitle":"Char最大字节数"],
    ["colName":"ORDINAL_POSITION", "colTitle":"表中的列的索引"],
    ["colName":"IS_NULLABLE", "colTitle":"ISO 规则用于确定列是否包括 null"],
    ["colName":"SCOPE_CATLOG", "colTitle":"作用域类别"],
    ["colName":"SCOPE_SCHEMA", "colTitle":"作用域模式称"],
    ["colName":"SCOPE_TABLE", "colTitle":"作用域表名称"],
    ["colName":"SOURCE_DATA_TYPE", "colTitle":"不同类型或用户生成 Ref 类型"],
    ["colName":"IS_AUTOINCREMENT", "colTitle":"是否自动增加"],
    ["colName":"catalog", "colTitle":"查询catalog"],
    ["colName":"schemaPattern", "colTitle":"查询schemaPattern"],
    ["colName":"tableNamePattern", "colTitle":"查询tableNamePattern"],
    ["colName":"columnNamePattern", "colTitle":"查询columnNamePattern"]
];

return fields;
#$@text#$@
sdescriptors
xworker.lang.actions.Actions/@GroovyAction
sth_createIndex
false
@xworker.dataObject.db.ColumnDataObject/@name
sname
name
sgroup
DataObject
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
@xworker.dataObject.db.ColumnDataObject/@label
sname
label
sgroup
DataObject
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
true
LallowDecimals
true
LallowNegative
true
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
sth_createIndex
false
@xworker.dataObject.db.ColumnDataObject/@dbConfigPath
sname
dataSource
slabel
数据源
sinputtype
openWindow
ssize
60
scolspan
2
sgroup
DataObject
sinputattrs
xworker.swt.xworker.attributeEditor.openWins.SelectThingOpenWindow/@shell|descriptor=xworkerdbjdbc.DataSource,returnType=path
sreadOnly
false
sinheritDescription
false
svalidateAllowBlank
true
LvalidateOnBlur
false
LallowDecimals
false
LallowNegative
false
sid
dbConfigPath
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
@xworker.dataObject.db.ColumnDataObject/@listData
sname
listData
sinputtype
text
sshowLabel
true
ssize
60
scolspan
2
sgroup
DataObject
sreadOnly
false
sdefault
__datas__
sinheritDescription
false
sdescription
<p>Ognl表达式，从actionContext获取List。</p>
svalidateAllowBlank
true
LvalidateOnBlur
false
LallowDecimals
false
LallowNegative
false
sid
listData
sdescriptors
xworker.lang.MetaDescriptor3/@attribute
