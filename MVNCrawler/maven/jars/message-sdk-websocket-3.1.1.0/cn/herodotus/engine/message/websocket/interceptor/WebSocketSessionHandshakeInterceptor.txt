Compiled from "WebSocketSessionHandshakeInterceptor.java"
public class cn.herodotus.engine.message.websocket.interceptor.WebSocketSessionHandshakeInterceptor extends org.springframework.web.socket.server.support.HttpSessionHandshakeInterceptor {
  private static final org.slf4j.Logger log;

  private static final java.lang.String SEC_WEBSOCKET_PROTOCOL;

  private final cn.herodotus.engine.assistant.core.definition.BearerTokenResolver bearerTokenResolver;

  public cn.herodotus.engine.message.websocket.interceptor.WebSocketSessionHandshakeInterceptor(cn.herodotus.engine.assistant.core.definition.BearerTokenResolver);
    Code:
       0: aload_0
       1: invokespecial #3                  // Method org/springframework/web/socket/server/support/HttpSessionHandshakeInterceptor."<init>":()V
       4: aload_0
       5: aload_1
       6: putfield      #9                  // Field bearerTokenResolver:Lcn/herodotus/engine/assistant/core/definition/BearerTokenResolver;
       9: return

  public boolean beforeHandshake(org.springframework.http.server.ServerHttpRequest, org.springframework.http.server.ServerHttpResponse, org.springframework.web.socket.WebSocketHandler, java.util.Map<java.lang.String, java.lang.Object>) throws java.lang.Exception;
    Code:
       0: aload_1
       1: invokestatic  #15                 // Method cn/herodotus/engine/message/websocket/utils/WebSocketUtils.getHttpServletRequest:(Lorg/springframework/http/server/ServerHttpRequest;)Ljakarta/servlet/http/HttpServletRequest;
       4: astore        5
       6: aload         5
       8: invokestatic  #21                 // Method org/apache/commons/lang3/ObjectUtils.isNotEmpty:(Ljava/lang/Object;)Z
      11: ifeq          125
      14: aload         5
      16: ldc           #27                 // String Sec-WebSocket-Protocol
      18: invokeinterface #29,  2           // InterfaceMethod jakarta/servlet/http/HttpServletRequest.getHeader:(Ljava/lang/String;)Ljava/lang/String;
      23: astore        6
      25: aload_0
      26: aload         6
      28: invokevirtual #35                 // Method determineToken:(Ljava/lang/String;)Ljava/lang/String;
      31: astore        7
      33: aload         7
      35: invokestatic  #38                 // Method org/apache/commons/lang3/StringUtils.isNotBlank:(Ljava/lang/CharSequence;)Z
      38: ifeq          125
      41: getstatic     #44                 // Field log:Lorg/slf4j/Logger;
      44: ldc           #48                 // String [Herodotus] |- WebSocket fetch the token is [{}].
      46: aload         7
      48: invokeinterface #50,  3           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;Ljava/lang/Object;)V
      53: aload_0
      54: getfield      #9                  // Field bearerTokenResolver:Lcn/herodotus/engine/assistant/core/definition/BearerTokenResolver;
      57: aload         7
      59: invokeinterface #56,  2           // InterfaceMethod cn/herodotus/engine/assistant/core/definition/BearerTokenResolver.resolve:(Ljava/lang/String;)Lcn/herodotus/engine/assistant/core/domain/PrincipalDetails;
      64: astore        8
      66: aload         8
      68: invokestatic  #21                 // Method org/apache/commons/lang3/ObjectUtils.isNotEmpty:(Ljava/lang/Object;)Z
      71: ifeq          104
      74: aload         4
      76: ldc           #64                 // String principal
      78: aload         8
      80: invokeinterface #66,  3           // InterfaceMethod java/util/Map.put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
      85: pop
      86: aload         4
      88: ldc           #72                 // String HTTP.SESSION.ID
      90: aload         5
      92: invokestatic  #74                 // Method cn/herodotus/engine/rest/core/utils/WebUtils.getSession:(Ljakarta/servlet/http/HttpServletRequest;)Ljakarta/servlet/http/HttpSession;
      95: invokeinterface #66,  3           // InterfaceMethod java/util/Map.put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
     100: pop
     101: goto          125
     104: aload_2
     105: getstatic     #80                 // Field org/springframework/http/HttpStatus.UNAUTHORIZED:Lorg/springframework/http/HttpStatus;
     108: invokeinterface #86,  2           // InterfaceMethod org/springframework/http/server/ServerHttpResponse.setStatusCode:(Lorg/springframework/http/HttpStatusCode;)V
     113: getstatic     #44                 // Field log:Lorg/slf4j/Logger;
     116: ldc           #92                 // String [Herodotus] |- Token is invalid for WebSocket, stop handshake.
     118: invokeinterface #94,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
     123: iconst_0
     124: ireturn
     125: aload_0
     126: aload_1
     127: aload_2
     128: aload_3
     129: aload         4
     131: invokespecial #98                 // Method org/springframework/web/socket/server/support/HttpSessionHandshakeInterceptor.beforeHandshake:(Lorg/springframework/http/server/ServerHttpRequest;Lorg/springframework/http/server/ServerHttpResponse;Lorg/springframework/web/socket/WebSocketHandler;Ljava/util/Map;)Z
     134: ireturn

  private java.lang.String determineToken(java.lang.String);
    Code:
       0: aload_1
       1: ldc           #104                // String ,
       3: invokestatic  #106                // Method org/apache/commons/lang3/StringUtils.contains:(Ljava/lang/CharSequence;Ljava/lang/CharSequence;)Z
       6: ifeq          57
       9: aload_1
      10: ldc           #104                // String ,
      12: invokestatic  #110                // Method org/apache/commons/lang3/StringUtils.split:(Ljava/lang/String;Ljava/lang/String;)[Ljava/lang/String;
      15: astore_2
      16: aload_2
      17: astore_3
      18: aload_3
      19: arraylength
      20: istore        4
      22: iconst_0
      23: istore        5
      25: iload         5
      27: iload         4
      29: if_icmpge     57
      32: aload_3
      33: iload         5
      35: aaload
      36: astore        6
      38: aload         6
      40: ldc           #114                // String .stomp
      42: invokestatic  #116                // Method org/apache/commons/lang3/StringUtils.endsWith:(Ljava/lang/CharSequence;Ljava/lang/CharSequence;)Z
      45: ifne          51
      48: aload         6
      50: areturn
      51: iinc          5, 1
      54: goto          25
      57: aconst_null
      58: areturn

  public void afterHandshake(org.springframework.http.server.ServerHttpRequest, org.springframework.http.server.ServerHttpResponse, org.springframework.web.socket.WebSocketHandler, java.lang.Exception);
    Code:
       0: aload_1
       1: invokestatic  #15                 // Method cn/herodotus/engine/message/websocket/utils/WebSocketUtils.getHttpServletRequest:(Lorg/springframework/http/server/ServerHttpRequest;)Ljakarta/servlet/http/HttpServletRequest;
       4: astore        5
       6: aload_2
       7: invokestatic  #119                // Method cn/herodotus/engine/message/websocket/utils/WebSocketUtils.getHttpServletResponse:(Lorg/springframework/http/server/ServerHttpResponse;)Ljakarta/servlet/http/HttpServletResponse;
      10: astore        6
      12: aload         5
      14: invokestatic  #21                 // Method org/apache/commons/lang3/ObjectUtils.isNotEmpty:(Ljava/lang/Object;)Z
      17: ifeq          39
      20: aload         6
      22: invokestatic  #21                 // Method org/apache/commons/lang3/ObjectUtils.isNotEmpty:(Ljava/lang/Object;)Z
      25: ifeq          39
      28: aload         6
      30: ldc           #27                 // String Sec-WebSocket-Protocol
      32: ldc           #123                // String v10.stomp
      34: invokeinterface #125,  3          // InterfaceMethod jakarta/servlet/http/HttpServletResponse.setHeader:(Ljava/lang/String;Ljava/lang/String;)V
      39: getstatic     #44                 // Field log:Lorg/slf4j/Logger;
      42: ldc           #131                // String [Herodotus] |- WebSocket handshake success!
      44: invokeinterface #94,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
      49: return

  static {};
    Code:
       0: ldc           #10                 // class cn/herodotus/engine/message/websocket/interceptor/WebSocketSessionHandshakeInterceptor
       2: invokestatic  #133                // Method org/slf4j/LoggerFactory.getLogger:(Ljava/lang/Class;)Lorg/slf4j/Logger;
       5: putstatic     #44                 // Field log:Lorg/slf4j/Logger;
       8: return
}
