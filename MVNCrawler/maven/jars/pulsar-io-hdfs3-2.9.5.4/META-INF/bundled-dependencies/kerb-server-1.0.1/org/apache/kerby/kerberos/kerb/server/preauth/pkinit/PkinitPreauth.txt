Compiled from "PkinitPreauth.java"
public class org.apache.kerby.kerberos.kerb.server.preauth.pkinit.PkinitPreauth extends org.apache.kerby.kerberos.kerb.server.preauth.AbstractPreauthPlugin {
  private static final org.slf4j.Logger LOG;

  private final java.util.Map<java.lang.String, org.apache.kerby.kerberos.kerb.server.preauth.pkinit.PkinitKdcContext> pkinitContexts;

  public org.apache.kerby.kerberos.kerb.server.preauth.pkinit.PkinitPreauth();
    Code:
       0: aload_0
       1: new           #1                  // class org/apache/kerby/kerberos/kerb/preauth/pkinit/PkinitPreauthMeta
       4: dup
       5: invokespecial #2                  // Method org/apache/kerby/kerberos/kerb/preauth/pkinit/PkinitPreauthMeta."<init>":()V
       8: invokespecial #3                  // Method org/apache/kerby/kerberos/kerb/server/preauth/AbstractPreauthPlugin."<init>":(Lorg/apache/kerby/kerberos/kerb/preauth/PreauthPluginMeta;)V
      11: aload_0
      12: new           #4                  // class java/util/HashMap
      15: dup
      16: iconst_1
      17: invokespecial #5                  // Method java/util/HashMap."<init>":(I)V
      20: putfield      #6                  // Field pkinitContexts:Ljava/util/Map;
      23: return

  public void initWith(org.apache.kerby.kerberos.kerb.server.KdcContext);
    Code:
       0: aload_0
       1: aload_1
       2: invokespecial #7                  // Method org/apache/kerby/kerberos/kerb/server/preauth/AbstractPreauthPlugin.initWith:(Lorg/apache/kerby/kerberos/kerb/server/KdcContext;)V
       5: new           #8                  // class org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitKdcContext
       8: dup
       9: invokespecial #9                  // Method org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitKdcContext."<init>":()V
      12: astore_2
      13: aload_2
      14: aload_1
      15: invokevirtual #10                 // Method org/apache/kerby/kerberos/kerb/server/KdcContext.getKdcRealm:()Ljava/lang/String;
      18: putfield      #11                 // Field org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitKdcContext.realm:Ljava/lang/String;
      21: aload_1
      22: invokevirtual #12                 // Method org/apache/kerby/kerberos/kerb/server/KdcContext.getConfig:()Lorg/apache/kerby/kerberos/kerb/server/KdcConfig;
      25: invokevirtual #13                 // Method org/apache/kerby/kerberos/kerb/server/KdcConfig.getPkinitIdentity:()Ljava/lang/String;
      28: astore_3
      29: aload_2
      30: getfield      #14                 // Field org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitKdcContext.identityOpts:Lorg/apache/kerby/kerberos/kerb/preauth/pkinit/IdentityOpts;
      33: aload_3
      34: putfield      #15                 // Field org/apache/kerby/kerberos/kerb/preauth/pkinit/IdentityOpts.identity:Ljava/lang/String;
      37: aload_0
      38: getfield      #6                  // Field pkinitContexts:Ljava/util/Map;
      41: aload_1
      42: invokevirtual #10                 // Method org/apache/kerby/kerberos/kerb/server/KdcContext.getKdcRealm:()Ljava/lang/String;
      45: aload_2
      46: invokeinterface #16,  3           // InterfaceMethod java/util/Map.put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
      51: pop
      52: return

  public org.apache.kerby.kerberos.kerb.preauth.PluginRequestContext initRequestContext(org.apache.kerby.kerberos.kerb.server.request.KdcRequest);
    Code:
       0: new           #17                 // class org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitRequestContext
       3: dup
       4: invokespecial #18                 // Method org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitRequestContext."<init>":()V
       7: astore_2
       8: aload_2
       9: areturn

  public boolean verify(org.apache.kerby.kerberos.kerb.server.request.KdcRequest, org.apache.kerby.kerberos.kerb.preauth.PluginRequestContext, org.apache.kerby.kerberos.kerb.type.pa.PaDataEntry) throws org.apache.kerby.kerberos.kerb.KrbException;
    Code:
       0: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
       3: ldc           #20                 // String pkinit verify padata: entered!
       5: invokeinterface #21,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
      10: aload_2
      11: checkcast     #17                 // class org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitRequestContext
      14: astore        4
      16: aload_1
      17: invokevirtual #22                 // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.getServerEntry:()Lorg/apache/kerby/kerberos/kerb/identity/KrbIdentity;
      20: invokevirtual #23                 // Method org/apache/kerby/kerberos/kerb/identity/KrbIdentity.getPrincipal:()Lorg/apache/kerby/kerberos/kerb/type/base/PrincipalName;
      23: astore        5
      25: aload_1
      26: aload         5
      28: invokevirtual #24                 // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.setServerPrincipal:(Lorg/apache/kerby/kerberos/kerb/type/base/PrincipalName;)V
      31: aload_0
      32: aload         5
      34: invokespecial #25                 // Method findContext:(Lorg/apache/kerby/kerberos/kerb/type/base/PrincipalName;)Lorg/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitKdcContext;
      37: astore        6
      39: aload         6
      41: ifnonnull     46
      44: iconst_0
      45: ireturn
      46: aload         4
      48: aload_3
      49: invokevirtual #26                 // Method org/apache/kerby/kerberos/kerb/type/pa/PaDataEntry.getPaDataType:()Lorg/apache/kerby/kerberos/kerb/type/pa/PaDataType;
      52: putfield      #27                 // Field org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitRequestContext.paType:Lorg/apache/kerby/kerberos/kerb/type/pa/PaDataType;
      55: aload_3
      56: invokevirtual #26                 // Method org/apache/kerby/kerberos/kerb/type/pa/PaDataEntry.getPaDataType:()Lorg/apache/kerby/kerberos/kerb/type/pa/PaDataType;
      59: getstatic     #28                 // Field org/apache/kerby/kerberos/kerb/type/pa/PaDataType.PK_AS_REQ:Lorg/apache/kerby/kerberos/kerb/type/pa/PaDataType;
      62: if_acmpne     911
      65: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
      68: ldc           #29                 // String processing PK_AS_REQ
      70: invokeinterface #21,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
      75: aload_3
      76: invokevirtual #30                 // Method org/apache/kerby/kerberos/kerb/type/pa/PaDataEntry.getPaDataValue:()[B
      79: ldc_w         #31                 // class org/apache/kerby/kerberos/kerb/type/pa/pkinit/PaPkAsReq
      82: invokestatic  #32                 // Method org/apache/kerby/kerberos/kerb/KrbCodec.decode:([BLjava/lang/Class;)Lorg/apache/kerby/asn1/type/Asn1Type;
      85: checkcast     #31                 // class org/apache/kerby/kerberos/kerb/type/pa/pkinit/PaPkAsReq
      88: astore        7
      90: aload         7
      92: invokevirtual #33                 // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/PaPkAsReq.getSignedAuthPack:()[B
      95: astore        8
      97: aconst_null
      98: astore        9
     100: aload_1
     101: invokevirtual #34                 // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.isAnonymous:()Z
     104: ifeq          175
     107: new           #35                 // class org/apache/kerby/cms/type/EncapsulatedContentInfo
     110: dup
     111: invokespecial #36                 // Method org/apache/kerby/cms/type/EncapsulatedContentInfo."<init>":()V
     114: astore        10
     116: aload         10
     118: aload         8
     120: invokevirtual #37                 // Method org/apache/kerby/cms/type/EncapsulatedContentInfo.decode:([B)V
     123: goto          156
     126: astore        11
     128: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     131: new           #39                 // class java/lang/StringBuilder
     134: dup
     135: invokespecial #40                 // Method java/lang/StringBuilder."<init>":()V
     138: ldc           #41                 // String Fail to decode signedAuthPack.
     140: invokevirtual #42                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     143: aload         11
     145: invokevirtual #43                 // Method java/lang/StringBuilder.append:(Ljava/lang/Object;)Ljava/lang/StringBuilder;
     148: invokevirtual #44                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     151: invokeinterface #45,  2           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     156: aload         10
     158: invokevirtual #46                 // Method org/apache/kerby/cms/type/EncapsulatedContentInfo.getContent:()[B
     161: ldc_w         #47                 // class org/apache/kerby/kerberos/kerb/type/pa/pkinit/AuthPack
     164: invokestatic  #32                 // Method org/apache/kerby/kerberos/kerb/KrbCodec.decode:([BLjava/lang/Class;)Lorg/apache/kerby/asn1/type/Asn1Type;
     167: checkcast     #47                 // class org/apache/kerby/kerberos/kerb/type/pa/pkinit/AuthPack
     170: astore        9
     172: goto          341
     175: new           #48                 // class org/apache/kerby/cms/type/ContentInfo
     178: dup
     179: invokespecial #49                 // Method org/apache/kerby/cms/type/ContentInfo."<init>":()V
     182: astore        10
     184: aload         10
     186: aload         8
     188: invokevirtual #50                 // Method org/apache/kerby/cms/type/ContentInfo.decode:([B)V
     191: goto          206
     194: astore        11
     196: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     199: ldc           #51                 // String Fail to decode signedAuthPack
     201: invokeinterface #45,  2           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     206: aload         10
     208: ldc_w         #52                 // class org/apache/kerby/cms/type/SignedData
     211: invokevirtual #53                 // Method org/apache/kerby/cms/type/ContentInfo.getContentAs:(Ljava/lang/Class;)Lorg/apache/kerby/asn1/type/Asn1Type;
     214: checkcast     #52                 // class org/apache/kerby/cms/type/SignedData
     217: astore        11
     219: getstatic     #54                 // Field org/apache/kerby/kerberos/kerb/preauth/pkinit/CmsMessageType.CMS_SIGN_CLIENT:Lorg/apache/kerby/kerberos/kerb/preauth/pkinit/CmsMessageType;
     222: aload         11
     224: invokestatic  #55                 // Method org/apache/kerby/kerberos/kerb/preauth/pkinit/PkinitCrypto.verifyCmsSignedData:(Lorg/apache/kerby/kerberos/kerb/preauth/pkinit/CmsMessageType;Lorg/apache/kerby/cms/type/SignedData;)V
     227: aload         11
     229: invokevirtual #56                 // Method org/apache/kerby/cms/type/SignedData.isSigned:()Z
     232: invokestatic  #57                 // Method java/lang/Boolean.valueOf:(Z)Ljava/lang/Boolean;
     235: astore        12
     237: aload         12
     239: invokevirtual #58                 // Method java/lang/Boolean.booleanValue:()Z
     242: ifeq          258
     245: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     248: ldc           #59                 // String Signed data.
     250: invokeinterface #21,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
     255: goto          322
     258: aload_1
     259: invokevirtual #60                 // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.getClientEntry:()Lorg/apache/kerby/kerberos/kerb/identity/KrbIdentity;
     262: invokevirtual #23                 // Method org/apache/kerby/kerberos/kerb/identity/KrbIdentity.getPrincipal:()Lorg/apache/kerby/kerberos/kerb/type/base/PrincipalName;
     265: astore        13
     267: invokestatic  #61                 // Method org/apache/kerby/kerberos/kerb/common/KrbUtil.makeAnonymousPrincipal:()Lorg/apache/kerby/kerberos/kerb/type/base/PrincipalName;
     270: astore        14
     272: aload_1
     273: invokevirtual #62                 // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.getKdcOptions:()Lorg/apache/kerby/kerberos/kerb/type/kdc/KdcOptions;
     276: getstatic     #63                 // Field org/apache/kerby/kerberos/kerb/type/kdc/KdcOption.REQUEST_ANONYMOUS:Lorg/apache/kerby/kerberos/kerb/type/kdc/KdcOption;
     279: invokevirtual #64                 // Method org/apache/kerby/kerberos/kerb/type/kdc/KdcOptions.isFlagSet:(Lorg/apache/kerby/asn1/EnumType;)Z
     282: ifeq          322
     285: aload         13
     287: aload         14
     289: invokestatic  #65                 // Method org/apache/kerby/kerberos/kerb/common/KrbUtil.pricipalCompareIgnoreRealm:(Lorg/apache/kerby/kerberos/kerb/type/base/PrincipalName;Lorg/apache/kerby/kerberos/kerb/type/base/PrincipalName;)Z
     292: ifne          322
     295: ldc           #66                 // String Pkinit request not signed, but client not anonymous.
     297: astore        15
     299: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     302: aload         15
     304: invokeinterface #45,  2           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     309: new           #67                 // class org/apache/kerby/kerberos/kerb/KrbException
     312: dup
     313: getstatic     #68                 // Field org/apache/kerby/kerberos/kerb/KrbErrorCode.KDC_ERR_PREAUTH_FAILED:Lorg/apache/kerby/kerberos/kerb/KrbErrorCode;
     316: aload         15
     318: invokespecial #69                 // Method org/apache/kerby/kerberos/kerb/KrbException."<init>":(Lorg/apache/kerby/kerberos/kerb/KrbErrorCode;Ljava/lang/String;)V
     321: athrow
     322: aload         11
     324: invokevirtual #70                 // Method org/apache/kerby/cms/type/SignedData.getEncapContentInfo:()Lorg/apache/kerby/cms/type/EncapsulatedContentInfo;
     327: invokevirtual #46                 // Method org/apache/kerby/cms/type/EncapsulatedContentInfo.getContent:()[B
     330: ldc_w         #47                 // class org/apache/kerby/kerberos/kerb/type/pa/pkinit/AuthPack
     333: invokestatic  #32                 // Method org/apache/kerby/kerberos/kerb/KrbCodec.decode:([BLjava/lang/Class;)Lorg/apache/kerby/asn1/type/Asn1Type;
     336: checkcast     #47                 // class org/apache/kerby/kerberos/kerb/type/pa/pkinit/AuthPack
     339: astore        9
     341: aload         9
     343: invokevirtual #71                 // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/AuthPack.getPkAuthenticator:()Lorg/apache/kerby/kerberos/kerb/type/pa/pkinit/PkAuthenticator;
     346: astore        10
     348: aload_0
     349: aload_1
     350: aload         10
     352: invokevirtual #72                 // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/PkAuthenticator.getCtime:()Lorg/apache/kerby/kerberos/kerb/type/KerberosTime;
     355: invokespecial #73                 // Method checkClockskew:(Lorg/apache/kerby/kerberos/kerb/server/request/KdcRequest;Lorg/apache/kerby/kerberos/kerb/type/KerberosTime;)Z
     358: pop
     359: aconst_null
     360: astore        11
     362: aload_1
     363: invokevirtual #74                 // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.getReqPackage:()Ljava/nio/ByteBuffer;
     366: ifnonnull     381
     369: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     372: ldc           #75                 // String ReqBodyBytes isn\'t available
     374: invokeinterface #45,  2           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     379: iconst_0
     380: ireturn
     381: aconst_null
     382: astore        12
     384: aload_1
     385: invokevirtual #74                 // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.getReqPackage:()Ljava/nio/ByteBuffer;
     388: invokestatic  #76                 // Method org/apache/kerby/asn1/Asn1.parse:(Ljava/nio/ByteBuffer;)Lorg/apache/kerby/asn1/parse/Asn1ParseResult;
     391: astore        12
     393: goto          426
     396: astore        13
     398: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     401: new           #39                 // class java/lang/StringBuilder
     404: dup
     405: invokespecial #40                 // Method java/lang/StringBuilder."<init>":()V
     408: ldc           #77                 // String Fail to parse reqPackage.
     410: invokevirtual #42                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     413: aload         13
     415: invokevirtual #43                 // Method java/lang/StringBuilder.append:(Ljava/lang/Object;)Ljava/lang/StringBuilder;
     418: invokevirtual #44                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     421: invokeinterface #45,  2           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     426: aload         12
     428: checkcast     #78                 // class org/apache/kerby/asn1/parse/Asn1Container
     431: astore        13
     433: aload         13
     435: invokevirtual #79                 // Method org/apache/kerby/asn1/parse/Asn1Container.getChildren:()Ljava/util/List;
     438: astore        14
     440: aload         14
     442: iconst_0
     443: invokeinterface #80,  2           // InterfaceMethod java/util/List.get:(I)Ljava/lang/Object;
     448: checkcast     #78                 // class org/apache/kerby/asn1/parse/Asn1Container
     451: astore        15
     453: aload         15
     455: invokevirtual #79                 // Method org/apache/kerby/asn1/parse/Asn1Container.getChildren:()Ljava/util/List;
     458: astore        16
     460: aload         16
     462: invokeinterface #81,  1           // InterfaceMethod java/util/List.size:()I
     467: iconst_3
     468: if_icmple     504
     471: aload         16
     473: iconst_3
     474: invokeinterface #80,  2           // InterfaceMethod java/util/List.get:(I)Ljava/lang/Object;
     479: checkcast     #82                 // class org/apache/kerby/asn1/parse/Asn1ParseResult
     482: invokevirtual #83                 // Method org/apache/kerby/asn1/parse/Asn1ParseResult.getBodyBuffer:()Ljava/nio/ByteBuffer;
     485: astore        17
     487: aload         17
     489: invokevirtual #84                 // Method java/nio/ByteBuffer.remaining:()I
     492: newarray       byte
     494: astore        11
     496: aload         17
     498: aload         11
     500: invokevirtual #85                 // Method java/nio/ByteBuffer.get:([B)Ljava/nio/ByteBuffer;
     503: pop
     504: aconst_null
     505: astore        12
     507: getstatic     #86                 // Field org/apache/kerby/kerberos/kerb/type/base/CheckSumType.NIST_SHA:Lorg/apache/kerby/kerberos/kerb/type/base/CheckSumType;
     510: aload         11
     512: invokestatic  #87                 // Method org/apache/kerby/kerberos/kerb/common/CheckSumUtil.makeCheckSum:(Lorg/apache/kerby/kerberos/kerb/type/base/CheckSumType;[B)Lorg/apache/kerby/kerberos/kerb/type/base/CheckSum;
     515: astore        12
     517: goto          537
     520: astore        13
     522: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     525: ldc           #88                 // String Unable to calculate AS REQ checksum.
     527: aload         13
     529: invokevirtual #89                 // Method org/apache/kerby/kerberos/kerb/KrbException.getMessage:()Ljava/lang/String;
     532: invokeinterface #90,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Object;)V
     537: aload         10
     539: invokevirtual #91                 // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/PkAuthenticator.getPaChecksum:()[B
     542: astore        13
     544: aload         12
     546: invokevirtual #92                 // Method org/apache/kerby/kerberos/kerb/type/base/CheckSum.getChecksum:()[B
     549: arraylength
     550: aload         13
     552: arraylength
     553: if_icmpne     569
     556: aload         12
     558: invokevirtual #92                 // Method org/apache/kerby/kerberos/kerb/type/base/CheckSum.getChecksum:()[B
     561: aload         13
     563: invokestatic  #93                 // Method java/util/Arrays.equals:([B[B)Z
     566: ifne          651
     569: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     572: new           #39                 // class java/lang/StringBuilder
     575: dup
     576: invokespecial #40                 // Method java/lang/StringBuilder."<init>":()V
     579: ldc           #94                 // String received checksum length:
     581: invokevirtual #42                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     584: aload         13
     586: arraylength
     587: invokevirtual #95                 // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
     590: ldc           #96                 // String , expected checksum type:
     592: invokevirtual #42                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     595: aload         12
     597: invokevirtual #97                 // Method org/apache/kerby/kerberos/kerb/type/base/CheckSum.getCksumtype:()Lorg/apache/kerby/kerberos/kerb/type/base/CheckSumType;
     600: invokevirtual #43                 // Method java/lang/StringBuilder.append:(Ljava/lang/Object;)Ljava/lang/StringBuilder;
     603: ldc           #98                 // String , expected checksum length:
     605: invokevirtual #42                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     608: aload         12
     610: invokevirtual #99                 // Method org/apache/kerby/kerberos/kerb/type/base/CheckSum.encodingLength:()I
     613: invokevirtual #95                 // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
     616: invokevirtual #44                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     619: invokeinterface #100,  2          // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;)V
     624: ldc           #101                // String Failed to match the checksum.
     626: astore        14
     628: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     631: aload         14
     633: invokeinterface #45,  2           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     638: new           #67                 // class org/apache/kerby/kerberos/kerb/KrbException
     641: dup
     642: getstatic     #102                // Field org/apache/kerby/kerberos/kerb/KrbErrorCode.KDC_ERR_PA_CHECKSUM_MUST_BE_INCLUDED:Lorg/apache/kerby/kerberos/kerb/KrbErrorCode;
     645: aload         14
     647: invokespecial #69                 // Method org/apache/kerby/kerberos/kerb/KrbException."<init>":(Lorg/apache/kerby/kerberos/kerb/KrbErrorCode;Ljava/lang/String;)V
     650: athrow
     651: aload         9
     653: invokevirtual #103                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/AuthPack.getClientPublicValue:()Lorg/apache/kerby/x509/type/SubjectPublicKeyInfo;
     656: astore        14
     658: aload         14
     660: invokevirtual #104                // Method org/apache/kerby/x509/type/SubjectPublicKeyInfo.getSubjectPubKey:()Lorg/apache/kerby/asn1/type/Asn1BitString;
     663: ifnull        869
     666: aload         9
     668: invokevirtual #103                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/AuthPack.getClientPublicValue:()Lorg/apache/kerby/x509/type/SubjectPublicKeyInfo;
     671: invokevirtual #105                // Method org/apache/kerby/x509/type/SubjectPublicKeyInfo.getAlgorithm:()Lorg/apache/kerby/x509/type/AlgorithmIdentifier;
     674: ldc_w         #106                // class org/apache/kerby/x509/type/DhParameter
     677: invokevirtual #107                // Method org/apache/kerby/x509/type/AlgorithmIdentifier.getParametersAs:(Ljava/lang/Class;)Lorg/apache/kerby/asn1/type/Asn1Type;
     680: checkcast     #106                // class org/apache/kerby/x509/type/DhParameter
     683: astore        15
     685: aload         6
     687: getfield      #108                // Field org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitKdcContext.pluginOpts:Lorg/apache/kerby/kerberos/kerb/preauth/pkinit/PluginOpts;
     690: aload         6
     692: getfield      #109                // Field org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitKdcContext.cryptoctx:Lorg/apache/kerby/kerberos/kerb/preauth/pkinit/PkinitPlgCryptoContext;
     695: aload         15
     697: invokestatic  #110                // Method org/apache/kerby/kerberos/kerb/preauth/pkinit/PkinitCrypto.serverCheckDH:(Lorg/apache/kerby/kerberos/kerb/preauth/pkinit/PluginOpts;Lorg/apache/kerby/kerberos/kerb/preauth/pkinit/PkinitPlgCryptoContext;Lorg/apache/kerby/x509/type/DhParameter;)V
     700: aload         14
     702: invokevirtual #104                // Method org/apache/kerby/x509/type/SubjectPublicKeyInfo.getSubjectPubKey:()Lorg/apache/kerby/asn1/type/Asn1BitString;
     705: invokevirtual #111                // Method org/apache/kerby/asn1/type/Asn1BitString.getValue:()Ljava/lang/Object;
     708: checkcast     #112                // class "[B"
     711: astore        16
     713: aload         16
     715: ldc_w         #113                // class org/apache/kerby/asn1/type/Asn1Integer
     718: invokestatic  #32                 // Method org/apache/kerby/kerberos/kerb/KrbCodec.decode:([BLjava/lang/Class;)Lorg/apache/kerby/asn1/type/Asn1Type;
     721: checkcast     #113                // class org/apache/kerby/asn1/type/Asn1Integer
     724: astore        17
     726: aload         17
     728: invokevirtual #114                // Method org/apache/kerby/asn1/type/Asn1Integer.getValue:()Ljava/lang/Object;
     731: checkcast     #115                // class java/math/BigInteger
     734: astore        18
     736: aload         15
     738: invokevirtual #116                // Method org/apache/kerby/x509/type/DhParameter.getP:()Ljava/math/BigInteger;
     741: astore        19
     743: aload         15
     745: invokevirtual #117                // Method org/apache/kerby/x509/type/DhParameter.getG:()Ljava/math/BigInteger;
     748: astore        20
     750: aload         19
     752: aload         20
     754: aload         18
     756: invokestatic  #118                // Method org/apache/kerby/kerberos/kerb/preauth/pkinit/PkinitCrypto.createDHPublicKey:(Ljava/math/BigInteger;Ljava/math/BigInteger;Ljava/math/BigInteger;)Ljavax/crypto/interfaces/DHPublicKey;
     759: astore        21
     761: new           #119                // class org/apache/kerby/kerberos/kerb/crypto/dh/DiffieHellmanServer
     764: dup
     765: invokespecial #120                // Method org/apache/kerby/kerberos/kerb/crypto/dh/DiffieHellmanServer."<init>":()V
     768: astore        22
     770: aconst_null
     771: astore        23
     773: aload         22
     775: aload         21
     777: invokeinterface #121,  1          // InterfaceMethod javax/crypto/interfaces/DHPublicKey.getEncoded:()[B
     782: invokevirtual #122                // Method org/apache/kerby/kerberos/kerb/crypto/dh/DiffieHellmanServer.initAndDoPhase:([B)Ljava/security/PublicKey;
     785: checkcast     #123                // class javax/crypto/interfaces/DHPublicKey
     788: astore        23
     790: goto          807
     793: astore        24
     795: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     798: ldc           #125                // String Fail to create server public key.
     800: aload         24
     802: invokeinterface #126,  3          // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Throwable;)V
     807: aload         22
     809: aconst_null
     810: aconst_null
     811: aload_1
     812: invokevirtual #127                // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.getEncryptionType:()Lorg/apache/kerby/kerberos/kerb/type/base/EncryptionType;
     815: invokevirtual #128                // Method org/apache/kerby/kerberos/kerb/crypto/dh/DiffieHellmanServer.generateKey:([B[BLorg/apache/kerby/kerberos/kerb/type/base/EncryptionType;)Lorg/apache/kerby/kerberos/kerb/type/base/EncryptionKey;
     818: astore        24
     820: aload_1
     821: aload         24
     823: invokevirtual #129                // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.setClientKey:(Lorg/apache/kerby/kerberos/kerb/type/base/EncryptionKey;)V
     826: aload         6
     828: getfield      #14                 // Field org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitKdcContext.identityOpts:Lorg/apache/kerby/kerberos/kerb/preauth/pkinit/IdentityOpts;
     831: getfield      #15                 // Field org/apache/kerby/kerberos/kerb/preauth/pkinit/IdentityOpts.identity:Ljava/lang/String;
     834: astore        25
     836: aload_0
     837: aload         23
     839: aload         25
     841: invokespecial #130                // Method makePaPkAsRep:(Ljavax/crypto/interfaces/DHPublicKey;Ljava/lang/String;)Lorg/apache/kerby/kerberos/kerb/type/pa/pkinit/PaPkAsRep;
     844: astore        26
     846: aload_0
     847: aload         26
     849: invokespecial #131                // Method makeEntry:(Lorg/apache/kerby/kerberos/kerb/type/pa/pkinit/PaPkAsRep;)Lorg/apache/kerby/kerberos/kerb/type/pa/PaDataEntry;
     852: astore        27
     854: aload_1
     855: invokevirtual #132                // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.getPreauthContext:()Lorg/apache/kerby/kerberos/kerb/server/preauth/PreauthContext;
     858: invokevirtual #133                // Method org/apache/kerby/kerberos/kerb/server/preauth/PreauthContext.getOutputPaData:()Lorg/apache/kerby/kerberos/kerb/type/pa/PaData;
     861: aload         27
     863: invokevirtual #134                // Method org/apache/kerby/kerberos/kerb/type/pa/PaData.add:(Lorg/apache/kerby/asn1/type/Asn1Type;)V
     866: goto          911
     869: aload_1
     870: invokevirtual #34                 // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.isAnonymous:()Z
     873: ifne          903
     876: ldc           #135                // String Anonymous pkinit without DH public value not supported.
     878: astore        16
     880: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     883: aload         16
     885: invokeinterface #45,  2           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     890: new           #67                 // class org/apache/kerby/kerberos/kerb/KrbException
     893: dup
     894: getstatic     #68                 // Field org/apache/kerby/kerberos/kerb/KrbErrorCode.KDC_ERR_PREAUTH_FAILED:Lorg/apache/kerby/kerberos/kerb/KrbErrorCode;
     897: aload         16
     899: invokespecial #69                 // Method org/apache/kerby/kerberos/kerb/KrbException."<init>":(Lorg/apache/kerby/kerberos/kerb/KrbErrorCode;Ljava/lang/String;)V
     902: athrow
     903: getstatic     #136                // Field java/lang/System.out:Ljava/io/PrintStream;
     906: ldc           #137                // String rsa
     908: invokevirtual #138                // Method java/io/PrintStream.println:(Ljava/lang/String;)V
     911: iconst_1
     912: ireturn
    Exception table:
       from    to  target type
         116   123   126   Class java/io/IOException
         184   191   194   Class java/io/IOException
         384   393   396   Class java/io/IOException
         507   517   520   Class org/apache/kerby/kerberos/kerb/KrbException
         773   790   793   Class java/lang/Exception

  private org.apache.kerby.kerberos.kerb.server.preauth.pkinit.PkinitKdcContext findContext(org.apache.kerby.kerberos.kerb.type.base.PrincipalName);
    Code:
       0: aload_1
       1: invokevirtual #139                // Method org/apache/kerby/kerberos/kerb/type/base/PrincipalName.getRealm:()Ljava/lang/String;
       4: astore_2
       5: aload_0
       6: getfield      #6                  // Field pkinitContexts:Ljava/util/Map;
       9: aload_2
      10: invokeinterface #140,  2          // InterfaceMethod java/util/Map.containsKey:(Ljava/lang/Object;)Z
      15: ifeq          32
      18: aload_0
      19: getfield      #6                  // Field pkinitContexts:Ljava/util/Map;
      22: aload_2
      23: invokeinterface #141,  2          // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
      28: checkcast     #8                  // class org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitKdcContext
      31: areturn
      32: aconst_null
      33: areturn

  private org.apache.kerby.kerberos.kerb.type.pa.PaDataEntry makeEntry(org.apache.kerby.kerberos.kerb.type.pa.pkinit.PaPkAsRep) throws org.apache.kerby.kerberos.kerb.KrbException;
    Code:
       0: new           #142                // class org/apache/kerby/kerberos/kerb/type/pa/PaDataEntry
       3: dup
       4: invokespecial #143                // Method org/apache/kerby/kerberos/kerb/type/pa/PaDataEntry."<init>":()V
       7: astore_2
       8: aload_2
       9: getstatic     #144                // Field org/apache/kerby/kerberos/kerb/type/pa/PaDataType.PK_AS_REP:Lorg/apache/kerby/kerberos/kerb/type/pa/PaDataType;
      12: invokevirtual #145                // Method org/apache/kerby/kerberos/kerb/type/pa/PaDataEntry.setPaDataType:(Lorg/apache/kerby/kerberos/kerb/type/pa/PaDataType;)V
      15: aload_2
      16: aload_1
      17: invokevirtual #146                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/PaPkAsRep.encode:()[B
      20: invokevirtual #147                // Method org/apache/kerby/kerberos/kerb/type/pa/PaDataEntry.setPaDataValue:([B)V
      23: goto          54
      26: astore_3
      27: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
      30: new           #39                 // class java/lang/StringBuilder
      33: dup
      34: invokespecial #40                 // Method java/lang/StringBuilder."<init>":()V
      37: ldc           #148                // String Fail to encode PaDataEntry.
      39: invokevirtual #42                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      42: aload_3
      43: invokevirtual #43                 // Method java/lang/StringBuilder.append:(Ljava/lang/Object;)Ljava/lang/StringBuilder;
      46: invokevirtual #44                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      49: invokeinterface #45,  2           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
      54: aload_2
      55: areturn
    Exception table:
       from    to  target type
          15    23    26   Class java/io/IOException

  private org.apache.kerby.kerberos.kerb.type.pa.pkinit.PaPkAsRep makePaPkAsRep(javax.crypto.interfaces.DHPublicKey, java.lang.String) throws org.apache.kerby.kerberos.kerb.KrbException;
    Code:
       0: new           #149                // class java/util/ArrayList
       3: dup
       4: invokespecial #150                // Method java/util/ArrayList."<init>":()V
       7: astore_3
       8: aload_2
       9: ifnull        116
      12: aload_2
      13: ldc           #151                // String ,
      15: invokevirtual #152                // Method java/lang/String.split:(Ljava/lang/String;)[Ljava/lang/String;
      18: invokestatic  #153                // Method java/util/Arrays.asList:([Ljava/lang/Object;)Ljava/util/List;
      21: astore        4
      23: aload         4
      25: invokeinterface #154,  1          // InterfaceMethod java/util/List.iterator:()Ljava/util/Iterator;
      30: astore        5
      32: aload         5
      34: invokeinterface #155,  1          // InterfaceMethod java/util/Iterator.hasNext:()Z
      39: ifeq          113
      42: aload         5
      44: invokeinterface #156,  1          // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      49: checkcast     #157                // class java/lang/String
      52: astore        6
      54: aload         6
      56: invokestatic  #158                // Method org/apache/kerby/kerberos/kerb/preauth/pkinit/CertificateHelper.loadCerts:(Ljava/lang/String;)Ljava/util/List;
      59: astore        7
      61: aload         7
      63: invokeinterface #159,  1          // InterfaceMethod java/util/List.isEmpty:()Z
      68: ifne          93
      71: aload_3
      72: aload         7
      74: invokeinterface #160,  1          // InterfaceMethod java/util/List.iterator:()Ljava/util/Iterator;
      79: invokeinterface #156,  1          // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      84: checkcast     #161                // class java/security/cert/X509Certificate
      87: invokeinterface #162,  2          // InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z
      92: pop
      93: goto          110
      96: astore        7
      98: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     101: ldc           #163                // String Error loading X.509 Certificate
     103: aload         7
     105: invokeinterface #164,  3          // InterfaceMethod org/slf4j/Logger.warn:(Ljava/lang/String;Ljava/lang/Throwable;)V
     110: goto          32
     113: goto          126
     116: getstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
     119: ldc           #165                // String No PKINIT identity keys specified
     121: invokeinterface #166,  2          // InterfaceMethod org/slf4j/Logger.warn:(Ljava/lang/String;)V
     126: new           #167                // class org/apache/kerby/kerberos/kerb/type/pa/pkinit/PaPkAsRep
     129: dup
     130: invokespecial #168                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/PaPkAsRep."<init>":()V
     133: astore        4
     135: new           #169                // class org/apache/kerby/kerberos/kerb/type/pa/pkinit/DhRepInfo
     138: dup
     139: invokespecial #170                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/DhRepInfo."<init>":()V
     142: astore        5
     144: new           #171                // class org/apache/kerby/kerberos/kerb/type/pa/pkinit/KdcDhKeyInfo
     147: dup
     148: invokespecial #172                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/KdcDhKeyInfo."<init>":()V
     151: astore        6
     153: new           #113                // class org/apache/kerby/asn1/type/Asn1Integer
     156: dup
     157: aload_1
     158: invokeinterface #173,  1          // InterfaceMethod javax/crypto/interfaces/DHPublicKey.getY:()Ljava/math/BigInteger;
     163: invokespecial #174                // Method org/apache/kerby/asn1/type/Asn1Integer."<init>":(Ljava/math/BigInteger;)V
     166: astore        7
     168: aload         7
     170: invokestatic  #175                // Method org/apache/kerby/kerberos/kerb/KrbCodec.encode:(Lorg/apache/kerby/asn1/type/Asn1Type;)[B
     173: astore        8
     175: aload         6
     177: aload         8
     179: invokevirtual #176                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/KdcDhKeyInfo.setSubjectPublicKey:([B)V
     182: aload         6
     184: iconst_0
     185: invokevirtual #177                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/KdcDhKeyInfo.setNonce:(I)V
     188: aload         6
     190: new           #178                // class org/apache/kerby/kerberos/kerb/type/KerberosTime
     193: dup
     194: invokestatic  #179                // Method java/lang/System.currentTimeMillis:()J
     197: ldc2_w        #180                // long 86400000l
     200: ladd
     201: invokespecial #182                // Method org/apache/kerby/kerberos/kerb/type/KerberosTime."<init>":(J)V
     204: invokevirtual #183                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/KdcDhKeyInfo.setDHKeyExpiration:(Lorg/apache/kerby/kerberos/kerb/type/KerberosTime;)V
     207: aconst_null
     208: astore        9
     210: new           #184                // class org/apache/kerby/cms/type/CertificateSet
     213: dup
     214: invokespecial #185                // Method org/apache/kerby/cms/type/CertificateSet."<init>":()V
     217: astore        10
     219: aload_3
     220: invokeinterface #154,  1          // InterfaceMethod java/util/List.iterator:()Ljava/util/Iterator;
     225: astore        11
     227: aload         11
     229: invokeinterface #155,  1          // InterfaceMethod java/util/Iterator.hasNext:()Z
     234: ifeq          282
     237: aload         11
     239: invokeinterface #156,  1          // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
     244: checkcast     #161                // class java/security/cert/X509Certificate
     247: astore        12
     249: aload         12
     251: invokestatic  #186                // Method org/apache/kerby/kerberos/kerb/preauth/pkinit/PkinitCrypto.changeToCertificate:(Ljava/security/cert/X509Certificate;)Lorg/apache/kerby/x509/type/Certificate;
     254: astore        13
     256: new           #187                // class org/apache/kerby/cms/type/CertificateChoices
     259: dup
     260: invokespecial #188                // Method org/apache/kerby/cms/type/CertificateChoices."<init>":()V
     263: astore        14
     265: aload         14
     267: aload         13
     269: invokevirtual #189                // Method org/apache/kerby/cms/type/CertificateChoices.setCertificate:(Lorg/apache/kerby/x509/type/Certificate;)V
     272: aload         10
     274: aload         14
     276: invokevirtual #190                // Method org/apache/kerby/cms/type/CertificateSet.addElement:(Lorg/apache/kerby/asn1/type/Asn1Type;)V
     279: goto          227
     282: invokestatic  #191                // Method org/apache/kerby/kerberos/kerb/preauth/pkinit/PkinitPlgCryptoContext.getIdPkinitDHKeyDataOID:()Ljava/lang/String;
     285: astore        11
     287: aload         6
     289: invokestatic  #175                // Method org/apache/kerby/kerberos/kerb/KrbCodec.encode:(Lorg/apache/kerby/asn1/type/Asn1Type;)[B
     292: aload         11
     294: iconst_3
     295: aconst_null
     296: aload         10
     298: aconst_null
     299: aconst_null
     300: invokestatic  #192                // Method org/apache/kerby/kerberos/kerb/preauth/pkinit/PkinitCrypto.cmsSignedDataCreate:([BLjava/lang/String;ILorg/apache/kerby/cms/type/DigestAlgorithmIdentifiers;Lorg/apache/kerby/cms/type/CertificateSet;Lorg/apache/kerby/cms/type/RevocationInfoChoices;Lorg/apache/kerby/cms/type/SignerInfos;)[B
     303: astore        9
     305: aload         5
     307: aload         9
     309: invokevirtual #193                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/DhRepInfo.setDHSignedData:([B)V
     312: aload         4
     314: aload         5
     316: invokevirtual #194                // Method org/apache/kerby/kerberos/kerb/type/pa/pkinit/PaPkAsRep.setDHRepInfo:(Lorg/apache/kerby/kerberos/kerb/type/pa/pkinit/DhRepInfo;)V
     319: aload         4
     321: areturn
    Exception table:
       from    to  target type
          54    93    96   Class org/apache/kerby/kerberos/kerb/KrbException

  private boolean checkClockskew(org.apache.kerby.kerberos.kerb.server.request.KdcRequest, org.apache.kerby.kerberos.kerb.type.KerberosTime) throws org.apache.kerby.kerberos.kerb.KrbException;
    Code:
       0: aload_1
       1: invokevirtual #195                // Method org/apache/kerby/kerberos/kerb/server/request/KdcRequest.getKdcContext:()Lorg/apache/kerby/kerberos/kerb/server/KdcContext;
       4: invokevirtual #12                 // Method org/apache/kerby/kerberos/kerb/server/KdcContext.getConfig:()Lorg/apache/kerby/kerberos/kerb/server/KdcConfig;
       7: invokevirtual #196                // Method org/apache/kerby/kerberos/kerb/server/KdcConfig.getAllowableClockSkew:()J
      10: ldc2_w        #197                // long 1000l
      13: lmul
      14: lstore_3
      15: aload_2
      16: lload_3
      17: invokevirtual #199                // Method org/apache/kerby/kerberos/kerb/type/KerberosTime.isInClockSkew:(J)Z
      20: ifne          34
      23: new           #67                 // class org/apache/kerby/kerberos/kerb/KrbException
      26: dup
      27: getstatic     #68                 // Field org/apache/kerby/kerberos/kerb/KrbErrorCode.KDC_ERR_PREAUTH_FAILED:Lorg/apache/kerby/kerberos/kerb/KrbErrorCode;
      30: invokespecial #200                // Method org/apache/kerby/kerberos/kerb/KrbException."<init>":(Lorg/apache/kerby/kerberos/kerb/KrbErrorCode;)V
      33: athrow
      34: iconst_1
      35: ireturn

  static {};
    Code:
       0: ldc_w         #201                // class org/apache/kerby/kerberos/kerb/server/preauth/pkinit/PkinitPreauth
       3: invokestatic  #202                // Method org/slf4j/LoggerFactory.getLogger:(Ljava/lang/Class;)Lorg/slf4j/Logger;
       6: putstatic     #19                 // Field LOG:Lorg/slf4j/Logger;
       9: return
}
