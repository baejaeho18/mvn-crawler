Compiled from "BrokerDiscoveryProvider.java"
public class org.apache.pulsar.proxy.server.BrokerDiscoveryProvider implements java.io.Closeable {
  final org.apache.pulsar.broker.resources.MetadataStoreCacheLoader metadataStoreCacheLoader;

  final org.apache.pulsar.broker.resources.PulsarResources pulsarResources;

  private final java.util.concurrent.atomic.AtomicInteger counter;

  private final org.apache.bookkeeper.common.util.OrderedScheduler orderedExecutor;

  private final java.util.concurrent.ScheduledExecutorService scheduledExecutorScheduler;

  private static final java.lang.String PARTITIONED_TOPIC_PATH_ZNODE;

  private static final org.slf4j.Logger LOG;

  public org.apache.pulsar.proxy.server.BrokerDiscoveryProvider(org.apache.pulsar.proxy.server.ProxyConfiguration, org.apache.pulsar.broker.resources.PulsarResources) throws org.apache.pulsar.broker.PulsarServerException;
    Code:
       0: aload_0
       1: invokespecial #2                  // Method java/lang/Object."<init>":()V
       4: aload_0
       5: new           #3                  // class java/util/concurrent/atomic/AtomicInteger
       8: dup
       9: invokespecial #4                  // Method java/util/concurrent/atomic/AtomicInteger."<init>":()V
      12: putfield      #5                  // Field counter:Ljava/util/concurrent/atomic/AtomicInteger;
      15: aload_0
      16: invokestatic  #6                  // Method org/apache/bookkeeper/common/util/OrderedScheduler.newSchedulerBuilder:()Lorg/apache/bookkeeper/common/util/OrderedScheduler$SchedulerBuilder;
      19: iconst_4
      20: invokevirtual #7                  // Method org/apache/bookkeeper/common/util/OrderedScheduler$SchedulerBuilder.numThreads:(I)Lorg/apache/bookkeeper/common/util/OrderedExecutor$AbstractBuilder;
      23: ldc           #8                  // String pulsar-proxy-ordered
      25: invokevirtual #9                  // Method org/apache/bookkeeper/common/util/OrderedExecutor$AbstractBuilder.name:(Ljava/lang/String;)Lorg/apache/bookkeeper/common/util/OrderedExecutor$AbstractBuilder;
      28: invokevirtual #10                 // Method org/apache/bookkeeper/common/util/OrderedExecutor$AbstractBuilder.build:()Lorg/apache/bookkeeper/common/util/OrderedExecutor;
      31: checkcast     #11                 // class org/apache/bookkeeper/common/util/OrderedScheduler
      34: putfield      #12                 // Field orderedExecutor:Lorg/apache/bookkeeper/common/util/OrderedScheduler;
      37: aload_0
      38: iconst_4
      39: new           #13                 // class io/netty/util/concurrent/DefaultThreadFactory
      42: dup
      43: ldc           #14                 // String pulsar-proxy-scheduled-executor
      45: invokespecial #15                 // Method io/netty/util/concurrent/DefaultThreadFactory."<init>":(Ljava/lang/String;)V
      48: invokestatic  #16                 // Method java/util/concurrent/Executors.newScheduledThreadPool:(ILjava/util/concurrent/ThreadFactory;)Ljava/util/concurrent/ScheduledExecutorService;
      51: putfield      #17                 // Field scheduledExecutorScheduler:Ljava/util/concurrent/ScheduledExecutorService;
      54: aload_0
      55: aload_2
      56: putfield      #18                 // Field pulsarResources:Lorg/apache/pulsar/broker/resources/PulsarResources;
      59: aload_0
      60: new           #19                 // class org/apache/pulsar/broker/resources/MetadataStoreCacheLoader
      63: dup
      64: aload_2
      65: aload_1
      66: invokevirtual #20                 // Method org/apache/pulsar/proxy/server/ProxyConfiguration.getZookeeperSessionTimeoutMs:()I
      69: invokespecial #21                 // Method org/apache/pulsar/broker/resources/MetadataStoreCacheLoader."<init>":(Lorg/apache/pulsar/broker/resources/PulsarResources;I)V
      72: putfield      #22                 // Field metadataStoreCacheLoader:Lorg/apache/pulsar/broker/resources/MetadataStoreCacheLoader;
      75: goto          125
      78: astore_3
      79: getstatic     #24                 // Field LOG:Lorg/slf4j/Logger;
      82: ldc           #25                 // String Failed to start ZooKeeper {}
      84: aload_3
      85: invokevirtual #26                 // Method java/lang/Exception.getMessage:()Ljava/lang/String;
      88: aload_3
      89: invokeinterface #27,  4           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
      94: new           #28                 // class org/apache/pulsar/broker/PulsarServerException
      97: dup
      98: new           #29                 // class java/lang/StringBuilder
     101: dup
     102: invokespecial #30                 // Method java/lang/StringBuilder."<init>":()V
     105: ldc           #31                 // String Failed to start zookeeper :
     107: invokevirtual #32                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     110: aload_3
     111: invokevirtual #26                 // Method java/lang/Exception.getMessage:()Ljava/lang/String;
     114: invokevirtual #32                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     117: invokevirtual #33                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     120: aload_3
     121: invokespecial #34                 // Method org/apache/pulsar/broker/PulsarServerException."<init>":(Ljava/lang/String;Ljava/lang/Throwable;)V
     124: athrow
     125: return
    Exception table:
       from    to  target type
          54    75    78   Class java/lang/Exception

  org.apache.pulsar.policies.data.loadbalancer.LoadManagerReport nextBroker() throws org.apache.pulsar.broker.PulsarServerException;
    Code:
       0: aload_0
       1: getfield      #22                 // Field metadataStoreCacheLoader:Lorg/apache/pulsar/broker/resources/MetadataStoreCacheLoader;
       4: invokevirtual #35                 // Method org/apache/pulsar/broker/resources/MetadataStoreCacheLoader.getAvailableBrokers:()Ljava/util/List;
       7: astore_1
       8: aload_1
       9: invokeinterface #36,  1           // InterfaceMethod java/util/List.isEmpty:()Z
      14: ifeq          27
      17: new           #28                 // class org/apache/pulsar/broker/PulsarServerException
      20: dup
      21: ldc           #37                 // String No active broker is available
      23: invokespecial #38                 // Method org/apache/pulsar/broker/PulsarServerException."<init>":(Ljava/lang/String;)V
      26: athrow
      27: aload_1
      28: invokeinterface #39,  1           // InterfaceMethod java/util/List.size:()I
      33: istore_2
      34: aload_0
      35: getfield      #5                  // Field counter:Ljava/util/concurrent/atomic/AtomicInteger;
      38: invokevirtual #40                 // Method java/util/concurrent/atomic/AtomicInteger.getAndIncrement:()I
      41: i2l
      42: iload_2
      43: invokestatic  #41                 // Method org/apache/bookkeeper/common/util/MathUtils.signSafeMod:(JI)I
      46: istore_3
      47: aload_1
      48: iload_3
      49: invokeinterface #42,  2           // InterfaceMethod java/util/List.get:(I)Ljava/lang/Object;
      54: checkcast     #43                 // class org/apache/pulsar/policies/data/loadbalancer/LoadManagerReport
      57: areturn

  java.util.concurrent.CompletableFuture<org.apache.pulsar.common.partition.PartitionedTopicMetadata> getPartitionedTopicMetadata(org.apache.pulsar.proxy.server.ProxyService, org.apache.pulsar.common.naming.TopicName, java.lang.String, org.apache.pulsar.broker.authentication.AuthenticationDataSource);
    Code:
       0: new           #44                 // class java/util/concurrent/CompletableFuture
       3: dup
       4: invokespecial #45                 // Method java/util/concurrent/CompletableFuture."<init>":()V
       7: astore        5
       9: aload_1
      10: aload_2
      11: aload_3
      12: aload         4
      14: invokestatic  #46                 // Method checkAuthorization:(Lorg/apache/pulsar/proxy/server/ProxyService;Lorg/apache/pulsar/common/naming/TopicName;Ljava/lang/String;Lorg/apache/pulsar/broker/authentication/AuthenticationDataSource;)V
      17: iconst_4
      18: anewarray     #47                 // class java/lang/String
      21: dup
      22: iconst_0
      23: ldc           #49                 // String partitioned-topics
      25: aastore
      26: dup
      27: iconst_1
      28: aload_2
      29: invokevirtual #50                 // Method org/apache/pulsar/common/naming/TopicName.getNamespaceObject:()Lorg/apache/pulsar/common/naming/NamespaceName;
      32: invokevirtual #51                 // Method org/apache/pulsar/common/naming/NamespaceName.toString:()Ljava/lang/String;
      35: aastore
      36: dup
      37: iconst_2
      38: ldc           #52                 // String persistent
      40: aastore
      41: dup
      42: iconst_3
      43: aload_2
      44: invokevirtual #53                 // Method org/apache/pulsar/common/naming/TopicName.getEncodedLocalName:()Ljava/lang/String;
      47: aastore
      48: invokestatic  #54                 // Method path:([Ljava/lang/String;)Ljava/lang/String;
      51: astore        6
      53: aload_0
      54: getfield      #18                 // Field pulsarResources:Lorg/apache/pulsar/broker/resources/PulsarResources;
      57: invokevirtual #55                 // Method org/apache/pulsar/broker/resources/PulsarResources.getNamespaceResources:()Lorg/apache/pulsar/broker/resources/NamespaceResources;
      60: invokevirtual #56                 // Method org/apache/pulsar/broker/resources/NamespaceResources.getPartitionedTopicResources:()Lorg/apache/pulsar/broker/resources/NamespaceResources$PartitionedTopicResources;
      63: aload         6
      65: invokevirtual #57                 // Method org/apache/pulsar/broker/resources/NamespaceResources$PartitionedTopicResources.getAsync:(Ljava/lang/String;)Ljava/util/concurrent/CompletableFuture;
      68: aload         5
      70: invokedynamic #58,  0             // InvokeDynamic #0:accept:(Ljava/util/concurrent/CompletableFuture;)Ljava/util/function/Consumer;
      75: invokevirtual #59                 // Method java/util/concurrent/CompletableFuture.thenAccept:(Ljava/util/function/Consumer;)Ljava/util/concurrent/CompletableFuture;
      78: aload         5
      80: invokedynamic #60,  0             // InvokeDynamic #1:apply:(Ljava/util/concurrent/CompletableFuture;)Ljava/util/function/Function;
      85: invokevirtual #61                 // Method java/util/concurrent/CompletableFuture.exceptionally:(Ljava/util/function/Function;)Ljava/util/concurrent/CompletableFuture;
      88: pop
      89: goto          102
      92: astore        6
      94: aload         5
      96: aload         6
      98: invokevirtual #62                 // Method java/util/concurrent/CompletableFuture.completeExceptionally:(Ljava/lang/Throwable;)Z
     101: pop
     102: aload         5
     104: areturn
    Exception table:
       from    to  target type
           9    89    92   Class java/lang/Exception

  protected static void checkAuthorization(org.apache.pulsar.proxy.server.ProxyService, org.apache.pulsar.common.naming.TopicName, java.lang.String, org.apache.pulsar.broker.authentication.AuthenticationDataSource) throws java.lang.Exception;
    Code:
       0: aload_0
       1: invokevirtual #63                 // Method org/apache/pulsar/proxy/server/ProxyService.getConfiguration:()Lorg/apache/pulsar/proxy/server/ProxyConfiguration;
       4: invokevirtual #64                 // Method org/apache/pulsar/proxy/server/ProxyConfiguration.isAuthorizationEnabled:()Z
       7: ifeq          26
      10: aload_0
      11: invokevirtual #63                 // Method org/apache/pulsar/proxy/server/ProxyService.getConfiguration:()Lorg/apache/pulsar/proxy/server/ProxyConfiguration;
      14: invokevirtual #65                 // Method org/apache/pulsar/proxy/server/ProxyConfiguration.getSuperUserRoles:()Ljava/util/Set;
      17: aload_2
      18: invokeinterface #66,  2           // InterfaceMethod java/util/Set.contains:(Ljava/lang/Object;)Z
      23: ifeq          27
      26: return
      27: aload_0
      28: invokevirtual #67                 // Method org/apache/pulsar/proxy/server/ProxyService.getAuthorizationService:()Lorg/apache/pulsar/broker/authorization/AuthorizationService;
      31: aload_1
      32: aload_2
      33: aload_3
      34: invokevirtual #68                 // Method org/apache/pulsar/broker/authorization/AuthorizationService.canLookup:(Lorg/apache/pulsar/common/naming/TopicName;Ljava/lang/String;Lorg/apache/pulsar/broker/authentication/AuthenticationDataSource;)Z
      37: ifne          204
      40: getstatic     #24                 // Field LOG:Lorg/slf4j/Logger;
      43: ldc           #69                 // String [{}] Role {} is not allowed to lookup topic
      45: aload_1
      46: aload_2
      47: invokeinterface #70,  4           // InterfaceMethod org/slf4j/Logger.warn:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
      52: aload_0
      53: invokevirtual #71                 // Method org/apache/pulsar/proxy/server/ProxyService.getConfigurationCacheService:()Lorg/apache/pulsar/broker/cache/ConfigurationCacheService;
      56: invokevirtual #72                 // Method org/apache/pulsar/broker/cache/ConfigurationCacheService.propertiesCache:()Lorg/apache/pulsar/zookeeper/ZooKeeperDataCache;
      59: iconst_2
      60: anewarray     #47                 // class java/lang/String
      63: dup
      64: iconst_0
      65: ldc           #73                 // String policies
      67: aastore
      68: dup
      69: iconst_1
      70: aload_1
      71: invokevirtual #74                 // Method org/apache/pulsar/common/naming/TopicName.getTenant:()Ljava/lang/String;
      74: aastore
      75: invokestatic  #54                 // Method path:([Ljava/lang/String;)Ljava/lang/String;
      78: invokevirtual #75                 // Method org/apache/pulsar/zookeeper/ZooKeeperDataCache.get:(Ljava/lang/String;)Ljava/util/Optional;
      81: invokedynamic #76,  0             // InvokeDynamic #2:get:()Ljava/util/function/Supplier;
      86: invokevirtual #77                 // Method java/util/Optional.orElseThrow:(Ljava/util/function/Supplier;)Ljava/lang/Object;
      89: checkcast     #78                 // class org/apache/pulsar/common/policies/data/TenantInfoImpl
      92: astore        4
      94: goto          167
      97: astore        5
      99: getstatic     #24                 // Field LOG:Lorg/slf4j/Logger;
     102: ldc           #80                 // String Failed to get property admin data for non existing property {}
     104: aload_1
     105: invokevirtual #74                 // Method org/apache/pulsar/common/naming/TopicName.getTenant:()Ljava/lang/String;
     108: invokeinterface #81,  3           // InterfaceMethod org/slf4j/Logger.warn:(Ljava/lang/String;Ljava/lang/Object;)V
     113: new           #82                 // class java/lang/IllegalAccessException
     116: dup
     117: ldc           #83                 // String Property does not exist
     119: invokespecial #84                 // Method java/lang/IllegalAccessException."<init>":(Ljava/lang/String;)V
     122: athrow
     123: astore        5
     125: getstatic     #24                 // Field LOG:Lorg/slf4j/Logger;
     128: ldc           #85                 // String Failed to get property admin data for property
     130: invokeinterface #86,  2           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     135: new           #82                 // class java/lang/IllegalAccessException
     138: dup
     139: ldc           #87                 // String Failed to get property %s admin data due to %s
     141: iconst_2
     142: anewarray     #88                 // class java/lang/Object
     145: dup
     146: iconst_0
     147: aload_1
     148: invokevirtual #74                 // Method org/apache/pulsar/common/naming/TopicName.getTenant:()Ljava/lang/String;
     151: aastore
     152: dup
     153: iconst_1
     154: aload         5
     156: invokevirtual #26                 // Method java/lang/Exception.getMessage:()Ljava/lang/String;
     159: aastore
     160: invokestatic  #89                 // Method java/lang/String.format:(Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;
     163: invokespecial #84                 // Method java/lang/IllegalAccessException."<init>":(Ljava/lang/String;)V
     166: athrow
     167: aload_0
     168: invokevirtual #67                 // Method org/apache/pulsar/proxy/server/ProxyService.getAuthorizationService:()Lorg/apache/pulsar/broker/authorization/AuthorizationService;
     171: aload_1
     172: invokevirtual #74                 // Method org/apache/pulsar/common/naming/TopicName.getTenant:()Ljava/lang/String;
     175: aload_2
     176: aload         4
     178: aload_3
     179: invokevirtual #90                 // Method org/apache/pulsar/broker/authorization/AuthorizationService.isTenantAdmin:(Ljava/lang/String;Ljava/lang/String;Lorg/apache/pulsar/common/policies/data/TenantInfo;Lorg/apache/pulsar/broker/authentication/AuthenticationDataSource;)Ljava/util/concurrent/CompletableFuture;
     182: invokevirtual #91                 // Method java/util/concurrent/CompletableFuture.get:()Ljava/lang/Object;
     185: checkcast     #92                 // class java/lang/Boolean
     188: invokevirtual #93                 // Method java/lang/Boolean.booleanValue:()Z
     191: ifne          204
     194: new           #82                 // class java/lang/IllegalAccessException
     197: dup
     198: ldc           #94                 // String Don\'t have permission to administrate resources on this tenant
     200: invokespecial #84                 // Method java/lang/IllegalAccessException."<init>":(Ljava/lang/String;)V
     203: athrow
     204: getstatic     #24                 // Field LOG:Lorg/slf4j/Logger;
     207: invokeinterface #95,  1           // InterfaceMethod org/slf4j/Logger.isDebugEnabled:()Z
     212: ifeq          230
     215: getstatic     #24                 // Field LOG:Lorg/slf4j/Logger;
     218: ldc           #96                 // String Successfully authorized {} on property {}
     220: aload_2
     221: aload_1
     222: invokevirtual #74                 // Method org/apache/pulsar/common/naming/TopicName.getTenant:()Ljava/lang/String;
     225: invokeinterface #97,  4           // InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/Object;)V
     230: return
    Exception table:
       from    to  target type
          52    94    97   Class org/apache/zookeeper/KeeperException$NoNodeException
          52    94   123   Class java/lang/Exception

  public static java.lang.String path(java.lang.String...);
    Code:
       0: new           #29                 // class java/lang/StringBuilder
       3: dup
       4: invokespecial #30                 // Method java/lang/StringBuilder."<init>":()V
       7: astore_1
       8: aload_1
       9: ldc           #98                 // String /admin/
      11: invokevirtual #32                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      14: pop
      15: bipush        47
      17: invokestatic  #99                 // Method com/google/common/base/Joiner.on:(C)Lcom/google/common/base/Joiner;
      20: aload_1
      21: aload_0
      22: invokevirtual #100                // Method com/google/common/base/Joiner.appendTo:(Ljava/lang/StringBuilder;[Ljava/lang/Object;)Ljava/lang/StringBuilder;
      25: pop
      26: aload_1
      27: invokevirtual #33                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      30: areturn

  public void close() throws java.io.IOException;
    Code:
       0: aload_0
       1: getfield      #22                 // Field metadataStoreCacheLoader:Lorg/apache/pulsar/broker/resources/MetadataStoreCacheLoader;
       4: invokevirtual #101                // Method org/apache/pulsar/broker/resources/MetadataStoreCacheLoader.close:()V
       7: aload_0
       8: getfield      #12                 // Field orderedExecutor:Lorg/apache/bookkeeper/common/util/OrderedScheduler;
      11: invokevirtual #102                // Method org/apache/bookkeeper/common/util/OrderedScheduler.shutdown:()V
      14: aload_0
      15: getfield      #17                 // Field scheduledExecutorScheduler:Ljava/util/concurrent/ScheduledExecutorService;
      18: invokeinterface #103,  1          // InterfaceMethod java/util/concurrent/ScheduledExecutorService.shutdownNow:()Ljava/util/List;
      23: pop
      24: return

  private static java.lang.IllegalAccessException lambda$checkAuthorization$2();
    Code:
       0: new           #82                 // class java/lang/IllegalAccessException
       3: dup
       4: ldc           #83                 // String Property does not exist
       6: invokespecial #84                 // Method java/lang/IllegalAccessException."<init>":(Ljava/lang/String;)V
       9: areturn

  private static java.lang.Void lambda$getPartitionedTopicMetadata$1(java.util.concurrent.CompletableFuture, java.lang.Throwable);
    Code:
       0: aload_0
       1: aload_1
       2: invokevirtual #62                 // Method java/util/concurrent/CompletableFuture.completeExceptionally:(Ljava/lang/Throwable;)Z
       5: pop
       6: aconst_null
       7: areturn

  private static void lambda$getPartitionedTopicMetadata$0(java.util.concurrent.CompletableFuture, java.util.Optional);
    Code:
       0: aload_1
       1: invokevirtual #104                // Method java/util/Optional.isPresent:()Z
       4: ifeq          19
       7: aload_0
       8: aload_1
       9: invokevirtual #105                // Method java/util/Optional.get:()Ljava/lang/Object;
      12: invokevirtual #106                // Method java/util/concurrent/CompletableFuture.complete:(Ljava/lang/Object;)Z
      15: pop
      16: goto          31
      19: aload_0
      20: new           #107                // class org/apache/pulsar/common/partition/PartitionedTopicMetadata
      23: dup
      24: invokespecial #108                // Method org/apache/pulsar/common/partition/PartitionedTopicMetadata."<init>":()V
      27: invokevirtual #106                // Method java/util/concurrent/CompletableFuture.complete:(Ljava/lang/Object;)Z
      30: pop
      31: return

  static {};
    Code:
       0: ldc           #48                 // class org/apache/pulsar/proxy/server/BrokerDiscoveryProvider
       2: invokestatic  #109                // Method org/slf4j/LoggerFactory.getLogger:(Ljava/lang/Class;)Lorg/slf4j/Logger;
       5: putstatic     #24                 // Field LOG:Lorg/slf4j/Logger;
       8: return
}
