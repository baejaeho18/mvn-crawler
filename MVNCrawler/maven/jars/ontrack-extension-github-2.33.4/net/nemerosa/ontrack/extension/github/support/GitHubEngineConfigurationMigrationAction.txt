Compiled from "GitHubEngineConfigurationMigrationAction.java"
public class net.nemerosa.ontrack.extension.github.support.GitHubEngineConfigurationMigrationAction implements net.nemerosa.ontrack.model.support.DBMigrationAction {
  public static final int GITHUB_ENGINE_PATCH;

  private final org.slf4j.Logger logger;

  private final com.fasterxml.jackson.databind.ObjectMapper objectMapper;

  public net.nemerosa.ontrack.extension.github.support.GitHubEngineConfigurationMigrationAction();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object."<init>":()V
       4: aload_0
       5: ldc           #2                  // class net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction
       7: invokestatic  #3                  // Method org/slf4j/LoggerFactory.getLogger:(Ljava/lang/Class;)Lorg/slf4j/Logger;
      10: putfield      #4                  // Field logger:Lorg/slf4j/Logger;
      13: aload_0
      14: invokestatic  #5                  // Method net/nemerosa/ontrack/json/ObjectMapperFactory.create:()Lcom/fasterxml/jackson/databind/ObjectMapper;
      17: putfield      #6                  // Field objectMapper:Lcom/fasterxml/jackson/databind/ObjectMapper;
      20: return

  public int getPatch();
    Code:
       0: bipush        18
       2: ireturn

  public void migrate(java.sql.Connection) throws java.lang.Exception;
    Code:
       0: aload_0
       1: aload_1
       2: invokespecial #7                  // Method migrateConfigurations:(Ljava/sql/Connection;)Ljava/util/Map;
       5: astore_2
       6: aload_0
       7: aload_1
       8: aload_2
       9: invokespecial #8                  // Method migrateProjects:(Ljava/sql/Connection;Ljava/util/Map;)V
      12: return

  private void migrateProjects(java.sql.Connection, java.util.Map<java.lang.String, net.nemerosa.ontrack.extension.github.support.GitHubEngineConfigurationMigrationAction$OldConfiguration>) throws java.sql.SQLException, java.io.IOException;
    Code:
       0: aload_1
       1: ldc           #9                  // String SELECT * FROM PROPERTIES WHERE TYPE = ?
       3: sipush        1003
       6: sipush        1008
       9: invokeinterface #11,  4           // InterfaceMethod java/sql/Connection.prepareStatement:(Ljava/lang/String;II)Ljava/sql/PreparedStatement;
      14: astore_3
      15: aconst_null
      16: astore        4
      18: aload_3
      19: iconst_1
      20: ldc           #12                 // class net/nemerosa/ontrack/extension/github/property/GitHubProjectConfigurationPropertyType
      22: invokevirtual #13                 // Method java/lang/Class.getName:()Ljava/lang/String;
      25: invokeinterface #14,  3           // InterfaceMethod java/sql/PreparedStatement.setString:(ILjava/lang/String;)V
      30: aload_3
      31: invokeinterface #15,  1           // InterfaceMethod java/sql/PreparedStatement.executeQuery:()Ljava/sql/ResultSet;
      36: astore        5
      38: aconst_null
      39: astore        6
      41: aload         5
      43: invokeinterface #16,  1           // InterfaceMethod java/sql/ResultSet.next:()Z
      48: ifeq          185
      51: aload         5
      53: ldc           #17                 // String JSON
      55: invokeinterface #18,  2           // InterfaceMethod java/sql/ResultSet.getString:(Ljava/lang/String;)Ljava/lang/String;
      60: astore        7
      62: aload_0
      63: getfield      #6                  // Field objectMapper:Lcom/fasterxml/jackson/databind/ObjectMapper;
      66: aload         7
      68: invokevirtual #19                 // Method com/fasterxml/jackson/databind/ObjectMapper.readTree:(Ljava/lang/String;)Lcom/fasterxml/jackson/databind/JsonNode;
      71: checkcast     #20                 // class com/fasterxml/jackson/databind/node/ObjectNode
      74: astore        8
      76: aload         8
      78: ldc           #21                 // String configuration
      80: invokestatic  #22                 // Method net/nemerosa/ontrack/json/JsonUtils.get:(Lcom/fasterxml/jackson/databind/JsonNode;Ljava/lang/String;)Ljava/lang/String;
      83: astore        9
      85: aload_2
      86: aload         9
      88: invokeinterface #23,  2           // InterfaceMethod java/util/Map.get:(Ljava/lang/Object;)Ljava/lang/Object;
      93: checkcast     #24                 // class net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction$OldConfiguration
      96: astore        10
      98: aload         10
     100: ifnonnull     131
     103: new           #25                 // class java/lang/IllegalStateException
     106: dup
     107: new           #26                 // class java/lang/StringBuilder
     110: dup
     111: invokespecial #27                 // Method java/lang/StringBuilder."<init>":()V
     114: ldc           #28                 // String Could not find GitHub configuration with name
     116: invokevirtual #29                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     119: aload         9
     121: invokevirtual #29                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     124: invokevirtual #30                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     127: invokespecial #31                 // Method java/lang/IllegalStateException."<init>":(Ljava/lang/String;)V
     130: athrow
     131: aload         8
     133: ldc           #32                 // String repository
     135: aload         10
     137: invokevirtual #33                 // Method net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction$OldConfiguration.getRepository:()Ljava/lang/String;
     140: invokevirtual #34                 // Method com/fasterxml/jackson/databind/node/ObjectNode.put:(Ljava/lang/String;Ljava/lang/String;)Lcom/fasterxml/jackson/databind/node/ObjectNode;
     143: pop
     144: aload         8
     146: ldc           #35                 // String indexationInterval
     148: aload         10
     150: invokevirtual #36                 // Method net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction$OldConfiguration.getIndexationInterval:()I
     153: invokevirtual #37                 // Method com/fasterxml/jackson/databind/node/ObjectNode.put:(Ljava/lang/String;I)Lcom/fasterxml/jackson/databind/node/ObjectNode;
     156: pop
     157: aload         5
     159: ldc           #17                 // String JSON
     161: aload_0
     162: getfield      #6                  // Field objectMapper:Lcom/fasterxml/jackson/databind/ObjectMapper;
     165: aload         8
     167: invokevirtual #38                 // Method com/fasterxml/jackson/databind/ObjectMapper.writeValueAsString:(Ljava/lang/Object;)Ljava/lang/String;
     170: invokeinterface #39,  3           // InterfaceMethod java/sql/ResultSet.updateString:(Ljava/lang/String;Ljava/lang/String;)V
     175: aload         5
     177: invokeinterface #40,  1           // InterfaceMethod java/sql/ResultSet.updateRow:()V
     182: goto          41
     185: aload         5
     187: ifnull        280
     190: aload         6
     192: ifnull        217
     195: aload         5
     197: invokeinterface #41,  1           // InterfaceMethod java/sql/ResultSet.close:()V
     202: goto          280
     205: astore        7
     207: aload         6
     209: aload         7
     211: invokevirtual #43                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     214: goto          280
     217: aload         5
     219: invokeinterface #41,  1           // InterfaceMethod java/sql/ResultSet.close:()V
     224: goto          280
     227: astore        7
     229: aload         7
     231: astore        6
     233: aload         7
     235: athrow
     236: astore        11
     238: aload         5
     240: ifnull        277
     243: aload         6
     245: ifnull        270
     248: aload         5
     250: invokeinterface #41,  1           // InterfaceMethod java/sql/ResultSet.close:()V
     255: goto          277
     258: astore        12
     260: aload         6
     262: aload         12
     264: invokevirtual #43                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     267: goto          277
     270: aload         5
     272: invokeinterface #41,  1           // InterfaceMethod java/sql/ResultSet.close:()V
     277: aload         11
     279: athrow
     280: aload_3
     281: ifnull        369
     284: aload         4
     286: ifnull        310
     289: aload_3
     290: invokeinterface #44,  1           // InterfaceMethod java/sql/PreparedStatement.close:()V
     295: goto          369
     298: astore        5
     300: aload         4
     302: aload         5
     304: invokevirtual #43                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     307: goto          369
     310: aload_3
     311: invokeinterface #44,  1           // InterfaceMethod java/sql/PreparedStatement.close:()V
     316: goto          369
     319: astore        5
     321: aload         5
     323: astore        4
     325: aload         5
     327: athrow
     328: astore        13
     330: aload_3
     331: ifnull        366
     334: aload         4
     336: ifnull        360
     339: aload_3
     340: invokeinterface #44,  1           // InterfaceMethod java/sql/PreparedStatement.close:()V
     345: goto          366
     348: astore        14
     350: aload         4
     352: aload         14
     354: invokevirtual #43                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     357: goto          366
     360: aload_3
     361: invokeinterface #44,  1           // InterfaceMethod java/sql/PreparedStatement.close:()V
     366: aload         13
     368: athrow
     369: return
    Exception table:
       from    to  target type
         195   202   205   Class java/lang/Throwable
          41   185   227   Class java/lang/Throwable
          41   185   236   any
         248   255   258   Class java/lang/Throwable
         227   238   236   any
         289   295   298   Class java/lang/Throwable
          18   280   319   Class java/lang/Throwable
          18   280   328   any
         339   345   348   Class java/lang/Throwable
         319   330   328   any

  private java.util.Map<java.lang.String, net.nemerosa.ontrack.extension.github.support.GitHubEngineConfigurationMigrationAction$OldConfiguration> migrateConfigurations(java.sql.Connection) throws java.lang.Exception;
    Code:
       0: new           #45                 // class java/util/HashMap
       3: dup
       4: invokespecial #46                 // Method java/util/HashMap."<init>":()V
       7: astore_2
       8: aload_1
       9: ldc           #47                 // String SELECT * FROM CONFIGURATIONS WHERE TYPE = ?
      11: sipush        1003
      14: sipush        1008
      17: invokeinterface #11,  4           // InterfaceMethod java/sql/Connection.prepareStatement:(Ljava/lang/String;II)Ljava/sql/PreparedStatement;
      22: astore_3
      23: aconst_null
      24: astore        4
      26: aload_3
      27: iconst_1
      28: ldc           #48                 // String net.nemerosa.ontrack.extension.github.model.GitHubConfiguration
      30: invokeinterface #14,  3           // InterfaceMethod java/sql/PreparedStatement.setString:(ILjava/lang/String;)V
      35: aload_3
      36: invokeinterface #15,  1           // InterfaceMethod java/sql/PreparedStatement.executeQuery:()Ljava/sql/ResultSet;
      41: astore        5
      43: aconst_null
      44: astore        6
      46: aload         5
      48: invokeinterface #16,  1           // InterfaceMethod java/sql/ResultSet.next:()Z
      53: ifeq          194
      56: aload         5
      58: ldc           #49                 // String NAME
      60: invokeinterface #18,  2           // InterfaceMethod java/sql/ResultSet.getString:(Ljava/lang/String;)Ljava/lang/String;
      65: astore        7
      67: aload_0
      68: getfield      #4                  // Field logger:Lorg/slf4j/Logger;
      71: ldc           #50                 // String Migrating GitHub configuration: {}
      73: aload         7
      75: invokeinterface #51,  3           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;Ljava/lang/Object;)V
      80: aload         5
      82: ldc           #52                 // String CONTENT
      84: invokeinterface #18,  2           // InterfaceMethod java/sql/ResultSet.getString:(Ljava/lang/String;)Ljava/lang/String;
      89: astore        8
      91: aload_0
      92: getfield      #6                  // Field objectMapper:Lcom/fasterxml/jackson/databind/ObjectMapper;
      95: aload         8
      97: ldc           #24                 // class net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction$OldConfiguration
      99: invokevirtual #53                 // Method com/fasterxml/jackson/databind/ObjectMapper.readValue:(Ljava/lang/String;Ljava/lang/Class;)Ljava/lang/Object;
     102: checkcast     #24                 // class net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction$OldConfiguration
     105: astore        9
     107: new           #54                 // class net/nemerosa/ontrack/extension/github/model/GitHubEngineConfiguration
     110: dup
     111: aload         9
     113: invokevirtual #55                 // Method net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction$OldConfiguration.getName:()Ljava/lang/String;
     116: ldc           #56                 // String https://github.com
     118: aload         9
     120: invokevirtual #57                 // Method net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction$OldConfiguration.getUser:()Ljava/lang/String;
     123: aload         9
     125: invokevirtual #58                 // Method net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction$OldConfiguration.getPassword:()Ljava/lang/String;
     128: aload         9
     130: invokevirtual #59                 // Method net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction$OldConfiguration.getOauth2Token:()Ljava/lang/String;
     133: invokespecial #60                 // Method net/nemerosa/ontrack/extension/github/model/GitHubEngineConfiguration."<init>":(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
     136: astore        10
     138: aload         5
     140: ldc           #61                 // String TYPE
     142: ldc           #54                 // class net/nemerosa/ontrack/extension/github/model/GitHubEngineConfiguration
     144: invokevirtual #13                 // Method java/lang/Class.getName:()Ljava/lang/String;
     147: invokeinterface #39,  3           // InterfaceMethod java/sql/ResultSet.updateString:(Ljava/lang/String;Ljava/lang/String;)V
     152: aload         5
     154: ldc           #52                 // String CONTENT
     156: aload_0
     157: getfield      #6                  // Field objectMapper:Lcom/fasterxml/jackson/databind/ObjectMapper;
     160: aload         10
     162: invokevirtual #38                 // Method com/fasterxml/jackson/databind/ObjectMapper.writeValueAsString:(Ljava/lang/Object;)Ljava/lang/String;
     165: invokeinterface #39,  3           // InterfaceMethod java/sql/ResultSet.updateString:(Ljava/lang/String;Ljava/lang/String;)V
     170: aload         5
     172: invokeinterface #40,  1           // InterfaceMethod java/sql/ResultSet.updateRow:()V
     177: aload_2
     178: aload         9
     180: invokevirtual #55                 // Method net/nemerosa/ontrack/extension/github/support/GitHubEngineConfigurationMigrationAction$OldConfiguration.getName:()Ljava/lang/String;
     183: aload         9
     185: invokeinterface #62,  3           // InterfaceMethod java/util/Map.put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
     190: pop
     191: goto          46
     194: aload         5
     196: ifnull        289
     199: aload         6
     201: ifnull        226
     204: aload         5
     206: invokeinterface #41,  1           // InterfaceMethod java/sql/ResultSet.close:()V
     211: goto          289
     214: astore        7
     216: aload         6
     218: aload         7
     220: invokevirtual #43                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     223: goto          289
     226: aload         5
     228: invokeinterface #41,  1           // InterfaceMethod java/sql/ResultSet.close:()V
     233: goto          289
     236: astore        7
     238: aload         7
     240: astore        6
     242: aload         7
     244: athrow
     245: astore        11
     247: aload         5
     249: ifnull        286
     252: aload         6
     254: ifnull        279
     257: aload         5
     259: invokeinterface #41,  1           // InterfaceMethod java/sql/ResultSet.close:()V
     264: goto          286
     267: astore        12
     269: aload         6
     271: aload         12
     273: invokevirtual #43                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     276: goto          286
     279: aload         5
     281: invokeinterface #41,  1           // InterfaceMethod java/sql/ResultSet.close:()V
     286: aload         11
     288: athrow
     289: aload_3
     290: ifnull        378
     293: aload         4
     295: ifnull        319
     298: aload_3
     299: invokeinterface #44,  1           // InterfaceMethod java/sql/PreparedStatement.close:()V
     304: goto          378
     307: astore        5
     309: aload         4
     311: aload         5
     313: invokevirtual #43                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     316: goto          378
     319: aload_3
     320: invokeinterface #44,  1           // InterfaceMethod java/sql/PreparedStatement.close:()V
     325: goto          378
     328: astore        5
     330: aload         5
     332: astore        4
     334: aload         5
     336: athrow
     337: astore        13
     339: aload_3
     340: ifnull        375
     343: aload         4
     345: ifnull        369
     348: aload_3
     349: invokeinterface #44,  1           // InterfaceMethod java/sql/PreparedStatement.close:()V
     354: goto          375
     357: astore        14
     359: aload         4
     361: aload         14
     363: invokevirtual #43                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     366: goto          375
     369: aload_3
     370: invokeinterface #44,  1           // InterfaceMethod java/sql/PreparedStatement.close:()V
     375: aload         13
     377: athrow
     378: aload_2
     379: areturn
    Exception table:
       from    to  target type
         204   211   214   Class java/lang/Throwable
          46   194   236   Class java/lang/Throwable
          46   194   245   any
         257   264   267   Class java/lang/Throwable
         236   247   245   any
         298   304   307   Class java/lang/Throwable
          26   289   328   Class java/lang/Throwable
          26   289   337   any
         348   354   357   Class java/lang/Throwable
         328   339   337   any

  public java.lang.String getDisplayName();
    Code:
       0: ldc           #63                 // String GitHub configuration engine migration
       2: areturn
}
