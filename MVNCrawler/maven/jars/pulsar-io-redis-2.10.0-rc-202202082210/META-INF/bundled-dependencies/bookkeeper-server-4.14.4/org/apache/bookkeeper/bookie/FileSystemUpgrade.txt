Compiled from "FileSystemUpgrade.java"
public class org.apache.bookkeeper.bookie.FileSystemUpgrade {
  private static final org.slf4j.Logger LOG;

  static java.io.FilenameFilter bookieFilesFilter;

  public org.apache.bookkeeper.bookie.FileSystemUpgrade();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object."<init>":()V
       4: return

  private static java.util.List<java.io.File> getAllDirectories(org.apache.bookkeeper.conf.ServerConfiguration);
    Code:
       0: new           #2                  // class java/util/ArrayList
       3: dup
       4: invokespecial #3                  // Method java/util/ArrayList."<init>":()V
       7: astore_1
       8: aload_1
       9: aload_0
      10: invokevirtual #4                  // Method org/apache/bookkeeper/conf/ServerConfiguration.getJournalDirs:()[Ljava/io/File;
      13: invokestatic  #5                  // Method com/google/common/collect/Lists.newArrayList:([Ljava/lang/Object;)Ljava/util/ArrayList;
      16: invokeinterface #6,  2            // InterfaceMethod java/util/List.addAll:(Ljava/util/Collection;)Z
      21: pop
      22: aload_1
      23: aload_0
      24: invokevirtual #7                  // Method org/apache/bookkeeper/conf/ServerConfiguration.getLedgerDirs:()[Ljava/io/File;
      27: invokestatic  #8                  // Method java/util/Collections.addAll:(Ljava/util/Collection;[Ljava/lang/Object;)Z
      30: pop
      31: aload_1
      32: areturn

  private static int detectPreviousVersion(java.io.File) throws java.io.IOException;
    Code:
       0: aload_0
       1: getstatic     #9                  // Field bookieFilesFilter:Ljava/io/FilenameFilter;
       4: invokevirtual #10                 // Method java/io/File.list:(Ljava/io/FilenameFilter;)[Ljava/lang/String;
       7: astore_1
       8: new           #11                 // class java/io/File
      11: dup
      12: aload_0
      13: ldc           #13                 // String VERSION
      15: invokespecial #14                 // Method java/io/File."<init>":(Ljava/io/File;Ljava/lang/String;)V
      18: astore_2
      19: aload_1
      20: ifnull        28
      23: aload_1
      24: arraylength
      25: ifne          37
      28: aload_2
      29: invokevirtual #15                 // Method java/io/File.exists:()Z
      32: ifne          37
      35: iconst_4
      36: ireturn
      37: aload_2
      38: invokevirtual #15                 // Method java/io/File.exists:()Z
      41: ifne          46
      44: iconst_1
      45: ireturn
      46: new           #17                 // class java/util/Scanner
      49: dup
      50: aload_2
      51: getstatic     #18                 // Field java/nio/charset/StandardCharsets.UTF_8:Ljava/nio/charset/Charset;
      54: invokevirtual #19                 // Method java/nio/charset/Charset.name:()Ljava/lang/String;
      57: invokespecial #20                 // Method java/util/Scanner."<init>":(Ljava/io/File;Ljava/lang/String;)V
      60: astore_3
      61: aconst_null
      62: astore        4
      64: aload_3
      65: invokevirtual #21                 // Method java/util/Scanner.nextInt:()I
      68: istore        5
      70: aload_3
      71: ifnull        102
      74: aload         4
      76: ifnull        98
      79: aload_3
      80: invokevirtual #22                 // Method java/util/Scanner.close:()V
      83: goto          102
      86: astore        6
      88: aload         4
      90: aload         6
      92: invokevirtual #24                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
      95: goto          102
      98: aload_3
      99: invokevirtual #22                 // Method java/util/Scanner.close:()V
     102: iload         5
     104: ireturn
     105: astore        5
     107: aload         5
     109: astore        4
     111: aload         5
     113: athrow
     114: astore        7
     116: aload_3
     117: ifnull        148
     120: aload         4
     122: ifnull        144
     125: aload_3
     126: invokevirtual #22                 // Method java/util/Scanner.close:()V
     129: goto          148
     132: astore        8
     134: aload         4
     136: aload         8
     138: invokevirtual #24                 // Method java/lang/Throwable.addSuppressed:(Ljava/lang/Throwable;)V
     141: goto          148
     144: aload_3
     145: invokevirtual #22                 // Method java/util/Scanner.close:()V
     148: aload         7
     150: athrow
     151: astore_3
     152: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     155: new           #27                 // class java/lang/StringBuilder
     158: dup
     159: invokespecial #28                 // Method java/lang/StringBuilder."<init>":()V
     162: ldc           #29                 // String Couldn\'t parse version file
     164: invokevirtual #30                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     167: aload_2
     168: invokevirtual #31                 // Method java/lang/StringBuilder.append:(Ljava/lang/Object;)Ljava/lang/StringBuilder;
     171: invokevirtual #32                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     174: aload_3
     175: invokeinterface #33,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Throwable;)V
     180: new           #34                 // class java/io/IOException
     183: dup
     184: ldc           #35                 // String Couldn\'t parse version file
     186: aload_3
     187: invokespecial #36                 // Method java/io/IOException."<init>":(Ljava/lang/String;Ljava/lang/Throwable;)V
     190: athrow
     191: astore_3
     192: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     195: new           #27                 // class java/lang/StringBuilder
     198: dup
     199: invokespecial #28                 // Method java/lang/StringBuilder."<init>":()V
     202: ldc           #38                 // String Error reading file
     204: invokevirtual #30                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     207: aload_2
     208: invokevirtual #31                 // Method java/lang/StringBuilder.append:(Ljava/lang/Object;)Ljava/lang/StringBuilder;
     211: invokevirtual #32                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     214: aload_3
     215: invokeinterface #33,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Throwable;)V
     220: new           #34                 // class java/io/IOException
     223: dup
     224: ldc           #39                 // String Error reading version file
     226: aload_3
     227: invokespecial #36                 // Method java/io/IOException."<init>":(Ljava/lang/String;Ljava/lang/Throwable;)V
     230: athrow
    Exception table:
       from    to  target type
          79    83    86   Class java/lang/Throwable
          64    70   105   Class java/lang/Throwable
          64    70   114   any
         125   129   132   Class java/lang/Throwable
         105   116   114   any
          46   102   151   Class java/util/NoSuchElementException
         105   151   151   Class java/util/NoSuchElementException
          46   102   191   Class java/lang/IllegalStateException
         105   151   191   Class java/lang/IllegalStateException

  private static void linkIndexDirectories(java.io.File, java.io.File) throws java.io.IOException;
    Code:
       0: aload_0
       1: invokevirtual #40                 // Method java/io/File.list:()[Ljava/lang/String;
       4: astore_2
       5: aload_2
       6: ifnonnull     10
       9: return
      10: aload_2
      11: astore_3
      12: aload_3
      13: arraylength
      14: istore        4
      16: iconst_0
      17: istore        5
      19: iload         5
      21: iload         4
      23: if_icmpge     142
      26: aload_3
      27: iload         5
      29: aaload
      30: astore        6
      32: aload         6
      34: ldc           #41                 // String .idx
      36: invokevirtual #42                 // Method java/lang/String.endsWith:(Ljava/lang/String;)Z
      39: ifeq          88
      42: aload_1
      43: invokevirtual #43                 // Method java/io/File.mkdirs:()Z
      46: ifne          81
      49: new           #34                 // class java/io/IOException
      52: dup
      53: new           #27                 // class java/lang/StringBuilder
      56: dup
      57: invokespecial #28                 // Method java/lang/StringBuilder."<init>":()V
      60: ldc           #44                 // String Could not create target path [
      62: invokevirtual #30                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      65: aload_1
      66: invokevirtual #31                 // Method java/lang/StringBuilder.append:(Ljava/lang/Object;)Ljava/lang/StringBuilder;
      69: ldc           #45                 // String ]
      71: invokevirtual #30                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      74: invokevirtual #32                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      77: invokespecial #46                 // Method java/io/IOException."<init>":(Ljava/lang/String;)V
      80: athrow
      81: aload_0
      82: aload_2
      83: aload_1
      84: invokestatic  #47                 // Method org/apache/bookkeeper/util/HardLink.createHardLinkMult:(Ljava/io/File;[Ljava/lang/String;Ljava/io/File;)V
      87: return
      88: new           #11                 // class java/io/File
      91: dup
      92: aload_0
      93: aload         6
      95: invokespecial #14                 // Method java/io/File."<init>":(Ljava/io/File;Ljava/lang/String;)V
      98: astore        7
     100: aload         7
     102: invokevirtual #48                 // Method java/io/File.isDirectory:()Z
     105: ifeq          136
     108: aload         6
     110: bipush        16
     112: invokestatic  #49                 // Method java/lang/Long.parseLong:(Ljava/lang/String;I)J
     115: pop2
     116: aload         7
     118: new           #11                 // class java/io/File
     121: dup
     122: aload_1
     123: aload         6
     125: invokespecial #14                 // Method java/io/File."<init>":(Ljava/io/File;Ljava/lang/String;)V
     128: invokestatic  #50                 // Method linkIndexDirectories:(Ljava/io/File;Ljava/io/File;)V
     131: goto          136
     134: astore        8
     136: iinc          5, 1
     139: goto          19
     142: return
    Exception table:
       from    to  target type
         108   131   134   Class java/lang/NumberFormatException

  public static void upgrade(org.apache.bookkeeper.conf.ServerConfiguration) throws org.apache.bookkeeper.bookie.BookieException$UpgradeException, java.lang.InterruptedException;
    Code:
       0: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
       3: ldc           #52                 // String Upgrading...
       5: invokeinterface #53,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
      10: aload_0
      11: aload_0
      12: invokedynamic #54,  0             // InvokeDynamic #0:apply:(Lorg/apache/bookkeeper/conf/ServerConfiguration;)Ljava/util/function/Function;
      17: invokestatic  #55                 // Method org/apache/bookkeeper/meta/MetadataDrivers.runFunctionWithRegistrationManager:(Lorg/apache/bookkeeper/conf/ServerConfiguration;Ljava/util/function/Function;)Ljava/lang/Object;
      20: pop
      21: goto          47
      24: astore_1
      25: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
      28: dup
      29: aload_1
      30: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
      33: athrow
      34: astore_1
      35: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
      38: dup
      39: aload_1
      40: invokevirtual #60                 // Method java/util/concurrent/ExecutionException.getCause:()Ljava/lang/Throwable;
      43: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
      46: athrow
      47: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
      50: ldc           #61                 // String Done
      52: invokeinterface #53,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
      57: return
    Exception table:
       from    to  target type
          10    21    24   Class org/apache/bookkeeper/meta/exceptions/MetadataException
          10    21    34   Class java/util/concurrent/ExecutionException

  private static void upgrade(org.apache.bookkeeper.conf.ServerConfiguration, org.apache.bookkeeper.discover.RegistrationManager) throws org.apache.bookkeeper.bookie.BookieException$UpgradeException;
    Code:
       0: new           #62                 // class java/util/HashMap
       3: dup
       4: invokespecial #63                 // Method java/util/HashMap."<init>":()V
       7: astore_2
       8: aload_0
       9: invokestatic  #64                 // Method org/apache/bookkeeper/bookie/Cookie.generateCookie:(Lorg/apache/bookkeeper/conf/ServerConfiguration;)Lorg/apache/bookkeeper/bookie/Cookie$Builder;
      12: astore_3
      13: aload_3
      14: invokevirtual #65                 // Method org/apache/bookkeeper/bookie/Cookie$Builder.build:()Lorg/apache/bookkeeper/bookie/Cookie;
      17: astore        4
      19: aload_0
      20: invokestatic  #66                 // Method getAllDirectories:(Lorg/apache/bookkeeper/conf/ServerConfiguration;)Ljava/util/List;
      23: invokeinterface #67,  1           // InterfaceMethod java/util/List.iterator:()Ljava/util/Iterator;
      28: astore        5
      30: aload         5
      32: invokeinterface #68,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
      37: ifeq          249
      40: aload         5
      42: invokeinterface #69,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      47: checkcast     #11                 // class java/io/File
      50: astore        6
      52: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
      55: ldc           #70                 // String Upgrading {}
      57: aload         6
      59: invokeinterface #71,  3           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;Ljava/lang/Object;)V
      64: aload         6
      66: invokestatic  #72                 // Method detectPreviousVersion:(Ljava/io/File;)I
      69: istore        7
      71: iload         7
      73: iconst_4
      74: if_icmpne     90
      77: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
      80: ldc           #73                 // String Directory is current, no need to upgrade
      82: invokeinterface #53,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
      87: goto          30
      90: new           #11                 // class java/io/File
      93: dup
      94: aload         6
      96: ldc           #74                 // String current
      98: invokespecial #14                 // Method java/io/File."<init>":(Ljava/io/File;Ljava/lang/String;)V
     101: astore        8
     103: new           #11                 // class java/io/File
     106: dup
     107: aload         6
     109: new           #27                 // class java/lang/StringBuilder
     112: dup
     113: invokespecial #28                 // Method java/lang/StringBuilder."<init>":()V
     116: ldc           #75                 // String upgradeTmp.
     118: invokevirtual #30                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     121: invokestatic  #76                 // Method java/lang/System.nanoTime:()J
     124: invokevirtual #77                 // Method java/lang/StringBuilder.append:(J)Ljava/lang/StringBuilder;
     127: invokevirtual #32                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     130: invokespecial #14                 // Method java/io/File."<init>":(Ljava/io/File;Ljava/lang/String;)V
     133: astore        9
     135: aload_2
     136: aload         8
     138: aload         9
     140: invokeinterface #78,  3           // InterfaceMethod java/util/Map.put:(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
     145: pop
     146: aload         9
     148: invokevirtual #43                 // Method java/io/File.mkdirs:()Z
     151: ifne          182
     154: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
     157: dup
     158: new           #27                 // class java/lang/StringBuilder
     161: dup
     162: invokespecial #28                 // Method java/lang/StringBuilder."<init>":()V
     165: ldc           #79                 // String Could not create temporary directory
     167: invokevirtual #30                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     170: aload         9
     172: invokevirtual #31                 // Method java/lang/StringBuilder.append:(Ljava/lang/Object;)Ljava/lang/StringBuilder;
     175: invokevirtual #32                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     178: invokespecial #80                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/String;)V
     181: athrow
     182: aload         4
     184: aload         9
     186: invokevirtual #81                 // Method org/apache/bookkeeper/bookie/Cookie.writeToDirectory:(Ljava/io/File;)V
     189: aload         6
     191: new           #82                 // class org/apache/bookkeeper/bookie/FileSystemUpgrade$2
     194: dup
     195: invokespecial #83                 // Method org/apache/bookkeeper/bookie/FileSystemUpgrade$2."<init>":()V
     198: invokevirtual #10                 // Method java/io/File.list:(Ljava/io/FilenameFilter;)[Ljava/lang/String;
     201: astore        10
     203: aload         6
     205: aload         10
     207: aload         9
     209: invokestatic  #47                 // Method org/apache/bookkeeper/util/HardLink.createHardLinkMult:(Ljava/io/File;[Ljava/lang/String;Ljava/io/File;)V
     212: aload         6
     214: aload         9
     216: invokestatic  #50                 // Method linkIndexDirectories:(Ljava/io/File;Ljava/io/File;)V
     219: goto          246
     222: astore        8
     224: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     227: ldc           #84                 // String Error upgrading {}
     229: aload         6
     231: invokeinterface #85,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Object;)V
     236: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
     239: dup
     240: aload         8
     242: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
     245: athrow
     246: goto          30
     249: aload_2
     250: invokeinterface #86,  1           // InterfaceMethod java/util/Map.entrySet:()Ljava/util/Set;
     255: invokeinterface #87,  1           // InterfaceMethod java/util/Set.iterator:()Ljava/util/Iterator;
     260: astore        5
     262: aload         5
     264: invokeinterface #68,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
     269: ifeq          368
     272: aload         5
     274: invokeinterface #69,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
     279: checkcast     #88                 // class java/util/Map$Entry
     282: astore        6
     284: aload         6
     286: invokeinterface #89,  1           // InterfaceMethod java/util/Map$Entry.getValue:()Ljava/lang/Object;
     291: checkcast     #11                 // class java/io/File
     294: aload         6
     296: invokeinterface #90,  1           // InterfaceMethod java/util/Map$Entry.getKey:()Ljava/lang/Object;
     301: checkcast     #11                 // class java/io/File
     304: invokestatic  #91                 // Method org/apache/commons/io/FileUtils.moveDirectory:(Ljava/io/File;Ljava/io/File;)V
     307: goto          365
     310: astore        7
     312: ldc           #92                 // String Error moving upgraded directories into place %s -> %s
     314: iconst_2
     315: anewarray     #93                 // class java/lang/Object
     318: dup
     319: iconst_0
     320: aload         6
     322: invokeinterface #89,  1           // InterfaceMethod java/util/Map$Entry.getValue:()Ljava/lang/Object;
     327: aastore
     328: dup
     329: iconst_1
     330: aload         6
     332: invokeinterface #90,  1           // InterfaceMethod java/util/Map$Entry.getKey:()Ljava/lang/Object;
     337: aastore
     338: invokestatic  #94                 // Method java/lang/String.format:(Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;
     341: astore        8
     343: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     346: aload         8
     348: aload         7
     350: invokeinterface #33,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Throwable;)V
     355: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
     358: dup
     359: aload         7
     361: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
     364: athrow
     365: goto          262
     368: aload_2
     369: invokeinterface #95,  1           // InterfaceMethod java/util/Map.isEmpty:()Z
     374: ifeq          378
     377: return
     378: aload         4
     380: aload_1
     381: aload_0
     382: getstatic     #96                 // Field org/apache/bookkeeper/versioning/Version.NEW:Lorg/apache/bookkeeper/versioning/Version;
     385: invokevirtual #97                 // Method org/apache/bookkeeper/bookie/Cookie.writeToRegistrationManager:(Lorg/apache/bookkeeper/discover/RegistrationManager;Lorg/apache/bookkeeper/conf/ServerConfiguration;Lorg/apache/bookkeeper/versioning/Version;)V
     388: goto          413
     391: astore        5
     393: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     396: ldc           #99                 // String Error writing cookie to registration manager
     398: invokeinterface #100,  2          // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     403: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
     406: dup
     407: aload         5
     409: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
     412: athrow
     413: goto          426
     416: astore_2
     417: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
     420: dup
     421: aload_2
     422: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
     425: athrow
     426: return
    Exception table:
       from    to  target type
          90   219   222   Class java/io/IOException
         284   307   310   Class java/io/IOException
         378   388   391   Class org/apache/bookkeeper/bookie/BookieException
           0   377   416   Class java/io/IOException
         378   413   416   Class java/io/IOException

  public static void finalizeUpgrade(org.apache.bookkeeper.conf.ServerConfiguration) throws org.apache.bookkeeper.bookie.BookieException$UpgradeException, java.lang.InterruptedException;
    Code:
       0: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
       3: ldc           #101                // String Finalizing upgrade...
       5: invokeinterface #53,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
      10: aload_0
      11: invokestatic  #66                 // Method getAllDirectories:(Lorg/apache/bookkeeper/conf/ServerConfiguration;)Ljava/util/List;
      14: invokeinterface #67,  1           // InterfaceMethod java/util/List.iterator:()Ljava/util/Iterator;
      19: astore_1
      20: aload_1
      21: invokeinterface #68,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
      26: ifeq          206
      29: aload_1
      30: invokeinterface #69,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      35: checkcast     #11                 // class java/io/File
      38: astore_2
      39: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
      42: ldc           #102                // String Finalizing {}
      44: aload_2
      45: invokeinterface #71,  3           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;Ljava/lang/Object;)V
      50: aload_2
      51: invokestatic  #72                 // Method detectPreviousVersion:(Ljava/io/File;)I
      54: istore_3
      55: iload_3
      56: iconst_3
      57: if_icmpge     179
      60: iload_3
      61: iconst_2
      62: if_icmpne     97
      65: new           #11                 // class java/io/File
      68: dup
      69: aload_2
      70: ldc           #13                 // String VERSION
      72: invokespecial #14                 // Method java/io/File."<init>":(Ljava/io/File;Ljava/lang/String;)V
      75: astore        4
      77: aload         4
      79: invokevirtual #103                // Method java/io/File.delete:()Z
      82: ifne          97
      85: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
      88: ldc           #104                // String Could not delete old version file {}
      90: aload         4
      92: invokeinterface #105,  3          // InterfaceMethod org/slf4j/Logger.warn:(Ljava/lang/String;Ljava/lang/Object;)V
      97: aload_2
      98: getstatic     #9                  // Field bookieFilesFilter:Ljava/io/FilenameFilter;
     101: invokevirtual #106                // Method java/io/File.listFiles:(Ljava/io/FilenameFilter;)[Ljava/io/File;
     104: astore        4
     106: aload         4
     108: ifnull        179
     111: aload         4
     113: astore        5
     115: aload         5
     117: arraylength
     118: istore        6
     120: iconst_0
     121: istore        7
     123: iload         7
     125: iload         6
     127: if_icmpge     179
     130: aload         5
     132: iload         7
     134: aaload
     135: astore        8
     137: aload         8
     139: invokevirtual #48                 // Method java/io/File.isDirectory:()Z
     142: ifeq          153
     145: aload         8
     147: invokestatic  #107                // Method org/apache/commons/io/FileUtils.deleteDirectory:(Ljava/io/File;)V
     150: goto          173
     153: aload         8
     155: invokevirtual #103                // Method java/io/File.delete:()Z
     158: ifne          173
     161: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     164: ldc           #108                // String Could not delete {}
     166: aload         8
     168: invokeinterface #105,  3          // InterfaceMethod org/slf4j/Logger.warn:(Ljava/lang/String;Ljava/lang/Object;)V
     173: iinc          7, 1
     176: goto          123
     179: goto          203
     182: astore_3
     183: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     186: ldc           #109                // String Error finalizing {}
     188: aload_2
     189: invokeinterface #85,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Object;)V
     194: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
     197: dup
     198: aload_3
     199: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
     202: athrow
     203: goto          20
     206: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     209: ldc           #61                 // String Done
     211: invokeinterface #53,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
     216: return
    Exception table:
       from    to  target type
          50   179   182   Class java/io/IOException

  public static void rollback(org.apache.bookkeeper.conf.ServerConfiguration) throws org.apache.bookkeeper.bookie.BookieException$UpgradeException, java.lang.InterruptedException;
    Code:
       0: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
       3: ldc           #110                // String Rolling back upgrade...
       5: invokeinterface #53,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
      10: aload_0
      11: aload_0
      12: invokedynamic #111,  0            // InvokeDynamic #1:apply:(Lorg/apache/bookkeeper/conf/ServerConfiguration;)Ljava/util/function/Function;
      17: invokestatic  #55                 // Method org/apache/bookkeeper/meta/MetadataDrivers.runFunctionWithRegistrationManager:(Lorg/apache/bookkeeper/conf/ServerConfiguration;Ljava/util/function/Function;)Ljava/lang/Object;
      20: pop
      21: goto          47
      24: astore_1
      25: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
      28: dup
      29: aload_1
      30: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
      33: athrow
      34: astore_1
      35: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
      38: dup
      39: aload_1
      40: invokevirtual #60                 // Method java/util/concurrent/ExecutionException.getCause:()Ljava/lang/Throwable;
      43: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
      46: athrow
      47: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
      50: ldc           #61                 // String Done
      52: invokeinterface #53,  2           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;)V
      57: return
    Exception table:
       from    to  target type
          10    21    24   Class org/apache/bookkeeper/meta/exceptions/MetadataException
          10    21    34   Class java/util/concurrent/ExecutionException

  private static void rollback(org.apache.bookkeeper.conf.ServerConfiguration, org.apache.bookkeeper.discover.RegistrationManager) throws org.apache.bookkeeper.bookie.BookieException$UpgradeException;
    Code:
       0: aload_0
       1: invokestatic  #66                 // Method getAllDirectories:(Lorg/apache/bookkeeper/conf/ServerConfiguration;)Ljava/util/List;
       4: invokeinterface #67,  1           // InterfaceMethod java/util/List.iterator:()Ljava/util/Iterator;
       9: astore_2
      10: aload_2
      11: invokeinterface #68,  1           // InterfaceMethod java/util/Iterator.hasNext:()Z
      16: ifeq          111
      19: aload_2
      20: invokeinterface #69,  1           // InterfaceMethod java/util/Iterator.next:()Ljava/lang/Object;
      25: checkcast     #11                 // class java/io/File
      28: astore_3
      29: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
      32: ldc           #112                // String Rolling back {}
      34: aload_3
      35: invokeinterface #71,  3           // InterfaceMethod org/slf4j/Logger.info:(Ljava/lang/String;Ljava/lang/Object;)V
      40: aload_3
      41: invokestatic  #72                 // Method detectPreviousVersion:(Ljava/io/File;)I
      44: istore        4
      46: iload         4
      48: iconst_4
      49: if_icmpgt     72
      52: new           #11                 // class java/io/File
      55: dup
      56: aload_3
      57: ldc           #74                 // String current
      59: invokespecial #14                 // Method java/io/File."<init>":(Ljava/io/File;Ljava/lang/String;)V
      62: astore        5
      64: aload         5
      66: invokestatic  #107                // Method org/apache/commons/io/FileUtils.deleteDirectory:(Ljava/io/File;)V
      69: goto          82
      72: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
      75: dup
      76: ldc           #113                // String Cannot rollback as previous data does not exist
      78: invokespecial #80                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/String;)V
      81: athrow
      82: goto          108
      85: astore        4
      87: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
      90: ldc           #114                // String Error rolling back {}
      92: aload_3
      93: invokeinterface #85,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Object;)V
      98: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
     101: dup
     102: aload         4
     104: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
     107: athrow
     108: goto          10
     111: aload_1
     112: aload_0
     113: invokestatic  #115                // Method org/apache/bookkeeper/bookie/Cookie.readFromRegistrationManager:(Lorg/apache/bookkeeper/discover/RegistrationManager;Lorg/apache/bookkeeper/conf/ServerConfiguration;)Lorg/apache/bookkeeper/versioning/Versioned;
     116: astore_2
     117: aload_2
     118: invokevirtual #116                // Method org/apache/bookkeeper/versioning/Versioned.getValue:()Ljava/lang/Object;
     121: checkcast     #16                 // class org/apache/bookkeeper/bookie/Cookie
     124: aload_1
     125: aload_0
     126: aload_2
     127: invokevirtual #117                // Method org/apache/bookkeeper/versioning/Versioned.getVersion:()Lorg/apache/bookkeeper/versioning/Version;
     130: invokevirtual #118                // Method org/apache/bookkeeper/bookie/Cookie.deleteFromRegistrationManager:(Lorg/apache/bookkeeper/discover/RegistrationManager;Lorg/apache/bookkeeper/conf/ServerConfiguration;Lorg/apache/bookkeeper/versioning/Version;)V
     133: goto          156
     136: astore_2
     137: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     140: ldc           #119                // String Error deleting cookie from Registration Manager
     142: invokeinterface #100,  2          // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     147: new           #57                 // class org/apache/bookkeeper/bookie/BookieException$UpgradeException
     150: dup
     151: aload_2
     152: invokespecial #58                 // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException."<init>":(Ljava/lang/Throwable;)V
     155: athrow
     156: return
    Exception table:
       from    to  target type
          40    82    85   Class java/io/IOException
         111   133   136   Class org/apache/bookkeeper/bookie/BookieException

  private static void printHelp(org.apache.commons.cli.Options);
    Code:
       0: new           #120                // class org/apache/commons/cli/HelpFormatter
       3: dup
       4: invokespecial #121                // Method org/apache/commons/cli/HelpFormatter."<init>":()V
       7: astore_1
       8: aload_1
       9: ldc           #122                // String FileSystemUpgrade [options]
      11: aload_0
      12: invokevirtual #123                // Method org/apache/commons/cli/HelpFormatter.printHelp:(Ljava/lang/String;Lorg/apache/commons/cli/Options;)V
      15: return

  public static void main(java.lang.String[]) throws java.lang.Exception;
    Code:
       0: invokestatic  #124                // Method org/apache/log4j/Logger.getRootLogger:()Lorg/apache/log4j/Logger;
       3: astore_1
       4: aload_1
       5: new           #125                // class org/apache/log4j/ConsoleAppender
       8: dup
       9: new           #126                // class org/apache/log4j/PatternLayout
      12: dup
      13: ldc           #127                // String %-5p [%t]: %m%n
      15: invokespecial #128                // Method org/apache/log4j/PatternLayout."<init>":(Ljava/lang/String;)V
      18: invokespecial #129                // Method org/apache/log4j/ConsoleAppender."<init>":(Lorg/apache/log4j/Layout;)V
      21: invokevirtual #130                // Method org/apache/log4j/Logger.addAppender:(Lorg/apache/log4j/Appender;)V
      24: aload_1
      25: getstatic     #131                // Field org/apache/log4j/Level.ERROR:Lorg/apache/log4j/Level;
      28: invokevirtual #132                // Method org/apache/log4j/Logger.setLevel:(Lorg/apache/log4j/Level;)V
      31: ldc           #133                // class org/apache/bookkeeper/bookie/FileSystemUpgrade
      33: invokestatic  #134                // Method org/apache/log4j/Logger.getLogger:(Ljava/lang/Class;)Lorg/apache/log4j/Logger;
      36: getstatic     #135                // Field org/apache/log4j/Level.INFO:Lorg/apache/log4j/Level;
      39: invokevirtual #132                // Method org/apache/log4j/Logger.setLevel:(Lorg/apache/log4j/Level;)V
      42: new           #136                // class org/apache/commons/cli/Options
      45: dup
      46: invokespecial #137                // Method org/apache/commons/cli/Options."<init>":()V
      49: astore_2
      50: aload_2
      51: ldc           #138                // String c
      53: ldc           #139                // String conf
      55: iconst_1
      56: ldc           #140                // String Configuration for Bookie
      58: invokevirtual #141                // Method org/apache/commons/cli/Options.addOption:(Ljava/lang/String;Ljava/lang/String;ZLjava/lang/String;)Lorg/apache/commons/cli/Options;
      61: pop
      62: aload_2
      63: ldc           #142                // String u
      65: ldc           #143                // String upgrade
      67: iconst_0
      68: ldc           #144                // String Upgrade bookie directories
      70: invokevirtual #141                // Method org/apache/commons/cli/Options.addOption:(Ljava/lang/String;Ljava/lang/String;ZLjava/lang/String;)Lorg/apache/commons/cli/Options;
      73: pop
      74: aload_2
      75: ldc           #145                // String f
      77: ldc           #146                // String finalize
      79: iconst_0
      80: ldc           #147                // String Finalize upgrade
      82: invokevirtual #141                // Method org/apache/commons/cli/Options.addOption:(Ljava/lang/String;Ljava/lang/String;ZLjava/lang/String;)Lorg/apache/commons/cli/Options;
      85: pop
      86: aload_2
      87: ldc           #148                // String r
      89: ldc           #149                // String rollback
      91: iconst_0
      92: ldc           #150                // String Rollback upgrade
      94: invokevirtual #141                // Method org/apache/commons/cli/Options.addOption:(Ljava/lang/String;Ljava/lang/String;ZLjava/lang/String;)Lorg/apache/commons/cli/Options;
      97: pop
      98: aload_2
      99: ldc           #151                // String h
     101: ldc           #152                // String help
     103: iconst_0
     104: ldc           #153                // String Print help message
     106: invokevirtual #141                // Method org/apache/commons/cli/Options.addOption:(Ljava/lang/String;Ljava/lang/String;ZLjava/lang/String;)Lorg/apache/commons/cli/Options;
     109: pop
     110: new           #154                // class org/apache/commons/cli/BasicParser
     113: dup
     114: invokespecial #155                // Method org/apache/commons/cli/BasicParser."<init>":()V
     117: astore_3
     118: aload_3
     119: aload_2
     120: aload_0
     121: invokevirtual #156                // Method org/apache/commons/cli/BasicParser.parse:(Lorg/apache/commons/cli/Options;[Ljava/lang/String;)Lorg/apache/commons/cli/CommandLine;
     124: astore        4
     126: aload         4
     128: ldc           #151                // String h
     130: invokevirtual #157                // Method org/apache/commons/cli/CommandLine.hasOption:(Ljava/lang/String;)Z
     133: ifeq          141
     136: aload_2
     137: invokestatic  #158                // Method printHelp:(Lorg/apache/commons/cli/Options;)V
     140: return
     141: aload         4
     143: ldc           #138                // String c
     145: invokevirtual #157                // Method org/apache/commons/cli/CommandLine.hasOption:(Ljava/lang/String;)Z
     148: ifne          179
     151: ldc           #159                // String Cannot upgrade without configuration
     153: astore        5
     155: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     158: aload         5
     160: invokeinterface #100,  2          // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     165: aload_2
     166: invokestatic  #158                // Method printHelp:(Lorg/apache/commons/cli/Options;)V
     169: new           #160                // class java/lang/IllegalArgumentException
     172: dup
     173: aload         5
     175: invokespecial #161                // Method java/lang/IllegalArgumentException."<init>":(Ljava/lang/String;)V
     178: athrow
     179: aload         4
     181: ldc           #138                // String c
     183: invokevirtual #162                // Method org/apache/commons/cli/CommandLine.getOptionValue:(Ljava/lang/String;)Ljava/lang/String;
     186: astore        5
     188: new           #163                // class org/apache/bookkeeper/conf/ServerConfiguration
     191: dup
     192: invokespecial #164                // Method org/apache/bookkeeper/conf/ServerConfiguration."<init>":()V
     195: astore        6
     197: aload         6
     199: new           #11                 // class java/io/File
     202: dup
     203: aload         5
     205: invokespecial #165                // Method java/io/File."<init>":(Ljava/lang/String;)V
     208: invokevirtual #166                // Method java/io/File.toURI:()Ljava/net/URI;
     211: invokevirtual #167                // Method java/net/URI.toURL:()Ljava/net/URL;
     214: invokevirtual #168                // Method org/apache/bookkeeper/conf/ServerConfiguration.loadConf:(Ljava/net/URL;)V
     217: goto          300
     220: astore        7
     222: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     225: new           #27                 // class java/lang/StringBuilder
     228: dup
     229: invokespecial #28                 // Method java/lang/StringBuilder."<init>":()V
     232: ldc           #170                // String Could not open configuration file
     234: invokevirtual #30                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     237: aload         5
     239: invokevirtual #30                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     242: invokevirtual #32                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     245: aload         7
     247: invokeinterface #33,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Throwable;)V
     252: new           #160                // class java/lang/IllegalArgumentException
     255: dup
     256: invokespecial #171                // Method java/lang/IllegalArgumentException."<init>":()V
     259: athrow
     260: astore        7
     262: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     265: new           #27                 // class java/lang/StringBuilder
     268: dup
     269: invokespecial #28                 // Method java/lang/StringBuilder."<init>":()V
     272: ldc           #173                // String Invalid configuration file
     274: invokevirtual #30                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     277: aload         5
     279: invokevirtual #30                 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     282: invokevirtual #32                 // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
     285: aload         7
     287: invokeinterface #33,  3           // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;Ljava/lang/Throwable;)V
     292: new           #160                // class java/lang/IllegalArgumentException
     295: dup
     296: invokespecial #171                // Method java/lang/IllegalArgumentException."<init>":()V
     299: athrow
     300: aload         4
     302: ldc           #142                // String u
     304: invokevirtual #157                // Method org/apache/commons/cli/CommandLine.hasOption:(Ljava/lang/String;)Z
     307: ifeq          318
     310: aload         6
     312: invokestatic  #174                // Method upgrade:(Lorg/apache/bookkeeper/conf/ServerConfiguration;)V
     315: goto          382
     318: aload         4
     320: ldc           #148                // String r
     322: invokevirtual #157                // Method org/apache/commons/cli/CommandLine.hasOption:(Ljava/lang/String;)Z
     325: ifeq          336
     328: aload         6
     330: invokestatic  #175                // Method rollback:(Lorg/apache/bookkeeper/conf/ServerConfiguration;)V
     333: goto          382
     336: aload         4
     338: ldc           #145                // String f
     340: invokevirtual #157                // Method org/apache/commons/cli/CommandLine.hasOption:(Ljava/lang/String;)Z
     343: ifeq          354
     346: aload         6
     348: invokestatic  #176                // Method finalizeUpgrade:(Lorg/apache/bookkeeper/conf/ServerConfiguration;)V
     351: goto          382
     354: ldc           #177                // String Must specify -upgrade, -finalize or -rollback
     356: astore        7
     358: getstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
     361: aload         7
     363: invokeinterface #100,  2          // InterfaceMethod org/slf4j/Logger.error:(Ljava/lang/String;)V
     368: aload_2
     369: invokestatic  #158                // Method printHelp:(Lorg/apache/commons/cli/Options;)V
     372: new           #160                // class java/lang/IllegalArgumentException
     375: dup
     376: aload         7
     378: invokespecial #161                // Method java/lang/IllegalArgumentException."<init>":(Ljava/lang/String;)V
     381: athrow
     382: return
    Exception table:
       from    to  target type
         197   217   220   Class java/net/MalformedURLException
         197   217   260   Class org/apache/commons/configuration/ConfigurationException

  private static java.lang.Object lambda$rollback$1(org.apache.bookkeeper.conf.ServerConfiguration, org.apache.bookkeeper.discover.RegistrationManager);
    Code:
       0: aload_0
       1: aload_1
       2: invokestatic  #178                // Method rollback:(Lorg/apache/bookkeeper/conf/ServerConfiguration;Lorg/apache/bookkeeper/discover/RegistrationManager;)V
       5: goto          22
       8: astore_2
       9: new           #179                // class com/google/common/util/concurrent/UncheckedExecutionException
      12: dup
      13: aload_2
      14: invokevirtual #180                // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException.getMessage:()Ljava/lang/String;
      17: aload_2
      18: invokespecial #181                // Method com/google/common/util/concurrent/UncheckedExecutionException."<init>":(Ljava/lang/String;Ljava/lang/Throwable;)V
      21: athrow
      22: aconst_null
      23: areturn
    Exception table:
       from    to  target type
           0     5     8   Class org/apache/bookkeeper/bookie/BookieException$UpgradeException

  private static java.lang.Object lambda$upgrade$0(org.apache.bookkeeper.conf.ServerConfiguration, org.apache.bookkeeper.discover.RegistrationManager);
    Code:
       0: aload_0
       1: aload_1
       2: invokestatic  #182                // Method upgrade:(Lorg/apache/bookkeeper/conf/ServerConfiguration;Lorg/apache/bookkeeper/discover/RegistrationManager;)V
       5: goto          22
       8: astore_2
       9: new           #179                // class com/google/common/util/concurrent/UncheckedExecutionException
      12: dup
      13: aload_2
      14: invokevirtual #180                // Method org/apache/bookkeeper/bookie/BookieException$UpgradeException.getMessage:()Ljava/lang/String;
      17: aload_2
      18: invokespecial #181                // Method com/google/common/util/concurrent/UncheckedExecutionException."<init>":(Ljava/lang/String;Ljava/lang/Throwable;)V
      21: athrow
      22: aconst_null
      23: areturn
    Exception table:
       from    to  target type
           0     5     8   Class org/apache/bookkeeper/bookie/BookieException$UpgradeException

  static {};
    Code:
       0: ldc           #133                // class org/apache/bookkeeper/bookie/FileSystemUpgrade
       2: invokestatic  #183                // Method org/slf4j/LoggerFactory.getLogger:(Ljava/lang/Class;)Lorg/slf4j/Logger;
       5: putstatic     #26                 // Field LOG:Lorg/slf4j/Logger;
       8: new           #184                // class org/apache/bookkeeper/bookie/FileSystemUpgrade$1
      11: dup
      12: invokespecial #185                // Method org/apache/bookkeeper/bookie/FileSystemUpgrade$1."<init>":()V
      15: putstatic     #9                  // Field bookieFilesFilter:Ljava/io/FilenameFilter;
      18: return
}
